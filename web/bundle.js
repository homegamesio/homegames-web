(()=>{var t={6874:t=>{t.exports={name:"DUALSHOCK 4 Wireless Controller",buttons:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SELECT:8,START:9,STICK_CLICK_1:10,STICK_CLICK_2:11,DIRECTION_UP:12,DIRECTION_DOWN:13,DIRECTION_LEFT:14,DIRECTION_RIGHT:15,HOME:16},sticks:{STICK_1_X:0,STICK_1_Y:1,STICK_2_X:2,STICK_2_Y:3},deadzones:{STICK_1_X:.08,STICK_1_Y:.08,STICK_2_X:.08,STICK_2_Y:.08}}},9645:(t,e,s)=>{const{Buttons:n,Sticks:o}=s(9945),r=s(642),i=t=>{for(let e in r){const s=r[e];if(t.indexOf(s.name)>=0)return s}return null},h=(t,e,s)=>({value:t[e.buttons[s]]&&t[e.buttons[s]].value,pressed:!(!t[e.buttons[s]]||!t[e.buttons[s]].pressed)}),a=(t,e,s)=>{const n=t[e.sticks[s]];if(e.deadzones&&e.deadzones[s]){const t=e.deadzones[s];return Math.abs(n)<t?{value:0}:n<0?{value:(n+t)/(1-t)}:{value:(n-t)/(1-t)}}return{value:n}};t.exports={Homepad:class{constructor(){if(!window)throw new Error("No window available");this.indexToMapping={},this.initializeListeners()}initializeListeners(){window.addEventListener("gamepadconnected",(t=>{const e=t.gamepad,s=i(e.id);s&&(this.indexToMapping[e.index]=s)})),window.addEventListener("gamepaddisconnected",(t=>{delete this.indexToMapping[gamepad.index]}))}getGamepadState(t){const e=navigator.getGamepads()[t],s=this.indexToMapping[t],n=((t,e)=>{const s={};for(let n in e.buttons)s[n]=h(t,e,n);return s})(e.buttons,s),o=((t,e)=>{const s={};for(let n in e.sticks)s[n]=a(t,e,n);return s})(e.axes,s);return{buttons:n,sticks:o}}getGamepads(){if(!navigator||!navigator.getGamepads)throw new Error("No gamepad API available");return navigator.getGamepads().filter((t=>t)).map((t=>({index:t.index,mapping:i(t.id)}))).filter((t=>!!t.mapping)).map((t=>({state:this.getGamepadState(t.index),...t})))}},Buttons:n,Sticks:o}},9945:()=>{},642:(t,e,s)=>{const n=s(6874);t.exports={DUALSHOCK_4:n}},6277:(t,e,s)=>{const{squish:n,unsquish:o}=s(1461),{gameNode:r,GameNode:i}=s(3056),h=(s(2509),s(5569)),a=s(586),l=s(4466),d=s(9056),c=s(2453),u=s(3475),{terrainGenerator:f}=s(2814),y=s(1584),p=s(9357),g=s(6085),x=s(5883),E=s(8506);t.exports={squish:n,unsquish:o,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:d,Squisher:p,ShapeUtils:c,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},6085:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(3741),this.http=s(871),this.fs=s(3991),this.crypto=s(3896),this.path=s(1753),this.process=s(6551)}getConfigValue(t,e=undefined){const s=this.getConfig();let n=process.env[t]&&`${process.env[t]}`;if(void 0!==n)return"true"===n?n=!0:"false"===n&&(n=!1),console.log(`Using environment value: ${n} for key: ${t}`),n;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),n=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,n):(await downloadFileSync(this.info.id,e),this.initialized=!0,n)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,n)=>{this.existsLocally().then((o=>{o&&!t?(this.initialized=!0,s(o)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{n(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,n)=>{s?e(s):t(n)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,n)=>{const o=this.getHash(t),r=`${e}/${o}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{n(t)}))}))}}},3192:(t,e,s)=>{const n=s(6630),o=s(2509),r=(t,e,s,r,i,h,a,l,d,c,u,f)=>{const y=new o(t,e,s,r,i,h,a,l,d,c,u,f);return n(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:n,fill:o,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:d,subtype:c,node:u,id:f}){this.node=u||r(t,e,s,n,o,i,h,a,l,d,c,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const n in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[n],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}}}},5569:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const n=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,o=Math.floor(Math.random()*n.length);return e[n[o]]}}},586:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let n in s)if(e=s[n].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},3056:(t,e,s)=>{const n=s(9056),o=s(1584),{gameNode:r,BaseNode:i}=s(3192),h={[n.CIRCLE]:o.SHAPE_2D_CIRCLE,[n.POLYGON]:o.SHAPE_2D_POLYGON,[n.LINE]:o.SHAPE_2D_LINE},a={[o.SHAPE_2D_CIRCLE]:n.CIRCLE,[o.SHAPE_2D_POLYGON]:n.POLYGON,[o.SHAPE_2D_LINE]:n.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,id:c}){if(!(n&&s||d))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,subtype:h[s],id:c})}clone({handleClick:t,input:e,id:s}){const n=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:n})}}class d extends i{constructor({textInfo:t,playerIds:e,input:s,node:n,id:r}){if(!t&&!n)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:n,subtype:o.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new d({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:n})}}class c extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,subtype:o.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new c({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:n})}}const u={Asset:c,Shape:l,Text:d};t.exports={gameNode:r,GameNode:u}},2509:t=>{t.exports=class{constructor(t,e,s,n,o,r,i,h=[],a=null,l=null,d=null,c=null){this.id=c?Number(c):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=n,this.fill=o,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=d}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},9056:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},9357:(t,e,s)=>{const{squish:n,unsquish:o}=s(1461);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:n,onAssetUpdate:o}){if(this.ids=new Set,this.game=t,this.assets={},this.customBottomLayer=s,this.customTopLayer=n,this.initialize(),this.onAssetUpdate=o,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return o(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const n={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,n),s.push(t)}for(const o in t){const r=[],i=t[o],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,n),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,n),s.push(t)}return this.playerFrames=n,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},o={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=n(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0)for(let t of r)o[t]||(o[Number(t)]=[]),o[t].push(i);else Object.keys(o).forEach((t=>{o[t]||(o[Number(t)]=[]),o[t].push(i)}));for(let n=0;n<t.node.children.length;n++){const i=new Set(r);this.squishHelper(t.node.children[n],e,s,o,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const n=t[s].root;e[s]=n}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),n=this.game.constructor.metadata&&this.game.constructor.metadata(),o=n&&n.assets?n.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(o,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(o,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(o,this.game.getAssets());const r=Object.assign(s,o);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let n=0;const o=new Array(32);for(;n<32&&n<e.length;)o[n]=e.charCodeAt(n),n++;const l=(s.length+32).toString(36),d={image:1,audio:2,font:3}[r[e].info.type];let c="";for(let t=0;t<10-l.length;t++)c+="0";for(let t=l.length;t<10;t++)c+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,d,...u,...o,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let n=0;n<this.assets[s].length;n++)e[t++]=this.assets[s][n];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.state=this.squish(this.game.getLayers()),this.broadcast()}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},4466:(t,e,s)=>{const{GameNode:n}=s(3056),o=s(9056),r=s(2453),i=s(5569),h=s(586);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},3914:(t,e,s)=>{const{GameNode:n}=s(3056);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:n.Asset,2:n.Shape,3:n.Text}}},8506:t=>{t.exports={getPath:(t,e,s,n,o=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+n;if(a<0||a>o||l<0||l>r){let t=a,e=l;a<0?t=0:a>o&&(t=o),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},1461:(t,e,s)=>{const n=s(2509),{CONSTRUCTOR_TO_TYPE:o,TYPE_TO_CONSTRUCTOR:r}=s(3914),i=s(6142),{squishId:h}=s(9448),{squishColor:a}=s(7858),{squishPlayerIds:l}=s(6252),{squishPos:d}=s(3003),{squishFill:c}=s(9676),{squishSize:u}=s(569),{squishHandleClick:f}=s(8761),{squishBorder:y}=s(9396),{squishSubType:p}=s(3852),{squishInput:g}=s(5712),{squishCoordinates2d:x}=s(1608),{squishEffect:E}=s(6554),{squishText:A}=s(995),{squishAsset:m}=s(4286),S={id:h,color:a,playerIds:l,pos:d,coordinates2d:x,fill:c,size:u,text:A,asset:m,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in S)L[Number(S[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const n=t.node,r=(()=>{const t=Object.keys(S).filter((t=>S[t].dependsOn&&S[t].dependsOn.length>0));return[Object.keys(S).filter((t=>!S[t].dependsOn||0===S[t].dependsOn.length)),t].flat()})();for(const t in r){const o=r[t];if(o in n){const t=n[o];if(null!=t){const r=S[o].squish(t,e,n),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([S[o].type,a,h,...r])}}}let h=o[t.constructor.name];h||(h=o[i[n.subType]]);const a=s.flat(),l=a.length+5,d=Math.min(255,l),c=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),c,d,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new n;for(;e<t.length;){const n=t[e],o=t[e+1]+t[e+2],r=t.slice(e+3,e+o);if(!L[n]){console.warn("Unknown sub frame type "+n);break}{const t=L[n],e=(0,S[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=o}const o=r[t[4]];return o?new o({node:s}):{node:s}}}},4286:(t,e,s)=>{const{getFractional:n}=s(6910),o={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],o=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,d=r.startTime||0;o[0]=Math.floor(i),o[1]=n(i),o[2]=Math.floor(h),o[3]=n(h),o[4]=Math.floor(a),o[5]=n(a),o[6]=Math.floor(l),o[7]=n(l),o[8]=Math.floor(d),o[9]=n(d);for(let t=0;t<s.length;t++)o[10+t]=s.codePointAt(t);return o},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t[6]+t[7]/100,r=t[8]+t[9]/100;return{[String.fromCodePoint.apply(null,t.slice(10))]:{pos:{x:e,y:s},size:{x:n,y:o},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:o}},9396:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},7858:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},1608:(t,e,s)=>{const{getFractional:n}=s(6910),o=s(1584),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==o.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=n(t);const s=r(e.y,i[1]);let o;h[2]=s,h[3]=n(s),o=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(o),h[5]=n(o)}else{const t=i[0];h[0]=Math.floor(t),h[1]=n(t);const e=i[1];h[2]=Math.floor(e),h[3]=n(e);const s=i[2];h[4]=Math.round(s),h[5]=n(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,o=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=o,h[2*t+1]=n(o)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t[e]+t[e+1]/100;s[e/2]=n}if(e===o.SHAPE_2D_POLYGON||e===o.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},6554:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const n=new Array(s);for(let t=0;t<e.length;t++)n[t]=e.codePointAt(t);return n[e.length]=t.shadow.color[0],n[e.length+1]=t.shadow.color[1],n[e.length+2]=t.shadow.color[2],n[e.length+3]=t.shadow.color[3],t.shadow.blur&&(n[e.length+4]=Math.floor(t.shadow.blur/10),n[e.length+5]=t.shadow.blur%10),n}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let n;t.length>10&&(n=10*t[10]+t[11]);const o={[e]:{color:s}};return n&&(o[e].blur=n),o}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},9676:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},8761:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},9448:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},5712:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},6252:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},3003:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},569:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},3852:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},995:(t,e,s)=>{const{hypLength:n}=s(6910),o=s(5569),{squishColor:r}=s(7858),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const d=t.size||1,c=e?d*n(e.x,e.y):d;l[4]=Math.floor(c),l[5]=Math.round(100*(c-Math.floor(c)));const u=t.color||o.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let n=6+f.length+2+3*[...h].length;l[n+p]=Number(s[0]),l[n+p+1]=Number(s[1]),l[n+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let n;n=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let o=6+f.length+2+3*[...h].length+3*[...a].length;l[o+g]=Number(n[0]),l[o+g+1]=Number(n[1]),l[o+g+2]=Number(n[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let d=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let n=h[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;d.push(o)}const c=String.fromCodePoint.apply(null,d);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let n=a[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;u.push(o)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let n=l[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;y.push(o)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:n,color:o,align:c,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},6142:(t,e,s)=>{const{GameNode:n}=s(3056),o=s(1584);t.exports={[[o.ASSET]]:n.Asset,[[o.TEXT]]:n.Text,[[o.SHAPE_2D_POLYGON]]:n.Shape,[[o.SHAPE_2D_CIRCLE]]:n.Shape,[[o.SHAPE_2D_LINE]]:n.Shape}},1584:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},2814:(t,e,s)=>{const{getRandomTerrain:n,getRandomStartPoint:o}=s(7592),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const d=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);n()(d,o(h,a,e),h,a,e);const c=((t,e,s,n)=>{const o=[];for(let i=0;i<s;i++)for(let s=0;s<n;s++){const n=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(o.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){o.push(...n);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(n.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(d,e,h,a);return c?i(d,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:n,height:o}=((t,e)=>{const s=t.x,n=t.y,o=e.x,r=e.y;return{width:Math.floor(s/o),height:Math.floor(n/r)}})(t,e);let r=((t,e)=>{const s=[],n={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let o=0;o<t;o++){s[o]=[];for(let r=0;r<e;r++){const i={...n};0===o?i.west=!1:o===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[o].push(i)}}return s})(n,o);const h={x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*o)};return r=i(r,h,s,n,o),r}}},7592:t=>{const e=(t,{x:e,y:s},n,o,r)=>{e<0||e>=n||s<0||s>=o||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s+1,y:n+1},o,r,i)):1===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i)):2===h?(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n-1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n-1},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s,y:n+3},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+3,y:n},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-3,y:n},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s,y:n-3},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s+1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+2,y:n-1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n+1},o,r,i),e(t,{x:s+2,y:n+1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n-1},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const n={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;n.x===s.x&&n.y===s.y;)n.x=Math.floor(Math.random()*t),n.y=Math.floor(Math.random()*e);return n}}},5883:t=>{const e=(t,s,n,o=[])=>{if(!n||n(t)&&t.node.id!==s.node.id){const e=t.node.text,n=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=n[0][0],h=n[1][0],a=r[0][0],l=r[1][0],d=n[0][1],c=n[2][1],u=r[0][1],f=r[2][1];l<i||h<a||d>f||u>c||o.push(t)}for(const r in t.node.children)e(t.node.children[r],s,n,o);return o};t.exports={checkCollisions:(t,s,n=null)=>e(t,s,n)}},6910:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},6630:t=>{t.exports=function(t,e){return new Proxy(t,{get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,n){const o=Reflect.defineProperty(t,s,n);return e&&e(),o},deleteProperty(t,s){const n=Reflect.deleteProperty(t,s);return e&&e(),n}})}},2453:t=>{t.exports={triangle:(t,e,s,n,o,r)=>[[t,e],[s,n],[o,r],[t,e]],rectangle:(t,e,s,n)=>[[t,e],[t+s,e],[t+s,e+n],[t,e+n],[t,e]]}},3475:(t,e,s)=>{const{GameNode:n}=s(3056),o=s(9056),r=s(2453),i=s(5883),h=s(5569);t.exports={getView:(t,e,s,a={},l={})=>{const d=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),c=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return d.length>0&&d.forEach((t=>{const n=[],o=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in o){const r=o[s],i=r[0],h=r[1];let d=Math.max(Math.min(i-e.x,100),0),c=Math.max(Math.min(h-e.y,100),0);d=(l.x||1)*d,c=(l.y||1)*c,(!a.filter||a.filter(t))&&(a.x&&(d+=a.x),a.y&&(c+=a.y)),d<0?d=0:d>100&&(d=100),c<0?c=0:c>100&&(c=100),n.push([d,c])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(n&&n.length&&(e.node.text&&(e.node.text.x=n[0][0],e.node.text.y=n[0][1]),n.length&&(e.node.coordinates2d=n),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],n=e.node.coordinates2d[2],o=s[0]-t[0],r=n[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=o,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>c.addChild(t))),c}}},4764:(t,e,s)=>{const{squish:n,unsquish:o}=s(5236),{gameNode:r,GameNode:i}=s(8194),h=(s(889),s(8887)),a=s(2857),l=s(2266),d=s(9025),c=s(2454),u=s(1280),{terrainGenerator:f}=s(2970),y=s(6565),p=s(9454),g=s(4506),x=s(2164),E=s(4902);t.exports={squish:n,unsquish:o,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:d,Squisher:p,ShapeUtils:c,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},4506:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(6936),this.http=s(3245),this.fs=s(9121),this.crypto=s(2625),this.path=s(1542),this.process=s(9417)}getConfigValue(t,e=undefined){const s=this.getConfig();let n=process.env[t]&&`${process.env[t]}`;if(void 0!==n)return"true"===n?n=!0:"false"===n&&(n=!1),console.log(`Using environment value: ${n} for key: ${t}`),n;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),n=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,n):(await downloadFileSync(this.info.id,e),this.initialized=!0,n)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,n)=>{this.existsLocally().then((n=>{n&&!t?(this.initialized=!0,s(n)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,n)=>{s?e(s):t(n)}))}))}))}doDownload(t,e){return new Promise(((s,n)=>{const o=this.getHash(t),r=`${e}/${o}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{n(t)}))}))}}},4351:(t,e,s)=>{const n=s(4821),o=s(889),r=(t,e,s,r,i,h,a,l,d,c,u,f)=>{const y=new o(t,e,s,r,i,h,a,l,d,c,u,f);return n(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:n,fill:o,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:d,subtype:c,node:u,id:f}){this.node=u||r(t,e,s,n,o,i,h,a,l,d,c,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const n in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[n],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}}}},8887:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const n=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,o=Math.floor(Math.random()*n.length);return e[n[o]]}}},2857:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let n in s)if(e=s[n].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},8194:(t,e,s)=>{const n=s(9025),o=s(6565),{gameNode:r,BaseNode:i}=s(4351),h={[n.CIRCLE]:o.SHAPE_2D_CIRCLE,[n.POLYGON]:o.SHAPE_2D_POLYGON,[n.LINE]:o.SHAPE_2D_LINE},a={[o.SHAPE_2D_CIRCLE]:n.CIRCLE,[o.SHAPE_2D_POLYGON]:n.POLYGON,[o.SHAPE_2D_LINE]:n.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,id:c}){if(!(n&&s||d))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,subtype:h[s],id:c})}clone({handleClick:t,input:e,id:s}){const n=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:n})}}class d extends i{constructor({textInfo:t,playerIds:e,input:s,node:n,id:r}){if(!t&&!n)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:n,subtype:o.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new d({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:n})}}class c extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,subtype:o.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new c({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:n})}}const u={Asset:c,Shape:l,Text:d};t.exports={gameNode:r,GameNode:u}},889:t=>{t.exports=class{constructor(t,e,s,n,o,r,i,h=[],a=null,l=null,d=null,c=null){this.id=c?Number(c):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=n,this.fill=o,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=d}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},9025:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},9454:(t,e,s)=>{const{squish:n,unsquish:o}=s(5236);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:n,onAssetUpdate:o}){if(this.ids=new Set,this.game=t,this.assets={},this.customBottomLayer=s,this.customTopLayer=n,this.initialize(),this.onAssetUpdate=o,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return o(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const n={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,n),s.push(t)}for(const o in t){const r=[],i=t[o],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,n),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,n),s.push(t)}return this.playerFrames=n,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},o={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=n(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0)for(let t of r)o[t]||(o[Number(t)]=[]),o[t].push(i);else Object.keys(o).forEach((t=>{o[t]||(o[Number(t)]=[]),o[t].push(i)}));for(let n=0;n<t.node.children.length;n++){const i=new Set(r);this.squishHelper(t.node.children[n],e,s,o,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const n=t[s].root;e[s]=n}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),n=this.game.constructor.metadata&&this.game.constructor.metadata(),o=n&&n.assets?n.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(o,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(o,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(o,this.game.getAssets());const r=Object.assign(s,o);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let n=0;const o=new Array(32);for(;n<32&&n<e.length;)o[n]=e.charCodeAt(n),n++;const l=(s.length+32).toString(36),d="image"===r[e].info.type?1:2;let c="";for(let t=0;t<10-l.length;t++)c+="0";for(let t=l.length;t<10;t++)c+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,d,...u,...o,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let n=0;n<this.assets[s].length;n++)e[t++]=this.assets[s][n];this.assetBundle=e,t(e)}}))}))}handleStateChange(t,e){this.state=this.squish(this.game.getLayers()),this.broadcast()}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},2266:(t,e,s)=>{const{GameNode:n}=s(8194),o=s(9025),r=s(2454),i=s(8887),h=s(2857);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},6970:(t,e,s)=>{const{GameNode:n}=s(8194);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:n.Asset,2:n.Shape,3:n.Text}}},4902:t=>{t.exports={getPath:(t,e,s,n,o=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+n;if(a<0||a>o||l<0||l>r){let t=a,e=l;a<0?t=0:a>o&&(t=o),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},5236:(t,e,s)=>{const n=s(889),{CONSTRUCTOR_TO_TYPE:o,TYPE_TO_CONSTRUCTOR:r}=s(6970),i=s(3805),{squishId:h}=s(7112),{squishColor:a}=s(6413),{squishPlayerIds:l}=s(6072),{squishPos:d}=s(9594),{squishFill:c}=s(7209),{squishSize:u}=s(6682),{squishHandleClick:f}=s(4759),{squishBorder:y}=s(7521),{squishSubType:p}=s(9478),{squishInput:g}=s(951),{squishCoordinates2d:x}=s(4206),{squishEffect:E}=s(5751),{squishText:A}=s(4642),{squishAsset:m}=s(9978),S={id:h,color:a,playerIds:l,pos:d,coordinates2d:x,fill:c,size:u,text:A,asset:m,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in S)L[Number(S[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const n=t.node,r=(()=>{const t=Object.keys(S).filter((t=>S[t].dependsOn&&S[t].dependsOn.length>0));return[Object.keys(S).filter((t=>!S[t].dependsOn||0===S[t].dependsOn.length)),t].flat()})();for(const t in r){const o=r[t];if(o in n){const t=n[o];if(null!=t){const r=S[o].squish(t,e,n),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([S[o].type,a,h,...r])}}}let h=o[t.constructor.name];h||(h=o[i[n.subType]]);const a=s.flat(),l=a.length+5,d=Math.min(255,l),c=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),c,d,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new n;for(;e<t.length;){const n=t[e],o=t[e+1]+t[e+2],r=t.slice(e+3,e+o);if(!L[n]){console.warn("Unknown sub frame type "+n);break}{const t=L[n],e=(0,S[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=o}const o=r[t[4]];return o?new o({node:s}):{node:s}}}},9978:(t,e,s)=>{const{getFractional:n}=s(2243),o={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],o=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,d=r.startTime||0;o[0]=Math.floor(i),o[1]=n(i),o[2]=Math.floor(h),o[3]=n(h),o[4]=Math.floor(a),o[5]=n(a),o[6]=Math.floor(l),o[7]=n(l),o[8]=Math.floor(d),o[9]=n(d);for(let t=0;t<s.length;t++)o[10+t]=s.codePointAt(t);return o},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t[6]+t[7]/100,r=t[8]+t[9]/100;return{[String.fromCodePoint.apply(null,t.slice(10))]:{pos:{x:e,y:s},size:{x:n,y:o},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:o}},7521:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},6413:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},4206:(t,e,s)=>{const{getFractional:n}=s(2243),o=s(6565),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==o.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=n(t);const s=r(e.y,i[1]);let o;h[2]=s,h[3]=n(s),o=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(o),h[5]=n(o)}else{const t=i[0];h[0]=Math.floor(t),h[1]=n(t);const e=i[1];h[2]=Math.floor(e),h[3]=n(e);const s=i[2];h[4]=Math.round(s),h[5]=n(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,o=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=o,h[2*t+1]=n(o)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t[e]+t[e+1]/100;s[e/2]=n}if(e===o.SHAPE_2D_POLYGON||e===o.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},5751:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const n=new Array(s);for(let t=0;t<e.length;t++)n[t]=e.codePointAt(t);return n[e.length]=t.shadow.color[0],n[e.length+1]=t.shadow.color[1],n[e.length+2]=t.shadow.color[2],n[e.length+3]=t.shadow.color[3],t.shadow.blur&&(n[e.length+4]=Math.floor(t.shadow.blur/10),n[e.length+5]=t.shadow.blur%10),n}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let n;t.length>10&&(n=10*t[10]+t[11]);const o={[e]:{color:s}};return n&&(o[e].blur=n),o}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},7209:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},4759:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},7112:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},951:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},6072:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},9594:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},6682:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},9478:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},4642:(t,e,s)=>{const{hypLength:n}=s(2243),o=s(8887),{squishColor:r}=s(6413),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=new Array(t.text.length+10+h.length);a[0]=Math.floor(s),a[1]=Math.round(100*(s-Math.floor(s))),a[2]=Math.floor(i),a[3]=Math.round(100*(i-Math.floor(i)));const l=t.size||1,d=e?l*n(e.x,e.y):l;a[4]=Math.floor(d),a[5]=Math.round(100*(d-Math.floor(d)));const c=t.color||o.BLACK,u=r.squish(c);for(let t=0;t<u.length;t++)a[6+t]=u[t];a[6+u.length]=3*[...h].length;let f=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],a[6+u.length+1+f]=Number(s[0]),a[6+u.length+1+f+1]=Number(s[1]),a[6+u.length+1+f+2]=Number(s[2]),f+=3}let y=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let n;n=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`],a[6+u.length+1+f+y]=Number(n[0]),a[6+u.length+1+f+y+1]=Number(n[1]),a[6+u.length+1+f+y+2]=Number(n[2]),y+=3}return a},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t.slice(6,10),r=t[10],i=t.slice(11,11+r),h=t.slice(11+r);let a=[];for(let t=0;t<i.length;t+=3){let e=i[t].toString();1==e.length&&(e=`0${e}`);let s=i[t+1].toString();1==s.length&&(s=`0${s}`);let n=i[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;a.push(o)}const l=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let n=h[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;l.push(o)}const d=String.fromCodePoint.apply(null,a);return{x:e,y:s,text:String.fromCodePoint.apply(null,l),size:n,color:o,align:d}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},3805:(t,e,s)=>{const{GameNode:n}=s(8194),o=s(6565);t.exports={[[o.ASSET]]:n.Asset,[[o.TEXT]]:n.Text,[[o.SHAPE_2D_POLYGON]]:n.Shape,[[o.SHAPE_2D_CIRCLE]]:n.Shape,[[o.SHAPE_2D_LINE]]:n.Shape}},6565:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},2970:(t,e,s)=>{const{getRandomTerrain:n,getRandomStartPoint:o}=s(7789),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const d=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);n()(d,o(h,a,e),h,a,e);const c=((t,e,s,n)=>{const o=[];for(let i=0;i<s;i++)for(let s=0;s<n;s++){const n=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(o.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){o.push(...n);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(n.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(d,e,h,a);return c?i(d,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:n,height:o}=((t,e)=>{const s=t.x,n=t.y,o=e.x,r=e.y;return{width:Math.floor(s/o),height:Math.floor(n/r)}})(t,e);let r=((t,e)=>{const s=[],n={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let o=0;o<t;o++){s[o]=[];for(let r=0;r<e;r++){const i={...n};0===o?i.west=!1:o===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[o].push(i)}}return s})(n,o);const h={x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*o)};return r=i(r,h,s,n,o),r}}},7789:t=>{const e=(t,{x:e,y:s},n,o,r)=>{e<0||e>=n||s<0||s>=o||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s+1,y:n+1},o,r,i)):1===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i)):2===h?(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n-1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n-1},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s,y:n+3},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+3,y:n},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-3,y:n},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s,y:n-3},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s+1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+2,y:n-1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n+1},o,r,i),e(t,{x:s+2,y:n+1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n-1},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const n={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;n.x===s.x&&n.y===s.y;)n.x=Math.floor(Math.random()*t),n.y=Math.floor(Math.random()*e);return n}}},2164:t=>{const e=(t,s,n,o=[])=>{if(!n||n(t)&&t.node.id!==s.node.id){const e=t.node.text,n=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=n[0][0],h=n[1][0],a=r[0][0],l=r[1][0],d=n[0][1],c=n[2][1],u=r[0][1],f=r[2][1];l<i||h<a||d>f||u>c||o.push(t)}for(const r in t.node.children)e(t.node.children[r],s,n,o);return o};t.exports={checkCollisions:(t,s,n=null)=>e(t,s,n)}},2243:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},4821:t=>{t.exports=function(t,e){return new Proxy(t,{get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,n){const o=Reflect.defineProperty(t,s,n);return e&&e(),o},deleteProperty(t,s){const n=Reflect.deleteProperty(t,s);return e&&e(),n}})}},2454:t=>{t.exports={triangle:(t,e,s,n,o,r)=>[[t,e],[s,n],[o,r],[t,e]],rectangle:(t,e,s,n)=>[[t,e],[t+s,e],[t+s,e+n],[t,e+n],[t,e]]}},1280:(t,e,s)=>{const{GameNode:n}=s(8194),o=s(9025),r=s(2454),i=s(2164),h=s(8887);t.exports={getView:(t,e,s,a={},l={})=>{const d=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),c=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return d.length>0&&d.forEach((t=>{const n=[],o=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in o){const r=o[s],i=r[0],h=r[1];let d=Math.max(Math.min(i-e.x,100),0),c=Math.max(Math.min(h-e.y,100),0);d=(l.x||1)*d,c=(l.y||1)*c,(!a.filter||a.filter(t))&&(a.x&&(d+=a.x),a.y&&(c+=a.y)),d<0?d=0:d>100&&(d=100),c<0?c=0:c>100&&(c=100),n.push([d,c])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(n&&n.length&&(e.node.text&&(e.node.text.x=n[0][0],e.node.text.y=n[0][1]),n.length&&(e.node.coordinates2d=n),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],n=e.node.coordinates2d[2],o=s[0]-t[0],r=n[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=o,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>c.addChild(t))),c}}},484:(t,e,s)=>{const{squish:n,unsquish:o}=s(2367),{gameNode:r,GameNode:i}=s(1072),h=(s(9400),s(2569)),a=s(2368),l=s(9614),d=s(4192),c=s(8118),u=s(4700),{terrainGenerator:f}=s(5050),y=s(2760),p=s(2709),g=s(5619),x=s(1270),E=s(2595);t.exports={squish:n,unsquish:o,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:d,Squisher:p,ShapeUtils:c,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},5619:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(9886),this.http=s(7622),this.fs=s(1418),this.crypto=s(7027),this.path=s(7701),this.process=s(305)}getConfigValue(t,e=undefined){const s=this.getConfig();let n=process.env[t]&&`${process.env[t]}`;if(void 0!==n)return"true"===n?n=!0:"false"===n&&(n=!1),console.log(`Using environment value: ${n} for key: ${t}`),n;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),n=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,n):(await downloadFileSync(this.info.id,e),this.initialized=!0,n)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,n)=>{this.existsLocally().then((n=>{n&&!t?(this.initialized=!0,s(n)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,n)=>{s?e(s):t(n)}))}))}))}doDownload(t,e){return new Promise(((s,n)=>{const o=this.getHash(t),r=`${e}/${o}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{n(t)}))}))}}},2467:(t,e,s)=>{const n=s(145),o=s(9400),r=(t,e,s,r,i,h,a,l,d,c,u,f)=>{const y=new o(t,e,s,r,i,h,a,l,d,c,u,f);return n(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:n,fill:o,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:d,subtype:c,node:u,id:f}){this.node=u||r(t,e,s,n,o,i,h,a,l,d,c,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const n in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[n],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}}}},2569:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const n=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,o=Math.floor(Math.random()*n.length);return e[n[o]]}}},2368:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let n in s)if(e=s[n].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},1072:(t,e,s)=>{const n=s(4192),o=s(2760),{gameNode:r,BaseNode:i}=s(2467),h={[n.CIRCLE]:o.SHAPE_2D_CIRCLE,[n.POLYGON]:o.SHAPE_2D_POLYGON,[n.LINE]:o.SHAPE_2D_LINE},a={[o.SHAPE_2D_CIRCLE]:n.CIRCLE,[o.SHAPE_2D_POLYGON]:n.POLYGON,[o.SHAPE_2D_LINE]:n.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,id:c}){if(!(n&&s||d))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,subtype:h[s],id:c})}clone({handleClick:t,input:e,id:s}){const n=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:n})}}class d extends i{constructor({textInfo:t,playerIds:e,input:s,node:n,id:r}){if(!t&&!n)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:n,subtype:o.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new d({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:n})}}class c extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,subtype:o.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new c({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:n})}}const u={Asset:c,Shape:l,Text:d};t.exports={gameNode:r,GameNode:u}},9400:t=>{t.exports=class{constructor(t,e,s,n,o,r,i,h=[],a=null,l=null,d=null,c=null){this.id=c?Number(c):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=n,this.fill=o,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=d}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},4192:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},2709:(t,e,s)=>{const{squish:n,unsquish:o}=s(2367);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:n,onAssetUpdate:o}){if(this.ids=new Set,this.game=t,this.assets={},this.customBottomLayer=s,this.customTopLayer=n,this.initialize(),this.onAssetUpdate=o,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return o(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const n={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,n),s.push(t)}for(const o in t){const r=[],i=t[o],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,n),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,n),s.push(t)}return this.playerFrames=n,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},o={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=n(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0)for(let t of r)o[t]||(o[Number(t)]=[]),o[t].push(i);else Object.keys(o).forEach((t=>{o[t]||(o[Number(t)]=[]),o[t].push(i)}));for(let n=0;n<t.node.children.length;n++){const i=new Set(r);this.squishHelper(t.node.children[n],e,s,o,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const n=t[s].root;e[s]=n}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),n=this.game.constructor.metadata&&this.game.constructor.metadata(),o=n&&n.assets?n.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(o,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(o,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(o,this.game.getAssets());const r=Object.assign(s,o);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let n=0;const o=new Array(32);for(;n<32&&n<e.length;)o[n]=e.charCodeAt(n),n++;const l=(s.length+32).toString(36),d={image:1,audio:2,font:3}[r[e].info.type];let c="";for(let t=0;t<10-l.length;t++)c+="0";for(let t=l.length;t<10;t++)c+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,d,...u,...o,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let n=0;n<this.assets[s].length;n++)e[t++]=this.assets[s][n];this.assetBundle=e,t(e)}}))}))}handleStateChange(t,e){this.state=this.squish(this.game.getLayers()),this.broadcast()}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},9614:(t,e,s)=>{const{GameNode:n}=s(1072),o=s(4192),r=s(8118),i=s(2569),h=s(2368);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},6778:(t,e,s)=>{const{GameNode:n}=s(1072);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:n.Asset,2:n.Shape,3:n.Text}}},2595:t=>{t.exports={getPath:(t,e,s,n,o=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+n;if(a<0||a>o||l<0||l>r){let t=a,e=l;a<0?t=0:a>o&&(t=o),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},2367:(t,e,s)=>{const n=s(9400),{CONSTRUCTOR_TO_TYPE:o,TYPE_TO_CONSTRUCTOR:r}=s(6778),i=s(4754),{squishId:h}=s(7552),{squishColor:a}=s(209),{squishPlayerIds:l}=s(143),{squishPos:d}=s(2313),{squishFill:c}=s(5271),{squishSize:u}=s(6076),{squishHandleClick:f}=s(5676),{squishBorder:y}=s(5006),{squishSubType:p}=s(208),{squishInput:g}=s(65),{squishCoordinates2d:x}=s(5264),{squishEffect:E}=s(4485),{squishText:A}=s(303),{squishAsset:m}=s(8078),S={id:h,color:a,playerIds:l,pos:d,coordinates2d:x,fill:c,size:u,text:A,asset:m,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in S)L[Number(S[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const n=t.node,r=(()=>{const t=Object.keys(S).filter((t=>S[t].dependsOn&&S[t].dependsOn.length>0));return[Object.keys(S).filter((t=>!S[t].dependsOn||0===S[t].dependsOn.length)),t].flat()})();for(const t in r){const o=r[t];if(o in n){const t=n[o];if(null!=t){const r=S[o].squish(t,e,n),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([S[o].type,a,h,...r])}}}let h=o[t.constructor.name];h||(h=o[i[n.subType]]);const a=s.flat(),l=a.length+5,d=Math.min(255,l),c=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),c,d,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new n;for(;e<t.length;){const n=t[e],o=t[e+1]+t[e+2],r=t.slice(e+3,e+o);if(!L[n]){console.warn("Unknown sub frame type "+n);break}{const t=L[n],e=(0,S[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=o}const o=r[t[4]];return o?new o({node:s}):{node:s}}}},8078:(t,e,s)=>{const{getFractional:n}=s(5024),o={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],o=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,d=r.startTime||0;o[0]=Math.floor(i),o[1]=n(i),o[2]=Math.floor(h),o[3]=n(h),o[4]=Math.floor(a),o[5]=n(a),o[6]=Math.floor(l),o[7]=n(l),o[8]=Math.floor(d),o[9]=n(d);for(let t=0;t<s.length;t++)o[10+t]=s.codePointAt(t);return o},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t[6]+t[7]/100,r=t[8]+t[9]/100;return{[String.fromCodePoint.apply(null,t.slice(10))]:{pos:{x:e,y:s},size:{x:n,y:o},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:o}},5006:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},209:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},5264:(t,e,s)=>{const{getFractional:n}=s(5024),o=s(2760),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==o.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=n(t);const s=r(e.y,i[1]);let o;h[2]=s,h[3]=n(s),o=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(o),h[5]=n(o)}else{const t=i[0];h[0]=Math.floor(t),h[1]=n(t);const e=i[1];h[2]=Math.floor(e),h[3]=n(e);const s=i[2];h[4]=Math.round(s),h[5]=n(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,o=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=o,h[2*t+1]=n(o)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t[e]+t[e+1]/100;s[e/2]=n}if(e===o.SHAPE_2D_POLYGON||e===o.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},4485:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const n=new Array(s);for(let t=0;t<e.length;t++)n[t]=e.codePointAt(t);return n[e.length]=t.shadow.color[0],n[e.length+1]=t.shadow.color[1],n[e.length+2]=t.shadow.color[2],n[e.length+3]=t.shadow.color[3],t.shadow.blur&&(n[e.length+4]=Math.floor(t.shadow.blur/10),n[e.length+5]=t.shadow.blur%10),n}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let n;t.length>10&&(n=10*t[10]+t[11]);const o={[e]:{color:s}};return n&&(o[e].blur=n),o}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},5271:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},5676:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},7552:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},65:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},143:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},2313:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},6076:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},208:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},303:(t,e,s)=>{const{hypLength:n}=s(5024),o=s(2569),{squishColor:r}=s(209),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const d=t.size||1,c=e?d*n(e.x,e.y):d;l[4]=Math.floor(c),l[5]=Math.round(100*(c-Math.floor(c)));const u=t.color||o.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let n=6+f.length+2+3*[...h].length;l[n+p]=Number(s[0]),l[n+p+1]=Number(s[1]),l[n+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let n;n=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let o=6+f.length+2+3*[...h].length+3*[...a].length;l[o+g]=Number(n[0]),l[o+g+1]=Number(n[1]),l[o+g+2]=Number(n[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let d=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let n=h[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;d.push(o)}const c=String.fromCodePoint.apply(null,d);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let n=a[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;u.push(o)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let n=l[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;y.push(o)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:n,color:o,align:c,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},4754:(t,e,s)=>{const{GameNode:n}=s(1072),o=s(2760);t.exports={[[o.ASSET]]:n.Asset,[[o.TEXT]]:n.Text,[[o.SHAPE_2D_POLYGON]]:n.Shape,[[o.SHAPE_2D_CIRCLE]]:n.Shape,[[o.SHAPE_2D_LINE]]:n.Shape}},2760:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},5050:(t,e,s)=>{const{getRandomTerrain:n,getRandomStartPoint:o}=s(6039),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const d=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);n()(d,o(h,a,e),h,a,e);const c=((t,e,s,n)=>{const o=[];for(let i=0;i<s;i++)for(let s=0;s<n;s++){const n=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(o.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){o.push(...n);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(n.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(d,e,h,a);return c?i(d,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:n,height:o}=((t,e)=>{const s=t.x,n=t.y,o=e.x,r=e.y;return{width:Math.floor(s/o),height:Math.floor(n/r)}})(t,e);let r=((t,e)=>{const s=[],n={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let o=0;o<t;o++){s[o]=[];for(let r=0;r<e;r++){const i={...n};0===o?i.west=!1:o===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[o].push(i)}}return s})(n,o);const h={x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*o)};return r=i(r,h,s,n,o),r}}},6039:t=>{const e=(t,{x:e,y:s},n,o,r)=>{e<0||e>=n||s<0||s>=o||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s+1,y:n+1},o,r,i)):1===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i)):2===h?(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n-1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n-1},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s,y:n+3},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+3,y:n},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-3,y:n},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s,y:n-3},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s+1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+2,y:n-1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n+1},o,r,i),e(t,{x:s+2,y:n+1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n-1},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const n={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;n.x===s.x&&n.y===s.y;)n.x=Math.floor(Math.random()*t),n.y=Math.floor(Math.random()*e);return n}}},1270:t=>{const e=(t,s,n,o=[])=>{if(!n||n(t)&&t.node.id!==s.node.id){const e=t.node.text,n=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=n[0][0],h=n[1][0],a=r[0][0],l=r[1][0],d=n[0][1],c=n[2][1],u=r[0][1],f=r[2][1];l<i||h<a||d>f||u>c||o.push(t)}for(const r in t.node.children)e(t.node.children[r],s,n,o);return o};t.exports={checkCollisions:(t,s,n=null)=>e(t,s,n)}},5024:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},145:t=>{t.exports=function(t,e){return new Proxy(t,{get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,n){const o=Reflect.defineProperty(t,s,n);return e&&e(),o},deleteProperty(t,s){const n=Reflect.deleteProperty(t,s);return e&&e(),n}})}},8118:t=>{t.exports={triangle:(t,e,s,n,o,r)=>[[t,e],[s,n],[o,r],[t,e]],rectangle:(t,e,s,n)=>[[t,e],[t+s,e],[t+s,e+n],[t,e+n],[t,e]]}},4700:(t,e,s)=>{const{GameNode:n}=s(1072),o=s(4192),r=s(8118),i=s(1270),h=s(2569);t.exports={getView:(t,e,s,a={},l={})=>{const d=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),c=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return d.length>0&&d.forEach((t=>{const n=[],o=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in o){const r=o[s],i=r[0],h=r[1];let d=Math.max(Math.min(i-e.x,100),0),c=Math.max(Math.min(h-e.y,100),0);d=(l.x||1)*d,c=(l.y||1)*c,(!a.filter||a.filter(t))&&(a.x&&(d+=a.x),a.y&&(c+=a.y)),d<0?d=0:d>100&&(d=100),c<0?c=0:c>100&&(c=100),n.push([d,c])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(n&&n.length&&(e.node.text&&(e.node.text.x=n[0][0],e.node.text.y=n[0][1]),n.length&&(e.node.coordinates2d=n),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],n=e.node.coordinates2d[2],o=s[0]-t[0],r=n[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=o,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>c.addChild(t))),c}}},6175:(t,e,s)=>{const{squish:n,unsquish:o}=s(8446),{gameNode:r,GameNode:i}=s(7588),h=(s(4023),s(5944)),a=s(1736),l=s(9505),d=s(6550),c=s(4639),u=s(6363),{terrainGenerator:f}=s(3869),y=s(2746),p=s(812),g=s(666),x=s(7030),E=s(1594);t.exports={squish:n,unsquish:o,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:d,Squisher:p,ShapeUtils:c,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},666:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(4016),this.http=s(36),this.fs=s(1590),this.crypto=s(314),this.path=s(1557),this.process=s(2678)}getConfigValue(t,e=undefined){const s=this.getConfig();let n=process.env[t]&&`${process.env[t]}`;if(void 0!==n)return"true"===n?n=!0:"false"===n&&(n=!1),console.log(`Using environment value: ${n} for key: ${t}`),n;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),n=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,n):(await downloadFileSync(this.info.id,e),this.initialized=!0,n)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,n)=>{this.existsLocally().then((o=>{o&&!t?(this.initialized=!0,s(o)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{n(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,n)=>{s?e(s):t(n)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,n)=>{const o=this.getHash(t),r=`${e}/${o}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{n(t)}))}))}}},597:(t,e,s)=>{const n=s(3681),o=s(4023),r=(t,e,s,r,i,h,a,l,d,c,u,f)=>{const y=new o(t,e,s,r,i,h,a,l,d,c,u,f);return n(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:n,fill:o,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:d,subtype:c,node:u,id:f}){this.node=u||r(t,e,s,n,o,i,h,a,l,d,c,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const n in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[n],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}}}},5944:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const n=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,o=Math.floor(Math.random()*n.length);return e[n[o]]}}},1736:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let n in s)if(e=s[n].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},7588:(t,e,s)=>{const n=s(6550),o=s(2746),{gameNode:r,BaseNode:i}=s(597),h={[n.CIRCLE]:o.SHAPE_2D_CIRCLE,[n.POLYGON]:o.SHAPE_2D_POLYGON,[n.LINE]:o.SHAPE_2D_LINE},a={[o.SHAPE_2D_CIRCLE]:n.CIRCLE,[o.SHAPE_2D_POLYGON]:n.POLYGON,[o.SHAPE_2D_LINE]:n.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,id:c}){if(!(n&&s||d))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,subtype:h[s],id:c})}clone({handleClick:t,input:e,id:s}){const n=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:n})}}class d extends i{constructor({textInfo:t,playerIds:e,input:s,node:n,id:r}){if(!t&&!n)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:n,subtype:o.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new d({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:n})}}class c extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,subtype:o.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new c({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:n})}}const u={Asset:c,Shape:l,Text:d};t.exports={gameNode:r,GameNode:u}},4023:t=>{t.exports=class{constructor(t,e,s,n,o,r,i,h=[],a=null,l=null,d=null,c=null){this.id=c?Number(c):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=n,this.fill=o,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=d}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},6550:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},812:(t,e,s)=>{const{squish:n,unsquish:o}=s(8446);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:n,onAssetUpdate:o}){if(this.ids=new Set,this.game=t,this.assets={},this.customBottomLayer=s,this.customTopLayer=n,this.initialize(),this.onAssetUpdate=o,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return o(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const n={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,n),s.push(t)}for(const o in t){const r=[],i=t[o],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,n),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,n),s.push(t)}return this.playerFrames=n,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},o={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=n(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0)for(let t of r)o[t]||(o[Number(t)]=[]),o[t].push(i);else Object.keys(o).forEach((t=>{o[t]||(o[Number(t)]=[]),o[t].push(i)}));for(let n=0;n<t.node.children.length;n++){const i=new Set(r);this.squishHelper(t.node.children[n],e,s,o,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const n=t[s].root;e[s]=n}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),n=this.game.constructor.metadata&&this.game.constructor.metadata(),o=n&&n.assets?n.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(o,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(o,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(o,this.game.getAssets());const r=Object.assign(s,o);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let n=0;const o=new Array(32);for(;n<32&&n<e.length;)o[n]=e.charCodeAt(n),n++;const l=(s.length+32).toString(36),d={image:1,audio:2,font:3}[r[e].info.type];let c="";for(let t=0;t<10-l.length;t++)c+="0";for(let t=l.length;t<10;t++)c+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,d,...u,...o,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let n=0;n<this.assets[s].length;n++)e[t++]=this.assets[s][n];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.state=this.squish(this.game.getLayers()),this.broadcast()}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},9505:(t,e,s)=>{const{GameNode:n}=s(7588),o=s(6550),r=s(4639),i=s(5944),h=s(1736);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},270:(t,e,s)=>{const{GameNode:n}=s(7588);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:n.Asset,2:n.Shape,3:n.Text}}},1594:t=>{t.exports={getPath:(t,e,s,n,o=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+n;if(a<0||a>o||l<0||l>r){let t=a,e=l;a<0?t=0:a>o&&(t=o),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},8446:(t,e,s)=>{const n=s(4023),{CONSTRUCTOR_TO_TYPE:o,TYPE_TO_CONSTRUCTOR:r}=s(270),i=s(9391),{squishId:h}=s(2329),{squishColor:a}=s(8674),{squishPlayerIds:l}=s(4314),{squishPos:d}=s(7861),{squishFill:c}=s(2983),{squishSize:u}=s(7167),{squishHandleClick:f}=s(2068),{squishBorder:y}=s(6483),{squishSubType:p}=s(449),{squishInput:g}=s(8628),{squishCoordinates2d:x}=s(259),{squishEffect:E}=s(6180),{squishText:A}=s(1808),{squishAsset:m}=s(177),S={id:h,color:a,playerIds:l,pos:d,coordinates2d:x,fill:c,size:u,text:A,asset:m,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in S)L[Number(S[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const n=t.node,r=(()=>{const t=Object.keys(S).filter((t=>S[t].dependsOn&&S[t].dependsOn.length>0));return[Object.keys(S).filter((t=>!S[t].dependsOn||0===S[t].dependsOn.length)),t].flat()})();for(const t in r){const o=r[t];if(o in n){const t=n[o];if(null!=t){const r=S[o].squish(t,e,n),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([S[o].type,a,h,...r])}}}let h=o[t.constructor.name];h||(h=o[i[n.subType]]);const a=s.flat(),l=a.length+5,d=Math.min(255,l),c=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),c,d,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new n;for(;e<t.length;){const n=t[e],o=t[e+1]+t[e+2],r=t.slice(e+3,e+o);if(!L[n]){console.warn("Unknown sub frame type "+n);break}{const t=L[n],e=(0,S[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=o}const o=r[t[4]];return o?new o({node:s}):{node:s}}}},177:(t,e,s)=>{const{getFractional:n}=s(2660),o={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],o=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,d=r.startTime||0;o[0]=Math.floor(i),o[1]=n(i),o[2]=Math.floor(h),o[3]=n(h),o[4]=Math.floor(a),o[5]=n(a),o[6]=Math.floor(l),o[7]=n(l),o[8]=Math.floor(d),o[9]=n(d);for(let t=0;t<s.length;t++)o[10+t]=s.codePointAt(t);return o},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t[6]+t[7]/100,r=t[8]+t[9]/100;return{[String.fromCodePoint.apply(null,t.slice(10))]:{pos:{x:e,y:s},size:{x:n,y:o},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:o}},6483:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},8674:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},259:(t,e,s)=>{const{getFractional:n}=s(2660),o=s(2746),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==o.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=n(t);const s=r(e.y,i[1]);let o;h[2]=s,h[3]=n(s),o=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(o),h[5]=n(o)}else{const t=i[0];h[0]=Math.floor(t),h[1]=n(t);const e=i[1];h[2]=Math.floor(e),h[3]=n(e);const s=i[2];h[4]=Math.round(s),h[5]=n(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,o=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=o,h[2*t+1]=n(o)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t[e]+t[e+1]/100;s[e/2]=n}if(e===o.SHAPE_2D_POLYGON||e===o.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},6180:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const n=new Array(s);for(let t=0;t<e.length;t++)n[t]=e.codePointAt(t);return n[e.length]=t.shadow.color[0],n[e.length+1]=t.shadow.color[1],n[e.length+2]=t.shadow.color[2],n[e.length+3]=t.shadow.color[3],t.shadow.blur&&(n[e.length+4]=Math.floor(t.shadow.blur/10),n[e.length+5]=t.shadow.blur%10),n}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let n;t.length>10&&(n=10*t[10]+t[11]);const o={[e]:{color:s}};return n&&(o[e].blur=n),o}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},2983:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},2068:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},2329:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},8628:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},4314:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},7861:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},7167:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},449:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},1808:(t,e,s)=>{const{hypLength:n}=s(2660),o=s(5944),{squishColor:r}=s(8674),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const d=t.size||1,c=e?d*n(e.x,e.y):d;l[4]=Math.floor(c),l[5]=Math.round(100*(c-Math.floor(c)));const u=t.color||o.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let n=6+f.length+2+3*[...h].length;l[n+p]=Number(s[0]),l[n+p+1]=Number(s[1]),l[n+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let n;n=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let o=6+f.length+2+3*[...h].length+3*[...a].length;l[o+g]=Number(n[0]),l[o+g+1]=Number(n[1]),l[o+g+2]=Number(n[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let d=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let n=h[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;d.push(o)}const c=String.fromCodePoint.apply(null,d);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let n=a[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;u.push(o)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let n=l[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;y.push(o)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:n,color:o,align:c,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},9391:(t,e,s)=>{const{GameNode:n}=s(7588),o=s(2746);t.exports={[[o.ASSET]]:n.Asset,[[o.TEXT]]:n.Text,[[o.SHAPE_2D_POLYGON]]:n.Shape,[[o.SHAPE_2D_CIRCLE]]:n.Shape,[[o.SHAPE_2D_LINE]]:n.Shape}},2746:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},3869:(t,e,s)=>{const{getRandomTerrain:n,getRandomStartPoint:o}=s(7373),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const d=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);n()(d,o(h,a,e),h,a,e);const c=((t,e,s,n)=>{const o=[];for(let i=0;i<s;i++)for(let s=0;s<n;s++){const n=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(o.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){o.push(...n);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(n.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(d,e,h,a);return c?i(d,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:n,height:o}=((t,e)=>{const s=t.x,n=t.y,o=e.x,r=e.y;return{width:Math.floor(s/o),height:Math.floor(n/r)}})(t,e);let r=((t,e)=>{const s=[],n={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let o=0;o<t;o++){s[o]=[];for(let r=0;r<e;r++){const i={...n};0===o?i.west=!1:o===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[o].push(i)}}return s})(n,o);const h={x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*o)};return r=i(r,h,s,n,o),r}}},7373:t=>{const e=(t,{x:e,y:s},n,o,r)=>{e<0||e>=n||s<0||s>=o||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s+1,y:n+1},o,r,i)):1===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i)):2===h?(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n-1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n-1},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s,y:n+3},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+3,y:n},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-3,y:n},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s,y:n-3},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s+1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+2,y:n-1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n+1},o,r,i),e(t,{x:s+2,y:n+1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n-1},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const n={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;n.x===s.x&&n.y===s.y;)n.x=Math.floor(Math.random()*t),n.y=Math.floor(Math.random()*e);return n}}},7030:t=>{const e=(t,s,n,o=[])=>{if(!n||n(t)&&t.node.id!==s.node.id){const e=t.node.text,n=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=n[0][0],h=n[1][0],a=r[0][0],l=r[1][0],d=n[0][1],c=n[2][1],u=r[0][1],f=r[2][1];l<i||h<a||d>f||u>c||o.push(t)}for(const r in t.node.children)e(t.node.children[r],s,n,o);return o};t.exports={checkCollisions:(t,s,n=null)=>e(t,s,n)}},2660:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},3681:t=>{t.exports=function(t,e){return new Proxy(t,{get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,n){const o=Reflect.defineProperty(t,s,n);return e&&e(),o},deleteProperty(t,s){const n=Reflect.deleteProperty(t,s);return e&&e(),n}})}},4639:t=>{t.exports={triangle:(t,e,s,n,o,r)=>[[t,e],[s,n],[o,r],[t,e]],rectangle:(t,e,s,n)=>[[t,e],[t+s,e],[t+s,e+n],[t,e+n],[t,e]]}},6363:(t,e,s)=>{const{GameNode:n}=s(7588),o=s(6550),r=s(4639),i=s(7030),h=s(5944);t.exports={getView:(t,e,s,a={},l={})=>{const d=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),c=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return d.length>0&&d.forEach((t=>{const n=[],o=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in o){const r=o[s],i=r[0],h=r[1];let d=Math.max(Math.min(i-e.x,100),0),c=Math.max(Math.min(h-e.y,100),0);d=(l.x||1)*d,c=(l.y||1)*c,(!a.filter||a.filter(t))&&(a.x&&(d+=a.x),a.y&&(c+=a.y)),d<0?d=0:d>100&&(d=100),c<0?c=0:c>100&&(c=100),n.push([d,c])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(n&&n.length&&(e.node.text&&(e.node.text.x=n[0][0],e.node.text.y=n[0][1]),n.length&&(e.node.coordinates2d=n),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],n=e.node.coordinates2d[2],o=s[0]-t[0],r=n[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=o,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>c.addChild(t))),c}}},3024:(t,e,s)=>{const{squish:n,unsquish:o}=s(506),{gameNode:r,GameNode:i}=s(4392),h=(s(122),s(3660)),a=s(6015),l=s(2837),d=s(1971),c=s(7821),u=s(5377),{terrainGenerator:f}=s(7414),y=s(1494),p=s(7119),g=s(7905),x=s(9522),E=s(308);t.exports={squish:n,unsquish:o,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:d,Squisher:p,ShapeUtils:c,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},7905:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(3524),this.http=s(6295),this.fs=s(4688),this.crypto=s(5140),this.path=s(4871),this.process=s(8183)}getConfigValue(t,e=undefined){const s=this.getConfig();let n=process.env[t]&&`${process.env[t]}`;if(void 0!==n)return"true"===n?n=!0:"false"===n&&(n=!1),console.log(`Using environment value: ${n} for key: ${t}`),n;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),n=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,n):(await downloadFileSync(this.info.id,e),this.initialized=!0,n)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,n)=>{this.existsLocally().then((o=>{o&&!t?(this.initialized=!0,s(o)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{n(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,n)=>{s?e(s):t(n)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,n)=>{const o=this.getHash(t),r=`${e}/${o}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{n(t)}))}))}}},7090:(t,e,s)=>{const n=s(4949),o=s(122),r=(t,e,s,r,i,h,a,l,d,c,u,f)=>{const y=new o(t,e,s,r,i,h,a,l,d,c,u,f);return n(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:n,fill:o,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:d,subtype:c,node:u,id:f}){this.node=u||r(t,e,s,n,o,i,h,a,l,d,c,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const n in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[n],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}free(){this.node.free()}}}},3660:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const n=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,o=Math.floor(Math.random()*n.length);return e[n[o]]}}},6015:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let n in s)if(e=s[n].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},4392:(t,e,s)=>{const n=s(1971),o=s(1494),{gameNode:r,BaseNode:i}=s(7090),h={[n.CIRCLE]:o.SHAPE_2D_CIRCLE,[n.POLYGON]:o.SHAPE_2D_POLYGON,[n.LINE]:o.SHAPE_2D_LINE},a={[o.SHAPE_2D_CIRCLE]:n.CIRCLE,[o.SHAPE_2D_POLYGON]:n.POLYGON,[o.SHAPE_2D_LINE]:n.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,id:c}){if(!(n&&s||d))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,subtype:h[s],id:c})}clone({handleClick:t,input:e,id:s}){const n=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:n})}}class d extends i{constructor({textInfo:t,playerIds:e,input:s,node:n,id:r}){if(!t&&!n)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:n,subtype:o.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new d({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:n})}}class c extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,subtype:o.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new c({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:n})}}const u={Asset:c,Shape:l,Text:d};t.exports={gameNode:r,GameNode:u}},122:t=>{t.exports=class{constructor(t,e,s,n,o,r,i,h=[],a=null,l=null,d=null,c=null){this.id=c?Number(c):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=n,this.fill=o,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=d}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},1971:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},7119:(t,e,s)=>{const{squish:n,unsquish:o}=s(506);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:n,onAssetUpdate:o}){if(this.ids=new Set,this.game=t,this.assets={},this.customBottomLayer=s,this.customTopLayer=n,this.initialize(),this.onAssetUpdate=o,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return o(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const n={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,n),s.push(t)}for(const o in t){const r=[],i=t[o],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,n),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,n),s.push(t)}return this.playerFrames=n,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},o={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=n(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0)for(let t of r)o[t]||(o[Number(t)]=[]),o[t].push(i);else Object.keys(o).forEach((t=>{o[t]||(o[Number(t)]=[]),o[t].push(i)}));for(let n=0;n<t.node.children.length;n++){const i=new Set(r);this.squishHelper(t.node.children[n],e,s,o,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const n=t[s].root;e[s]=n}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),n=this.game.constructor.metadata&&this.game.constructor.metadata(),o=n&&n.assets?n.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(o,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(o,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(o,this.game.getAssets());const r=Object.assign(s,o);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let n=0;const o=new Array(32);for(;n<32&&n<e.length;)o[n]=e.charCodeAt(n),n++;const l=(s.length+32).toString(36),d={image:1,audio:2,font:3}[r[e].info.type];let c="";for(let t=0;t<10-l.length;t++)c+="0";for(let t=l.length;t<10;t++)c+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,d,...u,...o,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let n=0;n<this.assets[s].length;n++)e[t++]=this.assets[s][n];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},2837:(t,e,s)=>{const{GameNode:n}=s(4392),o=s(1971),r=s(7821),i=s(3660),h=s(6015);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},182:(t,e,s)=>{const{GameNode:n}=s(4392);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:n.Asset,2:n.Shape,3:n.Text}}},308:t=>{t.exports={getPath:(t,e,s,n,o=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+n;if(a<0||a>o||l<0||l>r){let t=a,e=l;a<0?t=0:a>o&&(t=o),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},506:(t,e,s)=>{const n=s(122),{CONSTRUCTOR_TO_TYPE:o,TYPE_TO_CONSTRUCTOR:r}=s(182),i=s(5019),{squishId:h}=s(637),{squishColor:a}=s(9485),{squishPlayerIds:l}=s(3071),{squishPos:d}=s(8911),{squishFill:c}=s(3636),{squishSize:u}=s(5840),{squishHandleClick:f}=s(994),{squishBorder:y}=s(4687),{squishSubType:p}=s(858),{squishInput:g}=s(1178),{squishCoordinates2d:x}=s(9379),{squishEffect:E}=s(5611),{squishText:A}=s(5133),{squishAsset:m}=s(6212),S={id:h,color:a,playerIds:l,pos:d,coordinates2d:x,fill:c,size:u,text:A,asset:m,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in S)L[Number(S[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const n=t.node,r=(()=>{const t=Object.keys(S).filter((t=>S[t].dependsOn&&S[t].dependsOn.length>0));return[Object.keys(S).filter((t=>!S[t].dependsOn||0===S[t].dependsOn.length)),t].flat()})();for(const t in r){const o=r[t];if(o in n){const t=n[o];if(null!=t){const r=S[o].squish(t,e,n),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([S[o].type,a,h,...r])}}}let h=o[t.constructor.name];h||(h=o[i[n.subType]]);const a=s.flat(),l=a.length+5,d=Math.min(255,l),c=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),c,d,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new n;for(;e<t.length;){const n=t[e],o=t[e+1]+t[e+2],r=t.slice(e+3,e+o);if(!L[n]){console.warn("Unknown sub frame type "+n);break}{const t=L[n],e=(0,S[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=o}const o=r[t[4]];return o?new o({node:s}):{node:s}}}},6212:(t,e,s)=>{const{getFractional:n}=s(77),o={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],o=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,d=r.startTime||0;o[0]=Math.floor(i),o[1]=n(i),o[2]=Math.floor(h),o[3]=n(h),o[4]=Math.floor(a),o[5]=n(a),o[6]=Math.floor(l),o[7]=n(l),o[8]=Math.floor(d),o[9]=n(d);for(let t=0;t<s.length;t++)o[10+t]=s.codePointAt(t);return o},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t[6]+t[7]/100,r=t[8]+t[9]/100;return{[String.fromCodePoint.apply(null,t.slice(10))]:{pos:{x:e,y:s},size:{x:n,y:o},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:o}},4687:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},9485:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},9379:(t,e,s)=>{const{getFractional:n}=s(77),o=s(1494),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==o.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=n(t);const s=r(e.y,i[1]);let o;h[2]=s,h[3]=n(s),o=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(o),h[5]=n(o)}else{const t=i[0];h[0]=Math.floor(t),h[1]=n(t);const e=i[1];h[2]=Math.floor(e),h[3]=n(e);const s=i[2];h[4]=Math.round(s),h[5]=n(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,o=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=o,h[2*t+1]=n(o)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t[e]+t[e+1]/100;s[e/2]=n}if(e===o.SHAPE_2D_POLYGON||e===o.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},5611:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const n=new Array(s);for(let t=0;t<e.length;t++)n[t]=e.codePointAt(t);return n[e.length]=t.shadow.color[0],n[e.length+1]=t.shadow.color[1],n[e.length+2]=t.shadow.color[2],n[e.length+3]=t.shadow.color[3],t.shadow.blur&&(n[e.length+4]=Math.floor(t.shadow.blur/10),n[e.length+5]=t.shadow.blur%10),n}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let n;t.length>10&&(n=10*t[10]+t[11]);const o={[e]:{color:s}};return n&&(o[e].blur=n),o}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},3636:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},994:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},637:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},1178:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},3071:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},8911:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},5840:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},858:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},5133:(t,e,s)=>{const{hypLength:n}=s(77),o=s(3660),{squishColor:r}=s(9485),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const d=t.size||1,c=e?d*n(e.x,e.y):d;l[4]=Math.floor(c),l[5]=Math.round(100*(c-Math.floor(c)));const u=t.color||o.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let n=6+f.length+2+3*[...h].length;l[n+p]=Number(s[0]),l[n+p+1]=Number(s[1]),l[n+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let n;n=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let o=6+f.length+2+3*[...h].length+3*[...a].length;l[o+g]=Number(n[0]),l[o+g+1]=Number(n[1]),l[o+g+2]=Number(n[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let d=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let n=h[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;d.push(o)}const c=String.fromCodePoint.apply(null,d);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let n=a[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;u.push(o)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let n=l[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;y.push(o)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:n,color:o,align:c,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},5019:(t,e,s)=>{const{GameNode:n}=s(4392),o=s(1494);t.exports={[[o.ASSET]]:n.Asset,[[o.TEXT]]:n.Text,[[o.SHAPE_2D_POLYGON]]:n.Shape,[[o.SHAPE_2D_CIRCLE]]:n.Shape,[[o.SHAPE_2D_LINE]]:n.Shape}},1494:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},7414:(t,e,s)=>{const{getRandomTerrain:n,getRandomStartPoint:o}=s(8766),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const d=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);n()(d,o(h,a,e),h,a,e);const c=((t,e,s,n)=>{const o=[];for(let i=0;i<s;i++)for(let s=0;s<n;s++){const n=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(o.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){o.push(...n);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(n.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(d,e,h,a);return c?i(d,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:n,height:o}=((t,e)=>{const s=t.x,n=t.y,o=e.x,r=e.y;return{width:Math.floor(s/o),height:Math.floor(n/r)}})(t,e);let r=((t,e)=>{const s=[],n={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let o=0;o<t;o++){s[o]=[];for(let r=0;r<e;r++){const i={...n};0===o?i.west=!1:o===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[o].push(i)}}return s})(n,o);const h={x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*o)};return r=i(r,h,s,n,o),r}}},8766:t=>{const e=(t,{x:e,y:s},n,o,r)=>{e<0||e>=n||s<0||s>=o||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s+1,y:n+1},o,r,i)):1===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i)):2===h?(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n-1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n-1},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s,y:n+3},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+3,y:n},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-3,y:n},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s,y:n-3},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s+1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+2,y:n-1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n+1},o,r,i),e(t,{x:s+2,y:n+1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n-1},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const n={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;n.x===s.x&&n.y===s.y;)n.x=Math.floor(Math.random()*t),n.y=Math.floor(Math.random()*e);return n}}},9522:t=>{const e=(t,s,n,o=[])=>{if(!n||n(t)&&t.node.id!==s.node.id){const e=t.node.text,n=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=n[0][0],h=n[1][0],a=r[0][0],l=r[1][0],d=n[0][1],c=n[2][1],u=r[0][1],f=r[2][1];l<i||h<a||d>f||u>c||o.push(t)}for(const r in t.node.children)e(t.node.children[r],s,n,o);return o};t.exports={checkCollisions:(t,s,n=null)=>e(t,s,n)}},77:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},4949:t=>{t.exports=function(t,e){const s={get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,n){const o=Reflect.defineProperty(t,s,n);return e&&e(),o},deleteProperty(t,s){const n=Reflect.deleteProperty(t,s);return e&&e(),n}},n=Proxy.revocable(t,s);return t.free=()=>{n.revoke()},n.proxy}},7821:t=>{t.exports={triangle:(t,e,s,n,o,r)=>[[t,e],[s,n],[o,r],[t,e]],rectangle:(t,e,s,n)=>[[t,e],[t+s,e],[t+s,e+n],[t,e+n],[t,e]]}},5377:(t,e,s)=>{const{GameNode:n}=s(4392),o=s(1971),r=s(7821),i=s(9522),h=s(3660);t.exports={getView:(t,e,s,a={},l={})=>{const d=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),c=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return d.length>0&&d.forEach((t=>{const n=[],o=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in o){const r=o[s],i=r[0],h=r[1];let d=Math.max(Math.min(i-e.x,100),0),c=Math.max(Math.min(h-e.y,100),0);d=(l.x||1)*d,c=(l.y||1)*c,(!a.filter||a.filter(t))&&(a.x&&(d+=a.x),a.y&&(c+=a.y)),d<0?d=0:d>100&&(d=100),c<0?c=0:c>100&&(c=100),n.push([d,c])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(n&&n.length&&(e.node.text&&(e.node.text.x=n[0][0],e.node.text.y=n[0][1]),n.length&&(e.node.coordinates2d=n),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],n=e.node.coordinates2d[2],o=s[0]-t[0],r=n[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=o,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>c.addChild(t))),c}}},3811:(t,e,s)=>{const{squish:n,unsquish:o}=s(644),{gameNode:r,GameNode:i}=s(6819),h=(s(253),s(6578)),a=s(9852),l=s(3901),d=s(1268),c=s(2898),u=s(8153),{terrainGenerator:f}=s(3010),y=s(5361),p=s(9333),g=s(2889),x=s(4951),E=s(981);t.exports={squish:n,unsquish:o,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:d,Squisher:p,ShapeUtils:c,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},2889:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(7141),this.http=s(7557),this.fs=s(5456),this.crypto=s(9739),this.path=s(9942),this.process=s(5310)}getConfigValue(t,e=undefined){const s=this.getConfig();let n=process.env[t]&&`${process.env[t]}`;if(void 0!==n)return"true"===n?n=!0:"false"===n&&(n=!1),console.log(`Using environment value: ${n} for key: ${t}`),n;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),n=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,n):(await downloadFileSync(this.info.id,e),this.initialized=!0,n)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,n)=>{this.existsLocally().then((o=>{o&&!t?(this.initialized=!0,s(o)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{n(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,n)=>{s?e(s):t(n)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,n)=>{const o=this.getHash(t),r=`${e}/${o}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{n(t)}))}))}}},1695:(t,e,s)=>{const n=s(3001),o=s(253),r=(t,e,s,r,i,h,a,l,d,c,u,f)=>{const y=new o(t,e,s,r,i,h,a,l,d,c,u,f);return n(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:n,fill:o,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:d,subtype:c,node:u,id:f}){this.node=u||r(t,e,s,n,o,i,h,a,l,d,c,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const n in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[n],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}free(){this.node.free()}}}},6578:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const n=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,o=Math.floor(Math.random()*n.length);return e[n[o]]}}},9852:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let n in s)if(e=s[n].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},6819:(t,e,s)=>{const n=s(1268),o=s(5361),{gameNode:r,BaseNode:i}=s(1695),h={[n.CIRCLE]:o.SHAPE_2D_CIRCLE,[n.POLYGON]:o.SHAPE_2D_POLYGON,[n.LINE]:o.SHAPE_2D_LINE},a={[o.SHAPE_2D_CIRCLE]:n.CIRCLE,[o.SHAPE_2D_POLYGON]:n.POLYGON,[o.SHAPE_2D_LINE]:n.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,id:c}){if(!(n&&s||d))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,subtype:h[s],id:c})}clone({handleClick:t,input:e,id:s}){const n=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:n})}}class d extends i{constructor({textInfo:t,playerIds:e,input:s,node:n,id:r}){if(!t&&!n)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:n,subtype:o.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new d({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:n})}}class c extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,subtype:o.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new c({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:n})}}const u={Asset:c,Shape:l,Text:d};t.exports={gameNode:r,GameNode:u}},253:t=>{t.exports=class{constructor(t,e,s,n,o,r,i,h=[],a=null,l=null,d=null,c=null){this.id=c?Number(c):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=n,this.fill=o,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=d}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},1268:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},9333:(t,e,s)=>{const{squish:n,unsquish:o}=s(644);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:n,onAssetUpdate:o}){if(this.ids=new Set,this.game=t,this.gameMetadata=t.constructor.metadata&&t.constructor.metadata(),this.assets={},this.customBottomLayer=s,this.customTopLayer=n,this.initialize(),this.onAssetUpdate=o,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return o(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const n={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,n),s.push(t)}for(const o in t){const r=[],i=t[o],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,n),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,n),s.push(t)}return this.playerFrames=n,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},r={},i=new Set){t.node.listeners.has(this)||t.addListener(this);const h=n(t,s);if(e.push(h),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>i.add(t))),i.size>0){let e=new Set;for(let s of i)r[s]||(r[Number(s)]=[]),0===t.node.playerIds.length||t.node.playerIds.findIndex((t=>Number(t)===Number(s)))>=0?r[s].push(h):e.add(s);for(let t of e)i.delete(t)}else Object.keys(r).forEach((t=>{r[t]||(r[Number(t)]=[]),r[t].push(h)}));for(let n=0;n<t.node.children.length;n++){const o=new Set(i);this.squishHelper(t.node.children[n],e,s,r,o)}for(let t in r)for(let e in r[t]){const s=o(r[t][e]);if(s.node.playerIds.length>0&&s.node.playerIds.findIndex((e=>Number(e)===Number(t)))<0&&(console.log(s.node.playerIds),console.log(t),console.log(s.node.playerIds.indexOf(t)),254!=t))throw new Error("fuk")}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const n=t[s].root;e[s]=n}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),n=this.game.constructor.metadata&&this.game.constructor.metadata(),o=n&&n.assets?n.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(o,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(o,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(o,this.game.getAssets());const r=Object.assign(s,o);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let n=0;const o=new Array(32);for(;n<32&&n<e.length;)o[n]=e.charCodeAt(n),n++;const l=(s.length+32).toString(36),d={image:1,audio:2,font:3}[r[e].info.type];let c="";for(let t=0;t<10-l.length;t++)c+="0";for(let t=l.length;t<10;t++)c+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,d,...u,...o,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let n=0;n<this.assets[s].length;n++)e[t++]=this.assets[s][n];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},3901:(t,e,s)=>{const{GameNode:n}=s(6819),o=s(1268),r=s(2898),i=s(6578),h=s(9852);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},5707:(t,e,s)=>{const{GameNode:n}=s(6819);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:n.Asset,2:n.Shape,3:n.Text}}},981:t=>{t.exports={getPath:(t,e,s,n,o=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+n;if(a<0||a>o||l<0||l>r){let t=a,e=l;a<0?t=0:a>o&&(t=o),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},644:(t,e,s)=>{const n=s(253),{CONSTRUCTOR_TO_TYPE:o,TYPE_TO_CONSTRUCTOR:r}=s(5707),i=s(968),{squishId:h}=s(9715),{squishColor:a}=s(9321),{squishPlayerIds:l}=s(3696),{squishPos:d}=s(9621),{squishFill:c}=s(7668),{squishSize:u}=s(4445),{squishHandleClick:f}=s(1978),{squishBorder:y}=s(76),{squishSubType:p}=s(7795),{squishInput:g}=s(8522),{squishCoordinates2d:x}=s(7490),{squishEffect:E}=s(3700),{squishText:A}=s(6621),{squishAsset:m}=s(5714),S={id:h,color:a,playerIds:l,pos:d,coordinates2d:x,fill:c,size:u,text:A,asset:m,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in S)L[Number(S[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const n=t.node,r=(()=>{const t=Object.keys(S).filter((t=>S[t].dependsOn&&S[t].dependsOn.length>0));return[Object.keys(S).filter((t=>!S[t].dependsOn||0===S[t].dependsOn.length)),t].flat()})();for(const t in r){const o=r[t];if(o in n){const t=n[o];if(null!=t){const r=S[o].squish(t,e,n),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([S[o].type,a,h,...r])}}}let h=o[t.constructor.name];h||(h=o[i[n.subType]]);const a=s.flat(),l=a.length+5,d=Math.min(255,l),c=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),c,d,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new n;for(;e<t.length;){const n=t[e],o=t[e+1]+t[e+2],r=t.slice(e+3,e+o);if(!L[n]){console.warn("Unknown sub frame type "+n);break}{const t=L[n],e=(0,S[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=o}const o=r[t[4]];return o?new o({node:s}):{node:s}}}},5714:(t,e,s)=>{const{getFractional:n}=s(7935),o={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],o=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,d=r.startTime||0;o[0]=Math.floor(i),o[1]=n(i),o[2]=Math.floor(h),o[3]=n(h),o[4]=Math.floor(a),o[5]=n(a),o[6]=Math.floor(l),o[7]=n(l),o[8]=Math.floor(d),o[9]=n(d);for(let t=0;t<s.length;t++)o[10+t]=s.codePointAt(t);return o},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t[6]+t[7]/100,r=t[8]+t[9]/100;return{[String.fromCodePoint.apply(null,t.slice(10))]:{pos:{x:e,y:s},size:{x:n,y:o},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:o}},76:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},9321:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},7490:(t,e,s)=>{const{getFractional:n}=s(7935),o=s(5361),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==o.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=n(t);const s=r(e.y,i[1]);let o;h[2]=s,h[3]=n(s),o=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(o),h[5]=n(o)}else{const t=i[0];h[0]=Math.floor(t),h[1]=n(t);const e=i[1];h[2]=Math.floor(e),h[3]=n(e);const s=i[2];h[4]=Math.round(s),h[5]=n(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,o=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=o,h[2*t+1]=n(o)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t[e]+t[e+1]/100;s[e/2]=n}if(e===o.SHAPE_2D_POLYGON||e===o.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},3700:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const n=new Array(s);for(let t=0;t<e.length;t++)n[t]=e.codePointAt(t);return n[e.length]=t.shadow.color[0],n[e.length+1]=t.shadow.color[1],n[e.length+2]=t.shadow.color[2],n[e.length+3]=t.shadow.color[3],t.shadow.blur&&(n[e.length+4]=Math.floor(t.shadow.blur/10),n[e.length+5]=t.shadow.blur%10),n}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let n;t.length>10&&(n=10*t[10]+t[11]);const o={[e]:{color:s}};return n&&(o[e].blur=n),o}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},7668:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},1978:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},9715:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},8522:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},3696:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},9621:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},4445:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},7795:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},6621:(t,e,s)=>{const{hypLength:n}=s(7935),o=s(6578),{squishColor:r}=s(9321),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const d=t.size||1,c=e?d*n(e.x,e.y):d;l[4]=Math.floor(c),l[5]=Math.round(100*(c-Math.floor(c)));const u=t.color||o.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let n=6+f.length+2+3*[...h].length;l[n+p]=Number(s[0]),l[n+p+1]=Number(s[1]),l[n+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let n;n=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let o=6+f.length+2+3*[...h].length+3*[...a].length;l[o+g]=Number(n[0]),l[o+g+1]=Number(n[1]),l[o+g+2]=Number(n[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let d=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let n=h[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;d.push(o)}const c=String.fromCodePoint.apply(null,d);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let n=a[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;u.push(o)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let n=l[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;y.push(o)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:n,color:o,align:c,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},968:(t,e,s)=>{const{GameNode:n}=s(6819),o=s(5361);t.exports={[[o.ASSET]]:n.Asset,[[o.TEXT]]:n.Text,[[o.SHAPE_2D_POLYGON]]:n.Shape,[[o.SHAPE_2D_CIRCLE]]:n.Shape,[[o.SHAPE_2D_LINE]]:n.Shape}},5361:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},3010:(t,e,s)=>{const{getRandomTerrain:n,getRandomStartPoint:o}=s(6892),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const d=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);n()(d,o(h,a,e),h,a,e);const c=((t,e,s,n)=>{const o=[];for(let i=0;i<s;i++)for(let s=0;s<n;s++){const n=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(o.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){o.push(...n);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(n.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(d,e,h,a);return c?i(d,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:n,height:o}=((t,e)=>{const s=t.x,n=t.y,o=e.x,r=e.y;return{width:Math.floor(s/o),height:Math.floor(n/r)}})(t,e);let r=((t,e)=>{const s=[],n={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let o=0;o<t;o++){s[o]=[];for(let r=0;r<e;r++){const i={...n};0===o?i.west=!1:o===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[o].push(i)}}return s})(n,o);const h={x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*o)};return r=i(r,h,s,n,o),r}}},6892:t=>{const e=(t,{x:e,y:s},n,o,r)=>{e<0||e>=n||s<0||s>=o||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s+1,y:n+1},o,r,i)):1===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i)):2===h?(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n-1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n-1},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s,y:n+3},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+3,y:n},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-3,y:n},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s,y:n-3},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s+1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+2,y:n-1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n+1},o,r,i),e(t,{x:s+2,y:n+1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n-1},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const n={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;n.x===s.x&&n.y===s.y;)n.x=Math.floor(Math.random()*t),n.y=Math.floor(Math.random()*e);return n}}},4951:t=>{const e=(t,s,n,o=[])=>{if(!n||n(t)&&t.node.id!==s.node.id){const e=t.node.text,n=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=n[0][0],h=n[1][0],a=r[0][0],l=r[1][0],d=n[0][1],c=n[2][1],u=r[0][1],f=r[2][1];l<i||h<a||d>f||u>c||o.push(t)}for(const r in t.node.children)e(t.node.children[r],s,n,o);return o};t.exports={checkCollisions:(t,s,n=null)=>e(t,s,n)}},7935:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},3001:t=>{t.exports=function(t,e){const s={get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,n){const o=Reflect.defineProperty(t,s,n);return e&&e(),o},deleteProperty(t,s){const n=Reflect.deleteProperty(t,s);return e&&e(),n}},n=Proxy.revocable(t,s);return t.free=()=>{n.revoke()},n.proxy}},2898:t=>{t.exports={triangle:(t,e,s,n,o,r)=>[[t,e],[s,n],[o,r],[t,e]],rectangle:(t,e,s,n)=>[[t,e],[t+s,e],[t+s,e+n],[t,e+n],[t,e]]}},8153:(t,e,s)=>{const{GameNode:n}=s(6819),o=s(1268),r=s(2898),i=s(4951),h=s(6578);t.exports={getView:(t,e,s,a={},l={})=>{const d=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),c=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return d.length>0&&d.forEach((t=>{const n=[],o=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in o){const r=o[s],i=r[0],h=r[1];let d=Math.max(Math.min(i-e.x,100),0),c=Math.max(Math.min(h-e.y,100),0);d=(l.x||1)*d,c=(l.y||1)*c,(!a.filter||a.filter(t))&&(a.x&&(d+=a.x),a.y&&(c+=a.y)),d<0?d=0:d>100&&(d=100),c<0?c=0:c>100&&(c=100),n.push([d,c])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(n&&n.length&&(e.node.text&&(e.node.text.x=n[0][0],e.node.text.y=n[0][1]),n.length&&(e.node.coordinates2d=n),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],n=e.node.coordinates2d[2],o=s[0]-t[0],r=n[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=o,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>c.addChild(t))),c}}},1333:(t,e,s)=>{const{squish:n,unsquish:o}=s(7983),{gameNode:r,GameNode:i}=s(3532),h=(s(56),s(4784)),a=s(9367),l=s(2797),d=s(8849),c=s(9137),u=s(6298),{terrainGenerator:f}=s(9907),y=s(5830),p=s(7226),g=s(972),x=s(3526),E=s(6636);t.exports={squish:n,unsquish:o,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:d,Squisher:p,ShapeUtils:c,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},972:(t,e,s)=>{const n=s(737),{getAppDataPath:o}=s(4290);t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(8993),this.http=s(4807),this.fs=s(7386),this.crypto=s(6115),this.path=s(737),this.process=s(1284)}getConfigValue(t,e=undefined){const s=this.getConfig();let n=process.env[t]&&`${process.env[t]}`;if(void 0!==n)return"true"===n?n=!0:"false"===n&&(n=!1),console.log(`Using environment value: ${n} for key: ${t}`),n;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){const t=this.getHash(this.info.id);return`${n.join(o(),"asset-cache")}/${t}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=n.join(o(),"asset-cache");fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),r=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,r):(await downloadFileSync(this.info.id,e),this.initialized=!0,r)}download(t){const e=n.join(o(),"asset-cache");return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,n)=>{this.existsLocally().then((o=>{o&&!t?(this.initialized=!0,s(o)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{n(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,n)=>{s?e(s):t(n)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,n)=>{const o=this.getHash(t),r=`${e}/${o}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{n(t)}))}))}}},7055:(t,e,s)=>{const n=s(335),o=s(56),r=(t,e,s,r,i,h,a,l,d,c,u,f)=>{const y=new o(t,e,s,r,i,h,a,l,d,c,u,f);return n(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:n,fill:o,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:d,subtype:c,node:u,id:f}){this.node=u||r(t,e,s,n,o,i,h,a,l,d,c,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const n in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[n],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}free(){this.node.free()}}}},4784:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const n=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,o=Math.floor(Math.random()*n.length);return e[n[o]]}}},9367:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let n in s)if(e=s[n].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},3532:(t,e,s)=>{const n=s(8849),o=s(5830),{gameNode:r,BaseNode:i}=s(7055),h={[n.CIRCLE]:o.SHAPE_2D_CIRCLE,[n.POLYGON]:o.SHAPE_2D_POLYGON,[n.LINE]:o.SHAPE_2D_LINE},a={[o.SHAPE_2D_CIRCLE]:n.CIRCLE,[o.SHAPE_2D_POLYGON]:n.POLYGON,[o.SHAPE_2D_LINE]:n.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,id:c}){if(!(n&&s||d))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,subtype:h[s],id:c})}clone({handleClick:t,input:e,id:s}){const n=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:n})}}class d extends i{constructor({textInfo:t,playerIds:e,input:s,node:n,id:r}){if(!t&&!n)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:n,subtype:o.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new d({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:n})}}class c extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,subtype:o.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new c({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:n})}}const u={Asset:c,Shape:l,Text:d};t.exports={gameNode:r,GameNode:u}},56:t=>{t.exports=class{constructor(t,e,s,n,o,r,i,h=[],a=null,l=null,d=null,c=null){this.id=c?Number(c):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=n,this.fill=o,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=d}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},8849:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},7226:(t,e,s)=>{const{squish:n,unsquish:o}=s(7983);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:n,onAssetUpdate:o}){if(this.ids=new Set,this.game=t,this.gameMetadata=t.constructor.metadata&&t.constructor.metadata(),this.assets={},this.customBottomLayer=s,this.customTopLayer=n,this.initialize(),this.onAssetUpdate=o,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return o(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const n={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,n),s.push(t)}for(const o in t){const r=[],i=t[o],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,n),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,n),s.push(t)}return this.playerFrames=n,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},r={},i=new Set){t.node.listeners.has(this)||t.addListener(this);const h=n(t,s);if(e.push(h),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>i.add(t))),i.size>0){let e=new Set;for(let s of i)r[s]||(r[Number(s)]=[]),0===t.node.playerIds.length||t.node.playerIds.findIndex((t=>Number(t)===Number(s)))>=0?r[s].push(h):e.add(s);for(let t of e)i.delete(t)}else Object.keys(r).forEach((t=>{r[t]||(r[Number(t)]=[]),r[t].push(h)}));for(let n=0;n<t.node.children.length;n++){const o=new Set(i);this.squishHelper(t.node.children[n],e,s,r,o)}for(let t in r)for(let e in r[t]){const s=o(r[t][e]);if(s.node.playerIds.length>0&&s.node.playerIds.findIndex((e=>Number(e)===Number(t)))<0&&(console.log(s.node.playerIds),console.log(t),console.log(s.node.playerIds.indexOf(t)),254!=t))throw new Error("fuk")}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const n=t[s].root;e[s]=n}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),n=this.game.constructor.metadata&&this.game.constructor.metadata(),o=n&&n.assets?n.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(o,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(o,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(o,this.game.getAssets());const r=Object.assign(s,o);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let n=0;const o=new Array(32);for(;n<32&&n<e.length;)o[n]=e.charCodeAt(n),n++;const l=(s.length+32).toString(36),d={image:1,audio:2,font:3}[r[e].info.type];let c="";for(let t=0;t<10-l.length;t++)c+="0";for(let t=l.length;t<10;t++)c+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,d,...u,...o,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let n=0;n<this.assets[s].length;n++)e[t++]=this.assets[s][n];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},2797:(t,e,s)=>{const{GameNode:n}=s(3532),o=s(8849),r=s(9137),i=s(4784),h=s(9367);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},9626:(t,e,s)=>{const{GameNode:n}=s(3532);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:n.Asset,2:n.Shape,3:n.Text}}},6636:t=>{t.exports={getPath:(t,e,s,n,o=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+n;if(a<0||a>o||l<0||l>r){let t=a,e=l;a<0?t=0:a>o&&(t=o),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},7983:(t,e,s)=>{const n=s(56),{CONSTRUCTOR_TO_TYPE:o,TYPE_TO_CONSTRUCTOR:r}=s(9626),i=s(7253),{squishId:h}=s(8874),{squishColor:a}=s(2879),{squishPlayerIds:l}=s(5410),{squishPos:d}=s(2579),{squishFill:c}=s(9409),{squishSize:u}=s(7709),{squishHandleClick:f}=s(3409),{squishBorder:y}=s(3593),{squishSubType:p}=s(6937),{squishInput:g}=s(1366),{squishCoordinates2d:x}=s(247),{squishEffect:E}=s(873),{squishText:A}=s(5017),{squishAsset:m}=s(7203),S={id:h,color:a,playerIds:l,pos:d,coordinates2d:x,fill:c,size:u,text:A,asset:m,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in S)L[Number(S[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const n=t.node,r=(()=>{const t=Object.keys(S).filter((t=>S[t].dependsOn&&S[t].dependsOn.length>0));return[Object.keys(S).filter((t=>!S[t].dependsOn||0===S[t].dependsOn.length)),t].flat()})();for(const t in r){const o=r[t];if(o in n){const t=n[o];if(null!=t){const r=S[o].squish(t,e,n),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([S[o].type,a,h,...r])}}}let h=o[t.constructor.name];h||(h=o[i[n.subType]]);const a=s.flat(),l=a.length+5,d=Math.min(255,l),c=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),c,d,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new n;for(;e<t.length;){const n=t[e],o=t[e+1]+t[e+2],r=t.slice(e+3,e+o);if(!L[n]){console.warn("Unknown sub frame type "+n);break}{const t=L[n],e=(0,S[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=o}const o=r[t[4]];return o?new o({node:s}):{node:s}}}},7203:(t,e,s)=>{const{getFractional:n}=s(7384),o={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],o=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,d=r.startTime||0;o[0]=Math.floor(i),o[1]=n(i),o[2]=Math.floor(h),o[3]=n(h),o[4]=Math.floor(a),o[5]=n(a),o[6]=Math.floor(l),o[7]=n(l),o[8]=Math.floor(d),o[9]=n(d);for(let t=0;t<s.length;t++)o[10+t]=s.codePointAt(t);return o},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t[6]+t[7]/100,r=t[8]+t[9]/100;return{[String.fromCodePoint.apply(null,t.slice(10))]:{pos:{x:e,y:s},size:{x:n,y:o},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:o}},3593:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},2879:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},247:(t,e,s)=>{const{getFractional:n}=s(7384),o=s(5830),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==o.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=n(t);const s=r(e.y,i[1]);let o;h[2]=s,h[3]=n(s),o=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(o),h[5]=n(o)}else{const t=i[0];h[0]=Math.floor(t),h[1]=n(t);const e=i[1];h[2]=Math.floor(e),h[3]=n(e);const s=i[2];h[4]=Math.round(s),h[5]=n(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,o=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=o,h[2*t+1]=n(o)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t[e]+t[e+1]/100;s[e/2]=n}if(e===o.SHAPE_2D_POLYGON||e===o.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},873:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const n=new Array(s);for(let t=0;t<e.length;t++)n[t]=e.codePointAt(t);return n[e.length]=t.shadow.color[0],n[e.length+1]=t.shadow.color[1],n[e.length+2]=t.shadow.color[2],n[e.length+3]=t.shadow.color[3],t.shadow.blur&&(n[e.length+4]=Math.floor(t.shadow.blur/10),n[e.length+5]=t.shadow.blur%10),n}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let n;t.length>10&&(n=10*t[10]+t[11]);const o={[e]:{color:s}};return n&&(o[e].blur=n),o}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},9409:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},3409:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},8874:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},1366:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},5410:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},2579:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},7709:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},6937:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},5017:(t,e,s)=>{const{hypLength:n}=s(7384),o=s(4784),{squishColor:r}=s(2879),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const d=t.size||1,c=e?d*n(e.x,e.y):d;l[4]=Math.floor(c),l[5]=Math.round(100*(c-Math.floor(c)));const u=t.color||o.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let n=6+f.length+2+3*[...h].length;l[n+p]=Number(s[0]),l[n+p+1]=Number(s[1]),l[n+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let n;n=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let o=6+f.length+2+3*[...h].length+3*[...a].length;l[o+g]=Number(n[0]),l[o+g+1]=Number(n[1]),l[o+g+2]=Number(n[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let d=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let n=h[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;d.push(o)}const c=String.fromCodePoint.apply(null,d);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let n=a[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;u.push(o)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let n=l[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;y.push(o)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:n,color:o,align:c,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},7253:(t,e,s)=>{const{GameNode:n}=s(3532),o=s(5830);t.exports={[[o.ASSET]]:n.Asset,[[o.TEXT]]:n.Text,[[o.SHAPE_2D_POLYGON]]:n.Shape,[[o.SHAPE_2D_CIRCLE]]:n.Shape,[[o.SHAPE_2D_LINE]]:n.Shape}},5830:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},9907:(t,e,s)=>{const{getRandomTerrain:n,getRandomStartPoint:o}=s(5607),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const d=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);n()(d,o(h,a,e),h,a,e);const c=((t,e,s,n)=>{const o=[];for(let i=0;i<s;i++)for(let s=0;s<n;s++){const n=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(o.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){o.push(...n);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(n.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(d,e,h,a);return c?i(d,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:n,height:o}=((t,e)=>{const s=t.x,n=t.y,o=e.x,r=e.y;return{width:Math.floor(s/o),height:Math.floor(n/r)}})(t,e);let r=((t,e)=>{const s=[],n={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let o=0;o<t;o++){s[o]=[];for(let r=0;r<e;r++){const i={...n};0===o?i.west=!1:o===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[o].push(i)}}return s})(n,o);const h={x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*o)};return r=i(r,h,s,n,o),r}}},5607:t=>{const e=(t,{x:e,y:s},n,o,r)=>{e<0||e>=n||s<0||s>=o||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s+1,y:n+1},o,r,i)):1===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i)):2===h?(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n-1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n-1},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s,y:n+3},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+3,y:n},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-3,y:n},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s,y:n-3},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s+1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+2,y:n-1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n+1},o,r,i),e(t,{x:s+2,y:n+1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n-1},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const n={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;n.x===s.x&&n.y===s.y;)n.x=Math.floor(Math.random()*t),n.y=Math.floor(Math.random()*e);return n}}},3526:t=>{const e=(t,s,n,o=[])=>{if(!n||n(t)&&t.node.id!==s.node.id){const e=t.node.text,n=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=n[0][0],h=n[1][0],a=r[0][0],l=r[1][0],d=n[0][1],c=n[2][1],u=r[0][1],f=r[2][1];l<i||h<a||d>f||u>c||o.push(t)}for(const r in t.node.children)e(t.node.children[r],s,n,o);return o};t.exports={checkCollisions:(t,s,n=null)=>e(t,s,n)}},7384:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},335:t=>{t.exports=function(t,e){const s={get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,n){const o=Reflect.defineProperty(t,s,n);return e&&e(),o},deleteProperty(t,s){const n=Reflect.deleteProperty(t,s);return e&&e(),n}},n=Proxy.revocable(t,s);return t.free=()=>{n.revoke()},n.proxy}},9137:t=>{t.exports={triangle:(t,e,s,n,o,r)=>[[t,e],[s,n],[o,r],[t,e]],rectangle:(t,e,s,n)=>[[t,e],[t+s,e],[t+s,e+n],[t,e+n],[t,e]]}},6298:(t,e,s)=>{const{GameNode:n}=s(3532),o=s(8849),r=s(9137),i=s(3526),h=s(4784);t.exports={getView:(t,e,s,a={},l={})=>{const d=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),c=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return d.length>0&&d.forEach((t=>{const n=[],o=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in o){const r=o[s],i=r[0],h=r[1];let d=Math.max(Math.min(i-e.x,100),0),c=Math.max(Math.min(h-e.y,100),0);d=(l.x||1)*d,c=(l.y||1)*c,(!a.filter||a.filter(t))&&(a.x&&(d+=a.x),a.y&&(c+=a.y)),d<0?d=0:d>100&&(d=100),c<0?c=0:c>100&&(c=100),n.push([d,c])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(n&&n.length&&(e.node.text&&(e.node.text.x=n[0][0],e.node.text.y=n[0][1]),n.length&&(e.node.coordinates2d=n),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],n=e.node.coordinates2d[2],o=s[0]-t[0],r=n[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=o,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>c.addChild(t))),c}}},4290:(t,e,s)=>{const n=s(737);t.exports={getAppDataPath:()=>{if(!process)return"";switch(process.platform){case"darwin":return n.join(process.env.HOME,"Library","Application Support","homegames");case"win32":return n.join(process.env.APPDATA,"homegames");case"linux":return n.join(process.env.HOME,".homegames");default:console.log("Unsupported platform!"),process.exit(1)}}}},6672:(t,e,s)=>{const{Homepad:n}=s(9645),o=new n,r={"0756":s(6277),"0762":s(4764),"0765":s(484),"0766":s(6175),"0767":s(3024),1e3:s(3811),1004:s(1333)};let i,{squish:h,unsquish:a,Colors:l}=r["0766"];l=l.COLORS;const d=new Worker("socket.js"),c=document.getElementById("game"),u={};let f,y,p,g,x,E,A,m=!1,S=[];new Promise(((t,e)=>{fetch("/config.json").then((e=>{e.json().then((e=>{t(e)}))}))})).then((t=>{const e=t.HOME_PORT||7001;if(t.PUBLIC_CLIENT){const t=new URLSearchParams(window.location.search).get("code");if(t){const t=`${window.location.protocol}//${window.location.host}${window.location.pathname}`;window.history.pushState({path:t},"",t)}window.serverCode=t?t.toUpperCase():window.prompt("Enter server code").toUpperCase()}const s=document.getElementById("performance-data");d.onmessage=t=>{if(t.data.constructor===Object){if("SOCKET_CLOSE"===t.data.type&&(m=!1),"ERROR"===t.data.type){m=!1;const e=document.createElement("div"),s=document.createElement("div");s.innerHTML="Error: "+t.data.message;const n=document.createElement("a");n.href="https://public.homegames.link/code",n.innerHTML="Try again",e.appendChild(s),e.appendChild(n),(t=>{const e=document.createElement("div");e.style.position="absolute",e.style.width="100vw;",e.style.top="0",e.style["text-align"]="center",e.style["font-size"]="10vw",e.appendChild(t),document.body.appendChild(e)})(e)}}else if(f=new Uint8ClampedArray(t.data),2==f[0]){if(window.playerId=f[1],2==f.length&&d.postMessage({type:"finishReady",playerId:window.playerId}),f.length>2){const t=f[2],e=f[3];y={x:t,y:e},i={x:f[4],y:f[5]},f[6];const s=String.fromCharCode.apply(null,f.slice(7,7+f[6]));window.squishVersion=s;const n=r[s];n&&(h=n.squish,a=n.unsquish,l=n.Colors),R()}}else if(1==f[0])N(f);else if(9==f[0])y={x:f[1],y:f[2]},R();else if(5===f[0]){x=!1;let t=String(f[1])+(String(f[2]).length>1?f[2]:"0"+f[2]);const e=window.serverCode?"public.homegames.link":window.location.hostname,s=window.serverCode?82:t;d.postMessage({socketInfo:{hostname:e,playerId:window.playerId||null,port:Number(s),secure:"localhost"!==window.location.host&&window.isSecureContext,serverCode:window.serverCode,spectating:x}})}else if(6===f[0]){x=!0;let t=String(f[1])+(String(f[2]).length>1?f[2]:"0"+f[2]);const e=window.serverCode?"public.homegames.link":window.location.hostname,s=window.serverCode?82:t;d.postMessage({socketInfo:{hostname:e,playerId:window.playerId||null,port:Number(s),secure:"localhost"!==window.location.host&&window.isSecureContext,serverCode:window.serverCode,spectating:x}})}else if(7===f[0])p();else if(8===f[0]){let t=String(f[1])+(String(f[2]).length>1?f[2]:"0"+f[2]);if(!E){const e=window.location.hostname;E=new WebSocket(`wss://${e}:${t}`),E.onopen=()=>{console.log("hot client opened")},E.onerror=t=>{console.log("hot client err"),console.log(t)},E.onmessage=t=>{"reload"===t.data&&location.reload()}}}else 3!=f[0]||m||(m=!0,B())};const n=document.createElement("canvas"),o=document.createElement("canvas"),c=document.createElement("h3"),u=document.createElement("h3"),p=()=>{if(!A){A=!0;const t=document.createElement("div"),e=document.createElement("div");t.style="float: left; margin-right: 50px",e.style="float: left",t.appendChild(n),e.appendChild(o),s.appendChild(t),t.appendChild(c),s.appendChild(e),e.appendChild(u)}},g=window.serverCode?"public.homegames.link":window.location.hostname,S=window.serverCode?82:e;d.postMessage({socketInfo:{hostname:g,playerId:window.playerId||null,port:S,secure:"localhost"!==window.location.host&&window.isSecureContext,serverCode:window.serverCode}}),(()=>{const t=(()=>{const t=navigator.userAgent,e={};/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(t)?e.deviceType="tablet":/Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(t)?e.deviceType="mobile":navigator.maxTouchPoints&&navigator.maxTouchPoints>2?e.deviceType="tablet":e.deviceType="desktop";const s=window.innerWidth,n=window.innerHeight;let o=null;return s&&n&&(o=s/n),e.aspectRatio=o,e})(),e={clientInfo:t},s=new URLSearchParams(window.location.search);if(s.get("gameId")&&s.get("versionId")){const t=s.get("gameId"),n=s.get("versionId"),o=`${window.location.protocol}//${window.location.host}${window.location.pathname}`;window.history.pushState({path:o},"",o),e.requestedGame={gameId:t,versionId:n}}d.postMessage(e)})()})),window.playerId=null;let L=!1;const w={};let C,T;const _={},O={},I=document.getElementById("homegames-main"),P=l.BLACK;I.style.background=`rgba(${P[0]}, ${P[1]}, ${P[2]}, ${P[3]})`;const M=c.getContext("2d",{alpha:!1}),R=()=>{const t=window.innerWidth,e=window.innerHeight;let s,n;if(t*y.y/y.x<=e){const t=window.innerWidth;n=t,s=Math.floor(t*(y.y/y.x))}else{const t=window.innerHeight;n=Math.floor(t*(y.x/y.y)),s=t}c.height=2*s,c.width=2*n,g=.5*c.width,clientHeight=.5*c.height,c.style.height=`${clientHeight}px`,c.style.width=`${g}px`},N=t=>{let e=0;for(;t&&e<t.length;)if(1===t[e]){const s=t[e+1];if(1===s){const s=String.fromCharCode.apply(null,t.slice(e+2,e+12)),n=parseInt(s,36),o=t.slice(e+12,e+12+32),r=t.slice(e+12+32,e+12+n),i=String.fromCharCode.apply(null,o.filter((t=>t)));let h="";for(let t=0;t<r.length;t++)h+=String.fromCharCode(r[t]);const a=btoa(h);_[i]={type:"image",data:"data:image/jpeg;base64,"+a},e+=12+n}else if(2===s){const s=String.fromCharCode.apply(null,t.slice(e+2,e+12)),n=parseInt(s,36),o=t.slice(e+12,e+12+32),r=t.slice(e+12+32,e+12+n),i=String.fromCharCode.apply(null,o.filter((t=>t)));C?C.decodeAudioData(r.buffer,(t=>{_[i]={type:"audio",data:t,decoded:!0}}),(t=>{console.log("unable to decode audio data"),console.log(t)})):_[i]={type:"audio",data:r.buffer,decoded:!1},e+=12+n}else if(3===s){const s=String.fromCharCode.apply(null,t.slice(e+2,e+12)),n=parseInt(s,36),o=t.slice(e+12,e+12+32),r=t.slice(e+12+32,e+12+n),i=String.fromCharCode.apply(null,o.filter((t=>t))),h=new FontFace(i,r);h&&h.load().then((t=>{document.fonts.add(t),_[i]={type:"font",data:t,name:i}})),e+=12+n}else console.error("Unknown asset type: "+s)}};let q,b,$=[];function G(t){const e=new Set(Object.keys(u));M.clearRect(0,0,c.width,c.height);let s=0;for($=[];t&&s<t.length;){t[s];const n="0750"===window.squishVersion||"0751"===window.squishVersion?t[s+1]:t[s+1]+t[s+2]+t[s+3];let o=a(t.slice(s,s+n)).node;if(!o.coordinates2d&&o.input&&o.text){const t=Math.floor(c.width),e=o.text.size/100*t;M.font=e+"px sans-serif";const s=M.measureText(o.text.text);let n=o.text.x*c.width/100;o.text.align&&"center"==o.text.align&&(n-=s.width/2),n=n/c.width*100;const r=s.actualBoundingBoxDescent-s.actualBoundingBoxAscent,i=s.width/c.width*100,h=r/c.height*100,a=[!!o.handleClick,o.input&&o.input.type,o.id,[n,o.text.y,n+i,o.text.y,n+i,o.text.y+h,n,o.text.y+h,n,o.text.y]];$.push(a)}else if(null!==o.coordinates2d&&void 0!==o.coordinates2d){const t=[!!o.handleClick,o.input&&o.input.type,o.id,o.coordinates2d];if($.push(t),o.effects&&o.effects.shadow){const t=o.effects.shadow.color;M.shadowColor="rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")",o.effects.shadow.blur&&(M.shadowBlur=o.effects.shadow.blur)}if(o.color&&(M.globalAlpha=o.color[3]/255),null!==o.fill&&void 0!==o.fill&&(M.fillStyle="rgba("+o.fill[0]+","+o.fill[1]+","+o.fill[2]+","+o.fill[3]+")"),void 0!==o.border&&null!==o.border&&(M.lineWidth=o.border/255*.1*c.width,M.strokeStyle="rgba("+o.color[0]+","+o.color[1]+","+o.color[2]+","+o.color[3]+")"),null!==o.coordinates2d&&void 0!==o.coordinates2d){M.beginPath();const t=o.coordinates2d[0];M.moveTo(t[0]*c.width/100,t[1]*c.height/100);for(let t=1;t<o.coordinates2d.length;t++){const e=o.coordinates2d[t];M.lineTo(c.width/100*e[0],e[1]*c.height/100)}void 0!==o.fill&&null!==o.fill&&M.fill(),void 0!==o.border&&null!==o.border&&M.stroke()}M.shadowColor=null,M.shadowBlur=0,M.lineWidth=0,M.strokeStyle=null}if(o.text){M.globalAlpha=o.text.color[3]/255,M.fillStyle=`rgba(${o.text.color[0]}, ${o.text.color[1]}, ${o.text.color[2]}, ${o.text.color[3]})`;const t=Math.floor(c.width),e=o.text.size/100*t;M.font=e+"px "+(o.text.font&&"default"!==o.text.font?o.text.font:"sans-serif"),o.text.align&&(M.textAlign=o.text.align),M.textBaseline="top",M.fillText(o.text.text,o.text.x*c.width/100,o.text.y*c.height/100)}if(o.asset){const t=Object.keys(o.asset)[0];if(_[t]&&"audio"===_[t].type)!u[t]&&C&&_[t].decoded?(T=C.createBufferSource(),T.connect(C.destination),T.buffer=_[t].data,T.onended=()=>{delete u[t]},T.start(0,o.asset[t].startTime||0),u[t]=T):!u[t]&&C?console.warn("Cant play audio"):u[t]&&e.delete(t);else{const e=o.asset[t];let s;if(O[t]&&"loading"!==O[t]){if(s=O[t],s.width=e.size.x/100*c.width,s.height=e.size.y/100*c.height,o.effects&&o.effects.shadow){const t=o.effects.shadow.color;M.shadowColor="rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")",o.effects.shadow.blur&&(M.shadowBlur=o.effects.shadow.blur)}M.drawImage(s,e.pos.x/100*c.width,e.pos.y/100*c.height,s.width,s.height)}else O[t]||(s=new Image(e.size.x/100*c.width,e.size.y/100*c.height),O[t]="loading",s.onload=()=>{if(O[t]=s,o.effects&&o.effects.shadow){const t=o.effects.shadow.color;M.shadowColor="rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")",o.effects.shadow.blur&&(M.shadowBlur=o.effects.shadow.blur)}M.drawImage(s,e.pos.x/100*c.width,e.pos.y/100*c.height,s.width,s.height)},_[t]&&(s.src=_[t].data))}}s+=n,M.shadowColor=null,M.shadowBlur=0,M.lineWidth=0,M.strokeStyle=null,M.globalAlpha=1}e.forEach((t=>{u[t].stop()}))}const U=()=>{q=o.getGamepads()};function B(){if(m){if(A&&S.push({start:Date.now()}),Object.keys(w).filter((t=>w[t])).forEach((t=>k(t))),q&&q.length&&q.forEach((t=>{v(o.getGamepadState(t.index))})),p){const t=z(p[0],p[1]);L&&!b&&(D(t),b=setTimeout((()=>{b=null}),30)),t.isClickable||t.action?c.style.cursor="pointer":c.style.cursor="initial",p=null}if(f&&f.length>1&&3==f[0]&&G(f),A){const t=S[S.length-1];t.end=Date.now(),t.end,t.start,S.length%60==0&&Y()}window.requestAnimationFrame(B)}}window.addEventListener("gamepadconnected",U),window.addEventListener("gamepaddisconnected",U);let H=[];const Y=()=>{const t=S.length-60,e=S.length-1;let s=0;for(let n=t;n<=e;n++)s+=S[n].end-S[n].start;const n=s/60,o=S[e].end-S[t].start;H.push({avgRenderTime:n,lastNFrames:o});const r=(t,e,s,n)=>{const o=t.height,r=5+s/100*t.width,i=n/100*o;e.fillRect(r,i,5,5)},i=avgGraph.getContext("2d",{alpha:!1}),h=lastNGraph.getContext("2d",{alpha:!1});i.clearRect(0,0,avgGraph.width,avgGraph.height),h.clearRect(0,0,lastNGraph.width,lastNGraph.height),i.fillStyle="rgba(226, 114, 91, 255)",h.fillStyle="rgba(255, 192, 203, 255)",i.fillRect(0,0,avgGraph.width,avgGraph.height),h.fillRect(0,0,lastNGraph.width,lastNGraph.height),i.fillStyle="rgba(255, 0, 0, 255)",h.fillStyle="rgba(0, 255, 0, 255)",H.length>10&&(H=H.slice(H.length-10,H.length)),avgGraphLabel.innerHTML=n.toFixed(2)+" ms/render",lastNGraphLabel.innerHTML=Math.floor(1e3/(o/60))+" fps";for(let t=0;t<H.length;t++){const e=1e3/(H[t].lastNFrames/60);r(avgGraph,i,10*t,100-10*H[t].avgRenderTime),r(lastNGraph,h,10*t,100-e)}},D=function(t={}){if(!p)return;const e=p[0],s=p[1],n=(e-c.offsetLeft)/g*100,o=s/clientHeight*100;if(t.action){if("text"===t.action){L=!1;const e=prompt("Input text");d.postMessage(JSON.stringify({type:"input",input:e,nodeId:t.nodeId}))}else if("file"===t.action){L=!1;const e=document.getElementById("file-input");e.click(),e.onchange=s=>{if(e.files.length>0){const s=new FileReader;s.onload=e=>{d.postMessage(JSON.stringify({type:"input",input:new Uint8Array(s.result),nodeId:t.nodeId}))},s.readAsArrayBuffer(e.files[0])}}}}else if(n<=100&&o<=100){const t={type:"click",data:{x:n,y:o}};d.postMessage(JSON.stringify(t))}},v=t=>{d.postMessage(JSON.stringify({type:"input",gamepad:!0,input:t}))},k=function(t){const e={type:"keydown",key:t};d.postMessage(JSON.stringify(e))},F=()=>{if(!C){C=new(window.AudioContext||window.webkitAudioContext),"suspended"===C.state&&C.resume();for(const t in _)"audio"!==_[t].type||_[t].decoded||C.decodeAudioData(_[t].data,(e=>{_[t].data=e,_[t].decoded=!0}))}};document.addEventListener("touchstart",F,!1);const z=(t,e)=>{let s=!1,n=null,o=null;if(t<c.offsetLeft-window.scrollLeft)return!1;const r=t-c.offsetLeft-window.scrollX,h=e-window.scrollY,a=100*r/g,l=100*h/clientHeight,d=i.y/2,u=100-i.y/2,f=i.x/2,y=100-i.x/2;if(x&&a>f&&a<y&&l>d&&l<u)return!1;for(const r in $){const i=$[r];let h=i[3];if(!h||!h.length)continue;if(!h[0].length){let t=new Array(h.length/2);for(let e=0;e<h.length;e+=2)t[e/2]=[h[e],h[e+1]];h=t}let a=!1,l=K(h[0][0]),d=K(h[0][0]),c=j(h[0][1]),u=j(h[0][1]);for(let t=1;t<h.length;t++){const e=h[t];l=Math.min(K(e[0]),l),d=Math.max(K(e[0]),d),c=Math.min(j(e[1]),c),u=Math.max(j(e[1]),u)}if(!(t<l||t>d||e<c||e>u)){let s=0,n=h.length-1;for(;s<h.length;n=s++)j(h[s][1])>e!=j(h[n][1])>e&&t<(K(h[n][0])-K(h[s][0]))*(e-j(h[s][1]))/(j(h[n][1])-j(h[s][1]))+K(h[s][0])&&(a=!a)}a&&(s=i[0],n=i[1],o=i[2])}return{isClickable:s,action:n,nodeId:o}},K=t=>t*g/100+c.offsetLeft+window.scrollX,j=t=>t*clientHeight/100+c.offsetTop+window.scrollY;function W(t){return 1==t.key.length&&t.key>=" "&&t.key<="z"||t.keyCode>=36&&t.keyCode<=40||"Meta"===t.key||"Backspace"==t.key}window.addEventListener("mousedown",(function(t){L=!0,p=[t.clientX,t.clientY],F()})),window.addEventListener("mouseup",(function(t){L=!1})),c.addEventListener("mousemove",(function(t){})),window.addEventListener("touchstart",(function(t){t.preventDefault(),L=!0,p=[t.touches[0].clientX+window.scrollX,t.touches[0].clientY+window.scrollY]})),c.addEventListener("touchmove",(function(t){t.preventDefault(),L=!0,p=[t.touches[0].clientX+window.scrollX,t.touches[0].clientY+window.scrollY]})),window.addEventListener("touchend",(()=>{L=!1})),/Android/i.test(navigator.userAgent)||(document.addEventListener("keydown",(function(t){W(t)&&!w.Meta&&(t.preventDefault(),k(t.key),w[t.key]=!0)})),document.addEventListener("keyup",(function(t){W(t)&&(t.preventDefault(),function(t){const e={type:"keyup",key:t};d.postMessage(JSON.stringify(e))}(t.key),w[t.key]=!1)}))),window.addEventListener("mousemove",(t=>{p=[t.clientX+window.scrollX,t.clientY+window.scrollY]})),window.addEventListener("resize",(()=>{R(window.gameWidth,window.gameHeight),f&&f.length>1&&3==f[0]&&G(f),sendClientInfo()}))},3896:()=>{},3991:()=>{},871:()=>{},3741:()=>{},1753:()=>{},6551:()=>{},2625:()=>{},9121:()=>{},3245:()=>{},6936:()=>{},1542:()=>{},9417:()=>{},7027:()=>{},1418:()=>{},7622:()=>{},9886:()=>{},7701:()=>{},305:()=>{},314:()=>{},1590:()=>{},36:()=>{},4016:()=>{},1557:()=>{},2678:()=>{},5140:()=>{},4688:()=>{},6295:()=>{},3524:()=>{},4871:()=>{},8183:()=>{},9739:()=>{},5456:()=>{},7557:()=>{},7141:()=>{},9942:()=>{},5310:()=>{},6115:()=>{},7386:()=>{},4807:()=>{},8993:()=>{},737:()=>{},1284:()=>{}},e={};function s(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,s),r.exports}s.c=e,s(s.s=6672)})();