(()=>{var t={46866:t=>{t.exports={name:"DUALSHOCK 4 Wireless Controller",buttons:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SELECT:8,START:9,STICK_CLICK_1:10,STICK_CLICK_2:11,DIRECTION_UP:12,DIRECTION_DOWN:13,DIRECTION_LEFT:14,DIRECTION_RIGHT:15,HOME:16},sticks:{STICK_1_X:0,STICK_1_Y:1,STICK_2_X:2,STICK_2_Y:3},deadzones:{STICK_1_X:.08,STICK_1_Y:.08,STICK_2_X:.08,STICK_2_Y:.08}}},91085:t=>{t.exports={name:"Stadia Controller Extended Gamepad",buttons:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SELECT:8,START:9,STICK_CLICK_1:10,STICK_CLICK_2:11,DIRECTION_UP:12,DIRECTION_DOWN:13,DIRECTION_LEFT:14,DIRECTION_RIGHT:15,HOME:16},sticks:{STICK_1_X:0,STICK_1_Y:1,STICK_2_X:2,STICK_2_Y:3},deadzones:{STICK_1_X:.08,STICK_1_Y:.08,STICK_2_X:.08,STICK_2_Y:.08}}},11011:(t,e,s)=>{const{Buttons:o,Sticks:n}=s(69902),r=s(16636),i=t=>{for(let e in r){const s=r[e];if(t.indexOf(s.name)>=0)return s}return null},h=(t,e,s)=>({value:t[e.buttons[s]]&&t[e.buttons[s]].value,pressed:!(!t[e.buttons[s]]||!t[e.buttons[s]].pressed)}),a=(t,e,s)=>{const o=t[e.sticks[s]];if(e.deadzones&&e.deadzones[s]){const t=e.deadzones[s];return Math.abs(o)<t?{value:0}:o<0?{value:(o+t)/(1-t)}:{value:(o-t)/(1-t)}}return{value:o}};t.exports={Homepad:class{constructor(){if(!window)throw new Error("No window available");this.indexToMapping={},this.initializeListeners()}initializeListeners(){window.addEventListener("gamepadconnected",(t=>{const e=t.gamepad,s=i(e.id);s&&(this.indexToMapping[e.index]=s)})),window.addEventListener("gamepaddisconnected",(t=>{delete this.indexToMapping[gamepad.index]}))}getGamepadState(t){const e=navigator.getGamepads()[t],s=this.indexToMapping[t],o=((t,e)=>{const s={};for(let o in e.buttons)s[o]=h(t,e,o);return s})(e.buttons,s),n=((t,e)=>{const s={};for(let o in e.sticks)s[o]=a(t,e,o);return s})(e.axes,s);return{buttons:o,sticks:n}}getGamepads(){if(!navigator||!navigator.getGamepads)throw new Error("No gamepad API available");return navigator.getGamepads().filter((t=>t)).map((t=>({index:t.index,mapping:i(t.id)}))).filter((t=>!!t.mapping)).map((t=>({state:this.getGamepadState(t.index),...t})))}},Buttons:o,Sticks:n}},69902:()=>{},16636:(t,e,s)=>{const o=s(46866),n=s(91085);t.exports={DUALSHOCK_4:o,STADIA:n}},94497:(t,e,s)=>{const{squish:o,unsquish:n}=s(79419),{gameNode:r,GameNode:i}=s(77484),h=(s(99289),s(5554)),a=s(42044),l=s(46037),c=s(22916),d=s(68139),u=s(39583),{terrainGenerator:f}=s(2834),y=s(15029),p=s(81120),g=s(26712),x=s(63385),E=s(10093);t.exports={squish:o,unsquish:n,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:c,Squisher:p,ShapeUtils:d,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},26712:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(99105),this.http=s(61854),this.fs=s(68503),this.crypto=s(52957),this.path=s(15091),this.process=s(89757)}getConfigValue(t,e=void 0){const s=this.getConfig();let o=process.env[t]&&`${process.env[t]}`;if(void 0!==o)return"true"===o?o=!0:"false"===o&&(o=!1),console.log(`Using environment value: ${o} for key: ${t}`),o;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),o=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,o):(await downloadFileSync(this.info.id,e),this.initialized=!0,o)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,o)=>{this.existsLocally().then((n=>{n&&!t?(this.initialized=!0,s(n)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{o(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,o)=>{s?e(s):t(o)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,o)=>{const n=this.getHash(t),r=`${e}/${n}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{o(t)}))}))}}},16563:(t,e,s)=>{const o=s(39046),n=s(99289),r=(t,e,s,r,i,h,a,l,c,d,u,f)=>{const y=new n(t,e,s,r,i,h,a,l,c,d,u,f);return o(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:o,fill:n,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:c,subtype:d,node:u,id:f}){this.node=u||r(t,e,s,o,n,i,h,a,l,c,d,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const o in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[o],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}}}},5554:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const o=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,n=Math.floor(Math.random()*o.length);return e[o[n]]}}},42044:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let o in s)if(e=s[o].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},77484:(t,e,s)=>{const o=s(22916),n=s(15029),{gameNode:r,BaseNode:i}=s(16563),h={[o.CIRCLE]:n.SHAPE_2D_CIRCLE,[o.POLYGON]:n.SHAPE_2D_POLYGON,[o.LINE]:n.SHAPE_2D_LINE},a={[n.SHAPE_2D_CIRCLE]:o.CIRCLE,[n.SHAPE_2D_POLYGON]:o.POLYGON,[n.SHAPE_2D_LINE]:o.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,id:d}){if(!(o&&s||c))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,subtype:h[s],id:d})}clone({handleClick:t,input:e,id:s}){const o=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:o})}}class c extends i{constructor({textInfo:t,playerIds:e,input:s,node:o,id:r}){if(!t&&!o)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:o,subtype:n.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new c({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:o})}}class d extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,subtype:n.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new d({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:o})}}const u={Asset:d,Shape:l,Text:c};t.exports={gameNode:r,GameNode:u}},99289:t=>{t.exports=class{constructor(t,e,s,o,n,r,i,h=[],a=null,l=null,c=null,d=null){this.id=d?Number(d):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=o,this.fill=n,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=c}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},22916:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},81120:(t,e,s)=>{const{squish:o,unsquish:n}=s(79419);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:o,onAssetUpdate:n}){if(this.ids=new Set,this.game=t,this.assets={},this.customBottomLayer=s,this.customTopLayer=o,this.initialize(),this.onAssetUpdate=n,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return n(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const o={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,o),s.push(t)}for(const n in t){const r=[],i=t[n],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,o),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,o),s.push(t)}return this.playerFrames=o,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},n={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=o(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0)for(let t of r)n[t]||(n[Number(t)]=[]),n[t].push(i);else Object.keys(n).forEach((t=>{n[t]||(n[Number(t)]=[]),n[t].push(i)}));for(let o=0;o<t.node.children.length;o++){const i=new Set(r);this.squishHelper(t.node.children[o],e,s,n,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const o=t[s].root;e[s]=o}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),o=this.game.constructor.metadata&&this.game.constructor.metadata(),n=o&&o.assets?o.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(n,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(n,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(n,this.game.getAssets());const r=Object.assign(s,n);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let o=0;const n=new Array(32);for(;o<32&&o<e.length;)n[o]=e.charCodeAt(o),o++;const l=(s.length+32).toString(36),c={image:1,audio:2,font:3}[r[e].info.type];let d="";for(let t=0;t<10-l.length;t++)d+="0";for(let t=l.length;t<10;t++)d+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,c,...u,...n,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let o=0;o<this.assets[s].length;o++)e[t++]=this.assets[s][o];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.state=this.squish(this.game.getLayers()),this.broadcast()}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},46037:(t,e,s)=>{const{GameNode:o}=s(77484),n=s(22916),r=s(68139),i=s(5554),h=s(42044);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},92242:(t,e,s)=>{const{GameNode:o}=s(77484);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:o.Asset,2:o.Shape,3:o.Text}}},10093:t=>{t.exports={getPath:(t,e,s,o,n=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+o;if(a<0||a>n||l<0||l>r){let t=a,e=l;a<0?t=0:a>n&&(t=n),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},79419:(t,e,s)=>{const o=s(99289),{CONSTRUCTOR_TO_TYPE:n,TYPE_TO_CONSTRUCTOR:r}=s(92242),i=s(79596),{squishId:h}=s(88216),{squishColor:a}=s(32034),{squishPlayerIds:l}=s(3912),{squishPos:c}=s(2355),{squishFill:d}=s(87656),{squishSize:u}=s(48908),{squishHandleClick:f}=s(78215),{squishBorder:y}=s(22867),{squishSubType:p}=s(15395),{squishInput:g}=s(23293),{squishCoordinates2d:x}=s(18772),{squishEffect:E}=s(68408),{squishText:A}=s(59790),{squishAsset:S}=s(77725),m={id:h,color:a,playerIds:l,pos:c,coordinates2d:x,fill:d,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in m)L[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const o=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const n=r[t];if(n in o){const t=o[n];if(null!=t){const r=m[n].squish(t,e,o),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[n].type,a,h,...r])}}}let h=n[t.constructor.name];h||(h=n[i[o.subType]]);const a=s.flat(),l=a.length+5,c=Math.min(255,l),d=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),d,c,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new o;for(;e<t.length;){const o=t[e],n=t[e+1]+t[e+2],r=t.slice(e+3,e+n);if(!L[o]){console.warn("Unknown sub frame type "+o);break}{const t=L[o],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=n}const n=r[t[4]];return n?new n({node:s}):{node:s}}}},77725:(t,e,s)=>{const{getFractional:o}=s(48633),n={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],n=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,c=r.startTime||0;n[0]=Math.floor(i),n[1]=o(i),n[2]=Math.floor(h),n[3]=o(h),n[4]=Math.floor(a),n[5]=o(a),n[6]=Math.floor(l),n[7]=o(l),n[8]=Math.floor(c),n[9]=o(c);for(let t=0;t<s.length;t++)n[10+t]=s.codePointAt(t);return n},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t[6]+t[7]/100,r=t[8]+t[9]/100,i=String.fromCodePoint.apply(null,t.slice(10));return{[i]:{pos:{x:e,y:s},size:{x:o,y:n},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:n}},22867:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},32034:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},18772:(t,e,s)=>{const{getFractional:o}=s(48633),n=s(15029),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==n.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=o(t);const s=r(e.y,i[1]);let n;h[2]=s,h[3]=o(s),n=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(n),h[5]=o(n)}else{const t=i[0];h[0]=Math.floor(t),h[1]=o(t);const e=i[1];h[2]=Math.floor(e),h[3]=o(e);const s=i[2];h[4]=Math.round(s),h[5]=o(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,n=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=n,h[2*t+1]=o(n)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const o=t[e]+t[e+1]/100;s[e/2]=o}if(e===n.SHAPE_2D_POLYGON||e===n.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},68408:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const o=new Array(s);for(let t=0;t<e.length;t++)o[t]=e.codePointAt(t);return o[e.length]=t.shadow.color[0],o[e.length+1]=t.shadow.color[1],o[e.length+2]=t.shadow.color[2],o[e.length+3]=t.shadow.color[3],t.shadow.blur&&(o[e.length+4]=Math.floor(t.shadow.blur/10),o[e.length+5]=t.shadow.blur%10),o}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let o;t.length>10&&(o=10*t[10]+t[11]);const n={[e]:{color:s}};return o&&(n[e].blur=o),n}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},87656:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},78215:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},88216:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},23293:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},3912:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},2355:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},48908:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},15395:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},59790:(t,e,s)=>{const{hypLength:o}=s(48633),n=s(5554),{squishColor:r}=s(32034),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const c=t.size||1,d=e?c*o(e.x,e.y):c;l[4]=Math.floor(d),l[5]=Math.round(100*(d-Math.floor(d)));const u=t.color||n.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let o=6+f.length+2+3*[...h].length;l[o+p]=Number(s[0]),l[o+p+1]=Number(s[1]),l[o+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let o;o=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let n=6+f.length+2+3*[...h].length+3*[...a].length;l[n+g]=Number(o[0]),l[n+g+1]=Number(o[1]),l[n+g+2]=Number(o[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let c=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let o=h[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;c.push(n)}const d=String.fromCodePoint.apply(null,c);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let o=a[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;u.push(n)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let o=l[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;y.push(n)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:o,color:n,align:d,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},79596:(t,e,s)=>{const{GameNode:o}=s(77484),n=s(15029);t.exports={[[n.ASSET]]:o.Asset,[[n.TEXT]]:o.Text,[[n.SHAPE_2D_POLYGON]]:o.Shape,[[n.SHAPE_2D_CIRCLE]]:o.Shape,[[n.SHAPE_2D_LINE]]:o.Shape}},15029:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},2834:(t,e,s)=>{const{getRandomTerrain:o,getRandomStartPoint:n}=s(7438),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const c=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);o()(c,n(h,a,e),h,a,e);const d=((t,e,s,o)=>{const n=[];for(let i=0;i<s;i++)for(let s=0;s<o;s++){const o=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(n.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){n.push(...o);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(o.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(c,e,h,a);return d?i(c,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:o,height:n}=((t,e)=>{const s=t.x,o=t.y,n=e.x,r=e.y;return{width:Math.floor(s/n),height:Math.floor(o/r)}})(t,e);let r=((t,e)=>{const s=[],o={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let n=0;n<t;n++){s[n]=[];for(let r=0;r<e;r++){const i={...o};0===n?i.west=!1:n===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[n].push(i)}}return s})(o,n);const h={x:Math.floor(Math.random()*o),y:Math.floor(Math.random()*n)};return r=i(r,h,s,o,n),r}}},7438:t=>{const e=(t,{x:e,y:s},o,n,r)=>{e<0||e>=o||s<0||s>=n||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s+1,y:o+1},n,r,i)):1===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i)):2===h?(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o-1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o-1},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s,y:o+3},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+3,y:o},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-3,y:o},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s,y:o-3},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s+1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+2,y:o-1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o+1},n,r,i),e(t,{x:s+2,y:o+1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o-1},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const o={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;o.x===s.x&&o.y===s.y;)o.x=Math.floor(Math.random()*t),o.y=Math.floor(Math.random()*e);return o}}},63385:t=>{const e=(t,s,o,n=[])=>{if(!o||o(t)&&t.node.id!==s.node.id){const e=t.node.text,o=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=o[0][0],h=o[1][0],a=r[0][0],l=r[1][0],c=o[0][1],d=o[2][1],u=r[0][1],f=r[2][1];l<i||h<a||c>f||u>d||n.push(t)}for(const r in t.node.children)e(t.node.children[r],s,o,n);return n};t.exports={checkCollisions:(t,s,o=null)=>e(t,s,o)}},48633:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},39046:t=>{t.exports=function(t,e){return new Proxy(t,{get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,o){const n=Reflect.defineProperty(t,s,o);return e&&e(),n},deleteProperty(t,s){const o=Reflect.deleteProperty(t,s);return e&&e(),o}})}},68139:t=>{t.exports={triangle:(t,e,s,o,n,r)=>[[t,e],[s,o],[n,r],[t,e]],rectangle:(t,e,s,o)=>[[t,e],[t+s,e],[t+s,e+o],[t,e+o],[t,e]]}},39583:(t,e,s)=>{const{GameNode:o}=s(77484),n=s(22916),r=s(68139),i=s(63385),h=s(5554);t.exports={getView:(t,e,s,a={},l={})=>{const c=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),d=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return c.length>0&&c.forEach((t=>{const o=[],n=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in n){const r=n[s],i=r[0],h=r[1];let c=Math.max(Math.min(i-e.x,100),0),d=Math.max(Math.min(h-e.y,100),0);c=(l.x||1)*c,d=(l.y||1)*d,(!a.filter||a.filter(t))&&(a.x&&(c+=a.x),a.y&&(d+=a.y)),c<0?c=0:c>100&&(c=100),d<0?d=0:d>100&&(d=100),o.push([c,d])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(o&&o.length&&(e.node.text&&(e.node.text.x=o[0][0],e.node.text.y=o[0][1]),o.length&&(e.node.coordinates2d=o),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],o=e.node.coordinates2d[2],n=s[0]-t[0],r=o[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=n,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>d.addChild(t))),d}}},84718:(t,e,s)=>{const{squish:o,unsquish:n}=s(62286),{gameNode:r,GameNode:i}=s(4053),h=(s(58748),s(47039)),a=s(74193),l=s(48124),c=s(96513),d=s(7436),u=s(53714),{terrainGenerator:f}=s(64645),y=s(71060),p=s(63409),g=s(56523),x=s(97186),E=s(4262);t.exports={squish:o,unsquish:n,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:c,Squisher:p,ShapeUtils:d,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},56523:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(95236),this.http=s(80949),this.fs=s(432),this.crypto=s(32354),this.path=s(25824),this.process=s(76748)}getConfigValue(t,e=void 0){const s=this.getConfig();let o=process.env[t]&&`${process.env[t]}`;if(void 0!==o)return"true"===o?o=!0:"false"===o&&(o=!1),console.log(`Using environment value: ${o} for key: ${t}`),o;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),o=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,o):(await downloadFileSync(this.info.id,e),this.initialized=!0,o)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,o)=>{this.existsLocally().then((o=>{o&&!t?(this.initialized=!0,s(o)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,o)=>{s?e(s):t(o)}))}))}))}doDownload(t,e){return new Promise(((s,o)=>{const n=this.getHash(t),r=`${e}/${n}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{o(t)}))}))}}},94522:(t,e,s)=>{const o=s(91061),n=s(58748),r=(t,e,s,r,i,h,a,l,c,d,u,f)=>{const y=new n(t,e,s,r,i,h,a,l,c,d,u,f);return o(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:o,fill:n,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:c,subtype:d,node:u,id:f}){this.node=u||r(t,e,s,o,n,i,h,a,l,c,d,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const o in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[o],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}}}},47039:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const o=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,n=Math.floor(Math.random()*o.length);return e[o[n]]}}},74193:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let o in s)if(e=s[o].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},4053:(t,e,s)=>{const o=s(96513),n=s(71060),{gameNode:r,BaseNode:i}=s(94522),h={[o.CIRCLE]:n.SHAPE_2D_CIRCLE,[o.POLYGON]:n.SHAPE_2D_POLYGON,[o.LINE]:n.SHAPE_2D_LINE},a={[n.SHAPE_2D_CIRCLE]:o.CIRCLE,[n.SHAPE_2D_POLYGON]:o.POLYGON,[n.SHAPE_2D_LINE]:o.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,id:d}){if(!(o&&s||c))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,subtype:h[s],id:d})}clone({handleClick:t,input:e,id:s}){const o=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:o})}}class c extends i{constructor({textInfo:t,playerIds:e,input:s,node:o,id:r}){if(!t&&!o)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:o,subtype:n.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new c({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:o})}}class d extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,subtype:n.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new d({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:o})}}const u={Asset:d,Shape:l,Text:c};t.exports={gameNode:r,GameNode:u}},58748:t=>{t.exports=class{constructor(t,e,s,o,n,r,i,h=[],a=null,l=null,c=null,d=null){this.id=d?Number(d):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=o,this.fill=n,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=c}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},96513:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},63409:(t,e,s)=>{const{squish:o,unsquish:n}=s(62286);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:o,onAssetUpdate:n}){if(this.ids=new Set,this.game=t,this.assets={},this.customBottomLayer=s,this.customTopLayer=o,this.initialize(),this.onAssetUpdate=n,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return n(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const o={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,o),s.push(t)}for(const n in t){const r=[],i=t[n],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,o),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,o),s.push(t)}return this.playerFrames=o,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},n={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=o(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0)for(let t of r)n[t]||(n[Number(t)]=[]),n[t].push(i);else Object.keys(n).forEach((t=>{n[t]||(n[Number(t)]=[]),n[t].push(i)}));for(let o=0;o<t.node.children.length;o++){const i=new Set(r);this.squishHelper(t.node.children[o],e,s,n,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const o=t[s].root;e[s]=o}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),o=this.game.constructor.metadata&&this.game.constructor.metadata(),n=o&&o.assets?o.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(n,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(n,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(n,this.game.getAssets());const r=Object.assign(s,n);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let o=0;const n=new Array(32);for(;o<32&&o<e.length;)n[o]=e.charCodeAt(o),o++;const l=(s.length+32).toString(36),c="image"===r[e].info.type?1:2;let d="";for(let t=0;t<10-l.length;t++)d+="0";for(let t=l.length;t<10;t++)d+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,c,...u,...n,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let o=0;o<this.assets[s].length;o++)e[t++]=this.assets[s][o];this.assetBundle=e,t(e)}}))}))}handleStateChange(t,e){this.state=this.squish(this.game.getLayers()),this.broadcast()}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},48124:(t,e,s)=>{const{GameNode:o}=s(4053),n=s(96513),r=s(7436),i=s(47039),h=s(74193);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},95075:(t,e,s)=>{const{GameNode:o}=s(4053);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:o.Asset,2:o.Shape,3:o.Text}}},4262:t=>{t.exports={getPath:(t,e,s,o,n=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+o;if(a<0||a>n||l<0||l>r){let t=a,e=l;a<0?t=0:a>n&&(t=n),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},62286:(t,e,s)=>{const o=s(58748),{CONSTRUCTOR_TO_TYPE:n,TYPE_TO_CONSTRUCTOR:r}=s(95075),i=s(28425),{squishId:h}=s(389),{squishColor:a}=s(43601),{squishPlayerIds:l}=s(37879),{squishPos:c}=s(14772),{squishFill:d}=s(94209),{squishSize:u}=s(42353),{squishHandleClick:f}=s(45752),{squishBorder:y}=s(85090),{squishSubType:p}=s(20136),{squishInput:g}=s(15910),{squishCoordinates2d:x}=s(55983),{squishEffect:E}=s(18525),{squishText:A}=s(67799),{squishAsset:S}=s(66978),m={id:h,color:a,playerIds:l,pos:c,coordinates2d:x,fill:d,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in m)L[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const o=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const n=r[t];if(n in o){const t=o[n];if(null!=t){const r=m[n].squish(t,e,o),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[n].type,a,h,...r])}}}let h=n[t.constructor.name];h||(h=n[i[o.subType]]);const a=s.flat(),l=a.length+5,c=Math.min(255,l),d=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),d,c,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new o;for(;e<t.length;){const o=t[e],n=t[e+1]+t[e+2],r=t.slice(e+3,e+n);if(!L[o]){console.warn("Unknown sub frame type "+o);break}{const t=L[o],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=n}const n=r[t[4]];return n?new n({node:s}):{node:s}}}},66978:(t,e,s)=>{const{getFractional:o}=s(19336),n={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],n=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,c=r.startTime||0;n[0]=Math.floor(i),n[1]=o(i),n[2]=Math.floor(h),n[3]=o(h),n[4]=Math.floor(a),n[5]=o(a),n[6]=Math.floor(l),n[7]=o(l),n[8]=Math.floor(c),n[9]=o(c);for(let t=0;t<s.length;t++)n[10+t]=s.codePointAt(t);return n},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t[6]+t[7]/100,r=t[8]+t[9]/100,i=String.fromCodePoint.apply(null,t.slice(10));return{[i]:{pos:{x:e,y:s},size:{x:o,y:n},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:n}},85090:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},43601:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},55983:(t,e,s)=>{const{getFractional:o}=s(19336),n=s(71060),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==n.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=o(t);const s=r(e.y,i[1]);let n;h[2]=s,h[3]=o(s),n=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(n),h[5]=o(n)}else{const t=i[0];h[0]=Math.floor(t),h[1]=o(t);const e=i[1];h[2]=Math.floor(e),h[3]=o(e);const s=i[2];h[4]=Math.round(s),h[5]=o(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,n=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=n,h[2*t+1]=o(n)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const o=t[e]+t[e+1]/100;s[e/2]=o}if(e===n.SHAPE_2D_POLYGON||e===n.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},18525:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const o=new Array(s);for(let t=0;t<e.length;t++)o[t]=e.codePointAt(t);return o[e.length]=t.shadow.color[0],o[e.length+1]=t.shadow.color[1],o[e.length+2]=t.shadow.color[2],o[e.length+3]=t.shadow.color[3],t.shadow.blur&&(o[e.length+4]=Math.floor(t.shadow.blur/10),o[e.length+5]=t.shadow.blur%10),o}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let o;t.length>10&&(o=10*t[10]+t[11]);const n={[e]:{color:s}};return o&&(n[e].blur=o),n}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},94209:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},45752:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},389:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},15910:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},37879:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},14772:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},42353:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},20136:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},67799:(t,e,s)=>{const{hypLength:o}=s(19336),n=s(47039),{squishColor:r}=s(43601),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=new Array(t.text.length+10+h.length);a[0]=Math.floor(s),a[1]=Math.round(100*(s-Math.floor(s))),a[2]=Math.floor(i),a[3]=Math.round(100*(i-Math.floor(i)));const l=t.size||1,c=e?l*o(e.x,e.y):l;a[4]=Math.floor(c),a[5]=Math.round(100*(c-Math.floor(c)));const d=t.color||n.BLACK,u=r.squish(d);for(let t=0;t<u.length;t++)a[6+t]=u[t];a[6+u.length]=3*[...h].length;let f=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],a[6+u.length+1+f]=Number(s[0]),a[6+u.length+1+f+1]=Number(s[1]),a[6+u.length+1+f+2]=Number(s[2]),f+=3}let y=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let o;o=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`],a[6+u.length+1+f+y]=Number(o[0]),a[6+u.length+1+f+y+1]=Number(o[1]),a[6+u.length+1+f+y+2]=Number(o[2]),y+=3}return a},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t.slice(6,10),r=t[10],i=t.slice(11,11+r),h=t.slice(11+r);let a=[];for(let t=0;t<i.length;t+=3){let e=i[t].toString();1==e.length&&(e=`0${e}`);let s=i[t+1].toString();1==s.length&&(s=`0${s}`);let o=i[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;a.push(n)}const l=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let o=h[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;l.push(n)}const c=String.fromCodePoint.apply(null,a);return{x:e,y:s,text:String.fromCodePoint.apply(null,l),size:o,color:n,align:c}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},28425:(t,e,s)=>{const{GameNode:o}=s(4053),n=s(71060);t.exports={[[n.ASSET]]:o.Asset,[[n.TEXT]]:o.Text,[[n.SHAPE_2D_POLYGON]]:o.Shape,[[n.SHAPE_2D_CIRCLE]]:o.Shape,[[n.SHAPE_2D_LINE]]:o.Shape}},71060:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},64645:(t,e,s)=>{const{getRandomTerrain:o,getRandomStartPoint:n}=s(73827),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const c=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);o()(c,n(h,a,e),h,a,e);const d=((t,e,s,o)=>{const n=[];for(let i=0;i<s;i++)for(let s=0;s<o;s++){const o=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(n.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){n.push(...o);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(o.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(c,e,h,a);return d?i(c,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:o,height:n}=((t,e)=>{const s=t.x,o=t.y,n=e.x,r=e.y;return{width:Math.floor(s/n),height:Math.floor(o/r)}})(t,e);let r=((t,e)=>{const s=[],o={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let n=0;n<t;n++){s[n]=[];for(let r=0;r<e;r++){const i={...o};0===n?i.west=!1:n===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[n].push(i)}}return s})(o,n);const h={x:Math.floor(Math.random()*o),y:Math.floor(Math.random()*n)};return r=i(r,h,s,o,n),r}}},73827:t=>{const e=(t,{x:e,y:s},o,n,r)=>{e<0||e>=o||s<0||s>=n||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s+1,y:o+1},n,r,i)):1===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i)):2===h?(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o-1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o-1},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s,y:o+3},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+3,y:o},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-3,y:o},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s,y:o-3},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s+1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+2,y:o-1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o+1},n,r,i),e(t,{x:s+2,y:o+1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o-1},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const o={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;o.x===s.x&&o.y===s.y;)o.x=Math.floor(Math.random()*t),o.y=Math.floor(Math.random()*e);return o}}},97186:t=>{const e=(t,s,o,n=[])=>{if(!o||o(t)&&t.node.id!==s.node.id){const e=t.node.text,o=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=o[0][0],h=o[1][0],a=r[0][0],l=r[1][0],c=o[0][1],d=o[2][1],u=r[0][1],f=r[2][1];l<i||h<a||c>f||u>d||n.push(t)}for(const r in t.node.children)e(t.node.children[r],s,o,n);return n};t.exports={checkCollisions:(t,s,o=null)=>e(t,s,o)}},19336:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},91061:t=>{t.exports=function(t,e){return new Proxy(t,{get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,o){const n=Reflect.defineProperty(t,s,o);return e&&e(),n},deleteProperty(t,s){const o=Reflect.deleteProperty(t,s);return e&&e(),o}})}},7436:t=>{t.exports={triangle:(t,e,s,o,n,r)=>[[t,e],[s,o],[n,r],[t,e]],rectangle:(t,e,s,o)=>[[t,e],[t+s,e],[t+s,e+o],[t,e+o],[t,e]]}},53714:(t,e,s)=>{const{GameNode:o}=s(4053),n=s(96513),r=s(7436),i=s(97186),h=s(47039);t.exports={getView:(t,e,s,a={},l={})=>{const c=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),d=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return c.length>0&&c.forEach((t=>{const o=[],n=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in n){const r=n[s],i=r[0],h=r[1];let c=Math.max(Math.min(i-e.x,100),0),d=Math.max(Math.min(h-e.y,100),0);c=(l.x||1)*c,d=(l.y||1)*d,(!a.filter||a.filter(t))&&(a.x&&(c+=a.x),a.y&&(d+=a.y)),c<0?c=0:c>100&&(c=100),d<0?d=0:d>100&&(d=100),o.push([c,d])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(o&&o.length&&(e.node.text&&(e.node.text.x=o[0][0],e.node.text.y=o[0][1]),o.length&&(e.node.coordinates2d=o),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],o=e.node.coordinates2d[2],n=s[0]-t[0],r=o[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=n,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>d.addChild(t))),d}}},65863:(t,e,s)=>{const{squish:o,unsquish:n}=s(33465),{gameNode:r,GameNode:i}=s(84558),h=(s(51471),s(60308)),a=s(24902),l=s(59987),c=s(4906),d=s(52953),u=s(74053),{terrainGenerator:f}=s(35208),y=s(68967),p=s(63754),g=s(66514),x=s(19747),E=s(60483);t.exports={squish:o,unsquish:n,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:c,Squisher:p,ShapeUtils:d,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},66514:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(9523),this.http=s(47096),this.fs=s(83345),this.crypto=s(60267),this.path=s(97885),this.process=s(83151)}getConfigValue(t,e=void 0){const s=this.getConfig();let o=process.env[t]&&`${process.env[t]}`;if(void 0!==o)return"true"===o?o=!0:"false"===o&&(o=!1),console.log(`Using environment value: ${o} for key: ${t}`),o;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),o=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,o):(await downloadFileSync(this.info.id,e),this.initialized=!0,o)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,o)=>{this.existsLocally().then((o=>{o&&!t?(this.initialized=!0,s(o)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,o)=>{s?e(s):t(o)}))}))}))}doDownload(t,e){return new Promise(((s,o)=>{const n=this.getHash(t),r=`${e}/${n}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{o(t)}))}))}}},97593:(t,e,s)=>{const o=s(49880),n=s(51471),r=(t,e,s,r,i,h,a,l,c,d,u,f)=>{const y=new n(t,e,s,r,i,h,a,l,c,d,u,f);return o(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:o,fill:n,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:c,subtype:d,node:u,id:f}){this.node=u||r(t,e,s,o,n,i,h,a,l,c,d,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const o in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[o],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}}}},60308:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const o=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,n=Math.floor(Math.random()*o.length);return e[o[n]]}}},24902:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let o in s)if(e=s[o].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},84558:(t,e,s)=>{const o=s(4906),n=s(68967),{gameNode:r,BaseNode:i}=s(97593),h={[o.CIRCLE]:n.SHAPE_2D_CIRCLE,[o.POLYGON]:n.SHAPE_2D_POLYGON,[o.LINE]:n.SHAPE_2D_LINE},a={[n.SHAPE_2D_CIRCLE]:o.CIRCLE,[n.SHAPE_2D_POLYGON]:o.POLYGON,[n.SHAPE_2D_LINE]:o.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,id:d}){if(!(o&&s||c))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,subtype:h[s],id:d})}clone({handleClick:t,input:e,id:s}){const o=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:o})}}class c extends i{constructor({textInfo:t,playerIds:e,input:s,node:o,id:r}){if(!t&&!o)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:o,subtype:n.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new c({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:o})}}class d extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,subtype:n.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new d({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:o})}}const u={Asset:d,Shape:l,Text:c};t.exports={gameNode:r,GameNode:u}},51471:t=>{t.exports=class{constructor(t,e,s,o,n,r,i,h=[],a=null,l=null,c=null,d=null){this.id=d?Number(d):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=o,this.fill=n,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=c}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},4906:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},63754:(t,e,s)=>{const{squish:o,unsquish:n}=s(33465);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:o,onAssetUpdate:n}){if(this.ids=new Set,this.game=t,this.assets={},this.customBottomLayer=s,this.customTopLayer=o,this.initialize(),this.onAssetUpdate=n,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return n(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const o={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,o),s.push(t)}for(const n in t){const r=[],i=t[n],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,o),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,o),s.push(t)}return this.playerFrames=o,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},n={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=o(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0)for(let t of r)n[t]||(n[Number(t)]=[]),n[t].push(i);else Object.keys(n).forEach((t=>{n[t]||(n[Number(t)]=[]),n[t].push(i)}));for(let o=0;o<t.node.children.length;o++){const i=new Set(r);this.squishHelper(t.node.children[o],e,s,n,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const o=t[s].root;e[s]=o}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),o=this.game.constructor.metadata&&this.game.constructor.metadata(),n=o&&o.assets?o.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(n,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(n,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(n,this.game.getAssets());const r=Object.assign(s,n);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let o=0;const n=new Array(32);for(;o<32&&o<e.length;)n[o]=e.charCodeAt(o),o++;const l=(s.length+32).toString(36),c={image:1,audio:2,font:3}[r[e].info.type];let d="";for(let t=0;t<10-l.length;t++)d+="0";for(let t=l.length;t<10;t++)d+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,c,...u,...n,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let o=0;o<this.assets[s].length;o++)e[t++]=this.assets[s][o];this.assetBundle=e,t(e)}}))}))}handleStateChange(t,e){this.state=this.squish(this.game.getLayers()),this.broadcast()}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},59987:(t,e,s)=>{const{GameNode:o}=s(84558),n=s(4906),r=s(52953),i=s(60308),h=s(24902);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},56828:(t,e,s)=>{const{GameNode:o}=s(84558);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:o.Asset,2:o.Shape,3:o.Text}}},60483:t=>{t.exports={getPath:(t,e,s,o,n=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+o;if(a<0||a>n||l<0||l>r){let t=a,e=l;a<0?t=0:a>n&&(t=n),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},33465:(t,e,s)=>{const o=s(51471),{CONSTRUCTOR_TO_TYPE:n,TYPE_TO_CONSTRUCTOR:r}=s(56828),i=s(67094),{squishId:h}=s(98402),{squishColor:a}=s(61096),{squishPlayerIds:l}=s(46822),{squishPos:c}=s(37585),{squishFill:d}=s(91326),{squishSize:u}=s(18142),{squishHandleClick:f}=s(57989),{squishBorder:y}=s(69613),{squishSubType:p}=s(85129),{squishInput:g}=s(48047),{squishCoordinates2d:x}=s(31302),{squishEffect:E}=s(55454),{squishText:A}=s(36376),{squishAsset:S}=s(67),m={id:h,color:a,playerIds:l,pos:c,coordinates2d:x,fill:d,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in m)L[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const o=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const n=r[t];if(n in o){const t=o[n];if(null!=t){const r=m[n].squish(t,e,o),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[n].type,a,h,...r])}}}let h=n[t.constructor.name];h||(h=n[i[o.subType]]);const a=s.flat(),l=a.length+5,c=Math.min(255,l),d=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),d,c,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new o;for(;e<t.length;){const o=t[e],n=t[e+1]+t[e+2],r=t.slice(e+3,e+n);if(!L[o]){console.warn("Unknown sub frame type "+o);break}{const t=L[o],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=n}const n=r[t[4]];return n?new n({node:s}):{node:s}}}},67:(t,e,s)=>{const{getFractional:o}=s(17143),n={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],n=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,c=r.startTime||0;n[0]=Math.floor(i),n[1]=o(i),n[2]=Math.floor(h),n[3]=o(h),n[4]=Math.floor(a),n[5]=o(a),n[6]=Math.floor(l),n[7]=o(l),n[8]=Math.floor(c),n[9]=o(c);for(let t=0;t<s.length;t++)n[10+t]=s.codePointAt(t);return n},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t[6]+t[7]/100,r=t[8]+t[9]/100,i=String.fromCodePoint.apply(null,t.slice(10));return{[i]:{pos:{x:e,y:s},size:{x:o,y:n},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:n}},69613:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},61096:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},31302:(t,e,s)=>{const{getFractional:o}=s(17143),n=s(68967),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==n.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=o(t);const s=r(e.y,i[1]);let n;h[2]=s,h[3]=o(s),n=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(n),h[5]=o(n)}else{const t=i[0];h[0]=Math.floor(t),h[1]=o(t);const e=i[1];h[2]=Math.floor(e),h[3]=o(e);const s=i[2];h[4]=Math.round(s),h[5]=o(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,n=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=n,h[2*t+1]=o(n)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const o=t[e]+t[e+1]/100;s[e/2]=o}if(e===n.SHAPE_2D_POLYGON||e===n.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},55454:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const o=new Array(s);for(let t=0;t<e.length;t++)o[t]=e.codePointAt(t);return o[e.length]=t.shadow.color[0],o[e.length+1]=t.shadow.color[1],o[e.length+2]=t.shadow.color[2],o[e.length+3]=t.shadow.color[3],t.shadow.blur&&(o[e.length+4]=Math.floor(t.shadow.blur/10),o[e.length+5]=t.shadow.blur%10),o}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let o;t.length>10&&(o=10*t[10]+t[11]);const n={[e]:{color:s}};return o&&(n[e].blur=o),n}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},91326:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},57989:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},98402:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},48047:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},46822:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},37585:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},18142:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},85129:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},36376:(t,e,s)=>{const{hypLength:o}=s(17143),n=s(60308),{squishColor:r}=s(61096),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const c=t.size||1,d=e?c*o(e.x,e.y):c;l[4]=Math.floor(d),l[5]=Math.round(100*(d-Math.floor(d)));const u=t.color||n.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let o=6+f.length+2+3*[...h].length;l[o+p]=Number(s[0]),l[o+p+1]=Number(s[1]),l[o+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let o;o=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let n=6+f.length+2+3*[...h].length+3*[...a].length;l[n+g]=Number(o[0]),l[n+g+1]=Number(o[1]),l[n+g+2]=Number(o[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let c=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let o=h[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;c.push(n)}const d=String.fromCodePoint.apply(null,c);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let o=a[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;u.push(n)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let o=l[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;y.push(n)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:o,color:n,align:d,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},67094:(t,e,s)=>{const{GameNode:o}=s(84558),n=s(68967);t.exports={[[n.ASSET]]:o.Asset,[[n.TEXT]]:o.Text,[[n.SHAPE_2D_POLYGON]]:o.Shape,[[n.SHAPE_2D_CIRCLE]]:o.Shape,[[n.SHAPE_2D_LINE]]:o.Shape}},68967:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},35208:(t,e,s)=>{const{getRandomTerrain:o,getRandomStartPoint:n}=s(5752),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const c=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);o()(c,n(h,a,e),h,a,e);const d=((t,e,s,o)=>{const n=[];for(let i=0;i<s;i++)for(let s=0;s<o;s++){const o=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(n.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){n.push(...o);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(o.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(c,e,h,a);return d?i(c,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:o,height:n}=((t,e)=>{const s=t.x,o=t.y,n=e.x,r=e.y;return{width:Math.floor(s/n),height:Math.floor(o/r)}})(t,e);let r=((t,e)=>{const s=[],o={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let n=0;n<t;n++){s[n]=[];for(let r=0;r<e;r++){const i={...o};0===n?i.west=!1:n===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[n].push(i)}}return s})(o,n);const h={x:Math.floor(Math.random()*o),y:Math.floor(Math.random()*n)};return r=i(r,h,s,o,n),r}}},5752:t=>{const e=(t,{x:e,y:s},o,n,r)=>{e<0||e>=o||s<0||s>=n||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s+1,y:o+1},n,r,i)):1===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i)):2===h?(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o-1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o-1},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s,y:o+3},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+3,y:o},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-3,y:o},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s,y:o-3},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s+1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+2,y:o-1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o+1},n,r,i),e(t,{x:s+2,y:o+1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o-1},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const o={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;o.x===s.x&&o.y===s.y;)o.x=Math.floor(Math.random()*t),o.y=Math.floor(Math.random()*e);return o}}},19747:t=>{const e=(t,s,o,n=[])=>{if(!o||o(t)&&t.node.id!==s.node.id){const e=t.node.text,o=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=o[0][0],h=o[1][0],a=r[0][0],l=r[1][0],c=o[0][1],d=o[2][1],u=r[0][1],f=r[2][1];l<i||h<a||c>f||u>d||n.push(t)}for(const r in t.node.children)e(t.node.children[r],s,o,n);return n};t.exports={checkCollisions:(t,s,o=null)=>e(t,s,o)}},17143:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},49880:t=>{t.exports=function(t,e){return new Proxy(t,{get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,o){const n=Reflect.defineProperty(t,s,o);return e&&e(),n},deleteProperty(t,s){const o=Reflect.deleteProperty(t,s);return e&&e(),o}})}},52953:t=>{t.exports={triangle:(t,e,s,o,n,r)=>[[t,e],[s,o],[n,r],[t,e]],rectangle:(t,e,s,o)=>[[t,e],[t+s,e],[t+s,e+o],[t,e+o],[t,e]]}},74053:(t,e,s)=>{const{GameNode:o}=s(84558),n=s(4906),r=s(52953),i=s(19747),h=s(60308);t.exports={getView:(t,e,s,a={},l={})=>{const c=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),d=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return c.length>0&&c.forEach((t=>{const o=[],n=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in n){const r=n[s],i=r[0],h=r[1];let c=Math.max(Math.min(i-e.x,100),0),d=Math.max(Math.min(h-e.y,100),0);c=(l.x||1)*c,d=(l.y||1)*d,(!a.filter||a.filter(t))&&(a.x&&(c+=a.x),a.y&&(d+=a.y)),c<0?c=0:c>100&&(c=100),d<0?d=0:d>100&&(d=100),o.push([c,d])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(o&&o.length&&(e.node.text&&(e.node.text.x=o[0][0],e.node.text.y=o[0][1]),o.length&&(e.node.coordinates2d=o),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],o=e.node.coordinates2d[2],n=s[0]-t[0],r=o[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=n,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>d.addChild(t))),d}}},9570:(t,e,s)=>{const{squish:o,unsquish:n}=s(95298),{gameNode:r,GameNode:i}=s(47657),h=(s(42152),s(57763)),a=s(99685),l=s(84568),c=s(24053),d=s(22296),u=s(6710),{terrainGenerator:f}=s(62817),y=s(24264),p=s(49693),g=s(8511),x=s(44726),E=s(44586);t.exports={squish:o,unsquish:n,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:c,Squisher:p,ShapeUtils:d,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},8511:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(2728),this.http=s(82337),this.fs=s(74996),this.crypto=s(62337),this.path=s(24292),this.process=s(25584)}getConfigValue(t,e=void 0){const s=this.getConfig();let o=process.env[t]&&`${process.env[t]}`;if(void 0!==o)return"true"===o?o=!0:"false"===o&&(o=!1),console.log(`Using environment value: ${o} for key: ${t}`),o;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),o=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,o):(await downloadFileSync(this.info.id,e),this.initialized=!0,o)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,o)=>{this.existsLocally().then((n=>{n&&!t?(this.initialized=!0,s(n)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{o(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,o)=>{s?e(s):t(o)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,o)=>{const n=this.getHash(t),r=`${e}/${n}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{o(t)}))}))}}},43742:(t,e,s)=>{const o=s(23673),n=s(42152),r=(t,e,s,r,i,h,a,l,c,d,u,f)=>{const y=new n(t,e,s,r,i,h,a,l,c,d,u,f);return o(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:o,fill:n,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:c,subtype:d,node:u,id:f}){this.node=u||r(t,e,s,o,n,i,h,a,l,c,d,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const o in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[o],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}}}},57763:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const o=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,n=Math.floor(Math.random()*o.length);return e[o[n]]}}},99685:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let o in s)if(e=s[o].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},47657:(t,e,s)=>{const o=s(24053),n=s(24264),{gameNode:r,BaseNode:i}=s(43742),h={[o.CIRCLE]:n.SHAPE_2D_CIRCLE,[o.POLYGON]:n.SHAPE_2D_POLYGON,[o.LINE]:n.SHAPE_2D_LINE},a={[n.SHAPE_2D_CIRCLE]:o.CIRCLE,[n.SHAPE_2D_POLYGON]:o.POLYGON,[n.SHAPE_2D_LINE]:o.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,id:d}){if(!(o&&s||c))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,subtype:h[s],id:d})}clone({handleClick:t,input:e,id:s}){const o=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:o})}}class c extends i{constructor({textInfo:t,playerIds:e,input:s,node:o,id:r}){if(!t&&!o)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:o,subtype:n.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new c({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:o})}}class d extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,subtype:n.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new d({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:o})}}const u={Asset:d,Shape:l,Text:c};t.exports={gameNode:r,GameNode:u}},42152:t=>{t.exports=class{constructor(t,e,s,o,n,r,i,h=[],a=null,l=null,c=null,d=null){this.id=d?Number(d):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=o,this.fill=n,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=c}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},24053:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},49693:(t,e,s)=>{const{squish:o,unsquish:n}=s(95298);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:o,onAssetUpdate:n}){if(this.ids=new Set,this.game=t,this.assets={},this.customBottomLayer=s,this.customTopLayer=o,this.initialize(),this.onAssetUpdate=n,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return n(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const o={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,o),s.push(t)}for(const n in t){const r=[],i=t[n],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,o),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,o),s.push(t)}return this.playerFrames=o,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},n={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=o(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0)for(let t of r)n[t]||(n[Number(t)]=[]),n[t].push(i);else Object.keys(n).forEach((t=>{n[t]||(n[Number(t)]=[]),n[t].push(i)}));for(let o=0;o<t.node.children.length;o++){const i=new Set(r);this.squishHelper(t.node.children[o],e,s,n,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const o=t[s].root;e[s]=o}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),o=this.game.constructor.metadata&&this.game.constructor.metadata(),n=o&&o.assets?o.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(n,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(n,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(n,this.game.getAssets());const r=Object.assign(s,n);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let o=0;const n=new Array(32);for(;o<32&&o<e.length;)n[o]=e.charCodeAt(o),o++;const l=(s.length+32).toString(36),c={image:1,audio:2,font:3}[r[e].info.type];let d="";for(let t=0;t<10-l.length;t++)d+="0";for(let t=l.length;t<10;t++)d+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,c,...u,...n,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let o=0;o<this.assets[s].length;o++)e[t++]=this.assets[s][o];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.state=this.squish(this.game.getLayers()),this.broadcast()}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},84568:(t,e,s)=>{const{GameNode:o}=s(47657),n=s(24053),r=s(22296),i=s(57763),h=s(99685);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},20135:(t,e,s)=>{const{GameNode:o}=s(47657);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:o.Asset,2:o.Shape,3:o.Text}}},44586:t=>{t.exports={getPath:(t,e,s,o,n=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+o;if(a<0||a>n||l<0||l>r){let t=a,e=l;a<0?t=0:a>n&&(t=n),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},95298:(t,e,s)=>{const o=s(42152),{CONSTRUCTOR_TO_TYPE:n,TYPE_TO_CONSTRUCTOR:r}=s(20135),i=s(97101),{squishId:h}=s(63681),{squishColor:a}=s(15621),{squishPlayerIds:l}=s(63083),{squishPos:c}=s(57640),{squishFill:d}=s(64861),{squishSize:u}=s(43501),{squishHandleClick:f}=s(67420),{squishBorder:y}=s(22974),{squishSubType:p}=s(98444),{squishInput:g}=s(50138),{squishCoordinates2d:x}=s(26499),{squishEffect:E}=s(66345),{squishText:A}=s(60515),{squishAsset:S}=s(34046),m={id:h,color:a,playerIds:l,pos:c,coordinates2d:x,fill:d,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in m)L[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const o=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const n=r[t];if(n in o){const t=o[n];if(null!=t){const r=m[n].squish(t,e,o),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[n].type,a,h,...r])}}}let h=n[t.constructor.name];h||(h=n[i[o.subType]]);const a=s.flat(),l=a.length+5,c=Math.min(255,l),d=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),d,c,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new o;for(;e<t.length;){const o=t[e],n=t[e+1]+t[e+2],r=t.slice(e+3,e+n);if(!L[o]){console.warn("Unknown sub frame type "+o);break}{const t=L[o],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=n}const n=r[t[4]];return n?new n({node:s}):{node:s}}}},34046:(t,e,s)=>{const{getFractional:o}=s(99820),n={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],n=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,c=r.startTime||0;n[0]=Math.floor(i),n[1]=o(i),n[2]=Math.floor(h),n[3]=o(h),n[4]=Math.floor(a),n[5]=o(a),n[6]=Math.floor(l),n[7]=o(l),n[8]=Math.floor(c),n[9]=o(c);for(let t=0;t<s.length;t++)n[10+t]=s.codePointAt(t);return n},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t[6]+t[7]/100,r=t[8]+t[9]/100,i=String.fromCodePoint.apply(null,t.slice(10));return{[i]:{pos:{x:e,y:s},size:{x:o,y:n},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:n}},22974:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},15621:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},26499:(t,e,s)=>{const{getFractional:o}=s(99820),n=s(24264),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==n.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=o(t);const s=r(e.y,i[1]);let n;h[2]=s,h[3]=o(s),n=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(n),h[5]=o(n)}else{const t=i[0];h[0]=Math.floor(t),h[1]=o(t);const e=i[1];h[2]=Math.floor(e),h[3]=o(e);const s=i[2];h[4]=Math.round(s),h[5]=o(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,n=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=n,h[2*t+1]=o(n)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const o=t[e]+t[e+1]/100;s[e/2]=o}if(e===n.SHAPE_2D_POLYGON||e===n.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},66345:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const o=new Array(s);for(let t=0;t<e.length;t++)o[t]=e.codePointAt(t);return o[e.length]=t.shadow.color[0],o[e.length+1]=t.shadow.color[1],o[e.length+2]=t.shadow.color[2],o[e.length+3]=t.shadow.color[3],t.shadow.blur&&(o[e.length+4]=Math.floor(t.shadow.blur/10),o[e.length+5]=t.shadow.blur%10),o}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let o;t.length>10&&(o=10*t[10]+t[11]);const n={[e]:{color:s}};return o&&(n[e].blur=o),n}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},64861:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},67420:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},63681:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},50138:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},63083:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},57640:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},43501:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},98444:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},60515:(t,e,s)=>{const{hypLength:o}=s(99820),n=s(57763),{squishColor:r}=s(15621),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const c=t.size||1,d=e?c*o(e.x,e.y):c;l[4]=Math.floor(d),l[5]=Math.round(100*(d-Math.floor(d)));const u=t.color||n.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let o=6+f.length+2+3*[...h].length;l[o+p]=Number(s[0]),l[o+p+1]=Number(s[1]),l[o+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let o;o=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let n=6+f.length+2+3*[...h].length+3*[...a].length;l[n+g]=Number(o[0]),l[n+g+1]=Number(o[1]),l[n+g+2]=Number(o[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let c=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let o=h[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;c.push(n)}const d=String.fromCodePoint.apply(null,c);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let o=a[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;u.push(n)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let o=l[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;y.push(n)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:o,color:n,align:d,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},97101:(t,e,s)=>{const{GameNode:o}=s(47657),n=s(24264);t.exports={[[n.ASSET]]:o.Asset,[[n.TEXT]]:o.Text,[[n.SHAPE_2D_POLYGON]]:o.Shape,[[n.SHAPE_2D_CIRCLE]]:o.Shape,[[n.SHAPE_2D_LINE]]:o.Shape}},24264:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},62817:(t,e,s)=>{const{getRandomTerrain:o,getRandomStartPoint:n}=s(46727),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const c=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);o()(c,n(h,a,e),h,a,e);const d=((t,e,s,o)=>{const n=[];for(let i=0;i<s;i++)for(let s=0;s<o;s++){const o=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(n.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){n.push(...o);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(o.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(c,e,h,a);return d?i(c,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:o,height:n}=((t,e)=>{const s=t.x,o=t.y,n=e.x,r=e.y;return{width:Math.floor(s/n),height:Math.floor(o/r)}})(t,e);let r=((t,e)=>{const s=[],o={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let n=0;n<t;n++){s[n]=[];for(let r=0;r<e;r++){const i={...o};0===n?i.west=!1:n===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[n].push(i)}}return s})(o,n);const h={x:Math.floor(Math.random()*o),y:Math.floor(Math.random()*n)};return r=i(r,h,s,o,n),r}}},46727:t=>{const e=(t,{x:e,y:s},o,n,r)=>{e<0||e>=o||s<0||s>=n||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s+1,y:o+1},n,r,i)):1===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i)):2===h?(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o-1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o-1},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s,y:o+3},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+3,y:o},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-3,y:o},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s,y:o-3},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s+1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+2,y:o-1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o+1},n,r,i),e(t,{x:s+2,y:o+1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o-1},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const o={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;o.x===s.x&&o.y===s.y;)o.x=Math.floor(Math.random()*t),o.y=Math.floor(Math.random()*e);return o}}},44726:t=>{const e=(t,s,o,n=[])=>{if(!o||o(t)&&t.node.id!==s.node.id){const e=t.node.text,o=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=o[0][0],h=o[1][0],a=r[0][0],l=r[1][0],c=o[0][1],d=o[2][1],u=r[0][1],f=r[2][1];l<i||h<a||c>f||u>d||n.push(t)}for(const r in t.node.children)e(t.node.children[r],s,o,n);return n};t.exports={checkCollisions:(t,s,o=null)=>e(t,s,o)}},99820:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},23673:t=>{t.exports=function(t,e){return new Proxy(t,{get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,o){const n=Reflect.defineProperty(t,s,o);return e&&e(),n},deleteProperty(t,s){const o=Reflect.deleteProperty(t,s);return e&&e(),o}})}},22296:t=>{t.exports={triangle:(t,e,s,o,n,r)=>[[t,e],[s,o],[n,r],[t,e]],rectangle:(t,e,s,o)=>[[t,e],[t+s,e],[t+s,e+o],[t,e+o],[t,e]]}},6710:(t,e,s)=>{const{GameNode:o}=s(47657),n=s(24053),r=s(22296),i=s(44726),h=s(57763);t.exports={getView:(t,e,s,a={},l={})=>{const c=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),d=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return c.length>0&&c.forEach((t=>{const o=[],n=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in n){const r=n[s],i=r[0],h=r[1];let c=Math.max(Math.min(i-e.x,100),0),d=Math.max(Math.min(h-e.y,100),0);c=(l.x||1)*c,d=(l.y||1)*d,(!a.filter||a.filter(t))&&(a.x&&(c+=a.x),a.y&&(d+=a.y)),c<0?c=0:c>100&&(c=100),d<0?d=0:d>100&&(d=100),o.push([c,d])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(o&&o.length&&(e.node.text&&(e.node.text.x=o[0][0],e.node.text.y=o[0][1]),o.length&&(e.node.coordinates2d=o),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],o=e.node.coordinates2d[2],n=s[0]-t[0],r=o[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=n,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>d.addChild(t))),d}}},51001:(t,e,s)=>{const{squish:o,unsquish:n}=s(20483),{gameNode:r,GameNode:i}=s(73348),h=(s(48337),s(65578)),a=s(44116),l=s(26477),c=s(32316),d=s(28035),u=s(90183),{terrainGenerator:f}=s(74506),y=s(44653),p=s(27144),g=s(84496),x=s(14353),E=s(2421);t.exports={squish:o,unsquish:n,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:c,Squisher:p,ShapeUtils:d,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},84496:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(33997),this.http=s(67970),this.fs=s(6291),this.crypto=s(75409),this.path=s(63599),this.process=s(20617)}getConfigValue(t,e=void 0){const s=this.getConfig();let o=process.env[t]&&`${process.env[t]}`;if(void 0!==o)return"true"===o?o=!0:"false"===o&&(o=!1),console.log(`Using environment value: ${o} for key: ${t}`),o;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),o=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,o):(await downloadFileSync(this.info.id,e),this.initialized=!0,o)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,o)=>{this.existsLocally().then((n=>{n&&!t?(this.initialized=!0,s(n)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{o(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,o)=>{s?e(s):t(o)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,o)=>{const n=this.getHash(t),r=`${e}/${n}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{o(t)}))}))}}},40347:(t,e,s)=>{const o=s(39182),n=s(48337),r=(t,e,s,r,i,h,a,l,c,d,u,f)=>{const y=new n(t,e,s,r,i,h,a,l,c,d,u,f);return o(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:o,fill:n,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:c,subtype:d,node:u,id:f}){this.node=u||r(t,e,s,o,n,i,h,a,l,c,d,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const o in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[o],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}free(){this.node.free()}}}},65578:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const o=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,n=Math.floor(Math.random()*o.length);return e[o[n]]}}},44116:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let o in s)if(e=s[o].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},73348:(t,e,s)=>{const o=s(32316),n=s(44653),{gameNode:r,BaseNode:i}=s(40347),h={[o.CIRCLE]:n.SHAPE_2D_CIRCLE,[o.POLYGON]:n.SHAPE_2D_POLYGON,[o.LINE]:n.SHAPE_2D_LINE},a={[n.SHAPE_2D_CIRCLE]:o.CIRCLE,[n.SHAPE_2D_POLYGON]:o.POLYGON,[n.SHAPE_2D_LINE]:o.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,id:d}){if(!(o&&s||c))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,subtype:h[s],id:d})}clone({handleClick:t,input:e,id:s}){const o=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:o})}}class c extends i{constructor({textInfo:t,playerIds:e,input:s,node:o,id:r}){if(!t&&!o)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:o,subtype:n.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new c({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:o})}}class d extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,subtype:n.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new d({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:o})}}const u={Asset:d,Shape:l,Text:c};t.exports={gameNode:r,GameNode:u}},48337:t=>{t.exports=class{constructor(t,e,s,o,n,r,i,h=[],a=null,l=null,c=null,d=null){this.id=d?Number(d):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=o,this.fill=n,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=c}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},32316:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},27144:(t,e,s)=>{const{squish:o,unsquish:n}=s(20483);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:o,onAssetUpdate:n}){if(this.ids=new Set,this.game=t,this.assets={},this.customBottomLayer=s,this.customTopLayer=o,this.initialize(),this.onAssetUpdate=n,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return n(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const o={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,o),s.push(t)}for(const n in t){const r=[],i=t[n],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,o),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,o),s.push(t)}return this.playerFrames=o,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},n={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=o(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0)for(let t of r)n[t]||(n[Number(t)]=[]),n[t].push(i);else Object.keys(n).forEach((t=>{n[t]||(n[Number(t)]=[]),n[t].push(i)}));for(let o=0;o<t.node.children.length;o++){const i=new Set(r);this.squishHelper(t.node.children[o],e,s,n,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const o=t[s].root;e[s]=o}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),o=this.game.constructor.metadata&&this.game.constructor.metadata(),n=o&&o.assets?o.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(n,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(n,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(n,this.game.getAssets());const r=Object.assign(s,n);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let o=0;const n=new Array(32);for(;o<32&&o<e.length;)n[o]=e.charCodeAt(o),o++;const l=(s.length+32).toString(36),c={image:1,audio:2,font:3}[r[e].info.type];let d="";for(let t=0;t<10-l.length;t++)d+="0";for(let t=l.length;t<10;t++)d+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,c,...u,...n,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let o=0;o<this.assets[s].length;o++)e[t++]=this.assets[s][o];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},26477:(t,e,s)=>{const{GameNode:o}=s(73348),n=s(32316),r=s(28035),i=s(65578),h=s(44116);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},17626:(t,e,s)=>{const{GameNode:o}=s(73348);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:o.Asset,2:o.Shape,3:o.Text}}},2421:t=>{t.exports={getPath:(t,e,s,o,n=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+o;if(a<0||a>n||l<0||l>r){let t=a,e=l;a<0?t=0:a>n&&(t=n),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},20483:(t,e,s)=>{const o=s(48337),{CONSTRUCTOR_TO_TYPE:n,TYPE_TO_CONSTRUCTOR:r}=s(17626),i=s(96068),{squishId:h}=s(7936),{squishColor:a}=s(32154),{squishPlayerIds:l}=s(81088),{squishPos:c}=s(29547),{squishFill:d}=s(76048),{squishSize:u}=s(78148),{squishHandleClick:f}=s(28079),{squishBorder:y}=s(18747),{squishSubType:p}=s(53883),{squishInput:g}=s(76997),{squishCoordinates2d:x}=s(83804),{squishEffect:E}=s(6160),{squishText:A}=s(30998),{squishAsset:S}=s(15877),m={id:h,color:a,playerIds:l,pos:c,coordinates2d:x,fill:d,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in m)L[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const o=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const n=r[t];if(n in o){const t=o[n];if(null!=t){const r=m[n].squish(t,e,o),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[n].type,a,h,...r])}}}let h=n[t.constructor.name];h||(h=n[i[o.subType]]);const a=s.flat(),l=a.length+5,c=Math.min(255,l),d=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),d,c,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new o;for(;e<t.length;){const o=t[e],n=t[e+1]+t[e+2],r=t.slice(e+3,e+n);if(!L[o]){console.warn("Unknown sub frame type "+o);break}{const t=L[o],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=n}const n=r[t[4]];return n?new n({node:s}):{node:s}}}},15877:(t,e,s)=>{const{getFractional:o}=s(12897),n={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],n=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,c=r.startTime||0;n[0]=Math.floor(i),n[1]=o(i),n[2]=Math.floor(h),n[3]=o(h),n[4]=Math.floor(a),n[5]=o(a),n[6]=Math.floor(l),n[7]=o(l),n[8]=Math.floor(c),n[9]=o(c);for(let t=0;t<s.length;t++)n[10+t]=s.codePointAt(t);return n},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t[6]+t[7]/100,r=t[8]+t[9]/100,i=String.fromCodePoint.apply(null,t.slice(10));return{[i]:{pos:{x:e,y:s},size:{x:o,y:n},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:n}},18747:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},32154:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},83804:(t,e,s)=>{const{getFractional:o}=s(12897),n=s(44653),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==n.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=o(t);const s=r(e.y,i[1]);let n;h[2]=s,h[3]=o(s),n=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(n),h[5]=o(n)}else{const t=i[0];h[0]=Math.floor(t),h[1]=o(t);const e=i[1];h[2]=Math.floor(e),h[3]=o(e);const s=i[2];h[4]=Math.round(s),h[5]=o(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,n=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=n,h[2*t+1]=o(n)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const o=t[e]+t[e+1]/100;s[e/2]=o}if(e===n.SHAPE_2D_POLYGON||e===n.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},6160:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const o=new Array(s);for(let t=0;t<e.length;t++)o[t]=e.codePointAt(t);return o[e.length]=t.shadow.color[0],o[e.length+1]=t.shadow.color[1],o[e.length+2]=t.shadow.color[2],o[e.length+3]=t.shadow.color[3],t.shadow.blur&&(o[e.length+4]=Math.floor(t.shadow.blur/10),o[e.length+5]=t.shadow.blur%10),o}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let o;t.length>10&&(o=10*t[10]+t[11]);const n={[e]:{color:s}};return o&&(n[e].blur=o),n}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},76048:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},28079:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},7936:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},76997:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},81088:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},29547:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},78148:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},53883:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},30998:(t,e,s)=>{const{hypLength:o}=s(12897),n=s(65578),{squishColor:r}=s(32154),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const c=t.size||1,d=e?c*o(e.x,e.y):c;l[4]=Math.floor(d),l[5]=Math.round(100*(d-Math.floor(d)));const u=t.color||n.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let o=6+f.length+2+3*[...h].length;l[o+p]=Number(s[0]),l[o+p+1]=Number(s[1]),l[o+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let o;o=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let n=6+f.length+2+3*[...h].length+3*[...a].length;l[n+g]=Number(o[0]),l[n+g+1]=Number(o[1]),l[n+g+2]=Number(o[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let c=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let o=h[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;c.push(n)}const d=String.fromCodePoint.apply(null,c);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let o=a[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;u.push(n)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let o=l[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;y.push(n)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:o,color:n,align:d,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},96068:(t,e,s)=>{const{GameNode:o}=s(73348),n=s(44653);t.exports={[[n.ASSET]]:o.Asset,[[n.TEXT]]:o.Text,[[n.SHAPE_2D_POLYGON]]:o.Shape,[[n.SHAPE_2D_CIRCLE]]:o.Shape,[[n.SHAPE_2D_LINE]]:o.Shape}},44653:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},74506:(t,e,s)=>{const{getRandomTerrain:o,getRandomStartPoint:n}=s(68582),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const c=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);o()(c,n(h,a,e),h,a,e);const d=((t,e,s,o)=>{const n=[];for(let i=0;i<s;i++)for(let s=0;s<o;s++){const o=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(n.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){n.push(...o);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(o.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(c,e,h,a);return d?i(c,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:o,height:n}=((t,e)=>{const s=t.x,o=t.y,n=e.x,r=e.y;return{width:Math.floor(s/n),height:Math.floor(o/r)}})(t,e);let r=((t,e)=>{const s=[],o={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let n=0;n<t;n++){s[n]=[];for(let r=0;r<e;r++){const i={...o};0===n?i.west=!1:n===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[n].push(i)}}return s})(o,n);const h={x:Math.floor(Math.random()*o),y:Math.floor(Math.random()*n)};return r=i(r,h,s,o,n),r}}},68582:t=>{const e=(t,{x:e,y:s},o,n,r)=>{e<0||e>=o||s<0||s>=n||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s+1,y:o+1},n,r,i)):1===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i)):2===h?(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o-1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o-1},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s,y:o+3},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+3,y:o},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-3,y:o},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s,y:o-3},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s+1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+2,y:o-1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o+1},n,r,i),e(t,{x:s+2,y:o+1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o-1},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const o={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;o.x===s.x&&o.y===s.y;)o.x=Math.floor(Math.random()*t),o.y=Math.floor(Math.random()*e);return o}}},14353:t=>{const e=(t,s,o,n=[])=>{if(!o||o(t)&&t.node.id!==s.node.id){const e=t.node.text,o=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=o[0][0],h=o[1][0],a=r[0][0],l=r[1][0],c=o[0][1],d=o[2][1],u=r[0][1],f=r[2][1];l<i||h<a||c>f||u>d||n.push(t)}for(const r in t.node.children)e(t.node.children[r],s,o,n);return n};t.exports={checkCollisions:(t,s,o=null)=>e(t,s,o)}},12897:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},39182:t=>{t.exports=function(t,e){const s={get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,o){const n=Reflect.defineProperty(t,s,o);return e&&e(),n},deleteProperty(t,s){const o=Reflect.deleteProperty(t,s);return e&&e(),o}},o=Proxy.revocable(t,s);return t.free=()=>{o.revoke()},o.proxy}},28035:t=>{t.exports={triangle:(t,e,s,o,n,r)=>[[t,e],[s,o],[n,r],[t,e]],rectangle:(t,e,s,o)=>[[t,e],[t+s,e],[t+s,e+o],[t,e+o],[t,e]]}},90183:(t,e,s)=>{const{GameNode:o}=s(73348),n=s(32316),r=s(28035),i=s(14353),h=s(65578);t.exports={getView:(t,e,s,a={},l={})=>{const c=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),d=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return c.length>0&&c.forEach((t=>{const o=[],n=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in n){const r=n[s],i=r[0],h=r[1];let c=Math.max(Math.min(i-e.x,100),0),d=Math.max(Math.min(h-e.y,100),0);c=(l.x||1)*c,d=(l.y||1)*d,(!a.filter||a.filter(t))&&(a.x&&(c+=a.x),a.y&&(d+=a.y)),c<0?c=0:c>100&&(c=100),d<0?d=0:d>100&&(d=100),o.push([c,d])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(o&&o.length&&(e.node.text&&(e.node.text.x=o[0][0],e.node.text.y=o[0][1]),o.length&&(e.node.coordinates2d=o),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],o=e.node.coordinates2d[2],n=s[0]-t[0],r=o[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=n,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>d.addChild(t))),d}}},39086:(t,e,s)=>{const{squish:o,unsquish:n}=s(52270),{gameNode:r,GameNode:i}=s(63893),h=(s(24572),s(95679)),a=s(57585),l=s(28220),c=s(89761),d=s(1388),u=s(17234),{terrainGenerator:f}=s(46373),y=s(18708),p=s(31761),g=s(61099),x=s(69218),E=s(2182);t.exports={squish:o,unsquish:n,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:c,Squisher:p,ShapeUtils:d,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},61099:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(95464),this.http=s(56097),this.fs=s(80116),this.crypto=s(17358),this.path=s(45028),this.process=s(90160)}getConfigValue(t,e=void 0){const s=this.getConfig();let o=process.env[t]&&`${process.env[t]}`;if(void 0!==o)return"true"===o?o=!0:"false"===o&&(o=!1),console.log(`Using environment value: ${o} for key: ${t}`),o;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),o=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,o):(await downloadFileSync(this.info.id,e),this.initialized=!0,o)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,o)=>{this.existsLocally().then((n=>{n&&!t?(this.initialized=!0,s(n)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{o(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,o)=>{s?e(s):t(o)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,o)=>{const n=this.getHash(t),r=`${e}/${n}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{o(t)}))}))}}},39098:(t,e,s)=>{const o=s(91669),n=s(24572),r=(t,e,s,r,i,h,a,l,c,d,u,f)=>{const y=new n(t,e,s,r,i,h,a,l,c,d,u,f);return o(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:o,fill:n,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:c,subtype:d,node:u,id:f}){this.node=u||r(t,e,s,o,n,i,h,a,l,c,d,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const o in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[o],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}free(){this.node.free()}}}},95679:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const o=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,n=Math.floor(Math.random()*o.length);return e[o[n]]}}},57585:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let o in s)if(e=s[o].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},63893:(t,e,s)=>{const o=s(89761),n=s(18708),{gameNode:r,BaseNode:i}=s(39098),h={[o.CIRCLE]:n.SHAPE_2D_CIRCLE,[o.POLYGON]:n.SHAPE_2D_POLYGON,[o.LINE]:n.SHAPE_2D_LINE},a={[n.SHAPE_2D_CIRCLE]:o.CIRCLE,[n.SHAPE_2D_POLYGON]:o.POLYGON,[n.SHAPE_2D_LINE]:o.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,id:d}){if(!(o&&s||c))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,subtype:h[s],id:d})}clone({handleClick:t,input:e,id:s}){const o=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:o})}}class c extends i{constructor({textInfo:t,playerIds:e,input:s,node:o,id:r}){if(!t&&!o)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:o,subtype:n.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new c({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:o})}}class d extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,subtype:n.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new d({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:o})}}const u={Asset:d,Shape:l,Text:c};t.exports={gameNode:r,GameNode:u}},24572:t=>{t.exports=class{constructor(t,e,s,o,n,r,i,h=[],a=null,l=null,c=null,d=null){this.id=d?Number(d):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=o,this.fill=n,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=c}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},89761:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},31761:(t,e,s)=>{const{squish:o,unsquish:n}=s(52270);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:o,onAssetUpdate:n}){if(this.ids=new Set,this.game=t,this.gameMetadata=t.constructor.metadata&&t.constructor.metadata(),this.assets={},this.customBottomLayer=s,this.customTopLayer=o,this.initialize(),this.onAssetUpdate=n,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return n(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const o={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,o),s.push(t)}for(const n in t){const r=[],i=t[n],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,o),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,o),s.push(t)}return this.playerFrames=o,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},r={},i=new Set){t.node.listeners.has(this)||t.addListener(this);const h=o(t,s);if(e.push(h),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>i.add(t))),i.size>0){let e=new Set;for(let s of i)r[s]||(r[Number(s)]=[]),0===t.node.playerIds.length||t.node.playerIds.findIndex((t=>Number(t)===Number(s)))>=0?r[s].push(h):e.add(s);for(let t of e)i.delete(t)}else Object.keys(r).forEach((t=>{r[t]||(r[Number(t)]=[]),r[t].push(h)}));for(let o=0;o<t.node.children.length;o++){const n=new Set(i);this.squishHelper(t.node.children[o],e,s,r,n)}for(let t in r)for(let e in r[t]){const s=n(r[t][e]);if(s.node.playerIds.length>0&&s.node.playerIds.findIndex((e=>Number(e)===Number(t)))<0&&(console.log(s.node.playerIds),console.log(t),console.log(s.node.playerIds.indexOf(t)),254!=t))throw new Error("fuk")}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const o=t[s].root;e[s]=o}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),o=this.game.constructor.metadata&&this.game.constructor.metadata(),n=o&&o.assets?o.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(n,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(n,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(n,this.game.getAssets());const r=Object.assign(s,n);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let o=0;const n=new Array(32);for(;o<32&&o<e.length;)n[o]=e.charCodeAt(o),o++;const l=(s.length+32).toString(36),c={image:1,audio:2,font:3}[r[e].info.type];let d="";for(let t=0;t<10-l.length;t++)d+="0";for(let t=l.length;t<10;t++)d+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,c,...u,...n,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let o=0;o<this.assets[s].length;o++)e[t++]=this.assets[s][o];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},28220:(t,e,s)=>{const{GameNode:o}=s(63893),n=s(89761),r=s(1388),i=s(95679),h=s(57585);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},7171:(t,e,s)=>{const{GameNode:o}=s(63893);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:o.Asset,2:o.Shape,3:o.Text}}},2182:t=>{t.exports={getPath:(t,e,s,o,n=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+o;if(a<0||a>n||l<0||l>r){let t=a,e=l;a<0?t=0:a>n&&(t=n),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},52270:(t,e,s)=>{const o=s(24572),{CONSTRUCTOR_TO_TYPE:n,TYPE_TO_CONSTRUCTOR:r}=s(7171),i=s(21289),{squishId:h}=s(1701),{squishColor:a}=s(24369),{squishPlayerIds:l}=s(33047),{squishPos:c}=s(4692),{squishFill:d}=s(40417),{squishSize:u}=s(39601),{squishHandleClick:f}=s(14072),{squishBorder:y}=s(32610),{squishSubType:p}=s(55624),{squishInput:g}=s(79526),{squishCoordinates2d:x}=s(58095),{squishEffect:E}=s(98685),{squishText:A}=s(59159),{squishAsset:S}=s(38434),m={id:h,color:a,playerIds:l,pos:c,coordinates2d:x,fill:d,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in m)L[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const o=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const n=r[t];if(n in o){const t=o[n];if(null!=t){const r=m[n].squish(t,e,o),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[n].type,a,h,...r])}}}let h=n[t.constructor.name];h||(h=n[i[o.subType]]);const a=s.flat(),l=a.length+5,c=Math.min(255,l),d=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),d,c,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new o;for(;e<t.length;){const o=t[e],n=t[e+1]+t[e+2],r=t.slice(e+3,e+n);if(!L[o]){console.warn("Unknown sub frame type "+o);break}{const t=L[o],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=n}const n=r[t[4]];return n?new n({node:s}):{node:s}}}},38434:(t,e,s)=>{const{getFractional:o}=s(82440),n={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],n=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,c=r.startTime||0;n[0]=Math.floor(i),n[1]=o(i),n[2]=Math.floor(h),n[3]=o(h),n[4]=Math.floor(a),n[5]=o(a),n[6]=Math.floor(l),n[7]=o(l),n[8]=Math.floor(c),n[9]=o(c);for(let t=0;t<s.length;t++)n[10+t]=s.codePointAt(t);return n},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t[6]+t[7]/100,r=t[8]+t[9]/100,i=String.fromCodePoint.apply(null,t.slice(10));return{[i]:{pos:{x:e,y:s},size:{x:o,y:n},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:n}},32610:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},24369:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},58095:(t,e,s)=>{const{getFractional:o}=s(82440),n=s(18708),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==n.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=o(t);const s=r(e.y,i[1]);let n;h[2]=s,h[3]=o(s),n=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(n),h[5]=o(n)}else{const t=i[0];h[0]=Math.floor(t),h[1]=o(t);const e=i[1];h[2]=Math.floor(e),h[3]=o(e);const s=i[2];h[4]=Math.round(s),h[5]=o(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,n=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=n,h[2*t+1]=o(n)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const o=t[e]+t[e+1]/100;s[e/2]=o}if(e===n.SHAPE_2D_POLYGON||e===n.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},98685:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const o=new Array(s);for(let t=0;t<e.length;t++)o[t]=e.codePointAt(t);return o[e.length]=t.shadow.color[0],o[e.length+1]=t.shadow.color[1],o[e.length+2]=t.shadow.color[2],o[e.length+3]=t.shadow.color[3],t.shadow.blur&&(o[e.length+4]=Math.floor(t.shadow.blur/10),o[e.length+5]=t.shadow.blur%10),o}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let o;t.length>10&&(o=10*t[10]+t[11]);const n={[e]:{color:s}};return o&&(n[e].blur=o),n}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},40417:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},14072:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},1701:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},79526:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},33047:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},4692:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},39601:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},55624:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},59159:(t,e,s)=>{const{hypLength:o}=s(82440),n=s(95679),{squishColor:r}=s(24369),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const c=t.size||1,d=e?c*o(e.x,e.y):c;l[4]=Math.floor(d),l[5]=Math.round(100*(d-Math.floor(d)));const u=t.color||n.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let o=6+f.length+2+3*[...h].length;l[o+p]=Number(s[0]),l[o+p+1]=Number(s[1]),l[o+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let o;o=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let n=6+f.length+2+3*[...h].length+3*[...a].length;l[n+g]=Number(o[0]),l[n+g+1]=Number(o[1]),l[n+g+2]=Number(o[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let c=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let o=h[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;c.push(n)}const d=String.fromCodePoint.apply(null,c);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let o=a[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;u.push(n)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let o=l[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;y.push(n)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:o,color:n,align:d,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},21289:(t,e,s)=>{const{GameNode:o}=s(63893),n=s(18708);t.exports={[[n.ASSET]]:o.Asset,[[n.TEXT]]:o.Text,[[n.SHAPE_2D_POLYGON]]:o.Shape,[[n.SHAPE_2D_CIRCLE]]:o.Shape,[[n.SHAPE_2D_LINE]]:o.Shape}},18708:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},46373:(t,e,s)=>{const{getRandomTerrain:o,getRandomStartPoint:n}=s(14883),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const c=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);o()(c,n(h,a,e),h,a,e);const d=((t,e,s,o)=>{const n=[];for(let i=0;i<s;i++)for(let s=0;s<o;s++){const o=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(n.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){n.push(...o);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(o.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(c,e,h,a);return d?i(c,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:o,height:n}=((t,e)=>{const s=t.x,o=t.y,n=e.x,r=e.y;return{width:Math.floor(s/n),height:Math.floor(o/r)}})(t,e);let r=((t,e)=>{const s=[],o={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let n=0;n<t;n++){s[n]=[];for(let r=0;r<e;r++){const i={...o};0===n?i.west=!1:n===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[n].push(i)}}return s})(o,n);const h={x:Math.floor(Math.random()*o),y:Math.floor(Math.random()*n)};return r=i(r,h,s,o,n),r}}},14883:t=>{const e=(t,{x:e,y:s},o,n,r)=>{e<0||e>=o||s<0||s>=n||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s+1,y:o+1},n,r,i)):1===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i)):2===h?(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o-1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o-1},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s,y:o+3},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+3,y:o},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-3,y:o},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s,y:o-3},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s+1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+2,y:o-1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o+1},n,r,i),e(t,{x:s+2,y:o+1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o-1},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const o={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;o.x===s.x&&o.y===s.y;)o.x=Math.floor(Math.random()*t),o.y=Math.floor(Math.random()*e);return o}}},69218:t=>{const e=(t,s,o,n=[])=>{if(!o||o(t)&&t.node.id!==s.node.id){const e=t.node.text,o=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=o[0][0],h=o[1][0],a=r[0][0],l=r[1][0],c=o[0][1],d=o[2][1],u=r[0][1],f=r[2][1];l<i||h<a||c>f||u>d||n.push(t)}for(const r in t.node.children)e(t.node.children[r],s,o,n);return n};t.exports={checkCollisions:(t,s,o=null)=>e(t,s,o)}},82440:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},91669:t=>{t.exports=function(t,e){const s={get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,o){const n=Reflect.defineProperty(t,s,o);return e&&e(),n},deleteProperty(t,s){const o=Reflect.deleteProperty(t,s);return e&&e(),o}},o=Proxy.revocable(t,s);return t.free=()=>{o.revoke()},o.proxy}},1388:t=>{t.exports={triangle:(t,e,s,o,n,r)=>[[t,e],[s,o],[n,r],[t,e]],rectangle:(t,e,s,o)=>[[t,e],[t+s,e],[t+s,e+o],[t,e+o],[t,e]]}},17234:(t,e,s)=>{const{GameNode:o}=s(63893),n=s(89761),r=s(1388),i=s(69218),h=s(95679);t.exports={getView:(t,e,s,a={},l={})=>{const c=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),d=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return c.length>0&&c.forEach((t=>{const o=[],n=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in n){const r=n[s],i=r[0],h=r[1];let c=Math.max(Math.min(i-e.x,100),0),d=Math.max(Math.min(h-e.y,100),0);c=(l.x||1)*c,d=(l.y||1)*d,(!a.filter||a.filter(t))&&(a.x&&(c+=a.x),a.y&&(d+=a.y)),c<0?c=0:c>100&&(c=100),d<0?d=0:d>100&&(d=100),o.push([c,d])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(o&&o.length&&(e.node.text&&(e.node.text.x=o[0][0],e.node.text.y=o[0][1]),o.length&&(e.node.coordinates2d=o),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],o=e.node.coordinates2d[2],n=s[0]-t[0],r=o[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=n,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>d.addChild(t))),d}}},482:(t,e,s)=>{const{squish:o,unsquish:n}=s(63426),{gameNode:r,GameNode:i}=s(53609),h=(s(29576),s(24515)),a=s(41765),l=s(81912),c=s(55285),d=s(9560),u=s(73974),{terrainGenerator:f}=s(47745),y=s(57608),p=s(44541),g=s(4319),x=s(2262),E=s(4074);t.exports={squish:o,unsquish:n,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:c,Squisher:p,ShapeUtils:d,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},4319:(t,e,s)=>{const o=s(27872),{getAppDataPath:n}=s(81702);t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(67012),this.http=s(80885),this.fs=s(53968),this.crypto=s(1506),this.path=s(27872),this.process=s(59148)}getConfigValue(t,e=void 0){const s=this.getConfig();let o=process.env[t]&&`${process.env[t]}`;if(void 0!==o)return"true"===o?o=!0:"false"===o&&(o=!1),console.log(`Using environment value: ${o} for key: ${t}`),o;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){const t=this.getHash(this.info.id);return`${o.join(n(),"asset-cache")}/${t}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=o.join(n(),"asset-cache");fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),r=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,r):(await downloadFileSync(this.info.id,e),this.initialized=!0,r)}download(t){const e=o.join(n(),"asset-cache");return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,o)=>{this.existsLocally().then((n=>{n&&!t?(this.initialized=!0,s(n)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{o(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,o)=>{s?e(s):t(o)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,o)=>{const n=this.getHash(t),r=`${e}/${n}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{o(t)}))}))}}},77342:(t,e,s)=>{const o=s(11865),n=s(29576),r=(t,e,s,r,i,h,a,l,c,d,u,f)=>{const y=new n(t,e,s,r,i,h,a,l,c,d,u,f);return o(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:o,fill:n,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:c,subtype:d,node:u,id:f}){this.node=u||r(t,e,s,o,n,i,h,a,l,c,d,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const o in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[o],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}free(){this.node.free()}}}},24515:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const o=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,n=Math.floor(Math.random()*o.length);return e[o[n]]}}},41765:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let o in s)if(e=s[o].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},53609:(t,e,s)=>{const o=s(55285),n=s(57608),{gameNode:r,BaseNode:i}=s(77342),h={[o.CIRCLE]:n.SHAPE_2D_CIRCLE,[o.POLYGON]:n.SHAPE_2D_POLYGON,[o.LINE]:n.SHAPE_2D_LINE},a={[n.SHAPE_2D_CIRCLE]:o.CIRCLE,[n.SHAPE_2D_POLYGON]:o.POLYGON,[n.SHAPE_2D_LINE]:o.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,id:d}){if(!(o&&s||c))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,subtype:h[s],id:d})}clone({handleClick:t,input:e,id:s}){const o=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:o})}}class c extends i{constructor({textInfo:t,playerIds:e,input:s,node:o,id:r}){if(!t&&!o)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:o,subtype:n.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new c({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:o})}}class d extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,subtype:n.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new d({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:o})}}const u={Asset:d,Shape:l,Text:c};t.exports={gameNode:r,GameNode:u}},29576:t=>{t.exports=class{constructor(t,e,s,o,n,r,i,h=[],a=null,l=null,c=null,d=null){this.id=d?Number(d):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=o,this.fill=n,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=c}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},55285:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},44541:(t,e,s)=>{const{squish:o,unsquish:n}=s(63426);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:o,onAssetUpdate:n}){if(this.ids=new Set,this.game=t,this.gameMetadata=t.constructor.metadata&&t.constructor.metadata(),this.assets={},this.customBottomLayer=s,this.customTopLayer=o,this.initialize(),this.onAssetUpdate=n,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return n(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const o={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,o),s.push(t)}for(const n in t){const r=[],i=t[n],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,o),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,o),s.push(t)}return this.playerFrames=o,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},r={},i=new Set){t.node.listeners.has(this)||t.addListener(this);const h=o(t,s);if(e.push(h),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>i.add(t))),i.size>0){let e=new Set;for(let s of i)r[s]||(r[Number(s)]=[]),0===t.node.playerIds.length||t.node.playerIds.findIndex((t=>Number(t)===Number(s)))>=0?r[s].push(h):e.add(s);for(let t of e)i.delete(t)}else Object.keys(r).forEach((t=>{r[t]||(r[Number(t)]=[]),r[t].push(h)}));for(let o=0;o<t.node.children.length;o++){const n=new Set(i);this.squishHelper(t.node.children[o],e,s,r,n)}for(let t in r)for(let e in r[t]){const s=n(r[t][e]);if(s.node.playerIds.length>0&&s.node.playerIds.findIndex((e=>Number(e)===Number(t)))<0&&(console.log(s.node.playerIds),console.log(t),console.log(s.node.playerIds.indexOf(t)),254!=t))throw new Error("fuk")}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const o=t[s].root;e[s]=o}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),o=this.game.constructor.metadata&&this.game.constructor.metadata(),n=o&&o.assets?o.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(n,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(n,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(n,this.game.getAssets());const r=Object.assign(s,n);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let o=0;const n=new Array(32);for(;o<32&&o<e.length;)n[o]=e.charCodeAt(o),o++;const l=(s.length+32).toString(36),c={image:1,audio:2,font:3}[r[e].info.type];let d="";for(let t=0;t<10-l.length;t++)d+="0";for(let t=l.length;t<10;t++)d+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,c,...u,...n,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let o=0;o<this.assets[s].length;o++)e[t++]=this.assets[s][o];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},81912:(t,e,s)=>{const{GameNode:o}=s(53609),n=s(55285),r=s(9560),i=s(24515),h=s(41765);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},36231:(t,e,s)=>{const{GameNode:o}=s(53609);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:o.Asset,2:o.Shape,3:o.Text}}},4074:t=>{t.exports={getPath:(t,e,s,o,n=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+o;if(a<0||a>n||l<0||l>r){let t=a,e=l;a<0?t=0:a>n&&(t=n),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},63426:(t,e,s)=>{const o=s(29576),{CONSTRUCTOR_TO_TYPE:n,TYPE_TO_CONSTRUCTOR:r}=s(36231),i=s(51821),{squishId:h}=s(19585),{squishColor:a}=s(88933),{squishPlayerIds:l}=s(79659),{squishPos:c}=s(17928),{squishFill:d}=s(36637),{squishSize:u}=s(4717),{squishHandleClick:f}=s(98332),{squishBorder:y}=s(71358),{squishSubType:p}=s(18380),{squishInput:g}=s(52186),{squishCoordinates2d:x}=s(63491),{squishEffect:E}=s(51945),{squishText:A}=s(52483),{squishAsset:S}=s(83550),m={id:h,color:a,playerIds:l,pos:c,coordinates2d:x,fill:d,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in m)L[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const o=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const n=r[t];if(n in o){const t=o[n];if(null!=t){const r=m[n].squish(t,e,o),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[n].type,a,h,...r])}}}let h=n[t.constructor.name];h||(h=n[i[o.subType]]);const a=s.flat(),l=a.length+5,c=Math.min(255,l),d=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),d,c,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new o;for(;e<t.length;){const o=t[e],n=t[e+1]+t[e+2],r=t.slice(e+3,e+n);if(!L[o]){console.warn("Unknown sub frame type "+o);break}{const t=L[o],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=n}const n=r[t[4]];return n?new n({node:s}):{node:s}}}},83550:(t,e,s)=>{const{getFractional:o}=s(40876),n={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],n=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,c=r.startTime||0;n[0]=Math.floor(i),n[1]=o(i),n[2]=Math.floor(h),n[3]=o(h),n[4]=Math.floor(a),n[5]=o(a),n[6]=Math.floor(l),n[7]=o(l),n[8]=Math.floor(c),n[9]=o(c);for(let t=0;t<s.length;t++)n[10+t]=s.codePointAt(t);return n},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t[6]+t[7]/100,r=t[8]+t[9]/100,i=String.fromCodePoint.apply(null,t.slice(10));return{[i]:{pos:{x:e,y:s},size:{x:o,y:n},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:n}},71358:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},88933:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},63491:(t,e,s)=>{const{getFractional:o}=s(40876),n=s(57608),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==n.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=o(t);const s=r(e.y,i[1]);let n;h[2]=s,h[3]=o(s),n=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(n),h[5]=o(n)}else{const t=i[0];h[0]=Math.floor(t),h[1]=o(t);const e=i[1];h[2]=Math.floor(e),h[3]=o(e);const s=i[2];h[4]=Math.round(s),h[5]=o(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,n=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=n,h[2*t+1]=o(n)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const o=t[e]+t[e+1]/100;s[e/2]=o}if(e===n.SHAPE_2D_POLYGON||e===n.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},51945:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const o=new Array(s);for(let t=0;t<e.length;t++)o[t]=e.codePointAt(t);return o[e.length]=t.shadow.color[0],o[e.length+1]=t.shadow.color[1],o[e.length+2]=t.shadow.color[2],o[e.length+3]=t.shadow.color[3],t.shadow.blur&&(o[e.length+4]=Math.floor(t.shadow.blur/10),o[e.length+5]=t.shadow.blur%10),o}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let o;t.length>10&&(o=10*t[10]+t[11]);const n={[e]:{color:s}};return o&&(n[e].blur=o),n}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},36637:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},98332:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},19585:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},52186:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},79659:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},17928:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},4717:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},18380:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},52483:(t,e,s)=>{const{hypLength:o}=s(40876),n=s(24515),{squishColor:r}=s(88933),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const c=t.size||1,d=e?c*o(e.x,e.y):c;l[4]=Math.floor(d),l[5]=Math.round(100*(d-Math.floor(d)));const u=t.color||n.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let o=6+f.length+2+3*[...h].length;l[o+p]=Number(s[0]),l[o+p+1]=Number(s[1]),l[o+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let o;o=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let n=6+f.length+2+3*[...h].length+3*[...a].length;l[n+g]=Number(o[0]),l[n+g+1]=Number(o[1]),l[n+g+2]=Number(o[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let c=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let o=h[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;c.push(n)}const d=String.fromCodePoint.apply(null,c);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let o=a[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;u.push(n)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let o=l[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;y.push(n)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:o,color:n,align:d,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},51821:(t,e,s)=>{const{GameNode:o}=s(53609),n=s(57608);t.exports={[[n.ASSET]]:o.Asset,[[n.TEXT]]:o.Text,[[n.SHAPE_2D_POLYGON]]:o.Shape,[[n.SHAPE_2D_CIRCLE]]:o.Shape,[[n.SHAPE_2D_LINE]]:o.Shape}},57608:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},47745:(t,e,s)=>{const{getRandomTerrain:o,getRandomStartPoint:n}=s(5799),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const c=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);o()(c,n(h,a,e),h,a,e);const d=((t,e,s,o)=>{const n=[];for(let i=0;i<s;i++)for(let s=0;s<o;s++){const o=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(n.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){n.push(...o);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(o.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(c,e,h,a);return d?i(c,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:o,height:n}=((t,e)=>{const s=t.x,o=t.y,n=e.x,r=e.y;return{width:Math.floor(s/n),height:Math.floor(o/r)}})(t,e);let r=((t,e)=>{const s=[],o={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let n=0;n<t;n++){s[n]=[];for(let r=0;r<e;r++){const i={...o};0===n?i.west=!1:n===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[n].push(i)}}return s})(o,n);const h={x:Math.floor(Math.random()*o),y:Math.floor(Math.random()*n)};return r=i(r,h,s,o,n),r}}},5799:t=>{const e=(t,{x:e,y:s},o,n,r)=>{e<0||e>=o||s<0||s>=n||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s+1,y:o+1},n,r,i)):1===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i)):2===h?(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o-1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o-1},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s,y:o+3},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+3,y:o},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-3,y:o},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s,y:o-3},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s+1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+2,y:o-1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o+1},n,r,i),e(t,{x:s+2,y:o+1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o-1},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const o={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;o.x===s.x&&o.y===s.y;)o.x=Math.floor(Math.random()*t),o.y=Math.floor(Math.random()*e);return o}}},2262:t=>{const e=(t,s,o,n=[])=>{if(!o||o(t)&&t.node.id!==s.node.id){const e=t.node.text,o=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=o[0][0],h=o[1][0],a=r[0][0],l=r[1][0],c=o[0][1],d=o[2][1],u=r[0][1],f=r[2][1];l<i||h<a||c>f||u>d||n.push(t)}for(const r in t.node.children)e(t.node.children[r],s,o,n);return n};t.exports={checkCollisions:(t,s,o=null)=>e(t,s,o)}},40876:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},11865:t=>{t.exports=function(t,e){const s={get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,o){const n=Reflect.defineProperty(t,s,o);return e&&e(),n},deleteProperty(t,s){const o=Reflect.deleteProperty(t,s);return e&&e(),o}},o=Proxy.revocable(t,s);return t.free=()=>{o.revoke()},o.proxy}},9560:t=>{t.exports={triangle:(t,e,s,o,n,r)=>[[t,e],[s,o],[n,r],[t,e]],rectangle:(t,e,s,o)=>[[t,e],[t+s,e],[t+s,e+o],[t,e+o],[t,e]]}},73974:(t,e,s)=>{const{GameNode:o}=s(53609),n=s(55285),r=s(9560),i=s(2262),h=s(24515);t.exports={getView:(t,e,s,a={},l={})=>{const c=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),d=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return c.length>0&&c.forEach((t=>{const o=[],n=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in n){const r=n[s],i=r[0],h=r[1];let c=Math.max(Math.min(i-e.x,100),0),d=Math.max(Math.min(h-e.y,100),0);c=(l.x||1)*c,d=(l.y||1)*d,(!a.filter||a.filter(t))&&(a.x&&(c+=a.x),a.y&&(d+=a.y)),c<0?c=0:c>100&&(c=100),d<0?d=0:d>100&&(d=100),o.push([c,d])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(o&&o.length&&(e.node.text&&(e.node.text.x=o[0][0],e.node.text.y=o[0][1]),o.length&&(e.node.coordinates2d=o),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],o=e.node.coordinates2d[2],n=s[0]-t[0],r=o[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=n,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>d.addChild(t))),d}}},81702:(t,e,s)=>{const o=s(27872);t.exports={getAppDataPath:()=>{if(!process)return"";switch(process.platform){case"darwin":return o.join(process.env.HOME,"Library","Application Support","homegames");case"win32":return o.join(process.env.APPDATA,"homegames");case"linux":return o.join(process.env.HOME,".homegames");default:console.log("Unsupported platform!"),process.exit(1)}}}},32953:(t,e,s)=>{const{squish:o,unsquish:n}=s(36131),{gameNode:r,GameNode:i}=s(74148),h=(s(42993),s(68778)),a=s(788),l=s(10701),c=s(84444),d=s(32419),u=s(97191),{terrainGenerator:f}=s(80106),y=s(50733),p=s(63432),g=s(46416),x=s(3345),E=s(30421);t.exports={squish:o,unsquish:n,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:c,Squisher:p,ShapeUtils:d,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},46416:(t,e,s)=>{const o=s(41579),{getAppDataPath:n}=s(68033);t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(62121),this.http=s(10262),this.fs=s(72607),this.crypto=s(70341),this.path=s(41579),this.process=s(52869)}getConfigValue(t,e=void 0){const s=this.getConfig();let o=process.env[t]&&`${process.env[t]}`;if(void 0!==o)return"true"===o?o=!0:"false"===o&&(o=!1),console.log(`Using environment value: ${o} for key: ${t}`),o;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){const t=this.getHash(this.info.id);return`${o.join(n(),"asset-cache")}/${t}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=o.join(n(),"asset-cache");fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),r=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,r):(await downloadFileSync(this.info.id,e),this.initialized=!0,r)}download(t){const e=o.join(n(),"asset-cache");return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,o)=>{this.existsLocally().then((n=>{n&&!t?(this.initialized=!0,s(n)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{o(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,o)=>{s?e(s):t(o)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,o)=>{const n=this.getHash(t),r=`${e}/${n}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{o(t)}))}))}}},85755:(t,e,s)=>{const o=s(27758),n=s(42993),r=(t,e,s,r,i,h,a,l,c,d,u,f)=>{const y=new n(t,e,s,r,i,h,a,l,c,d,u,f);return o(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:o,fill:n,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:c,subtype:d,node:u,id:f}){this.node=u||r(t,e,s,o,n,i,h,a,l,c,d,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const o in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[o],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}free(){this.node.free()}}}},68778:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const o=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,n=Math.floor(Math.random()*o.length);return e[o[n]]}}},788:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let o in s)if(e=s[o].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},74148:(t,e,s)=>{const o=s(84444),n=s(50733),{gameNode:r,BaseNode:i}=s(85755),h={[o.CIRCLE]:n.SHAPE_2D_CIRCLE,[o.POLYGON]:n.SHAPE_2D_POLYGON,[o.LINE]:n.SHAPE_2D_LINE},a={[n.SHAPE_2D_CIRCLE]:o.CIRCLE,[n.SHAPE_2D_POLYGON]:o.POLYGON,[n.SHAPE_2D_LINE]:o.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,id:d}){if(!(o&&s||c))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,subtype:h[s],id:d})}clone({handleClick:t,input:e,id:s}){const o=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:o})}}class c extends i{constructor({textInfo:t,playerIds:e,input:s,node:o,id:r}){if(!t&&!o)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:o,subtype:n.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new c({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:o})}}class d extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,subtype:n.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new d({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:o})}}const u={Asset:d,Shape:l,Text:c};t.exports={gameNode:r,GameNode:u}},42993:t=>{t.exports=class{constructor(t,e,s,o,n,r,i,h=[],a=null,l=null,c=null,d=null){this.id=d?Number(d):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=o,this.fill=n,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=c}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},84444:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},63432:(t,e,s)=>{const{squish:o,unsquish:n}=s(36131);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:o,onAssetUpdate:n}){if(this.ids=new Set,this.game=t,this.gameMetadata=t.constructor.metadata&&t.constructor.metadata(),this.assets={},this.customBottomLayer=s,this.customTopLayer=o,this.initialize(),this.onAssetUpdate=n,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return n(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const o={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,o),s.push(t)}for(const n in t){const r=[],i=t[n],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,o),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,o),s.push(t)}return this.playerFrames=o,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},n={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=o(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0){let e=new Set;for(let s of r)n[s]||(n[Number(s)]=[]),0===t.node.playerIds.length||t.node.playerIds.findIndex((t=>Number(t)===Number(s)))>=0?n[s].push(i):e.add(s);for(let t of e)r.delete(t)}else Object.keys(n).forEach((t=>{n[t]||(n[Number(t)]=[]),n[t].push(i)}));for(let o=0;o<t.node.children.length;o++){const i=new Set(r);this.squishHelper(t.node.children[o],e,s,n,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const o=t[s].root;e[s]=o}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),o=this.game.constructor.metadata&&this.game.constructor.metadata(),n=o&&o.assets?o.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(n,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(n,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(n,this.game.getAssets());const r=Object.assign(s,n);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let o=0;const n=new Array(32);for(;o<32&&o<e.length;)n[o]=e.charCodeAt(o),o++;const l=(s.length+32).toString(36),c={image:1,audio:2,font:3}[r[e].info.type];let d="";for(let t=0;t<10-l.length;t++)d+="0";for(let t=l.length;t<10;t++)d+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,c,...u,...n,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let o=0;o<this.assets[s].length;o++)e[t++]=this.assets[s][o];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},10701:(t,e,s)=>{const{GameNode:o}=s(74148),n=s(84444),r=s(32419),i=s(68778),h=s(788);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},22554:(t,e,s)=>{const{GameNode:o}=s(74148);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:o.Asset,2:o.Shape,3:o.Text}}},30421:t=>{t.exports={getPath:(t,e,s,o,n=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+o;if(a<0||a>n||l<0||l>r){let t=a,e=l;a<0?t=0:a>n&&(t=n),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},36131:(t,e,s)=>{const o=s(42993),{CONSTRUCTOR_TO_TYPE:n,TYPE_TO_CONSTRUCTOR:r}=s(22554),i=s(69444),{squishId:h}=s(42464),{squishColor:a}=s(75386),{squishPlayerIds:l}=s(33664),{squishPos:c}=s(94571),{squishFill:d}=s(69072),{squishSize:u}=s(56228),{squishHandleClick:f}=s(98319),{squishBorder:y}=s(96955),{squishSubType:p}=s(50235),{squishInput:g}=s(30789),{squishCoordinates2d:x}=s(34492),{squishEffect:E}=s(20304),{squishText:A}=s(822),{squishAsset:S}=s(53221),m={id:h,color:a,playerIds:l,pos:c,coordinates2d:x,fill:d,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in m)L[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const o=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const n=r[t];if(n in o){const t=o[n];if(null!=t){const r=m[n].squish(t,e,o),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[n].type,a,h,...r])}}}let h=n[t.constructor.name];h||(h=n[i[o.subType]]);const a=s.flat(),l=a.length+5,c=Math.min(255,l),d=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),d,c,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new o;for(;e<t.length;){const o=t[e],n=t[e+1]+t[e+2],r=t.slice(e+3,e+n);if(!L[o]){console.warn("Unknown sub frame type "+o);break}{const t=L[o],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=n}const n=r[t[4]];return n?new n({node:s}):{node:s}}}},53221:(t,e,s)=>{const{getFractional:o}=s(16065),n={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],n=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,c=r.startTime||0;n[0]=Math.floor(i),n[1]=o(i),n[2]=Math.floor(h),n[3]=o(h),n[4]=Math.floor(a),n[5]=o(a),n[6]=Math.floor(l),n[7]=o(l),n[8]=Math.floor(c),n[9]=o(c);for(let t=0;t<s.length;t++)n[10+t]=s.codePointAt(t);return n},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t[6]+t[7]/100,r=t[8]+t[9]/100,i=String.fromCodePoint.apply(null,t.slice(10));return{[i]:{pos:{x:e,y:s},size:{x:o,y:n},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:n}},96955:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},75386:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},34492:(t,e,s)=>{const{getFractional:o}=s(16065),n=s(50733),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==n.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=o(t);const s=r(e.y,i[1]);let n;h[2]=s,h[3]=o(s),n=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(n),h[5]=o(n)}else{const t=i[0];h[0]=Math.floor(t),h[1]=o(t);const e=i[1];h[2]=Math.floor(e),h[3]=o(e);const s=i[2];h[4]=Math.round(s),h[5]=o(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,n=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=n,h[2*t+1]=o(n)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const o=t[e]+t[e+1]/100;s[e/2]=o}if(e===n.SHAPE_2D_POLYGON||e===n.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},20304:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const o=new Array(s);for(let t=0;t<e.length;t++)o[t]=e.codePointAt(t);return o[e.length]=t.shadow.color[0],o[e.length+1]=t.shadow.color[1],o[e.length+2]=t.shadow.color[2],o[e.length+3]=t.shadow.color[3],t.shadow.blur&&(o[e.length+4]=Math.floor(t.shadow.blur/10),o[e.length+5]=t.shadow.blur%10),o}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let o;t.length>10&&(o=10*t[10]+t[11]);const n={[e]:{color:s}};return o&&(n[e].blur=o),n}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},69072:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},98319:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},42464:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},30789:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},33664:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},94571:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},56228:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},50235:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},822:(t,e,s)=>{const{hypLength:o}=s(16065),n=s(68778),{squishColor:r}=s(75386),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const c=t.size||1,d=e?c*o(e.x,e.y):c;l[4]=Math.floor(d),l[5]=Math.round(100*(d-Math.floor(d)));const u=t.color||n.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let o=6+f.length+2+3*[...h].length;l[o+p]=Number(s[0]),l[o+p+1]=Number(s[1]),l[o+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let o;o=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let n=6+f.length+2+3*[...h].length+3*[...a].length;l[n+g]=Number(o[0]),l[n+g+1]=Number(o[1]),l[n+g+2]=Number(o[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let c=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let o=h[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;c.push(n)}const d=String.fromCodePoint.apply(null,c);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let o=a[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;u.push(n)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let o=l[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;y.push(n)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:o,color:n,align:d,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},69444:(t,e,s)=>{const{GameNode:o}=s(74148),n=s(50733);t.exports={[[n.ASSET]]:o.Asset,[[n.TEXT]]:o.Text,[[n.SHAPE_2D_POLYGON]]:o.Shape,[[n.SHAPE_2D_CIRCLE]]:o.Shape,[[n.SHAPE_2D_LINE]]:o.Shape}},50733:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},80106:(t,e,s)=>{const{getRandomTerrain:o,getRandomStartPoint:n}=s(17958),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const c=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);o()(c,n(h,a,e),h,a,e);const d=((t,e,s,o)=>{const n=[];for(let i=0;i<s;i++)for(let s=0;s<o;s++){const o=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(n.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){n.push(...o);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(o.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(c,e,h,a);return d?i(c,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:o,height:n}=((t,e)=>{const s=t.x,o=t.y,n=e.x,r=e.y;return{width:Math.floor(s/n),height:Math.floor(o/r)}})(t,e);let r=((t,e)=>{const s=[],o={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let n=0;n<t;n++){s[n]=[];for(let r=0;r<e;r++){const i={...o};0===n?i.west=!1:n===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[n].push(i)}}return s})(o,n);const h={x:Math.floor(Math.random()*o),y:Math.floor(Math.random()*n)};return r=i(r,h,s,o,n),r}}},17958:t=>{const e=(t,{x:e,y:s},o,n,r)=>{e<0||e>=o||s<0||s>=n||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s+1,y:o+1},n,r,i)):1===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i)):2===h?(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o-1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o-1},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s,y:o+3},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+3,y:o},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-3,y:o},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s,y:o-3},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s+1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+2,y:o-1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o+1},n,r,i),e(t,{x:s+2,y:o+1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o-1},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const o={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;o.x===s.x&&o.y===s.y;)o.x=Math.floor(Math.random()*t),o.y=Math.floor(Math.random()*e);return o}}},3345:t=>{const e=(t,s,o,n=[])=>{if(!o||o(t)&&t.node.id!==s.node.id){const e=t.node.text,o=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=o[0][0],h=o[1][0],a=r[0][0],l=r[1][0],c=o[0][1],d=o[2][1],u=r[0][1],f=r[2][1];l<i||h<a||c>f||u>d||n.push(t)}for(const r in t.node.children)e(t.node.children[r],s,o,n);return n};t.exports={checkCollisions:(t,s,o=null)=>e(t,s,o)}},16065:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},27758:t=>{t.exports=function(t,e){const s={get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,o){const n=Reflect.defineProperty(t,s,o);return e&&e(),n},deleteProperty(t,s){const o=Reflect.deleteProperty(t,s);return e&&e(),o}},o=Proxy.revocable(t,s);return t.free=()=>{o.revoke()},o.proxy}},32419:t=>{t.exports={triangle:(t,e,s,o,n,r)=>[[t,e],[s,o],[n,r],[t,e]],rectangle:(t,e,s,o)=>[[t,e],[t+s,e],[t+s,e+o],[t,e+o],[t,e]]}},97191:(t,e,s)=>{const{GameNode:o}=s(74148),n=s(84444),r=s(32419),i=s(3345),h=s(68778);t.exports={getView:(t,e,s,a={},l={})=>{const c=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),d=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return c.length>0&&c.forEach((t=>{const o=[],n=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in n){const r=n[s],i=r[0],h=r[1];let c=Math.max(Math.min(i-e.x,100),0),d=Math.max(Math.min(h-e.y,100),0);c=(l.x||1)*c,d=(l.y||1)*d,(!a.filter||a.filter(t))&&(a.x&&(c+=a.x),a.y&&(d+=a.y)),c<0?c=0:c>100&&(c=100),d<0?d=0:d>100&&(d=100),o.push([c,d])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(o&&o.length&&(e.node.text&&(e.node.text.x=o[0][0],e.node.text.y=o[0][1]),o.length&&(e.node.coordinates2d=o),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],o=e.node.coordinates2d[2],n=s[0]-t[0],r=o[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=n,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>d.addChild(t))),d}}},68033:(t,e,s)=>{const o=s(41579);t.exports={getAppDataPath:()=>{if(!process)return"";switch(process.platform){case"darwin":return o.join(process.env.HOME,"Library","Application Support","homegames");case"win32":return o.join(process.env.APPDATA,"homegames");case"linux":return o.join(process.env.HOME,".homegames");default:console.log("Unsupported platform!"),process.exit(1)}}}},78784:(t,e,s)=>{const{squish:o,unsquish:n}=s(82984),{gameNode:r,GameNode:i}=s(65459),h=(s(53014),s(4949)),a=s(46479),l=s(2582),c=s(19771),d=s(32110),u=s(20660),{terrainGenerator:f}=s(1063),y=s(57994),p=s(92423),g=s(68497),x=s(5960),E=s(34680);t.exports={squish:o,unsquish:n,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:c,Squisher:p,ShapeUtils:d,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},68497:(t,e,s)=>{const o=s(75678),{getAppDataPath:n}=s(96580);t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(16898),this.http=s(77779),this.fs=s(21302),this.crypto=s(37204),this.path=s(75678),this.process=s(95578)}getConfigValue(t,e=void 0){const s=this.getConfig();let o=process.env[t]&&`${process.env[t]}`;if(void 0!==o)return"true"===o?o=!0:"false"===o&&(o=!1),console.log(`Using environment value: ${o} for key: ${t}`),o;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){const t=this.getHash(this.info.id);return`${o.join(n(),"asset-cache")}/${t}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=o.join(n(),"asset-cache");fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),r=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,r):(await downloadFileSync(this.info.id,e),this.initialized=!0,r)}download(t){const e=o.join(n(),"asset-cache");return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,o)=>{this.existsLocally().then((n=>{n&&!t?(this.initialized=!0,s(n)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{o(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,o)=>{s?e(s):t(o)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,o)=>{const n=this.getHash(t),r=`${e}/${n}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{o(t)}))}))}}},24204:(t,e,s)=>{const o=s(53014),n=(t,e,s,n,r,i,h,a,l,c,d,u)=>new o(t,e,s,n,r,i,h,a,l,c,d,u);t.exports={gameNode:n,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:o,fill:r,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:c,subtype:d,node:u,id:f}){this.node=u||n(t,e,s,o,r,i,h,a,l,c,d,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t,e=!0){this.node.addChild(t),e&&this.node.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e],!1);this.node.onStateChange()}getChildren(){return this.node.children}removeChild(t,e=!0){this.node.removeChild(t),e&&this.node.onStateChange()}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const o in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[o],s)}return s}clearChildren(t){this.node.clearChildren(t),this.node.onStateChange()}update(t={}){t&&(t.fill&&(this.node.fill=t.fill),t.coordinates2d&&(this.node.coordinates2d=coordinates2d)),this.node.onStateChange()}clone(){throw new Error("Clone not implemented")}}}},4949:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const o=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,n=Math.floor(Math.random()*o.length);return e[o[n]]}}},46479:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let o in s)if(e=s[o].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},65459:(t,e,s)=>{const o=s(19771),n=s(57994),{gameNode:r,BaseNode:i}=s(24204),h={[o.CIRCLE]:n.SHAPE_2D_CIRCLE,[o.POLYGON]:n.SHAPE_2D_POLYGON,[o.LINE]:n.SHAPE_2D_LINE},a={[n.SHAPE_2D_CIRCLE]:o.CIRCLE,[n.SHAPE_2D_POLYGON]:o.POLYGON,[n.SHAPE_2D_LINE]:o.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,id:d}){if(!(o&&s||c))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,subtype:h[s],id:d})}clone({handleClick:t,input:e,id:s}){const o=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:o})}}class c extends i{constructor({textInfo:t,playerIds:e,input:s,node:o,id:r}){if(!t&&!o)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:o,subtype:n.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new c({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:o})}}class d extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,subtype:n.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new d({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:o})}}const u={Asset:d,Shape:l,Text:c};t.exports={gameNode:r,GameNode:u}},53014:t=>{t.exports=class{constructor(t,e,s,o,n,r,i,h=[],a=null,l=null,c=null,d=null){this.id=d?Number(d):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=o,this.fill=n,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=c}addChild(t){this.children.push(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1))}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},19771:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},92423:(t,e,s)=>{const{squish:o,unsquish:n}=s(82984);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:o,onAssetUpdate:n}){if(this.ids=new Set,this.game=t,this.gameMetadata=t.constructor.metadata&&t.constructor.metadata(),this.assets={},this.customBottomLayer=s,this.customTopLayer=o,this.initialize(),this.onAssetUpdate=n,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return n(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const o={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,o),s.push(t)}for(const n in t){const r=[],i=t[n],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,o),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,o),s.push(t)}return this.playerFrames=o,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},n={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=o(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0){let e=new Set;for(let s of r)n[s]||(n[Number(s)]=[]),0===t.node.playerIds.length||t.node.playerIds.findIndex((t=>Number(t)===Number(s)))>=0?n[s].push(i):e.add(s);for(let t of e)r.delete(t)}else Object.keys(n).forEach((t=>{n[t]||(n[Number(t)]=[]),n[t].push(i)}));for(let o=0;o<t.node.children.length;o++){const i=new Set(r);this.squishHelper(t.node.children[o],e,s,n,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const o=t[s].root;e[s]=o}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),o=this.game.constructor.metadata&&this.game.constructor.metadata(),n=o&&o.assets?o.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(n,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(n,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(n,this.game.getAssets());const r=Object.assign(s,n);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let o=0;const n=new Array(32);for(;o<32&&o<e.length;)n[o]=e.charCodeAt(o),o++;const l=(s.length+32).toString(36),c={image:1,audio:2,font:3}[r[e].info.type];let d="";for(let t=0;t<10-l.length;t++)d+="0";for(let t=l.length;t<10;t++)d+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,c,...u,...n,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let o=0;o<this.assets[s].length;o++)e[t++]=this.assets[s][o];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},2582:(t,e,s)=>{const{GameNode:o}=s(65459),n=s(19771),r=s(32110),i=s(4949),h=s(46479);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},22401:(t,e,s)=>{const{GameNode:o}=s(65459);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:o.Asset,2:o.Shape,3:o.Text}}},34680:t=>{t.exports={getPath:(t,e,s,o,n=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+o;if(a<0||a>n||l<0||l>r){let t=a,e=l;a<0?t=0:a>n&&(t=n),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},82984:(t,e,s)=>{const o=s(53014),{CONSTRUCTOR_TO_TYPE:n,TYPE_TO_CONSTRUCTOR:r}=s(22401),i=s(14831),{squishId:h}=s(51787),{squishColor:a}=s(35459),{squishPlayerIds:l}=s(29769),{squishPos:c}=s(73374),{squishFill:d}=s(21075),{squishSize:u}=s(99679),{squishHandleClick:f}=s(75778),{squishBorder:y}=s(91952),{squishSubType:p}=s(90298),{squishInput:g}=s(99116),{squishCoordinates2d:x}=s(89637),{squishEffect:E}=s(67895),{squishText:A}=s(32421),{squishAsset:S}=s(14380),m={id:h,color:a,playerIds:l,pos:c,coordinates2d:x,fill:d,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in m)L[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const o=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const n=r[t];if(n in o){const t=o[n];if(null!=t){const r=m[n].squish(t,e,o),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[n].type,a,h,...r])}}}let h=n[t.constructor.name];h||(h=n[i[o.subType]]);const a=s.flat(),l=a.length+5,c=Math.min(255,l),d=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),d,c,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new o;for(;e<t.length;){const o=t[e],n=t[e+1]+t[e+2],r=t.slice(e+3,e+n);if(!L[o]){console.warn("Unknown sub frame type "+o);break}{const t=L[o],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=n}const n=r[t[4]];return n?new n({node:s}):{node:s}}}},14380:(t,e,s)=>{const{getFractional:o}=s(66698),n={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],n=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,c=r.startTime||0;n[0]=Math.floor(i),n[1]=o(i),n[2]=Math.floor(h),n[3]=o(h),n[4]=Math.floor(a),n[5]=o(a),n[6]=Math.floor(l),n[7]=o(l),n[8]=Math.floor(c),n[9]=o(c);for(let t=0;t<s.length;t++)n[10+t]=s.codePointAt(t);return n},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t[6]+t[7]/100,r=t[8]+t[9]/100,i=String.fromCodePoint.apply(null,t.slice(10));return{[i]:{pos:{x:e,y:s},size:{x:o,y:n},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:n}},91952:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},35459:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},89637:(t,e,s)=>{const{getFractional:o}=s(66698),n=s(57994),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==n.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=o(t);const s=r(e.y,i[1]);let n;h[2]=s,h[3]=o(s),n=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(n),h[5]=o(n)}else{const t=i[0];h[0]=Math.floor(t),h[1]=o(t);const e=i[1];h[2]=Math.floor(e),h[3]=o(e);const s=i[2];h[4]=Math.round(s),h[5]=o(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,n=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=n,h[2*t+1]=o(n)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const o=t[e]+t[e+1]/100;s[e/2]=o}if(e===n.SHAPE_2D_POLYGON||e===n.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},67895:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const o=new Array(s);for(let t=0;t<e.length;t++)o[t]=e.codePointAt(t);return o[e.length]=t.shadow.color[0],o[e.length+1]=t.shadow.color[1],o[e.length+2]=t.shadow.color[2],o[e.length+3]=t.shadow.color[3],t.shadow.blur&&(o[e.length+4]=Math.floor(t.shadow.blur/10),o[e.length+5]=t.shadow.blur%10),o}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let o;t.length>10&&(o=10*t[10]+t[11]);const n={[e]:{color:s}};return o&&(n[e].blur=o),n}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},21075:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},75778:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},51787:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},99116:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},29769:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},73374:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},99679:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},90298:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},32421:(t,e,s)=>{const{hypLength:o}=s(66698),n=s(4949),{squishColor:r}=s(35459),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const c=t.size||1,d=e?c*o(e.x,e.y):c;l[4]=Math.floor(d),l[5]=Math.round(100*(d-Math.floor(d)));const u=t.color||n.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let o=6+f.length+2+3*[...h].length;l[o+p]=Number(s[0]),l[o+p+1]=Number(s[1]),l[o+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let o;o=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let n=6+f.length+2+3*[...h].length+3*[...a].length;l[n+g]=Number(o[0]),l[n+g+1]=Number(o[1]),l[n+g+2]=Number(o[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let c=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let o=h[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;c.push(n)}const d=String.fromCodePoint.apply(null,c);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let o=a[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;u.push(n)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let o=l[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;y.push(n)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:o,color:n,align:d,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},14831:(t,e,s)=>{const{GameNode:o}=s(65459),n=s(57994);t.exports={[[n.ASSET]]:o.Asset,[[n.TEXT]]:o.Text,[[n.SHAPE_2D_POLYGON]]:o.Shape,[[n.SHAPE_2D_CIRCLE]]:o.Shape,[[n.SHAPE_2D_LINE]]:o.Shape}},57994:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},1063:(t,e,s)=>{const{getRandomTerrain:o,getRandomStartPoint:n}=s(93465),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const c=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);o()(c,n(h,a,e),h,a,e);const d=((t,e,s,o)=>{const n=[];for(let i=0;i<s;i++)for(let s=0;s<o;s++){const o=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(n.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){n.push(...o);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(o.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(c,e,h,a);return d?i(c,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:o,height:n}=((t,e)=>{const s=t.x,o=t.y,n=e.x,r=e.y;return{width:Math.floor(s/n),height:Math.floor(o/r)}})(t,e);let r=((t,e)=>{const s=[],o={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let n=0;n<t;n++){s[n]=[];for(let r=0;r<e;r++){const i={...o};0===n?i.west=!1:n===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[n].push(i)}}return s})(o,n);const h={x:Math.floor(Math.random()*o),y:Math.floor(Math.random()*n)};return r=i(r,h,s,o,n),r}}},93465:t=>{const e=(t,{x:e,y:s},o,n,r)=>{e<0||e>=o||s<0||s>=n||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s+1,y:o+1},n,r,i)):1===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i)):2===h?(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o-1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o-1},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s,y:o+3},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+3,y:o},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-3,y:o},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s,y:o-3},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s+1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+2,y:o-1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o+1},n,r,i),e(t,{x:s+2,y:o+1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o-1},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const o={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;o.x===s.x&&o.y===s.y;)o.x=Math.floor(Math.random()*t),o.y=Math.floor(Math.random()*e);return o}}},5960:t=>{const e=(t,s,o,n=[])=>{if(!o||o(t)&&t.node.id!==s.node.id){const e=t.node.text,o=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=o[0][0],h=o[1][0],a=r[0][0],l=r[1][0],c=o[0][1],d=o[2][1],u=r[0][1],f=r[2][1];l<i||h<a||c>f||u>d||n.push(t)}for(const r in t.node.children)e(t.node.children[r],s,o,n);return n};t.exports={checkCollisions:(t,s,o=null)=>e(t,s,o)}},66698:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},32110:t=>{t.exports={triangle:(t,e,s,o,n,r)=>[[t,e],[s,o],[n,r],[t,e]],rectangle:(t,e,s,o)=>[[t,e],[t+s,e],[t+s,e+o],[t,e+o],[t,e]]}},20660:(t,e,s)=>{const{GameNode:o}=s(65459),n=s(19771),r=s(32110),i=s(5960),h=s(4949);t.exports={getView:(t,e,s,a={},l={})=>{const c=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),d=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return c.length>0&&c.forEach((t=>{const o=[],n=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in n){const r=n[s],i=r[0],h=r[1];let c=Math.max(Math.min(i-e.x,100),0),d=Math.max(Math.min(h-e.y,100),0);c=(l.x||1)*c,d=(l.y||1)*d,(!a.filter||a.filter(t))&&(a.x&&(c+=a.x),a.y&&(d+=a.y)),c<0?c=0:c>100&&(c=100),d<0?d=0:d>100&&(d=100),o.push([c,d])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(o&&o.length&&(e.node.text&&(e.node.text.x=o[0][0],e.node.text.y=o[0][1]),o.length&&(e.node.coordinates2d=o),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],o=e.node.coordinates2d[2],n=s[0]-t[0],r=o[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=n,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>d.addChild(t))),d}}},96580:(t,e,s)=>{const o=s(75678);t.exports={getAppDataPath:()=>{if(!process)return"";switch(process.platform){case"darwin":return o.join(process.env.HOME,"Library","Application Support","homegames");case"win32":return o.join(process.env.APPDATA,"homegames");case"linux":return o.join(process.env.HOME,".homegames");default:console.log("Unsupported platform!"),process.exit(1)}}}},28423:(t,e,s)=>{const{squish:o,unsquish:n}=s(38745),{gameNode:r,GameNode:i}=s(17550),h=(s(73852),s(31956)),a=s(10150),l=s(51347),c=s(39146),d=s(52857),u=s(63429),{terrainGenerator:f}=s(78056),y=s(7623),p=s(6410),g=s(37074),x=s(32675),E=s(42883);t.exports={squish:o,unsquish:n,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:c,Squisher:p,ShapeUtils:d,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},37074:(t,e,s)=>{const o=s(35225),{getAppDataPath:n}=s(45279);t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(95055),this.http=s(51788),this.fs=s(60781),this.crypto=s(93919),this.path=s(35225),this.process=s(68395)}getConfigValue(t,e=void 0){const s=this.getConfig();let o=process.env[t]&&`${process.env[t]}`;if(void 0!==o)return"true"===o?o=!0:"false"===o&&(o=!1),console.log(`Using environment value: ${o} for key: ${t}`),o;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){const t=this.getHash(this.info.id);return`${o.join(n(),"asset-cache")}/${t}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=o.join(n(),"asset-cache");fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),r=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,r):(await downloadFileSync(this.info.id,e),this.initialized=!0,r)}download(t){const e=o.join(n(),"asset-cache");return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,o)=>{this.existsLocally().then((n=>{n&&!t?(this.initialized=!0,s(n)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{o(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,o)=>{s?e(s):t(o)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,o)=>{const n=this.getHash(t),r=`${e}/${n}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{o(t)}))}))}}},61126:(t,e,s)=>{const o=s(73852),n=(t,e,s,n,r,i,h,a,l,c,d,u,f,y)=>new o(t,e,s,n,r,i,h,a,l,c,d,u,f,y);t.exports={gameNode:n,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:o,fill:r,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:c,subtype:d,node:u,id:f,onHover:y,offHover:p}){this.node=u||n(t,e,s,o,r,i,h,a,l,c,d,f,y,p),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t,e=!0){this.node.addChild(t),e&&this.node.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e],!1);this.node.onStateChange()}getChildren(){return this.node.children}removeChild(t,e=!0){this.node.removeChild(t),e&&this.node.onStateChange()}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const o in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[o],s)}return s}clearChildren(t){this.node.clearChildren(t),this.node.onStateChange()}update(t={}){t&&(t.fill&&(this.node.fill=t.fill),t.coordinates2d&&(this.node.coordinates2d=coordinates2d)),this.node.onStateChange()}clone(){throw new Error("Clone not implemented")}}}},31956:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const o=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,n=Math.floor(Math.random()*o.length);return e[o[n]]}}},10150:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let o in s)if(e=s[o].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},17550:(t,e,s)=>{const o=s(39146),n=s(7623),{gameNode:r,BaseNode:i}=s(61126),h={[o.CIRCLE]:n.SHAPE_2D_CIRCLE,[o.POLYGON]:n.SHAPE_2D_POLYGON,[o.LINE]:n.SHAPE_2D_LINE},a={[n.SHAPE_2D_CIRCLE]:o.CIRCLE,[n.SHAPE_2D_POLYGON]:o.POLYGON,[n.SHAPE_2D_LINE]:o.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,id:d,onHover:u,offHover:f}){if(!(o&&s||c))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,subtype:h[s],id:d,onHover:u,offHover:f})}clone({handleClick:t,input:e,id:s}){const o=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:o})}}class c extends i{constructor({textInfo:t,playerIds:e,input:s,node:o,id:r}){if(!t&&!o)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:o,subtype:n.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new c({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:o})}}class d extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,id:h,onHover:a,offHover:l}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,subtype:n.ASSET,id:h,onHover:a,offHover:l})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new d({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:o})}}const u={Asset:d,Shape:l,Text:c};t.exports={gameNode:r,GameNode:u}},73852:t=>{t.exports=class{constructor(t,e,s,o,n,r,i,h=[],a=null,l=null,c=null,d=null,u,f){this.id=d?Number(d):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=o,this.fill=n,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=c,this.onHover=u,this.offHover=f}addChild(t){this.children.push(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1))}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},39146:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},6410:(t,e,s)=>{const{squish:o,unsquish:n}=s(38745);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:o,onAssetUpdate:n}){if(this.ids=new Set,this.game=t,this.gameMetadata=t.constructor.metadata&&t.constructor.metadata(),this.assets={},this.customBottomLayer=s,this.customTopLayer=o,this.initialize(),this.onAssetUpdate=n,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return n(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const o={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,o),s.push(t)}for(const n in t){const r=[],i=t[n],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,o),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,o),s.push(t)}return this.playerFrames=o,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},n={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=o(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0){let e=new Set;for(let s of r)n[s]||(n[Number(s)]=[]),0===t.node.playerIds.length||t.node.playerIds.findIndex((t=>Number(t)===Number(s)))>=0?n[s].push(i):e.add(s);for(let t of e)r.delete(t)}else Object.keys(n).forEach((t=>{n[t]||(n[Number(t)]=[]),n[t].push(i)}));for(let o=0;o<t.node.children.length;o++){const i=new Set(r);this.squishHelper(t.node.children[o],e,s,n,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const o=t[s].root;e[s]=o}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),o=this.game.constructor.metadata&&this.game.constructor.metadata(),n=o&&o.assets?o.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(n,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(n,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(n,this.game.getAssets());const r=Object.assign(s,n);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let o=0;const n=new Array(32);for(;o<32&&o<e.length;)n[o]=e.charCodeAt(o),o++;const l=(s.length+32).toString(36),c={image:1,audio:2,font:3}[r[e].info.type];let d="";for(let t=0;t<10-l.length;t++)d+="0";for(let t=l.length;t<10;t++)d+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,c,...u,...n,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let o=0;o<this.assets[s].length;o++)e[t++]=this.assets[s][o];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},51347:(t,e,s)=>{const{GameNode:o}=s(17550),n=s(39146),r=s(52857),i=s(31956),h=s(10150);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},18620:(t,e,s)=>{const{GameNode:o}=s(17550);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:o.Asset,2:o.Shape,3:o.Text}}},42883:t=>{t.exports={getPath:(t,e,s,o,n=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+o;if(a<0||a>n||l<0||l>r){let t=a,e=l;a<0?t=0:a>n&&(t=n),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},38745:(t,e,s)=>{const o=s(73852),{CONSTRUCTOR_TO_TYPE:n,TYPE_TO_CONSTRUCTOR:r}=s(18620),i=s(45334),{squishId:h}=s(34402),{squishColor:a}=s(10696),{squishPlayerIds:l}=s(43462),{squishPos:c}=s(27953),{squishFill:d}=s(3838),{squishSize:u}=s(99806),{squishHandleClick:f}=s(36933),{squishBorder:y}=s(5869),{squishSubType:p}=s(73609),{squishInput:g}=s(36591),{squishCoordinates2d:x}=s(36710),{squishEffect:E}=s(27422),{squishText:A}=s(18040),{squishAsset:S}=s(21219),m={id:h,color:a,playerIds:l,pos:c,coordinates2d:x,fill:d,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in m)L[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const o=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const n=r[t];if(n in o){const t=o[n];if(null!=t){const r=m[n].squish(t,e,o),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[n].type,a,h,...r])}}}let h=n[t.constructor.name];h||(h=n[i[o.subType]]);const a=s.flat(),l=a.length+5,c=Math.min(255,l),d=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),d,c,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new o;for(;e<t.length;){const o=t[e],n=t[e+1]+t[e+2],r=t.slice(e+3,e+n);if(!L[o]){console.warn("Unknown sub frame type "+o);break}{const t=L[o],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=n}const n=r[t[4]];return n?new n({node:s}):{node:s}}}},21219:(t,e,s)=>{const{getFractional:o}=s(93879),n={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],n=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,c=r.startTime||0;n[0]=Math.floor(i),n[1]=o(i),n[2]=Math.floor(h),n[3]=o(h),n[4]=Math.floor(a),n[5]=o(a),n[6]=Math.floor(l),n[7]=o(l),n[8]=Math.floor(c),n[9]=o(c);for(let t=0;t<s.length;t++)n[10+t]=s.codePointAt(t);return n},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t[6]+t[7]/100,r=t[8]+t[9]/100,i=String.fromCodePoint.apply(null,t.slice(10));return{[i]:{pos:{x:e,y:s},size:{x:o,y:n},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:n}},5869:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},10696:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},36710:(t,e,s)=>{const{getFractional:o}=s(93879),n=s(7623),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==n.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=o(t);const s=r(e.y,i[1]);let n;h[2]=s,h[3]=o(s),n=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(n),h[5]=o(n)}else{const t=i[0];h[0]=Math.floor(t),h[1]=o(t);const e=i[1];h[2]=Math.floor(e),h[3]=o(e);const s=i[2];h[4]=Math.round(s),h[5]=o(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,n=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=n,h[2*t+1]=o(n)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const o=t[e]+t[e+1]/100;s[e/2]=o}if(e===n.SHAPE_2D_POLYGON||e===n.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},27422:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const o=new Array(s);for(let t=0;t<e.length;t++)o[t]=e.codePointAt(t);return o[e.length]=t.shadow.color[0],o[e.length+1]=t.shadow.color[1],o[e.length+2]=t.shadow.color[2],o[e.length+3]=t.shadow.color[3],t.shadow.blur&&(o[e.length+4]=Math.floor(t.shadow.blur/10),o[e.length+5]=t.shadow.blur%10),o}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let o;t.length>10&&(o=10*t[10]+t[11]);const n={[e]:{color:s}};return o&&(n[e].blur=o),n}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},3838:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},36933:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},34402:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},36591:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},43462:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},27953:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},99806:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},73609:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},18040:(t,e,s)=>{const{hypLength:o}=s(93879),n=s(31956),{squishColor:r}=s(10696),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const c=t.size||1,d=e?c*o(e.x,e.y):c;l[4]=Math.floor(d),l[5]=Math.round(100*(d-Math.floor(d)));const u=t.color||n.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let o=6+f.length+2+3*[...h].length;l[o+p]=Number(s[0]),l[o+p+1]=Number(s[1]),l[o+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let o;o=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let n=6+f.length+2+3*[...h].length+3*[...a].length;l[n+g]=Number(o[0]),l[n+g+1]=Number(o[1]),l[n+g+2]=Number(o[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let c=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let o=h[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;c.push(n)}const d=String.fromCodePoint.apply(null,c);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let o=a[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;u.push(n)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let o=l[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;y.push(n)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:o,color:n,align:d,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},45334:(t,e,s)=>{const{GameNode:o}=s(17550),n=s(7623);t.exports={[[n.ASSET]]:o.Asset,[[n.TEXT]]:o.Text,[[n.SHAPE_2D_POLYGON]]:o.Shape,[[n.SHAPE_2D_CIRCLE]]:o.Shape,[[n.SHAPE_2D_LINE]]:o.Shape}},7623:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},78056:(t,e,s)=>{const{getRandomTerrain:o,getRandomStartPoint:n}=s(82584),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const c=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);o()(c,n(h,a,e),h,a,e);const d=((t,e,s,o)=>{const n=[];for(let i=0;i<s;i++)for(let s=0;s<o;s++){const o=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(n.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){n.push(...o);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(o.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(c,e,h,a);return d?i(c,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:o,height:n}=((t,e)=>{const s=t.x,o=t.y,n=e.x,r=e.y;return{width:Math.floor(s/n),height:Math.floor(o/r)}})(t,e);let r=((t,e)=>{const s=[],o={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let n=0;n<t;n++){s[n]=[];for(let r=0;r<e;r++){const i={...o};0===n?i.west=!1:n===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[n].push(i)}}return s})(o,n);const h={x:Math.floor(Math.random()*o),y:Math.floor(Math.random()*n)};return r=i(r,h,s,o,n),r}}},82584:t=>{const e=(t,{x:e,y:s},o,n,r)=>{e<0||e>=o||s<0||s>=n||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s+1,y:o+1},n,r,i)):1===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i)):2===h?(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o-1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o-1},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s,y:o+3},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+3,y:o},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-3,y:o},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s,y:o-3},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s+1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+2,y:o-1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o+1},n,r,i),e(t,{x:s+2,y:o+1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o-1},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const o={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;o.x===s.x&&o.y===s.y;)o.x=Math.floor(Math.random()*t),o.y=Math.floor(Math.random()*e);return o}}},32675:t=>{const e=(t,s,o,n=[])=>{if(!o||o(t)&&t.node.id!==s.node.id){const e=t.node.text,o=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=o[0][0],h=o[1][0],a=r[0][0],l=r[1][0],c=o[0][1],d=o[2][1],u=r[0][1],f=r[2][1];l<i||h<a||c>f||u>d||n.push(t)}for(const r in t.node.children)e(t.node.children[r],s,o,n);return n};t.exports={checkCollisions:(t,s,o=null)=>e(t,s,o)}},93879:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},52857:t=>{t.exports={triangle:(t,e,s,o,n,r)=>[[t,e],[s,o],[n,r],[t,e]],rectangle:(t,e,s,o)=>[[t,e],[t+s,e],[t+s,e+o],[t,e+o],[t,e]]}},63429:(t,e,s)=>{const{GameNode:o}=s(17550),n=s(39146),r=s(52857),i=s(32675),h=s(31956);t.exports={getView:(t,e,s,a={},l={})=>{const c=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),d=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return c.length>0&&c.forEach((t=>{const o=[],n=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in n){const r=n[s],i=r[0],h=r[1];let c=Math.max(Math.min(i-e.x,100),0),d=Math.max(Math.min(h-e.y,100),0);c=(l.x||1)*c,d=(l.y||1)*d,(!a.filter||a.filter(t))&&(a.x&&(c+=a.x),a.y&&(d+=a.y)),c<0?c=0:c>100&&(c=100),d<0?d=0:d>100&&(d=100),o.push([c,d])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(o&&o.length&&(e.node.text&&(e.node.text.x=o[0][0],e.node.text.y=o[0][1]),o.length&&(e.node.coordinates2d=o),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],o=e.node.coordinates2d[2],n=s[0]-t[0],r=o[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=n,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>d.addChild(t))),d}}},45279:(t,e,s)=>{const o=s(35225);t.exports={getAppDataPath:()=>{if(!process)return"";switch(process.platform){case"darwin":return o.join(process.env.HOME,"Library","Application Support","homegames");case"win32":return o.join(process.env.APPDATA,"homegames");case"linux":return o.join(process.env.HOME,".homegames");default:console.log("Unsupported platform!"),process.exit(1)}}}},31805:(t,e,s)=>{const{squish:o,unsquish:n}=s(78295),{gameNode:r,GameNode:i}=s(68456),h=(s(29837),s(99726)),a=s(91944),l=s(61945),c=s(63824),d=s(57631),u=s(20315),{terrainGenerator:f}=s(40966),y=s(24081),p=s(24372),g=s(30516),x=s(62805),E=s(23705);t.exports={squish:o,unsquish:n,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:c,Squisher:p,ShapeUtils:d,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},30516:(t,e,s)=>{const o=s(85047),{getAppDataPath:n}=s(60893);t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(83077),this.http=s(20810),this.fs=s(19883),this.crypto=s(98953),this.path=s(85047),this.process=s(32129)}getConfigValue(t,e=void 0){const s=this.getConfig();let o=process.env[t]&&`${process.env[t]}`;if(void 0!==o)return"true"===o?o=!0:"false"===o&&(o=!1),console.log(`Using environment value: ${o} for key: ${t}`),o;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){const t=this.getHash(this.info.id);return`${o.join(n(),"asset-cache")}/${t}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=o.join(n(),"asset-cache");fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),r=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,r):(await downloadFileSync(this.info.id,e),this.initialized=!0,r)}download(t){const e=o.join(n(),"asset-cache");return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,o)=>{this.existsLocally().then((n=>{n&&!t?(this.initialized=!0,s(n)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{o(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,o)=>{s?e(s):t(o)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,o)=>{const n=this.getHash(t),r=`${e}/${n}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{o(t)}))}))}}},78751:(t,e,s)=>{const o=s(29837),n=(t,e,s,n,r,i,h,a,l,c,d,u,f,y)=>new o(t,e,s,n,r,i,h,a,l,c,d,u,f,y);t.exports={gameNode:n,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:o,fill:r,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:c,subtype:d,node:u,id:f,onHover:y,offHover:p}){this.node=u||n(t,e,s,o,r,i,h,a,l,c,d,f,y,p),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t,e=!0){this.node.addChild(t),e&&this.node.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e],!1);this.node.onStateChange()}getChildren(){return this.node.children}removeChild(t,e=!0){this.node.removeChild(t),e&&this.node.onStateChange()}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const o in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[o],s)}return s}clearChildren(t){this.node.clearChildren(t),this.node.onStateChange()}update(t={}){t&&(t.fill&&(this.node.fill=t.fill),t.coordinates2d&&(this.node.coordinates2d=coordinates2d)),this.node.onStateChange()}clone(){throw new Error("Clone not implemented")}}}},99726:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const o=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,n=Math.floor(Math.random()*o.length);return e[o[n]]}}},91944:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let o in s)if(e=s[o].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},68456:(t,e,s)=>{const o=s(63824),n=s(24081),{gameNode:r,BaseNode:i}=s(78751),h={[o.CIRCLE]:n.SHAPE_2D_CIRCLE,[o.POLYGON]:n.SHAPE_2D_POLYGON,[o.LINE]:n.SHAPE_2D_LINE},a={[n.SHAPE_2D_CIRCLE]:o.CIRCLE,[n.SHAPE_2D_POLYGON]:o.POLYGON,[n.SHAPE_2D_LINE]:o.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,id:d,onHover:u,offHover:f}){if(!(o&&s||c))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,subtype:h[s],id:d,onHover:u,offHover:f})}clone({handleClick:t,input:e,id:s}){const o=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:o})}}class c extends i{constructor({textInfo:t,playerIds:e,input:s,node:o,id:r}){if(!t&&!o)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:o,subtype:n.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new c({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:o})}}class d extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,id:h,onHover:a,offHover:l}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,subtype:n.ASSET,id:h,onHover:a,offHover:l})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new d({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:o})}}const u={Asset:d,Shape:l,Text:c};t.exports={gameNode:r,GameNode:u}},29837:t=>{t.exports=class{constructor(t,e,s,o,n,r,i,h=[],a=null,l=null,c=null,d=null,u,f){this.id=d?Number(d):Math.floor(999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=o,this.fill=n,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=c,this.onHover=u,this.offHover=f}addChild(t){this.children.push(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1))}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},63824:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},24372:(t,e,s)=>{const{squish:o,unsquish:n}=s(78295);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:o,onAssetUpdate:n}){if(this.ids=new Set,this.game=t,this.gameMetadata=t.constructor.metadata&&t.constructor.metadata(),this.assets={},this.customBottomLayer=s,this.customTopLayer=o,this.initialize(),this.onAssetUpdate=n,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return n(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const o={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,o),s.push(t)}for(const n in t){const r=[],i=t[n],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,o),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,o),s.push(t)}return this.playerFrames=o,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},n={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=o(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0){let e=new Set;for(let s of r)n[s]||(n[Number(s)]=[]),0===t.node.playerIds.length||t.node.playerIds.findIndex((t=>Number(t)===Number(s)))>=0?n[s].push(i):e.add(s);for(let t of e)r.delete(t)}else Object.keys(n).forEach((t=>{n[t]||(n[Number(t)]=[]),n[t].push(i)}));for(let o=0;o<t.node.children.length;o++){const i=new Set(r);this.squishHelper(t.node.children[o],e,s,n,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const o=t[s].root;e[s]=o}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),o=this.game.constructor.metadata&&this.game.constructor.metadata(),n=o&&o.assets?o.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(n,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(n,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(n,this.game.getAssets());const r=Object.assign(s,n);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let o=0;const n=new Array(32);for(;o<32&&o<e.length;)n[o]=e.charCodeAt(o),o++;const l=(s.length+32).toString(36),c={image:1,audio:2,font:3}[r[e].info.type];let d="";for(let t=0;t<10-l.length;t++)d+="0";for(let t=l.length;t<10;t++)d+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,c,...u,...n,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let o=0;o<this.assets[s].length;o++)e[t++]=this.assets[s][o];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},61945:(t,e,s)=>{const{GameNode:o}=s(68456),n=s(63824),r=s(57631),i=s(99726),h=s(91944);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},25614:(t,e,s)=>{const{GameNode:o}=s(68456);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:o.Asset,2:o.Shape,3:o.Text}}},23705:t=>{t.exports={getPath:(t,e,s,o,n=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+o;if(a<0||a>n||l<0||l>r){let t=a,e=l;a<0?t=0:a>n&&(t=n),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},78295:(t,e,s)=>{const o=s(29837),{CONSTRUCTOR_TO_TYPE:n,TYPE_TO_CONSTRUCTOR:r}=s(25614),i=s(41080),{squishId:h}=s(54572),{squishColor:a}=s(64894),{squishPlayerIds:l}=s(66612),{squishPos:c}=s(55279),{squishFill:d}=s(24412),{squishSize:u}=s(31456),{squishHandleClick:f}=s(86211),{squishBorder:y}=s(3175),{squishSubType:p}=s(39919),{squishInput:g}=s(5049),{squishCoordinates2d:x}=s(28016),{squishEffect:E}=s(94700),{squishText:A}=s(92210),{squishAsset:S}=s(48977),m={id:h,color:a,playerIds:l,pos:c,coordinates2d:x,fill:d,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in m)L[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const o=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const n=r[t];if(n in o){const t=o[n];if(null!=t){const r=m[n].squish(t,e,o),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[n].type,a,h,...r])}}}let h=n[t.constructor.name];h||(h=n[i[o.subType]]);const a=s.flat(),l=a.length+5,c=Math.min(255,l),d=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),d,c,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new o;for(;e<t.length;){const o=t[e],n=t[e+1]+t[e+2],r=t.slice(e+3,e+n);if(!L[o]){console.warn("Unknown sub frame type "+o);break}{const t=L[o],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=n}const n=r[t[4]];return n?new n({node:s}):{node:s}}}},48977:(t,e,s)=>{const{getFractional:o}=s(38597),n={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],n=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,c=r.startTime||0;n[0]=Math.floor(i),n[1]=o(i),n[2]=Math.floor(h),n[3]=o(h),n[4]=Math.floor(a),n[5]=o(a),n[6]=Math.floor(l),n[7]=o(l),n[8]=Math.floor(c),n[9]=o(c);for(let t=0;t<s.length;t++)n[10+t]=s.codePointAt(t);return n},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t[6]+t[7]/100,r=t[8]+t[9]/100,i=String.fromCodePoint.apply(null,t.slice(10));return{[i]:{pos:{x:e,y:s},size:{x:o,y:n},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:n}},3175:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},64894:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},28016:(t,e,s)=>{const{getFractional:o}=s(38597),n=s(24081),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==n.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=o(t);const s=r(e.y,i[1]);let n;h[2]=s,h[3]=o(s),n=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(n),h[5]=o(n)}else{const t=i[0];h[0]=Math.floor(t),h[1]=o(t);const e=i[1];h[2]=Math.floor(e),h[3]=o(e);const s=i[2];h[4]=Math.round(s),h[5]=o(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,n=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=n,h[2*t+1]=o(n)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const o=t[e]+t[e+1]/100;s[e/2]=o}if(e===n.SHAPE_2D_POLYGON||e===n.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},94700:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const o=new Array(s);for(let t=0;t<e.length;t++)o[t]=e.codePointAt(t);return o[e.length]=t.shadow.color[0],o[e.length+1]=t.shadow.color[1],o[e.length+2]=t.shadow.color[2],o[e.length+3]=t.shadow.color[3],t.shadow.blur&&(o[e.length+4]=Math.floor(t.shadow.blur/10),o[e.length+5]=t.shadow.blur%10),o}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let o;t.length>10&&(o=10*t[10]+t[11]);const n={[e]:{color:s}};return o&&(n[e].blur=o),n}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},24412:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},86211:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},54572:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=new Array(12),o=0;for(;o<=12-e.length;o++)s[o]=0;for(let t=0;t<e.length;t++)s[t+o]=Number(e.charAt(t));return s},unsquish:t=>{let e=0;for(let s=0;s<t.length;s++)e+=t[s]*Math.pow(10,t.length-s-1);return Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},5049:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},66612:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},55279:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},31456:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},39919:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},92210:(t,e,s)=>{const{hypLength:o}=s(38597),n=s(99726),{squishColor:r}=s(64894),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const c=t.size||1,d=e?c*o(e.x,e.y):c;l[4]=Math.floor(d),l[5]=Math.round(100*(d-Math.floor(d)));const u=t.color||n.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let o=6+f.length+2+3*[...h].length;l[o+p]=Number(s[0]),l[o+p+1]=Number(s[1]),l[o+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let o;o=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let n=6+f.length+2+3*[...h].length+3*[...a].length;l[n+g]=Number(o[0]),l[n+g+1]=Number(o[1]),l[n+g+2]=Number(o[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let c=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let o=h[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;c.push(n)}const d=String.fromCodePoint.apply(null,c);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let o=a[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;u.push(n)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let o=l[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;y.push(n)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:o,color:n,align:d,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},41080:(t,e,s)=>{const{GameNode:o}=s(68456),n=s(24081);t.exports={[[n.ASSET]]:o.Asset,[[n.TEXT]]:o.Text,[[n.SHAPE_2D_POLYGON]]:o.Shape,[[n.SHAPE_2D_CIRCLE]]:o.Shape,[[n.SHAPE_2D_LINE]]:o.Shape}},24081:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},40966:(t,e,s)=>{const{getRandomTerrain:o,getRandomStartPoint:n}=s(33370),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const c=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);o()(c,n(h,a,e),h,a,e);const d=((t,e,s,o)=>{const n=[];for(let i=0;i<s;i++)for(let s=0;s<o;s++){const o=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(n.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){n.push(...o);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(o.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(c,e,h,a);return d?i(c,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:o,height:n}=((t,e)=>{const s=t.x,o=t.y,n=e.x,r=e.y;return{width:Math.floor(s/n),height:Math.floor(o/r)}})(t,e);let r=((t,e)=>{const s=[],o={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let n=0;n<t;n++){s[n]=[];for(let r=0;r<e;r++){const i={...o};0===n?i.west=!1:n===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[n].push(i)}}return s})(o,n);const h={x:Math.floor(Math.random()*o),y:Math.floor(Math.random()*n)};return r=i(r,h,s,o,n),r}}},33370:t=>{const e=(t,{x:e,y:s},o,n,r)=>{e<0||e>=o||s<0||s>=n||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s+1,y:o+1},n,r,i)):1===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i)):2===h?(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o-1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o-1},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s,y:o+3},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+3,y:o},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-3,y:o},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s,y:o-3},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s+1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+2,y:o-1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o+1},n,r,i),e(t,{x:s+2,y:o+1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o-1},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const o={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;o.x===s.x&&o.y===s.y;)o.x=Math.floor(Math.random()*t),o.y=Math.floor(Math.random()*e);return o}}},62805:t=>{const e=(t,s,o,n=[])=>{if(!o||o(t)&&t.node.id!==s.node.id){const e=t.node.text,o=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=o[0][0],h=o[1][0],a=r[0][0],l=r[1][0],c=o[0][1],d=o[2][1],u=r[0][1],f=r[2][1];l<i||h<a||c>f||u>d||n.push(t)}for(const r in t.node.children)e(t.node.children[r],s,o,n);return n};t.exports={checkCollisions:(t,s,o=null)=>e(t,s,o)}},38597:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},57631:t=>{t.exports={triangle:(t,e,s,o,n,r)=>[[t,e],[s,o],[n,r],[t,e]],rectangle:(t,e,s,o)=>[[t,e],[t+s,e],[t+s,e+o],[t,e+o],[t,e]]}},20315:(t,e,s)=>{const{GameNode:o}=s(68456),n=s(63824),r=s(57631),i=s(62805),h=s(99726);t.exports={getView:(t,e,s,a={},l={})=>{const c=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),d=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return c.length>0&&c.forEach((t=>{const o=[],n=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in n){const r=n[s],i=r[0],h=r[1];let c=Math.max(Math.min(i-e.x,100),0),d=Math.max(Math.min(h-e.y,100),0);c=(l.x||1)*c,d=(l.y||1)*d,(!a.filter||a.filter(t))&&(a.x&&(c+=a.x),a.y&&(d+=a.y)),c<0?c=0:c>100&&(c=100),d<0?d=0:d>100&&(d=100),o.push([c,d])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(o&&o.length&&(e.node.text&&(e.node.text.x=o[0][0],e.node.text.y=o[0][1]),o.length&&(e.node.coordinates2d=o),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],o=e.node.coordinates2d[2],n=s[0]-t[0],r=o[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=n,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>d.addChild(t))),d}}},60893:(t,e,s)=>{const o=s(85047);t.exports={getAppDataPath:()=>{if(!process)return"";switch(process.platform){case"darwin":return o.join(process.env.HOME,"Library","Application Support","homegames");case"win32":return o.join(process.env.APPDATA,"homegames");case"linux":return o.join(process.env.HOME,".homegames");default:console.log("Unsupported platform!"),process.exit(1)}}}},94007:(t,e,s)=>{const{squish:o,unsquish:n}=s(80809),{gameNode:r,GameNode:i}=s(63038),h=(s(33247),s(59588)),a=s(9814),l=s(56611),c=s(1050),d=s(96585),u=s(32565),{terrainGenerator:f}=s(15352),y=s(92023),p=s(70874),g=s(40642),x=s(32499),E=s(36083);t.exports={squish:o,unsquish:n,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:c,Squisher:p,ShapeUtils:d,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},40642:(t,e,s)=>{const o=s(80013),{getAppDataPath:n}=s(45999);t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(95939),this.http=s(91784),this.fs=s(99201),this.crypto=s(53499),this.path=s(80013),this.process=s(51039)}getConfigValue(t,e=void 0){const s=this.getConfig();let o=process.env[t]&&`${process.env[t]}`;if(void 0!==o)return"true"===o?o=!0:"false"===o&&(o=!1),console.log(`Using environment value: ${o} for key: ${t}`),o;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){const t=this.getHash(this.info.id);return`${o.join(n(),"asset-cache")}/${t}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=o.join(n(),"asset-cache");fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),r=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,r):(await downloadFileSync(this.info.id,e),this.initialized=!0,r)}download(t){const e=o.join(n(),"asset-cache");return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,o)=>{this.existsLocally().then((n=>{n&&!t?(this.initialized=!0,s(n)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{o(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,o)=>{s?e(s):t(o)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,o)=>{const n=this.getHash(t),r=`${e}/${n}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{o(t)}))}))}}},35977:(t,e,s)=>{const o=s(33247),n=(t,e,s,n,r,i,h,a,l,c,d,u,f,y)=>new o(t,e,s,n,r,i,h,a,l,c,d,u,f,y);t.exports={gameNode:n,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:o,fill:r,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:c,subtype:d,node:u,id:f,onHover:y,offHover:p}){this.node=u||n(t,e,s,o,r,i,h,a,l,c,d,f,y,p),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t,e=!0){this.node.addChild(t),e&&this.node.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e],!1);this.node.onStateChange()}getChildren(){return this.node.children}removeChild(t,e=!0){this.node.removeChild(t),e&&this.node.onStateChange()}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const o in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[o],s)}return s}clearChildren(t){this.node.clearChildren(t),this.node.onStateChange()}update(t={}){t&&(t.fill&&(this.node.fill=t.fill),t.coordinates2d&&(this.node.coordinates2d=coordinates2d)),this.node.onStateChange()}clone(){throw new Error("Clone not implemented")}}}},59588:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const o=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,n=Math.floor(Math.random()*o.length);return e[o[n]]}}},9814:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let o in s)if(e=s[o].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},63038:(t,e,s)=>{const o=s(1050),n=s(92023),{gameNode:r,BaseNode:i}=s(35977),h={[o.CIRCLE]:n.SHAPE_2D_CIRCLE,[o.POLYGON]:n.SHAPE_2D_POLYGON,[o.LINE]:n.SHAPE_2D_LINE},a={[n.SHAPE_2D_CIRCLE]:o.CIRCLE,[n.SHAPE_2D_POLYGON]:o.POLYGON,[n.SHAPE_2D_LINE]:o.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,id:d,onHover:u,offHover:f}){if(!(o&&s||c))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,subtype:h[s],id:d,onHover:u,offHover:f})}clone({handleClick:t,input:e,id:s}){const o=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:o})}}class c extends i{constructor({textInfo:t,playerIds:e,input:s,node:o,id:r}){if(!t&&!o)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:o,subtype:n.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new c({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:o})}}class d extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,id:h,onHover:a,offHover:l}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,subtype:n.ASSET,id:h,onHover:a,offHover:l})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new d({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:o})}}const u={Asset:d,Shape:l,Text:c};t.exports={gameNode:r,GameNode:u}},33247:t=>{t.exports=class{constructor(t,e,s,o,n,r,i,h=[],a=null,l=null,c=null,d=null,u,f){this.id=d?Number(d):Math.floor(999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=o,this.fill=n,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=c,this.onHover=u,this.offHover=f}addChild(t){this.children.push(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1))}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},1050:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},70874:(t,e,s)=>{const{squish:o,unsquish:n}=s(80809);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:o,onAssetUpdate:n}){if(this.ids=new Set,this.game=t,this.gameMetadata=t.constructor.metadata&&t.constructor.metadata(),this.assets={},this.playerSettings={},this.customBottomLayer=s,this.customTopLayer=o,this.initialize(),this.onAssetUpdate=n,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return n(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const o={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,o),s.push(t)}for(const n in t){const r=[],i=t[n],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,o),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,o),s.push(t)}return this.playerFrames=o,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},n={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=o(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0){let e=new Set;for(let s of r)if(n[s]||(n[Number(s)]=[]),0===t.node.playerIds.length||t.node.playerIds.findIndex((t=>Number(t)===Number(s)))>=0)if(t.node.asset){const e=this.gameAssets[Object.keys(t.node.asset)[0]]?.info;("audio"!==e.type||this.playerSettings[s]?.SOUND?.ENABLED)&&n[s].push(i)}else n[s].push(i);else e.add(s);for(let t of e)r.delete(t)}else Object.keys(n).forEach((e=>{if(n[e]||(n[Number(e)]=[]),t.node.asset){const s=this.gameAssets[Object.keys(t.node.asset)[0]]?.info;"audio"===s.type&&this.playerSettings[e]?.SOUND&&!this.playerSettings[e].SOUND.enabled||n[e].push(i)}else n[e].push(i)}));for(let o=0;o<t.node.children.length;o++){const i=new Set(r);this.squishHelper(t.node.children[o],e,s,n,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const o=t[s].root;e[s]=o}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),o=this.game.constructor.metadata&&this.game.constructor.metadata(),n=o&&o.assets?o.assets:{};this.gameAssets=n,this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(n,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(n,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(n,this.game.getAssets());const r=Object.assign(s,n);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let o=0;const n=new Array(32);for(;o<32&&o<e.length;)n[o]=e.charCodeAt(o),o++;const l=(s.length+32).toString(36),c={image:1,audio:2,font:3}[r[e].info.type];let d="";for(let t=0;t<10-l.length;t++)d+="0";for(let t=l.length;t<10;t++)d+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,c,...u,...n,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let o=0;o<this.assets[s].length;o++)e[t++]=this.assets[s][o];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}updatePlayerSettings(t,e){const s=Object.assign(this.playerSettings[t]||{},e);this.playerSettings[t]=s}deletePlayerSettings(t){delete this.playerSettings[t]}}},56611:(t,e,s)=>{const{GameNode:o}=s(63038),n=s(1050),r=s(96585),i=s(59588),h=s(9814);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},46732:(t,e,s)=>{const{GameNode:o}=s(63038);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:o.Asset,2:o.Shape,3:o.Text}}},36083:t=>{t.exports={getPath:(t,e,s,o,n=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+o;if(a<0||a>n||l<0||l>r){let t=a,e=l;a<0?t=0:a>n&&(t=n),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},80809:(t,e,s)=>{const o=s(33247),{CONSTRUCTOR_TO_TYPE:n,TYPE_TO_CONSTRUCTOR:r}=s(46732),i=s(20902),{squishId:h}=s(83602),{squishColor:a}=s(79352),{squishPlayerIds:l}=s(93430),{squishPos:c}=s(11137),{squishFill:d}=s(81038),{squishSize:u}=s(89006),{squishHandleClick:f}=s(38517),{squishBorder:y}=s(33917),{squishSubType:p}=s(94105),{squishInput:g}=s(58719),{squishCoordinates2d:x}=s(4918),{squishEffect:E}=s(12942),{squishText:A}=s(37288),{squishAsset:S}=s(9139),m={id:h,color:a,playerIds:l,pos:c,coordinates2d:x,fill:d,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in m)L[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const o=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const n=r[t];if(n in o){const t=o[n];if(null!=t){const r=m[n].squish(t,e,o),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[n].type,a,h,...r])}}}let h=n[t.constructor.name];h||(h=n[i[o.subType]]);const a=s.flat(),l=a.length+5,c=Math.min(255,l),d=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),d,c,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new o;for(;e<t.length;){const o=t[e],n=t[e+1]+t[e+2],r=t.slice(e+3,e+n);if(!L[o]){console.warn("Unknown sub frame type "+o);break}{const t=L[o],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=n}const n=r[t[4]];return n?new n({node:s}):{node:s}}}},9139:(t,e,s)=>{const{getFractional:o}=s(43975),n={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],n=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,c=r.startTime||0;n[0]=Math.floor(i),n[1]=o(i),n[2]=Math.floor(h),n[3]=o(h),n[4]=Math.floor(a),n[5]=o(a),n[6]=Math.floor(l),n[7]=o(l),n[8]=Math.floor(c),n[9]=o(c);for(let t=0;t<s.length;t++)n[10+t]=s.codePointAt(t);return n},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t[6]+t[7]/100,r=t[8]+t[9]/100,i=String.fromCodePoint.apply(null,t.slice(10));return{[i]:{pos:{x:e,y:s},size:{x:o,y:n},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:n}},33917:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},79352:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},4918:(t,e,s)=>{const{getFractional:o}=s(43975),n=s(92023),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==n.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=o(t);const s=r(e.y,i[1]);let n;h[2]=s,h[3]=o(s),n=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(n),h[5]=o(n)}else{const t=i[0];h[0]=Math.floor(t),h[1]=o(t);const e=i[1];h[2]=Math.floor(e),h[3]=o(e);const s=i[2];h[4]=Math.round(s),h[5]=o(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,n=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=n,h[2*t+1]=o(n)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const o=t[e]+t[e+1]/100;s[e/2]=o}if(e===n.SHAPE_2D_POLYGON||e===n.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},12942:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const o=new Array(s);for(let t=0;t<e.length;t++)o[t]=e.codePointAt(t);return o[e.length]=t.shadow.color[0],o[e.length+1]=t.shadow.color[1],o[e.length+2]=t.shadow.color[2],o[e.length+3]=t.shadow.color[3],t.shadow.blur&&(o[e.length+4]=Math.floor(t.shadow.blur/10),o[e.length+5]=t.shadow.blur%10),o}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let o;t.length>10&&(o=10*t[10]+t[11]);const n={[e]:{color:s}};return o&&(n[e].blur=o),n}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},81038:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},38517:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},83602:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=new Array(12),o=0;for(;o<=12-e.length;o++)s[o]=0;for(let t=0;t<e.length;t++)s[t+o]=Number(e.charAt(t));return s},unsquish:t=>{let e=0;for(let s=0;s<t.length;s++)e+=t[s]*Math.pow(10,t.length-s-1);return Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},58719:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},93430:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},11137:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},89006:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},94105:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},37288:(t,e,s)=>{const{hypLength:o}=s(43975),n=s(59588),{squishColor:r}=s(79352),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const c=t.size||1,d=e?c*o(e.x,e.y):c;l[4]=Math.floor(d),l[5]=Math.round(100*(d-Math.floor(d)));const u=t.color||n.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let o=6+f.length+2+3*[...h].length;l[o+p]=Number(s[0]),l[o+p+1]=Number(s[1]),l[o+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let o;o=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let n=6+f.length+2+3*[...h].length+3*[...a].length;l[n+g]=Number(o[0]),l[n+g+1]=Number(o[1]),l[n+g+2]=Number(o[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let c=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let o=h[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;c.push(n)}const d=String.fromCodePoint.apply(null,c);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let o=a[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;u.push(n)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let o=l[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;y.push(n)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:o,color:n,align:d,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},20902:(t,e,s)=>{const{GameNode:o}=s(63038),n=s(92023);t.exports={[[n.ASSET]]:o.Asset,[[n.TEXT]]:o.Text,[[n.SHAPE_2D_POLYGON]]:o.Shape,[[n.SHAPE_2D_CIRCLE]]:o.Shape,[[n.SHAPE_2D_LINE]]:o.Shape}},92023:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},15352:(t,e,s)=>{const{getRandomTerrain:o,getRandomStartPoint:n}=s(39720),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const c=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);o()(c,n(h,a,e),h,a,e);const d=((t,e,s,o)=>{const n=[];for(let i=0;i<s;i++)for(let s=0;s<o;s++){const o=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(n.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){n.push(...o);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(o.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(c,e,h,a);return d?i(c,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:o,height:n}=((t,e)=>{const s=t.x,o=t.y,n=e.x,r=e.y;return{width:Math.floor(s/n),height:Math.floor(o/r)}})(t,e);let r=((t,e)=>{const s=[],o={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let n=0;n<t;n++){s[n]=[];for(let r=0;r<e;r++){const i={...o};0===n?i.west=!1:n===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[n].push(i)}}return s})(o,n);const h={x:Math.floor(Math.random()*o),y:Math.floor(Math.random()*n)};return r=i(r,h,s,o,n),r}}},39720:t=>{const e=(t,{x:e,y:s},o,n,r)=>{e<0||e>=o||s<0||s>=n||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s+1,y:o+1},n,r,i)):1===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i)):2===h?(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o-1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o-1},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s,y:o+3},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+3,y:o},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-3,y:o},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s,y:o-3},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s+1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+2,y:o-1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o+1},n,r,i),e(t,{x:s+2,y:o+1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o-1},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const o={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;o.x===s.x&&o.y===s.y;)o.x=Math.floor(Math.random()*t),o.y=Math.floor(Math.random()*e);return o}}},32499:t=>{const e=(t,s,o,n=[])=>{if(!o||o(t)&&t.node.id!==s.node.id){const e=t.node.text,o=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=o[0][0],h=o[1][0],a=r[0][0],l=r[1][0],c=o[0][1],d=o[2][1],u=r[0][1],f=r[2][1];l<i||h<a||c>f||u>d||n.push(t)}for(const r in t.node.children)e(t.node.children[r],s,o,n);return n};t.exports={checkCollisions:(t,s,o=null)=>e(t,s,o)}},43975:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},96585:t=>{t.exports={triangle:(t,e,s,o,n,r)=>[[t,e],[s,o],[n,r],[t,e]],rectangle:(t,e,s,o)=>[[t,e],[t+s,e],[t+s,e+o],[t,e+o],[t,e]]}},32565:(t,e,s)=>{const{GameNode:o}=s(63038),n=s(1050),r=s(96585),i=s(32499),h=s(59588);t.exports={getView:(t,e,s,a={},l={})=>{const c=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),d=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return c.length>0&&c.forEach((t=>{const o=[],n=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in n){const r=n[s],i=r[0],h=r[1];let c=Math.max(Math.min(i-e.x,100),0),d=Math.max(Math.min(h-e.y,100),0);c=(l.x||1)*c,d=(l.y||1)*d,(!a.filter||a.filter(t))&&(a.x&&(c+=a.x),a.y&&(d+=a.y)),c<0?c=0:c>100&&(c=100),d<0?d=0:d>100&&(d=100),o.push([c,d])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(o&&o.length&&(e.node.text&&(e.node.text.x=o[0][0],e.node.text.y=o[0][1]),o.length&&(e.node.coordinates2d=o),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],o=e.node.coordinates2d[2],n=s[0]-t[0],r=o[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=n,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>d.addChild(t))),d}}},45999:(t,e,s)=>{const o=s(80013);t.exports={getAppDataPath:()=>{if(!process)return"";switch(process.platform){case"darwin":return o.join(process.env.HOME,"Library","Application Support","homegames");case"win32":return o.join(process.env.APPDATA,"homegames");case"linux":return o.join(process.env.HOME,".homegames");default:console.log("Unsupported platform!"),process.exit(1)}}}},51996:(t,e,s)=>{const{squish:o,unsquish:n}=s(63652),{gameNode:r,GameNode:i}=s(65231),h=(s(88378),s(833)),a=s(25323),l=s(36874),c=s(27031),d=s(69714),u=s(45280),{terrainGenerator:f}=s(88699),y=s(92678),p=s(20603),g=s(61981),x=s(14020),E=s(94084);t.exports={squish:o,unsquish:n,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:c,Squisher:p,ShapeUtils:d,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},61981:(t,e,s)=>{const o=s(10398),{getAppDataPath:n}=s(81560);let r="https://assets.homegames.io";try{r=process?.env?.API_URL?`${process.env.API_URL}/assets`:"https://assets.homegames.io"}catch(t){console.log("probably running in a browser"),console.error(t)}const i=r;t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(31714),this.http=s(96147),this.fs=s(40822),this.crypto=s(20020),this.path=s(10398),this.process=s(15034)}getConfigValue(t,e=void 0){const s=this.getConfig();let o=process.env[t]&&`${process.env[t]}`;if(void 0!==o)return"true"===o?o=!0:"false"===o&&(o=!1),console.log(`Using environment value: ${o} for key: ${t}`),o;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){const t=this.getHash(this.info.id);return`${o.join(n(),"asset-cache")}/${t}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=o.join(n(),"asset-cache");fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),r=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,r):(await downloadFileSync(this.info.id,e),this.initialized=!0,r)}download(t){const e=o.join(n(),"asset-cache");return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,o)=>{this.existsLocally().then((n=>{n&&!t?(this.initialized=!0,s(n)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{o(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,o)=>{s?e(s):t(o)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,o)=>{const n=this.getHash(t),r=`${e}/${n}`,h=this.fs.createWriteStream(r),a=this.https;h.on("close",(()=>{s(r)})),a.get(`${i}/${t}`,(t=>{h.on("finish",(()=>{h.close()})),t.pipe(h)})).on("error",(t=>{console.error("Failed to download asset"),console.error(t),o(t)}))}))}}},65e3:(t,e,s)=>{const o=s(88378),n=(t,e,s,n,r,i,h,a,l,c,d,u,f,y)=>new o(t,e,s,n,r,i,h,a,l,c,d,u,f,y);t.exports={gameNode:n,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:o,fill:r,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:c,subtype:d,node:u,id:f,onHover:y,offHover:p}){this.node=u||n(t,e,s,o,r,i,h,a,l,c,d,f,y,p),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t,e=!0){this.node.addChild(t),e&&this.node.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e],!1);this.node.onStateChange()}getChildren(){return this.node.children}removeChild(t,e=!0){this.node.removeChild(t),e&&this.node.onStateChange()}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const o in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[o],s)}return s}clearChildren(t){this.node.clearChildren(t),this.node.onStateChange()}update(t={}){t&&(t.fill&&(this.node.fill=t.fill),t.coordinates2d&&(this.node.coordinates2d=coordinates2d)),this.node.onStateChange()}clone(){throw new Error("Clone not implemented")}}}},833:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const o=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,n=Math.floor(Math.random()*o.length);return e[o[n]]}}},25323:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let o in s)if(e=s[o].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},65231:(t,e,s)=>{const o=s(27031),n=s(92678),{gameNode:r,BaseNode:i}=s(65e3),h={[o.CIRCLE]:n.SHAPE_2D_CIRCLE,[o.POLYGON]:n.SHAPE_2D_POLYGON,[o.LINE]:n.SHAPE_2D_LINE},a={[n.SHAPE_2D_CIRCLE]:o.CIRCLE,[n.SHAPE_2D_POLYGON]:o.POLYGON,[n.SHAPE_2D_LINE]:o.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,id:d,onHover:u,offHover:f}){if(!(o&&s||c))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,subtype:h[s],id:d,onHover:u,offHover:f})}clone({handleClick:t,input:e,id:s}){const o=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:o})}}class c extends i{constructor({textInfo:t,playerIds:e,input:s,node:o,id:r}){if(!t&&!o)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:o,subtype:n.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new c({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:o})}}class d extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,id:h,onHover:a,offHover:l}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,subtype:n.ASSET,id:h,onHover:a,offHover:l})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new d({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:o})}}const u={Asset:d,Shape:l,Text:c};t.exports={gameNode:r,GameNode:u}},88378:t=>{t.exports=class{constructor(t,e,s,o,n,r,i,h=[],a=null,l=null,c=null,d=null,u,f){this.id=d?Number(d):Math.floor(999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=o,this.fill=n,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=c,this.onHover=u,this.offHover=f}addChild(t){this.children.push(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1))}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},27031:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},20603:(t,e,s)=>{const{squish:o,unsquish:n}=s(63652);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:o,onAssetUpdate:n}){if(this.ids=new Set,this.game=t,this.gameMetadata=t.constructor.metadata&&t.constructor.metadata(),this.assets={},this.playerSettings={},this.customBottomLayer=s,this.customTopLayer=o,this.initialize(),this.onAssetUpdate=n,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return n(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const o={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,o),s.push(t)}for(const n in t){const r=[],i=t[n],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,o),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,o),s.push(t)}return this.playerFrames=o,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},n={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=o(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0){let e=new Set;for(let s of r)if(n[s]||(n[Number(s)]=[]),0===t.node.playerIds.length||t.node.playerIds.findIndex((t=>Number(t)===Number(s)))>=0)if(t.node.asset){const e=this.gameAssets[Object.keys(t.node.asset)[0]]?.info;("audio"!==e.type||this.playerSettings[s]?.SOUND?.ENABLED)&&n[s].push(i)}else n[s].push(i);else e.add(s);for(let t of e)r.delete(t)}else Object.keys(n).forEach((e=>{if(n[e]||(n[Number(e)]=[]),t.node.asset){const s=this.gameAssets[Object.keys(t.node.asset)[0]]?.info;"audio"===s.type&&this.playerSettings[e]?.SOUND&&!this.playerSettings[e].SOUND.enabled||n[e].push(i)}else n[e].push(i)}));for(let o=0;o<t.node.children.length;o++){const i=new Set(r);this.squishHelper(t.node.children[o],e,s,n,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const o=t[s].root;e[s]=o}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),o=this.game.constructor.metadata&&this.game.constructor.metadata(),n=o&&o.assets?o.assets:{};this.gameAssets=n,this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(n,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(n,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(n,this.game.getAssets());const r=Object.assign(s,n);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let o=0;const n=new Array(32);for(;o<32&&o<e.length;)n[o]=e.charCodeAt(o),o++;const l=(s.length+32).toString(36),c={image:1,audio:2,font:3}[r[e].info.type];let d="";for(let t=0;t<10-l.length;t++)d+="0";for(let t=l.length;t<10;t++)d+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,c,...u,...n,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let o=0;o<this.assets[s].length;o++)e[t++]=this.assets[s][o];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}updatePlayerSettings(t,e){const s=Object.assign(this.playerSettings[t]||{},e);this.playerSettings[t]=s}deletePlayerSettings(t){delete this.playerSettings[t]}}},36874:(t,e,s)=>{const{GameNode:o}=s(65231),n=s(27031),r=s(69714),i=s(833),h=s(25323);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},64877:(t,e,s)=>{const{GameNode:o}=s(65231);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:o.Asset,2:o.Shape,3:o.Text}}},94084:t=>{t.exports={getPath:(t,e,s,o,n=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+o;if(a<0||a>n||l<0||l>r){let t=a,e=l;a<0?t=0:a>n&&(t=n),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},63652:(t,e,s)=>{const o=s(88378),{CONSTRUCTOR_TO_TYPE:n,TYPE_TO_CONSTRUCTOR:r}=s(64877),i=s(843),{squishId:h}=s(18287),{squishColor:a}=s(32335),{squishPlayerIds:l}=s(29573),{squishPos:c}=s(33626),{squishFill:d}=s(49943),{squishSize:u}=s(1955),{squishHandleClick:f}=s(82846),{squishBorder:y}=s(54612),{squishSubType:p}=s(51622),{squishInput:g}=s(47720),{squishCoordinates2d:x}=s(85265),{squishEffect:E}=s(27819),{squishText:A}=s(28073),{squishAsset:S}=s(46384),m={id:h,color:a,playerIds:l,pos:c,coordinates2d:x,fill:d,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in m)L[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const o=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const n=r[t];if(n in o){const t=o[n];if(null!=t){const r=m[n].squish(t,e,o),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[n].type,a,h,...r])}}}let h=n[t.constructor.name];h||(h=n[i[o.subType]]);const a=s.flat(),l=a.length+5,c=Math.min(255,l),d=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),d,c,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new o;for(;e<t.length;){const o=t[e],n=t[e+1]+t[e+2],r=t.slice(e+3,e+n);if(!L[o]){console.warn("Unknown sub frame type "+o);break}{const t=L[o],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=n}const n=r[t[4]];return n?new n({node:s}):{node:s}}}},46384:(t,e,s)=>{const{getFractional:o}=s(6406),n={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],n=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,c=r.startTime||0;n[0]=Math.floor(i),n[1]=o(i),n[2]=Math.floor(h),n[3]=o(h),n[4]=Math.floor(a),n[5]=o(a),n[6]=Math.floor(l),n[7]=o(l),n[8]=Math.floor(c),n[9]=o(c);for(let t=0;t<s.length;t++)n[10+t]=s.codePointAt(t);return n},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t[6]+t[7]/100,r=t[8]+t[9]/100,i=String.fromCodePoint.apply(null,t.slice(10));return{[i]:{pos:{x:e,y:s},size:{x:o,y:n},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:n}},54612:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},32335:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},85265:(t,e,s)=>{const{getFractional:o}=s(6406),n=s(92678),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==n.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=o(t);const s=r(e.y,i[1]);let n;h[2]=s,h[3]=o(s),n=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(n),h[5]=o(n)}else{const t=i[0];h[0]=Math.floor(t),h[1]=o(t);const e=i[1];h[2]=Math.floor(e),h[3]=o(e);const s=i[2];h[4]=Math.round(s),h[5]=o(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,n=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=n,h[2*t+1]=o(n)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const o=t[e]+t[e+1]/100;s[e/2]=o}if(e===n.SHAPE_2D_POLYGON||e===n.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},27819:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const o=new Array(s);for(let t=0;t<e.length;t++)o[t]=e.codePointAt(t);return o[e.length]=t.shadow.color[0],o[e.length+1]=t.shadow.color[1],o[e.length+2]=t.shadow.color[2],o[e.length+3]=t.shadow.color[3],t.shadow.blur&&(o[e.length+4]=Math.floor(t.shadow.blur/10),o[e.length+5]=t.shadow.blur%10),o}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let o;t.length>10&&(o=10*t[10]+t[11]);const n={[e]:{color:s}};return o&&(n[e].blur=o),n}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},49943:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},82846:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},18287:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=new Array(12),o=0;for(;o<=12-e.length;o++)s[o]=0;for(let t=0;t<e.length;t++)s[t+o]=Number(e.charAt(t));return s},unsquish:t=>{let e=0;for(let s=0;s<t.length;s++)e+=t[s]*Math.pow(10,t.length-s-1);return Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},47720:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},29573:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},33626:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},1955:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},51622:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},28073:(t,e,s)=>{const{hypLength:o}=s(6406),n=s(833),{squishColor:r}=s(32335),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const c=t.size||1,d=e?c*o(e.x,e.y):c;l[4]=Math.floor(d),l[5]=Math.round(100*(d-Math.floor(d)));const u=t.color||n.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let o=6+f.length+2+3*[...h].length;l[o+p]=Number(s[0]),l[o+p+1]=Number(s[1]),l[o+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let o;o=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let n=6+f.length+2+3*[...h].length+3*[...a].length;l[n+g]=Number(o[0]),l[n+g+1]=Number(o[1]),l[n+g+2]=Number(o[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let c=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let o=h[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;c.push(n)}const d=String.fromCodePoint.apply(null,c);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let o=a[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;u.push(n)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let o=l[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;y.push(n)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:o,color:n,align:d,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},843:(t,e,s)=>{const{GameNode:o}=s(65231),n=s(92678);t.exports={[[n.ASSET]]:o.Asset,[[n.TEXT]]:o.Text,[[n.SHAPE_2D_POLYGON]]:o.Shape,[[n.SHAPE_2D_CIRCLE]]:o.Shape,[[n.SHAPE_2D_LINE]]:o.Shape}},92678:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},88699:(t,e,s)=>{const{getRandomTerrain:o,getRandomStartPoint:n}=s(48853),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const c=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);o()(c,n(h,a,e),h,a,e);const d=((t,e,s,o)=>{const n=[];for(let i=0;i<s;i++)for(let s=0;s<o;s++){const o=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(n.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){n.push(...o);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(o.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(c,e,h,a);return d?i(c,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:o,height:n}=((t,e)=>{const s=t.x,o=t.y,n=e.x,r=e.y;return{width:Math.floor(s/n),height:Math.floor(o/r)}})(t,e);let r=((t,e)=>{const s=[],o={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let n=0;n<t;n++){s[n]=[];for(let r=0;r<e;r++){const i={...o};0===n?i.west=!1:n===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[n].push(i)}}return s})(o,n);const h={x:Math.floor(Math.random()*o),y:Math.floor(Math.random()*n)};return r=i(r,h,s,o,n),r}}},48853:t=>{const e=(t,{x:e,y:s},o,n,r)=>{e<0||e>=o||s<0||s>=n||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s+1,y:o+1},n,r,i)):1===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i)):2===h?(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o-1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o-1},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s,y:o+3},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+3,y:o},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-3,y:o},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s,y:o-3},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s+1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+2,y:o-1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o+1},n,r,i),e(t,{x:s+2,y:o+1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o-1},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const o={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;o.x===s.x&&o.y===s.y;)o.x=Math.floor(Math.random()*t),o.y=Math.floor(Math.random()*e);return o}}},14020:t=>{const e=(t,s,o,n=[])=>{if(!o||o(t)&&t.node.id!==s.node.id){const e=t.node.text,o=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=o[0][0],h=o[1][0],a=r[0][0],l=r[1][0],c=o[0][1],d=o[2][1],u=r[0][1],f=r[2][1];l<i||h<a||c>f||u>d||n.push(t)}for(const r in t.node.children)e(t.node.children[r],s,o,n);return n};t.exports={checkCollisions:(t,s,o=null)=>e(t,s,o)}},6406:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},69714:t=>{t.exports={triangle:(t,e,s,o,n,r)=>[[t,e],[s,o],[n,r],[t,e]],rectangle:(t,e,s,o)=>[[t,e],[t+s,e],[t+s,e+o],[t,e+o],[t,e]]}},45280:(t,e,s)=>{const{GameNode:o}=s(65231),n=s(27031),r=s(69714),i=s(14020),h=s(833);t.exports={getView:(t,e,s,a={},l={})=>{const c=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),d=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return c.length>0&&c.forEach((t=>{const o=[],n=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in n){const r=n[s],i=r[0],h=r[1];let c=Math.max(Math.min(i-e.x,100),0),d=Math.max(Math.min(h-e.y,100),0);c=(l.x||1)*c,d=(l.y||1)*d,(!a.filter||a.filter(t))&&(a.x&&(c+=a.x),a.y&&(d+=a.y)),c<0?c=0:c>100&&(c=100),d<0?d=0:d>100&&(d=100),o.push([c,d])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(o&&o.length&&(e.node.text&&(e.node.text.x=o[0][0],e.node.text.y=o[0][1]),o.length&&(e.node.coordinates2d=o),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],o=e.node.coordinates2d[2],n=s[0]-t[0],r=o[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=n,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>d.addChild(t))),d}}},81560:(t,e,s)=>{const o=s(10398);t.exports={getAppDataPath:()=>{if(!process)return"";switch(process.platform){case"darwin":return o.join(process.env.HOME,"Library","Application Support","homegames");case"win32":return o.join(process.env.APPDATA,"homegames");case"linux":return o.join(process.env.HOME,".homegames");default:console.log("Unsupported platform!"),process.exit(1)}}}},11669:(t,e,s)=>{const{squish:o,unsquish:n}=s(16351),{gameNode:r,GameNode:i}=s(8704),h=(s(90341),s(48774)),a=s(62816),l=s(65265),c=s(96872),d=s(82167),u=s(76323),{terrainGenerator:f}=s(50750),y=s(74697),p=s(95900),g=s(61004),x=s(68397),E=s(70273);t.exports={squish:o,unsquish:n,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:c,Squisher:p,ShapeUtils:d,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},61004:(t,e,s)=>{const o=s(10175),{getAppDataPath:n}=s(94261);let r="https://assets.homegames.io";try{r=process?.env?.API_URL?`${process.env.API_URL}/assets`:"https://assets.homegames.io"}catch(t){console.log("probably running in a browser"),console.error(t)}const i=r;t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(14045),this.http=s(35346),this.fs=s(49891),this.crypto=s(30849),this.path=s(10175),this.process=s(34425)}getConfigValue(t,e=void 0){const s=this.getConfig();let o=process.env[t]&&`${process.env[t]}`;if(void 0!==o)return"true"===o?o=!0:"false"===o&&(o=!1),console.log(`Using environment value: ${o} for key: ${t}`),o;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){const t=this.getHash(this.info.id);return`${o.join(n(),"asset-cache")}/${t}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=o.join(n(),"asset-cache");fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),r=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,r):(await downloadFileSync(this.info.id,e),this.initialized=!0,r)}download(t){const e=o.join(n(),"asset-cache");return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,o)=>{this.existsLocally().then((n=>{n&&!t?(this.initialized=!0,s(n)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{o(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,o)=>{s?e(s):t(o)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,o)=>{const n=this.getHash(t),r=`${e}/${n}`,h=this.fs.createWriteStream(r),a=this.https;h.on("close",(()=>{s(r)})),a.get(`${i}/${t}`,(t=>{200!==t.statusCode?o("Bad response when downloading asset"):(h.on("finish",(()=>{h.close()})),t.pipe(h))})).on("error",(t=>{console.error("Failed to download asset"),console.error(t),o(t)}))}))}}},61415:(t,e,s)=>{const o=s(90341),n=(t,e,s,n,r,i,h,a,l,c,d,u,f,y)=>new o(t,e,s,n,r,i,h,a,l,c,d,u,f,y);t.exports={gameNode:n,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:o,fill:r,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:c,subtype:d,node:u,id:f,onHover:y,offHover:p}){this.node=u||n(t,e,s,o,r,i,h,a,l,c,d,f,y,p),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t,e=!0){this.node.addChild(t),e&&this.node.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e],!1);this.node.onStateChange()}getChildren(){return this.node.children}removeChild(t,e=!0){this.node.removeChild(t),e&&this.node.onStateChange()}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const o in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[o],s)}return s}clearChildren(t){this.node.clearChildren(t),this.node.onStateChange()}update(t={}){t&&(t.fill&&(this.node.fill=t.fill),t.coordinates2d&&(this.node.coordinates2d=coordinates2d)),this.node.onStateChange()}clone(){throw new Error("Clone not implemented")}}}},48774:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const o=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,n=Math.floor(Math.random()*o.length);return e[o[n]]}}},62816:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let o in s)if(e=s[o].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},8704:(t,e,s)=>{const o=s(96872),n=s(74697),{gameNode:r,BaseNode:i}=s(61415),h={[o.CIRCLE]:n.SHAPE_2D_CIRCLE,[o.POLYGON]:n.SHAPE_2D_POLYGON,[o.LINE]:n.SHAPE_2D_LINE},a={[n.SHAPE_2D_CIRCLE]:o.CIRCLE,[n.SHAPE_2D_POLYGON]:o.POLYGON,[n.SHAPE_2D_LINE]:o.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,id:d,onHover:u,offHover:f}){if(!(o&&s||c))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,subtype:h[s],id:d,onHover:u,offHover:f})}clone({handleClick:t,input:e,id:s}){const o=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:o})}}class c extends i{constructor({textInfo:t,playerIds:e,input:s,node:o,id:r}){if(!t&&!o)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:o,subtype:n.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new c({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:o})}}class d extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,id:h,onHover:a,offHover:l}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,subtype:n.ASSET,id:h,onHover:a,offHover:l})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new d({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:o})}}const u={Asset:d,Shape:l,Text:c};t.exports={gameNode:r,GameNode:u}},90341:t=>{t.exports=class{constructor(t,e,s,o,n,r,i,h=[],a=null,l=null,c=null,d=null,u,f){this.id=d?Number(d):Math.floor(999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=o,this.fill=n,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=c,this.onHover=u,this.offHover=f}addChild(t){this.children.push(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1))}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},96872:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},95900:(t,e,s)=>{const{squish:o,unsquish:n}=s(16351);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:o,onAssetUpdate:n}){if(this.ids=new Set,this.game=t,this.gameMetadata=t.constructor.metadata&&t.constructor.metadata(),this.assets={},this.playerSettings={},this.customBottomLayer=s,this.customTopLayer=o,this.initialize(),this.onAssetUpdate=n,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return n(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const o={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,o),s.push(t)}for(const n in t){const r=[],i=t[n],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,o),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,o),s.push(t)}return this.playerFrames=o,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},n={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=o(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0){let e=new Set;for(let s of r)if(n[s]||(n[Number(s)]=[]),0===t.node.playerIds.length||t.node.playerIds.findIndex((t=>Number(t)===Number(s)))>=0)if(t.node.asset){const e=this.gameAssets[Object.keys(t.node.asset)[0]]?.info;("audio"!==e.type||this.playerSettings[s]?.SOUND?.ENABLED)&&n[s].push(i)}else n[s].push(i);else e.add(s);for(let t of e)r.delete(t)}else Object.keys(n).forEach((e=>{if(n[e]||(n[Number(e)]=[]),t.node.asset){const s=this.gameAssets[Object.keys(t.node.asset)[0]]?.info;"audio"===s.type&&this.playerSettings[e]?.SOUND&&!this.playerSettings[e].SOUND.enabled||n[e].push(i)}else n[e].push(i)}));for(let o=0;o<t.node.children.length;o++){const i=new Set(r);this.squishHelper(t.node.children[o],e,s,n,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const o=t[s].root;e[s]=o}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),o=this.game.constructor.metadata&&this.game.constructor.metadata(),n=o&&o.assets?o.assets:{};this.gameAssets=n,this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(n,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(n,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(n,this.game.getAssets());const r=Object.assign(s,n);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let o=0;const n=new Array(32);for(;o<32&&o<e.length;)n[o]=e.charCodeAt(o),o++;const l=(s.length+32).toString(36),c={image:1,audio:2,font:3}[r[e].info.type];let d="";for(let t=0;t<10-l.length;t++)d+="0";for(let t=l.length;t<10;t++)d+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,c,...u,...n,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let o=0;o<this.assets[s].length;o++)e[t++]=this.assets[s][o];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}updatePlayerSettings(t,e){const s=Object.assign(this.playerSettings[t]||{},e);this.playerSettings[t]=s}deletePlayerSettings(t){delete this.playerSettings[t]}}},65265:(t,e,s)=>{const{GameNode:o}=s(8704),n=s(96872),r=s(82167),i=s(48774),h=s(62816);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},1014:(t,e,s)=>{const{GameNode:o}=s(8704);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:o.Asset,2:o.Shape,3:o.Text}}},70273:t=>{t.exports={getPath:(t,e,s,o,n=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+o;if(a<0||a>n||l<0||l>r){let t=a,e=l;a<0?t=0:a>n&&(t=n),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},16351:(t,e,s)=>{const o=s(90341),{CONSTRUCTOR_TO_TYPE:n,TYPE_TO_CONSTRUCTOR:r}=s(1014),i=s(96080),{squishId:h}=s(79828),{squishColor:a}=s(43542),{squishPlayerIds:l}=s(55052),{squishPos:c}=s(57895),{squishFill:d}=s(86052),{squishSize:u}=s(63e3),{squishHandleClick:f}=s(69707),{squishBorder:y}=s(25967),{squishSubType:p}=s(46503),{squishInput:g}=s(90529),{squishCoordinates2d:x}=s(80792),{squishEffect:E}=s(43780),{squishText:A}=s(8282),{squishAsset:S}=s(82393),m={id:h,color:a,playerIds:l,pos:c,coordinates2d:x,fill:d,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in m)L[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const o=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const n=r[t];if(n in o){const t=o[n];if(null!=t){const r=m[n].squish(t,e,o),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[n].type,a,h,...r])}}}let h=n[t.constructor.name];h||(h=n[i[o.subType]]);const a=s.flat(),l=a.length+5,c=Math.min(255,l),d=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),d,c,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new o;for(;e<t.length;){const o=t[e],n=t[e+1]+t[e+2],r=t.slice(e+3,e+n);if(!L[o]){console.warn("Unknown sub frame type "+o);break}{const t=L[o],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=n}const n=r[t[4]];return n?new n({node:s}):{node:s}}}},82393:(t,e,s)=>{const{getFractional:o}=s(33645),n={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],n=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,c=r.startTime||0;n[0]=Math.floor(i),n[1]=o(i),n[2]=Math.floor(h),n[3]=o(h),n[4]=Math.floor(a),n[5]=o(a),n[6]=Math.floor(l),n[7]=o(l),n[8]=Math.floor(c),n[9]=o(c);for(let t=0;t<s.length;t++)n[10+t]=s.codePointAt(t);return n},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t[6]+t[7]/100,r=t[8]+t[9]/100,i=String.fromCodePoint.apply(null,t.slice(10));return{[i]:{pos:{x:e,y:s},size:{x:o,y:n},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:n}},25967:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},43542:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},80792:(t,e,s)=>{const{getFractional:o}=s(33645),n=s(74697),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==n.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=o(t);const s=r(e.y,i[1]);let n;h[2]=s,h[3]=o(s),n=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(n),h[5]=o(n)}else{const t=i[0];h[0]=Math.floor(t),h[1]=o(t);const e=i[1];h[2]=Math.floor(e),h[3]=o(e);const s=i[2];h[4]=Math.round(s),h[5]=o(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,n=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=n,h[2*t+1]=o(n)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const o=t[e]+t[e+1]/100;s[e/2]=o}if(e===n.SHAPE_2D_POLYGON||e===n.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},43780:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const o=new Array(s);for(let t=0;t<e.length;t++)o[t]=e.codePointAt(t);return o[e.length]=t.shadow.color[0],o[e.length+1]=t.shadow.color[1],o[e.length+2]=t.shadow.color[2],o[e.length+3]=t.shadow.color[3],t.shadow.blur&&(o[e.length+4]=Math.floor(t.shadow.blur/10),o[e.length+5]=t.shadow.blur%10),o}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let o;t.length>10&&(o=10*t[10]+t[11]);const n={[e]:{color:s}};return o&&(n[e].blur=o),n}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},86052:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},69707:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},79828:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=new Array(12),o=0;for(;o<=12-e.length;o++)s[o]=0;for(let t=0;t<e.length;t++)s[t+o]=Number(e.charAt(t));return s},unsquish:t=>{let e=0;for(let s=0;s<t.length;s++)e+=t[s]*Math.pow(10,t.length-s-1);return Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},90529:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},55052:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},57895:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},63e3:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},46503:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},8282:(t,e,s)=>{const{hypLength:o}=s(33645),n=s(48774),{squishColor:r}=s(43542),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const c=t.size||1,d=e?c*o(e.x,e.y):c;l[4]=Math.floor(d),l[5]=Math.round(100*(d-Math.floor(d)));const u=t.color||n.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let o=6+f.length+2+3*[...h].length;l[o+p]=Number(s[0]),l[o+p+1]=Number(s[1]),l[o+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let o;o=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let n=6+f.length+2+3*[...h].length+3*[...a].length;l[n+g]=Number(o[0]),l[n+g+1]=Number(o[1]),l[n+g+2]=Number(o[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let c=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let o=h[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;c.push(n)}const d=String.fromCodePoint.apply(null,c);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let o=a[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;u.push(n)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let o=l[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;y.push(n)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:o,color:n,align:d,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},96080:(t,e,s)=>{const{GameNode:o}=s(8704),n=s(74697);t.exports={[[n.ASSET]]:o.Asset,[[n.TEXT]]:o.Text,[[n.SHAPE_2D_POLYGON]]:o.Shape,[[n.SHAPE_2D_CIRCLE]]:o.Shape,[[n.SHAPE_2D_LINE]]:o.Shape}},74697:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},50750:(t,e,s)=>{const{getRandomTerrain:o,getRandomStartPoint:n}=s(36562),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const c=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);o()(c,n(h,a,e),h,a,e);const d=((t,e,s,o)=>{const n=[];for(let i=0;i<s;i++)for(let s=0;s<o;s++){const o=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(n.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){n.push(...o);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(o.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(c,e,h,a);return d?i(c,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:o,height:n}=((t,e)=>{const s=t.x,o=t.y,n=e.x,r=e.y;return{width:Math.floor(s/n),height:Math.floor(o/r)}})(t,e);let r=((t,e)=>{const s=[],o={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let n=0;n<t;n++){s[n]=[];for(let r=0;r<e;r++){const i={...o};0===n?i.west=!1:n===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[n].push(i)}}return s})(o,n);const h={x:Math.floor(Math.random()*o),y:Math.floor(Math.random()*n)};return r=i(r,h,s,o,n),r}}},36562:t=>{const e=(t,{x:e,y:s},o,n,r)=>{e<0||e>=o||s<0||s>=n||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s+1,y:o+1},n,r,i)):1===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i)):2===h?(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o-1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o-1},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s,y:o+3},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+3,y:o},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-3,y:o},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s,y:o-3},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s+1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+2,y:o-1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o+1},n,r,i),e(t,{x:s+2,y:o+1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o-1},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const o={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;o.x===s.x&&o.y===s.y;)o.x=Math.floor(Math.random()*t),o.y=Math.floor(Math.random()*e);return o}}},68397:t=>{const e=(t,s,o,n=[])=>{if(!o||o(t)&&t.node.id!==s.node.id){const e=t.node.text,o=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=o[0][0],h=o[1][0],a=r[0][0],l=r[1][0],c=o[0][1],d=o[2][1],u=r[0][1],f=r[2][1];l<i||h<a||c>f||u>d||n.push(t)}for(const r in t.node.children)e(t.node.children[r],s,o,n);return n};t.exports={checkCollisions:(t,s,o=null)=>e(t,s,o)}},33645:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},82167:t=>{t.exports={triangle:(t,e,s,o,n,r)=>[[t,e],[s,o],[n,r],[t,e]],rectangle:(t,e,s,o)=>[[t,e],[t+s,e],[t+s,e+o],[t,e+o],[t,e]]}},76323:(t,e,s)=>{const{GameNode:o}=s(8704),n=s(96872),r=s(82167),i=s(68397),h=s(48774);t.exports={getView:(t,e,s,a={},l={})=>{const c=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),d=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return c.length>0&&c.forEach((t=>{const o=[],n=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in n){const r=n[s],i=r[0],h=r[1];let c=Math.max(Math.min(i-e.x,100),0),d=Math.max(Math.min(h-e.y,100),0);c=(l.x||1)*c,d=(l.y||1)*d,(!a.filter||a.filter(t))&&(a.x&&(c+=a.x),a.y&&(d+=a.y)),c<0?c=0:c>100&&(c=100),d<0?d=0:d>100&&(d=100),o.push([c,d])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(o&&o.length&&(e.node.text&&(e.node.text.x=o[0][0],e.node.text.y=o[0][1]),o.length&&(e.node.coordinates2d=o),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],o=e.node.coordinates2d[2],n=s[0]-t[0],r=o[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=n,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>d.addChild(t))),d}}},94261:(t,e,s)=>{const o=s(10175);t.exports={getAppDataPath:()=>{if(!process)return"";switch(process.platform){case"darwin":return o.join(process.env.HOME,"Library","Application Support","homegames");case"win32":return o.join(process.env.APPDATA,"homegames");case"linux":return o.join(process.env.HOME,".homegames");default:console.log("Unsupported platform!"),process.exit(1)}}}},26478:(t,e,s)=>{const{squish:o,unsquish:n}=s(26670),{gameNode:r,GameNode:i}=s(32245),h=(s(80700),s(11423)),a=s(50513),l=s(24732),c=s(60897),d=s(47564),u=s(34610),{terrainGenerator:f}=s(78533),y=s(82900),p=s(91601),g=s(24843),x=s(11074),E=s(47238);t.exports={squish:o,unsquish:n,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:c,Squisher:p,ShapeUtils:d,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},24843:(t,e,s)=>{const o=s(24212),{getAppDataPath:n}=s(73258);t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(65528),this.http=s(68337),this.fs=s(78596),this.crypto=s(21182),this.path=s(24212),this.process=s(98880)}getConfigValue(t,e=void 0){const s=this.getConfig();let o=process.env[t]&&`${process.env[t]}`;if(void 0!==o)return"true"===o?o=!0:"false"===o&&(o=!1),console.log(`Using environment value: ${o} for key: ${t}`),o;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){const t=this.getHash(this.info.id);return`${o.join(n(),"asset-cache")}/${t}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=o.join(n(),"asset-cache");fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),r=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,r):(await downloadFileSync(this.info.id,e),this.initialized=!0,r)}download(t){const e=o.join(n(),"asset-cache");return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,o)=>{this.existsLocally().then((n=>{n&&!t?(this.initialized=!0,s(n)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{o(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,o)=>{s?e(s):t(o)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,o)=>{const n=this.getHash(t),r=`${e}/${n}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)})),this.getConfigValue("API_URL",null),h.get(`${ASSET_URL}/${t}`,(t=>{200!==t.statusCode?o("Bad response when downloading asset"):(i.on("finish",(()=>{i.close()})),t.pipe(i))})).on("error",(t=>{console.error("Failed to download asset"),console.error(t),o(t)}))}))}}},22714:(t,e,s)=>{const o=s(80700),n=(t,e,s,n,r,i,h,a,l,c,d,u,f,y)=>new o(t,e,s,n,r,i,h,a,l,c,d,u,f,y);t.exports={gameNode:n,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:o,fill:r,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:c,subtype:d,node:u,id:f,onHover:y,offHover:p}){this.node=u||n(t,e,s,o,r,i,h,a,l,c,d,f,y,p),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t,e=!0){this.node.addChild(t),e&&this.node.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e],!1);this.node.onStateChange()}getChildren(){return this.node.children}removeChild(t,e=!0){this.node.removeChild(t),e&&this.node.onStateChange()}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const o in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[o],s)}return s}clearChildren(t){this.node.clearChildren(t),this.node.onStateChange()}update(t={}){t&&(t.fill&&(this.node.fill=t.fill),t.coordinates2d&&(this.node.coordinates2d=coordinates2d)),this.node.onStateChange()}clone(){throw new Error("Clone not implemented")}}}},11423:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const o=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,n=Math.floor(Math.random()*o.length);return e[o[n]]}}},50513:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let o in s)if(e=s[o].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},32245:(t,e,s)=>{const o=s(60897),n=s(82900),{gameNode:r,BaseNode:i}=s(22714),h={[o.CIRCLE]:n.SHAPE_2D_CIRCLE,[o.POLYGON]:n.SHAPE_2D_POLYGON,[o.LINE]:n.SHAPE_2D_LINE},a={[n.SHAPE_2D_CIRCLE]:o.CIRCLE,[n.SHAPE_2D_POLYGON]:o.POLYGON,[n.SHAPE_2D_LINE]:o.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,id:d,onHover:u,offHover:f}){if(!(o&&s||c))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:o,border:n,fill:r,playerIds:i,effects:a,input:l,node:c,subtype:h[s],id:d,onHover:u,offHover:f})}clone({handleClick:t,input:e,id:s}){const o=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:o})}}class c extends i{constructor({textInfo:t,playerIds:e,input:s,node:o,id:r}){if(!t&&!o)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:o,subtype:n.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new c({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:o})}}class d extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,id:h,onHover:a,offHover:l}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:o,effects:r,node:i,subtype:n.ASSET,id:h,onHover:a,offHover:l})}clone({handleClick:t,input:e,id:s}){const o=s||null;return new d({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:o})}}const u={Asset:d,Shape:l,Text:c};t.exports={gameNode:r,GameNode:u}},80700:t=>{t.exports=class{constructor(t,e,s,o,n,r,i,h=[],a=null,l=null,c=null,d=null,u,f){this.id=d?Number(d):Math.floor(999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=o,this.fill=n,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=c,this.onHover=u,this.offHover=f}addChild(t){this.children.push(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1))}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},60897:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},91601:(t,e,s)=>{const{squish:o,unsquish:n}=s(26670);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:o,onAssetUpdate:n}){if(this.ids=new Set,this.game=t,this.gameMetadata=t.constructor.metadata&&t.constructor.metadata(),this.assets={},this.playerSettings={},this.customBottomLayer=s,this.customTopLayer=o,this.initialize(),this.onAssetUpdate=n,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return n(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const o={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,o),s.push(t)}for(const n in t){const r=[],i=t[n],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,o),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,o),s.push(t)}return this.playerFrames=o,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},n={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=o(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0){let e=new Set;for(let s of r)if(n[s]||(n[Number(s)]=[]),0===t.node.playerIds.length||t.node.playerIds.findIndex((t=>Number(t)===Number(s)))>=0)if(t.node.asset){const e=this.gameAssets[Object.keys(t.node.asset)[0]]?.info;("audio"!==e.type||this.playerSettings[s]?.SOUND?.ENABLED)&&n[s].push(i)}else n[s].push(i);else e.add(s);for(let t of e)r.delete(t)}else Object.keys(n).forEach((e=>{if(n[e]||(n[Number(e)]=[]),t.node.asset){const s=this.gameAssets[Object.keys(t.node.asset)[0]]?.info;"audio"===s.type&&this.playerSettings[e]?.SOUND&&!this.playerSettings[e].SOUND.enabled||n[e].push(i)}else n[e].push(i)}));for(let o=0;o<t.node.children.length;o++){const i=new Set(r);this.squishHelper(t.node.children[o],e,s,n,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const o=t[s].root;e[s]=o}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),o=this.game.constructor.metadata&&this.game.constructor.metadata(),n=o&&o.assets?o.assets:{};this.gameAssets=n,this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(n,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(n,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(n,this.game.getAssets());const r=Object.assign(s,n);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let o=0;const n=new Array(32);for(;o<32&&o<e.length;)n[o]=e.charCodeAt(o),o++;const l=(s.length+32).toString(36),c={image:1,audio:2,font:3}[r[e].info.type];let d="";for(let t=0;t<10-l.length;t++)d+="0";for(let t=l.length;t<10;t++)d+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,c,...u,...n,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let o=0;o<this.assets[s].length;o++)e[t++]=this.assets[s][o];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}updatePlayerSettings(t,e){const s=Object.assign(this.playerSettings[t]||{},e);this.playerSettings[t]=s}deletePlayerSettings(t){delete this.playerSettings[t]}}},24732:(t,e,s)=>{const{GameNode:o}=s(32245),n=s(60897),r=s(47564),i=s(11423),h=s(50513);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},59619:(t,e,s)=>{const{GameNode:o}=s(32245);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:o.Asset,2:o.Shape,3:o.Text}}},47238:t=>{t.exports={getPath:(t,e,s,o,n=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+o;if(a<0||a>n||l<0||l>r){let t=a,e=l;a<0?t=0:a>n&&(t=n),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},26670:(t,e,s)=>{const o=s(80700),{CONSTRUCTOR_TO_TYPE:n,TYPE_TO_CONSTRUCTOR:r}=s(59619),i=s(50377),{squishId:h}=s(22341),{squishColor:a}=s(91921),{squishPlayerIds:l}=s(10935),{squishPos:c}=s(89108),{squishFill:d}=s(72385),{squishSize:u}=s(20529),{squishHandleClick:f}=s(73816),{squishBorder:y}=s(34818),{squishSubType:p}=s(93224),{squishInput:g}=s(47878),{squishCoordinates2d:x}=s(74543),{squishEffect:E}=s(68253),{squishText:A}=s(62327),{squishAsset:S}=s(15298),m={id:h,color:a,playerIds:l,pos:c,coordinates2d:x,fill:d,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},L={};for(const t in m)L[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const o=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const n=r[t];if(n in o){const t=o[n];if(null!=t){const r=m[n].squish(t,e,o),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[n].type,a,h,...r])}}}let h=n[t.constructor.name];h||(h=n[i[o.subType]]);const a=s.flat(),l=a.length+5,c=Math.min(255,l),d=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),d,c,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new o;for(;e<t.length;){const o=t[e],n=t[e+1]+t[e+2],r=t.slice(e+3,e+n);if(!L[o]){console.warn("Unknown sub frame type "+o);break}{const t=L[o],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=n}const n=r[t[4]];return n?new n({node:s}):{node:s}}}},15298:(t,e,s)=>{const{getFractional:o}=s(232),n={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],n=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,c=r.startTime||0;n[0]=Math.floor(i),n[1]=o(i),n[2]=Math.floor(h),n[3]=o(h),n[4]=Math.floor(a),n[5]=o(a),n[6]=Math.floor(l),n[7]=o(l),n[8]=Math.floor(c),n[9]=o(c);for(let t=0;t<s.length;t++)n[10+t]=s.codePointAt(t);return n},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t[6]+t[7]/100,r=t[8]+t[9]/100,i=String.fromCodePoint.apply(null,t.slice(10));return{[i]:{pos:{x:e,y:s},size:{x:o,y:n},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:n}},34818:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},91921:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},74543:(t,e,s)=>{const{getFractional:o}=s(232),n=s(82900),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==n.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=o(t);const s=r(e.y,i[1]);let n;h[2]=s,h[3]=o(s),n=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(n),h[5]=o(n)}else{const t=i[0];h[0]=Math.floor(t),h[1]=o(t);const e=i[1];h[2]=Math.floor(e),h[3]=o(e);const s=i[2];h[4]=Math.round(s),h[5]=o(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,n=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=n,h[2*t+1]=o(n)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const o=t[e]+t[e+1]/100;s[e/2]=o}if(e===n.SHAPE_2D_POLYGON||e===n.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},68253:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const o=new Array(s);for(let t=0;t<e.length;t++)o[t]=e.codePointAt(t);return o[e.length]=t.shadow.color[0],o[e.length+1]=t.shadow.color[1],o[e.length+2]=t.shadow.color[2],o[e.length+3]=t.shadow.color[3],t.shadow.blur&&(o[e.length+4]=Math.floor(t.shadow.blur/10),o[e.length+5]=t.shadow.blur%10),o}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let o;t.length>10&&(o=10*t[10]+t[11]);const n={[e]:{color:s}};return o&&(n[e].blur=o),n}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},72385:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},73816:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},22341:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=new Array(12),o=0;for(;o<=12-e.length;o++)s[o]=0;for(let t=0;t<e.length;t++)s[t+o]=Number(e.charAt(t));return s},unsquish:t=>{let e=0;for(let s=0;s<t.length;s++)e+=t[s]*Math.pow(10,t.length-s-1);return Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},47878:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},10935:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},89108:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},20529:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},93224:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},62327:(t,e,s)=>{const{hypLength:o}=s(232),n=s(11423),{squishColor:r}=s(91921),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const c=t.size||1,d=e?c*o(e.x,e.y):c;l[4]=Math.floor(d),l[5]=Math.round(100*(d-Math.floor(d)));const u=t.color||n.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let o=6+f.length+2+3*[...h].length;l[o+p]=Number(s[0]),l[o+p+1]=Number(s[1]),l[o+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let o;o=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let n=6+f.length+2+3*[...h].length+3*[...a].length;l[n+g]=Number(o[0]),l[n+g+1]=Number(o[1]),l[n+g+2]=Number(o[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,o=t[4]+t[5]/100,n=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let c=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let o=h[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;c.push(n)}const d=String.fromCodePoint.apply(null,c);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let o=a[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;u.push(n)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let o=l[t+2].toString();1==o.length&&(o=`0${o}`);const n=e+s+o;y.push(n)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:o,color:n,align:d,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},50377:(t,e,s)=>{const{GameNode:o}=s(32245),n=s(82900);t.exports={[[n.ASSET]]:o.Asset,[[n.TEXT]]:o.Text,[[n.SHAPE_2D_POLYGON]]:o.Shape,[[n.SHAPE_2D_CIRCLE]]:o.Shape,[[n.SHAPE_2D_LINE]]:o.Shape}},82900:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},78533:(t,e,s)=>{const{getRandomTerrain:o,getRandomStartPoint:n}=s(32963),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const c=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);o()(c,n(h,a,e),h,a,e);const d=((t,e,s,o)=>{const n=[];for(let i=0;i<s;i++)for(let s=0;s<o;s++){const o=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(n.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){n.push(...o);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(o.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(c,e,h,a);return d?i(c,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:o,height:n}=((t,e)=>{const s=t.x,o=t.y,n=e.x,r=e.y;return{width:Math.floor(s/n),height:Math.floor(o/r)}})(t,e);let r=((t,e)=>{const s=[],o={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let n=0;n<t;n++){s[n]=[];for(let r=0;r<e;r++){const i={...o};0===n?i.west=!1:n===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[n].push(i)}}return s})(o,n);const h={x:Math.floor(Math.random()*o),y:Math.floor(Math.random()*n)};return r=i(r,h,s,o,n),r}}},32963:t=>{const e=(t,{x:e,y:s},o,n,r)=>{e<0||e>=o||s<0||s>=n||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s+1,y:o+1},n,r,i)):1===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i)):2===h?(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o-1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o-1},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s,y:o+3},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+3,y:o},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-3,y:o},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s,y:o-3},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s,y:o+2},n,r,i),e(t,{x:s+1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+2,y:o},n,r,i),e(t,{x:s+2,y:o-1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-2,y:o},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s,y:o-2},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))},(t,{x:s,y:o},n,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:o},n,r,i),0===h?(e(t,{x:s,y:o+1},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-1,y:o+2},n,r,i)):1===h?(e(t,{x:s+1,y:o},n,r,i),e(t,{x:s+1,y:o+1},n,r,i),e(t,{x:s+2,y:o+1},n,r,i)):2===h?(e(t,{x:s-1,y:o},n,r,i),e(t,{x:s-1,y:o+1},n,r,i),e(t,{x:s-2,y:o+1},n,r,i)):(e(t,{x:s,y:o-1},n,r,i),e(t,{x:s-1,y:o-1},n,r,i),e(t,{x:s-1,y:o-2},n,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const o={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;o.x===s.x&&o.y===s.y;)o.x=Math.floor(Math.random()*t),o.y=Math.floor(Math.random()*e);return o}}},11074:t=>{const e=(t,s,o,n=[])=>{if(!o||o(t)&&t.node.id!==s.node.id){const e=t.node.text,o=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=o[0][0],h=o[1][0],a=r[0][0],l=r[1][0],c=o[0][1],d=o[2][1],u=r[0][1],f=r[2][1];l<i||h<a||c>f||u>d||n.push(t)}for(const r in t.node.children)e(t.node.children[r],s,o,n);return n};t.exports={checkCollisions:(t,s,o=null)=>e(t,s,o)}},232:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},47564:t=>{t.exports={triangle:(t,e,s,o,n,r)=>[[t,e],[s,o],[n,r],[t,e]],rectangle:(t,e,s,o)=>[[t,e],[t+s,e],[t+s,e+o],[t,e+o],[t,e]]}},34610:(t,e,s)=>{const{GameNode:o}=s(32245),n=s(60897),r=s(47564),i=s(11074),h=s(11423);t.exports={getView:(t,e,s,a={},l={})=>{const c=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),d=new o.Shape({shapeType:n.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return c.length>0&&c.forEach((t=>{const o=[],n=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in n){const r=n[s],i=r[0],h=r[1];let c=Math.max(Math.min(i-e.x,100),0),d=Math.max(Math.min(h-e.y,100),0);c=(l.x||1)*c,d=(l.y||1)*d,(!a.filter||a.filter(t))&&(a.x&&(c+=a.x),a.y&&(d+=a.y)),c<0?c=0:c>100&&(c=100),d<0?d=0:d>100&&(d=100),o.push([c,d])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(o&&o.length&&(e.node.text&&(e.node.text.x=o[0][0],e.node.text.y=o[0][1]),o.length&&(e.node.coordinates2d=o),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],o=e.node.coordinates2d[2],n=s[0]-t[0],r=o[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=n,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>d.addChild(t))),d}}},73258:(t,e,s)=>{const o=s(24212);t.exports={getAppDataPath:()=>{if(!process)return"";switch(process.platform){case"darwin":return o.join(process.env.HOME,"Library","Application Support","homegames");case"win32":return o.join(process.env.APPDATA,"homegames");case"linux":return o.join(process.env.HOME,".homegames");default:console.log("Unsupported platform!"),process.exit(1)}}}},92127:(t,e,s)=>{const{Homepad:o}=s(11011),n=new o,r={"0756":s(94497),"0762":s(84718),"0765":s(65863),"0766":s(9570),"0767":s(51001),1e3:s(39086),1004:s(482),1005:s(32953),1006:s(78784),1007:s(28423),1009:s(31805),1010:s(94007),120:s(51996),130:s(11669),131:s(26478)};let i,{squish:h,unsquish:a,Colors:l}=r["0766"];l=l.COLORS;const c=new Worker("socket.js"),d=document.getElementById("game"),u={};let f,y,p,g,x,E,A,S=!1,m=[];new Promise(((t,e)=>{fetch("/config.json").then((e=>{e.json().then((e=>{t(e)}))}))})).then((t=>{const e=t.HOME_PORT||7001;if(t.PUBLIC_CLIENT){const t=new URLSearchParams(window.location.search).get("code");if(t){const t=`${window.location.protocol}//${window.location.host}${window.location.pathname}`;window.history.pushState({path:t},"",t)}window.serverCode=t?t.toUpperCase():window.prompt("Enter server code").toUpperCase()}const s=document.getElementById("performance-data");c.onmessage=t=>{if(t.data.constructor===Object){if("SOCKET_CLOSE"===t.data.type&&(S=!1),"ERROR"===t.data.type){S=!1;const e=document.createElement("div"),s=document.createElement("div");s.innerHTML="Error: "+t.data.message;const o=document.createElement("a");o.href="https://public.homegames.link/code",o.innerHTML="Try again",e.appendChild(s),e.appendChild(o),(t=>{const e=document.createElement("div");e.style.position="absolute",e.style.width="100vw;",e.style.top="0",e.style["text-align"]="center",e.style["font-size"]="10vw",e.appendChild(t),document.body.appendChild(e)})(e)}}else if(f=new Uint8ClampedArray(t.data),2==f[0]){if(window.playerId=f[1],2==f.length&&c.postMessage({type:"finishReady",playerId:window.playerId}),f.length>2){const t=f[2],e=f[3];y={x:t,y:e},i={x:f[4],y:f[5]},f[6];const s=String.fromCharCode.apply(null,f.slice(7,7+f[6]));window.squishVersion=s;const o=r[s];o&&(h=o.squish,a=o.unsquish,l=o.Colors),P()}}else if(1==f[0])R(f);else if(9==f[0])y={x:f[1],y:f[2]},P();else if(5===f[0]){x=!1;let t=String(f[1])+(String(f[2]).length>1?f[2]:"0"+f[2]);const e=window.serverCode?"public.homegames.link":window.location.hostname,s=window.serverCode?82:t;c.postMessage({socketInfo:{hostname:e,playerId:window.playerId||null,port:Number(s),secure:"localhost"!==window.location.host&&window.isSecureContext,serverCode:window.serverCode,spectating:x}})}else if(6===f[0]){x=!0;let t=String(f[1])+(String(f[2]).length>1?f[2]:"0"+f[2]);const e=window.serverCode?"public.homegames.link":window.location.hostname,s=window.serverCode?82:t;c.postMessage({socketInfo:{hostname:e,playerId:window.playerId||null,port:Number(s),secure:"localhost"!==window.location.host&&window.isSecureContext,serverCode:window.serverCode,spectating:x}})}else if(7===f[0])p();else if(8===f[0]){let t=String(f[1])+(String(f[2]).length>1?f[2]:"0"+f[2]);if(!E){const e=window.location.hostname;E=new WebSocket(`wss://${e}:${t}`),E.onopen=()=>{console.log("hot client opened")},E.onerror=t=>{console.log("hot client err"),console.log(t)},E.onmessage=t=>{"reload"===t.data&&location.reload()}}}else 3!=f[0]||S||(S=!0,H())};const o=document.createElement("canvas"),n=document.createElement("canvas"),d=document.createElement("h3"),u=document.createElement("h3"),p=()=>{if(!A){A=!0;const t=document.createElement("div"),e=document.createElement("div");t.style="float: left; margin-right: 50px",e.style="float: left",t.appendChild(o),e.appendChild(n),s.appendChild(t),t.appendChild(d),s.appendChild(e),e.appendChild(u)}},g=window.serverCode?"public.homegames.link":window.location.hostname,m=window.serverCode?82:e;c.postMessage({socketInfo:{hostname:g,playerId:window.playerId||null,port:m,secure:"localhost"!==window.location.host&&window.isSecureContext,serverCode:window.serverCode}}),(()=>{const t=(()=>{const t=navigator.userAgent,e={};/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(t)?e.deviceType="tablet":/Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(t)?e.deviceType="mobile":navigator.maxTouchPoints&&navigator.maxTouchPoints>2?e.deviceType="tablet":e.deviceType="desktop";const s=window.innerWidth,o=window.innerHeight;let n=null;return s&&o&&(n=s/o),e.aspectRatio=n,e})(),e={clientInfo:t},s=new URLSearchParams(window.location.search);if(s.get("gameId")){const t=s.get("gameId"),o=s.get("versionId"),n=`${window.location.protocol}//${window.location.host}${window.location.pathname}`;window.history.pushState({path:n},"",n),e.requestedGame={gameId:t,versionId:o}}c.postMessage(e)})()})),window.playerId=null;let L=!1;const C={};let T,O;const _={},w={},I=document.getElementById("homegames-main"),N=l.BLACK;I.style.background=`rgba(${N[0]}, ${N[1]}, ${N[2]}, ${N[3]})`;const M=d.getContext("2d",{alpha:!1}),P=()=>{const t=window.innerWidth,e=window.innerHeight;let s,o;if(t*y.y/y.x<=e){const t=window.innerWidth;o=t,s=Math.floor(t*(y.y/y.x))}else{const t=window.innerHeight;o=Math.floor(t*(y.x/y.y)),s=t}d.height=2*s,d.width=2*o,g=.5*d.width,clientHeight=.5*d.height,d.style.height=`${clientHeight}px`,d.style.width=`${g}px`},R=t=>{let e=0;for(;t&&e<t.length;)if(1===t[e]){const s=t[e+1];if(1===s){const s=String.fromCharCode.apply(null,t.slice(e+2,e+12)),o=parseInt(s,36),n=t.slice(e+12,e+12+32),r=t.slice(e+12+32,e+12+o),i=String.fromCharCode.apply(null,n.filter((t=>t)));let h="";for(let t=0;t<r.length;t++)h+=String.fromCharCode(r[t]);const a=btoa(h);_[i]={type:"image",data:"data:image/jpeg;base64,"+a},e+=12+o}else if(2===s){const s=String.fromCharCode.apply(null,t.slice(e+2,e+12)),o=parseInt(s,36),n=t.slice(e+12,e+12+32),r=t.slice(e+12+32,e+12+o),i=String.fromCharCode.apply(null,n.filter((t=>t)));T?T.decodeAudioData(r.buffer,(t=>{_[i]={type:"audio",data:t,decoded:!0}}),(t=>{console.log("unable to decode audio data"),console.log(t)})):_[i]={type:"audio",data:r.buffer,decoded:!1},e+=12+o}else if(3===s){const s=String.fromCharCode.apply(null,t.slice(e+2,e+12)),o=parseInt(s,36),n=t.slice(e+12,e+12+32),r=t.slice(e+12+32,e+12+o),i=String.fromCharCode.apply(null,n.filter((t=>t))),h=new FontFace(i,r);h&&h.load().then((t=>{document.fonts.add(t),_[i]={type:"font",data:t,name:i}})),e+=12+o}else console.error("Unknown asset type: "+s)}};let q,$,b=[];function U(t){const e=new Set(Object.keys(u));M.clearRect(0,0,d.width,d.height);let s=0;b=[];const o=new Set;for(;t&&s<t.length;){t[s];const n="0750"===window.squishVersion||"0751"===window.squishVersion?t[s+1]:t[s+1]+t[s+2]+t[s+3];let r=a(t.slice(s,s+n)).node;if(!r.coordinates2d&&r.input&&r.text){const t=Math.floor(d.width),e=r.text.size/100*t;M.font=e+"px sans-serif";const s=M.measureText(r.text.text);let o=r.text.x*d.width/100;r.text.align&&"center"==r.text.align&&(o-=s.width/2),o=o/d.width*100;const n=s.actualBoundingBoxDescent-s.actualBoundingBoxAscent,i=s.width/d.width*100,h=n/d.height*100,a=[!!r.handleClick,r.input&&r.input.type,r.id,[o,r.text.y,o+i,r.text.y,o+i,r.text.y+h,o,r.text.y+h,o,r.text.y]];b.push(a)}else if(null!==r.coordinates2d&&void 0!==r.coordinates2d){const t=[!!r.handleClick,r.input&&r.input.type,r.id,r.coordinates2d];if(b.push(t),r.effects&&r.effects.shadow){const t=r.effects.shadow.color;M.shadowColor="rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")",r.effects.shadow.blur&&(M.shadowBlur=r.effects.shadow.blur)}if(r.color&&(M.globalAlpha=r.color[3]/255),null!==r.fill&&void 0!==r.fill&&(M.fillStyle="rgba("+r.fill[0]+","+r.fill[1]+","+r.fill[2]+","+r.fill[3]+")"),void 0!==r.border&&null!==r.border&&(M.lineWidth=r.border/255*.1*d.width,M.strokeStyle="rgba("+r.color[0]+","+r.color[1]+","+r.color[2]+","+r.color[3]+")"),null!==r.coordinates2d&&void 0!==r.coordinates2d){M.beginPath();const t=r.coordinates2d[0];M.moveTo(t[0]*d.width/100,t[1]*d.height/100);for(let t=1;t<r.coordinates2d.length;t++){const e=r.coordinates2d[t];M.lineTo(d.width/100*e[0],e[1]*d.height/100)}void 0!==r.fill&&null!==r.fill&&M.fill(),void 0!==r.border&&null!==r.border&&M.stroke()}M.shadowColor=null,M.shadowBlur=0,M.lineWidth=0,M.strokeStyle=null}if(r.text){M.globalAlpha=r.text.color[3]/255,M.fillStyle=`rgba(${r.text.color[0]}, ${r.text.color[1]}, ${r.text.color[2]}, ${r.text.color[3]})`;const t=Math.floor(d.width),e=r.text.size/100*t;M.font=e+"px "+(r.text.font&&"default"!==r.text.font?r.text.font:"sans-serif"),r.text.align&&(M.textAlign=r.text.align),M.textBaseline="top",M.fillText(r.text.text,r.text.x*d.width/100,r.text.y*d.height/100)}if(r.asset){const t=Object.keys(r.asset)[0];if(_[t]&&"audio"===_[t].type)o.add(t),!u[t]&&T&&_[t].decoded?(O=T.createBufferSource(),O.connect(T.destination),O.buffer=_[t].data,O.onended=()=>{},O.start(0,r.asset[t].startTime||0),u[t]=O):!u[t]&&T?console.warn("Cant play audio"):u[t]&&e.delete(t);else{const e=r.asset[t];let s;if(w[t]&&"loading"!==w[t]){if(s=w[t],s.width=e.size.x/100*d.width,s.height=e.size.y/100*d.height,r.effects&&r.effects.shadow){const t=r.effects.shadow.color;M.shadowColor="rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")",r.effects.shadow.blur&&(M.shadowBlur=r.effects.shadow.blur)}M.drawImage(s,e.pos.x/100*d.width,e.pos.y/100*d.height,s.width,s.height)}else w[t]||(s=new Image(e.size.x/100*d.width,e.size.y/100*d.height),w[t]="loading",s.onload=()=>{if(w[t]=s,r.effects&&r.effects.shadow){const t=r.effects.shadow.color;M.shadowColor="rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")",r.effects.shadow.blur&&(M.shadowBlur=r.effects.shadow.blur)}M.drawImage(s,e.pos.x/100*d.width,e.pos.y/100*d.height,s.width,s.height)},_[t]&&(s.src=_[t].data))}}s+=n,M.shadowColor=null,M.shadowBlur=0,M.lineWidth=0,M.strokeStyle=null,M.globalAlpha=1}e.forEach((t=>{u[t].stop()}));for(let t in u)o.has(t)||(u[t].stop(),delete u[t])}const G=()=>{q=n.getGamepads()};window.addEventListener("gamepadconnected",G),window.addEventListener("gamepaddisconnected",G);let B=null;function H(){if(S){if(A&&m.push({start:Date.now()}),Object.keys(C).filter((t=>C[t])).forEach((t=>j(t))),q&&q.length&&q.forEach((t=>{z(n.getGamepadState(t.index))})),p){const t=W(p[0],p[1]);L&&!$&&(F(t),$=setTimeout((()=>{$=null}),30)),t.isClickable||t.action?(B&&Number(t.nodeId)===Number(B)||(B&&k(B),B=t.nodeId,v(t.nodeId)),d.style.cursor="pointer"):(B&&(k(B),B=null),d.style.cursor="initial"),p=null}if(f&&f.length>1&&3==f[0]&&U(f),A){const t=m[m.length-1];t.end=Date.now(),t.end,t.start,m.length%60==0&&Y()}window.requestAnimationFrame(H)}}let D=[];const Y=()=>{const t=m.length-60,e=m.length-1;let s=0;for(let o=t;o<=e;o++)s+=m[o].end-m[o].start;const o=s/60,n=m[e].end-m[t].start;D.push({avgRenderTime:o,lastNFrames:n});const r=(t,e,s,o)=>{const n=t.height,r=5+s/100*t.width,i=o/100*n;e.fillRect(r,i,5,5)},i=avgGraph.getContext("2d",{alpha:!1}),h=lastNGraph.getContext("2d",{alpha:!1});i.clearRect(0,0,avgGraph.width,avgGraph.height),h.clearRect(0,0,lastNGraph.width,lastNGraph.height),i.fillStyle="rgba(226, 114, 91, 255)",h.fillStyle="rgba(255, 192, 203, 255)",i.fillRect(0,0,avgGraph.width,avgGraph.height),h.fillRect(0,0,lastNGraph.width,lastNGraph.height),i.fillStyle="rgba(255, 0, 0, 255)",h.fillStyle="rgba(0, 255, 0, 255)",D.length>10&&(D=D.slice(D.length-10,D.length)),avgGraphLabel.innerHTML=o.toFixed(2)+" ms/render",lastNGraphLabel.innerHTML=Math.floor(1e3/(n/60))+" fps";for(let t=0;t<D.length;t++){const e=1e3/(D[t].lastNFrames/60);r(avgGraph,i,10*t,100-10*D[t].avgRenderTime),r(lastNGraph,h,10*t,100-e)}},v=t=>{c.postMessage(JSON.stringify({type:"onhover",nodeId:t}))},k=t=>{c.postMessage(JSON.stringify({type:"offhover",nodeId:t}))},F=function(t={}){if(!p)return;const e=p[0],s=p[1],o=(e-d.offsetLeft)/g*100,n=s/clientHeight*100;if(t.action){if("text"===t.action){L=!1;const e=prompt("Input text");c.postMessage(JSON.stringify({type:"input",input:e,nodeId:t.nodeId}))}else if("file"===t.action){L=!1;const e=document.getElementById("file-input");e.click(),e.onchange=s=>{if(e.files.length>0){const s=new FileReader;s.onload=e=>{c.postMessage(JSON.stringify({type:"input",input:new Uint8Array(s.result),nodeId:t.nodeId}))},s.readAsArrayBuffer(e.files[0])}}}}else if(o<=100&&n<=100){const t={type:"click",data:{x:o,y:n}};c.postMessage(JSON.stringify(t))}},z=t=>{c.postMessage(JSON.stringify({type:"input",gamepad:!0,input:t}))},j=function(t){const e={type:"keydown",key:t};c.postMessage(JSON.stringify(e))},K=()=>{if(!T){T=new(window.AudioContext||window.webkitAudioContext),"suspended"===T.state&&T.resume();for(const t in _)"audio"!==_[t].type||_[t].decoded||T.decodeAudioData(_[t].data,(e=>{_[t].data=e,_[t].decoded=!0}))}};document.addEventListener("touchstart",K,!1);const W=(t,e)=>{let s=!1,o=null,n=null;if(t<d.offsetLeft-window.scrollLeft)return!1;const r=t-d.offsetLeft-window.scrollX,h=e-window.scrollY,a=100*r/g,l=100*h/clientHeight,c=i.y/2,u=100-i.y/2,f=i.x/2,y=100-i.x/2;if(x&&a>f&&a<y&&l>c&&l<u)return!1;for(const r in b){const i=b[r];let h=i[3];if(!h||!h.length)continue;if(!h[0].length){let t=new Array(h.length/2);for(let e=0;e<h.length;e+=2)t[e/2]=[h[e],h[e+1]];h=t}let a=!1,l=V(h[0][0]),c=V(h[0][0]),d=X(h[0][1]),u=X(h[0][1]);for(let t=1;t<h.length;t++){const e=h[t];l=Math.min(V(e[0]),l),c=Math.max(V(e[0]),c),d=Math.min(X(e[1]),d),u=Math.max(X(e[1]),u)}if(!(t<l||t>c||e<d||e>u)){let s=0,o=h.length-1;for(;s<h.length;o=s++)X(h[s][1])>e!=X(h[o][1])>e&&t<(V(h[o][0])-V(h[s][0]))*(e-X(h[s][1]))/(X(h[o][1])-X(h[s][1]))+V(h[s][0])&&(a=!a)}a&&(s=i[0],o=i[1],n=i[2])}return{isClickable:s,action:o,nodeId:n}},V=t=>t*g/100+d.offsetLeft+window.scrollX,X=t=>t*clientHeight/100+d.offsetTop+window.scrollY;function Q(t){return 1==t.key.length&&t.key>=" "&&t.key<="z"||t.keyCode>=36&&t.keyCode<=40||"Meta"===t.key||"Backspace"==t.key}window.addEventListener("mousedown",(function(t){L=!0,p=[t.clientX,t.clientY],K()})),window.addEventListener("mouseup",(function(t){L=!1,p=[t.clientX,t.clientY];const e={type:"mouseup",data:{x:(p[0]-d.offsetLeft)/g*100,y:p[1]/clientHeight*100}};c.postMessage(JSON.stringify(e))})),d.addEventListener("mousemove",(function(t){})),window.addEventListener("touchstart",(function(t){t.preventDefault(),L=!0,p=[t.touches[0].clientX+window.scrollX,t.touches[0].clientY+window.scrollY]})),d.addEventListener("touchmove",(function(t){t.preventDefault(),L=!0,p=[t.touches[0].clientX+window.scrollX,t.touches[0].clientY+window.scrollY]})),window.addEventListener("touchend",(()=>{L=!1})),/Android/i.test(navigator.userAgent)||(document.addEventListener("keydown",(function(t){K(),Q(t)&&!C.Meta&&(t.preventDefault(),j(t.key),C[t.key]=!0)})),document.addEventListener("keyup",(function(t){Q(t)&&(t.preventDefault(),function(t){const e={type:"keyup",key:t};c.postMessage(JSON.stringify(e))}(t.key),C[t.key]=!1)}))),window.addEventListener("mousemove",(t=>{p=[t.clientX+window.scrollX,t.clientY+window.scrollY]})),window.addEventListener("resize",(()=>{P(window.gameWidth,window.gameHeight),f&&f.length>1&&3==f[0]&&U(f),sendClientInfo()}))},52957:()=>{},68503:()=>{},61854:()=>{},99105:()=>{},15091:()=>{},89757:()=>{},32354:()=>{},432:()=>{},80949:()=>{},95236:()=>{},25824:()=>{},76748:()=>{},60267:()=>{},83345:()=>{},47096:()=>{},9523:()=>{},97885:()=>{},83151:()=>{},62337:()=>{},74996:()=>{},82337:()=>{},2728:()=>{},24292:()=>{},25584:()=>{},75409:()=>{},6291:()=>{},67970:()=>{},33997:()=>{},63599:()=>{},20617:()=>{},17358:()=>{},80116:()=>{},56097:()=>{},95464:()=>{},45028:()=>{},90160:()=>{},1506:()=>{},53968:()=>{},80885:()=>{},67012:()=>{},27872:()=>{},59148:()=>{},70341:()=>{},72607:()=>{},10262:()=>{},62121:()=>{},41579:()=>{},52869:()=>{},37204:()=>{},21302:()=>{},77779:()=>{},16898:()=>{},75678:()=>{},95578:()=>{},93919:()=>{},60781:()=>{},51788:()=>{},95055:()=>{},35225:()=>{},68395:()=>{},98953:()=>{},19883:()=>{},20810:()=>{},83077:()=>{},85047:()=>{},32129:()=>{},53499:()=>{},99201:()=>{},91784:()=>{},95939:()=>{},80013:()=>{},51039:()=>{},20020:()=>{},40822:()=>{},96147:()=>{},31714:()=>{},10398:()=>{},15034:()=>{},30849:()=>{},49891:()=>{},35346:()=>{},14045:()=>{},10175:()=>{},34425:()=>{},21182:()=>{},78596:()=>{},68337:()=>{},65528:()=>{},24212:()=>{},98880:()=>{}},e={};function s(o){var n=e[o];if(void 0!==n)return n.exports;var r=e[o]={exports:{}};return t[o](r,r.exports,s),r.exports}s.c=e,s(s.s=92127)})();