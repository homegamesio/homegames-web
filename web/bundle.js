(()=>{var t={4600:t=>{t.exports={name:"DUALSHOCK 4 Wireless Controller",buttons:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SELECT:8,START:9,STICK_CLICK_1:10,STICK_CLICK_2:11,DIRECTION_UP:12,DIRECTION_DOWN:13,DIRECTION_LEFT:14,DIRECTION_RIGHT:15,HOME:16},sticks:{STICK_1_X:0,STICK_1_Y:1,STICK_2_X:2,STICK_2_Y:3},deadzones:{STICK_1_X:.08,STICK_1_Y:.08,STICK_2_X:.08,STICK_2_Y:.08}}},3952:t=>{t.exports={name:"DualSense Wireless Controller Extended Gamepad",buttons:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SELECT:8,START:9,STICK_CLICK_1:10,STICK_CLICK_2:11,DIRECTION_UP:12,DIRECTION_DOWN:13,DIRECTION_LEFT:14,DIRECTION_RIGHT:15,HOME:16},sticks:{STICK_1_X:0,STICK_1_Y:1,STICK_2_X:2,STICK_2_Y:3},deadzones:{STICK_1_X:.08,STICK_1_Y:.08,STICK_2_X:.08,STICK_2_Y:.08}}},3412:t=>{t.exports={name:"Luna Gamepad Extended Gamepad",buttons:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SELECT:8,START:9,STICK_CLICK_1:10,STICK_CLICK_2:11,DIRECTION_UP:12,DIRECTION_DOWN:13,DIRECTION_LEFT:14,DIRECTION_RIGHT:15,HOME:16},sticks:{STICK_1_X:0,STICK_1_Y:1,STICK_2_X:2,STICK_2_Y:3},deadzones:{STICK_1_X:.08,STICK_1_Y:.08,STICK_2_X:.08,STICK_2_Y:.08}}},5232:t=>{t.exports={name:"8Bitdo NES30 Arcade(x) Extended Gamepad",buttons:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SELECT:8,START:9,STICK_CLICK_1:10,STICK_CLICK_2:11,DIRECTION_UP:12,DIRECTION_DOWN:13,DIRECTION_LEFT:14,DIRECTION_RIGHT:15,HOME:16},sticks:{STICK_1_X:0,STICK_1_Y:1,STICK_2_X:2,STICK_2_Y:3},deadzones:{STICK_1_X:.08,STICK_1_Y:.08,STICK_2_X:.08,STICK_2_Y:.08}}},6596:t=>{t.exports={name:"Stadia Controller Extended Gamepad",buttons:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SELECT:8,START:9,STICK_CLICK_1:10,STICK_CLICK_2:11,DIRECTION_UP:12,DIRECTION_DOWN:13,DIRECTION_LEFT:14,DIRECTION_RIGHT:15,HOME:16},sticks:{STICK_1_X:0,STICK_1_Y:1,STICK_2_X:2,STICK_2_Y:3},deadzones:{STICK_1_X:.08,STICK_1_Y:.08,STICK_2_X:.08,STICK_2_Y:.08}}},8608:t=>{t.exports={name:"Pro Controller Extended Gamepad",buttons:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SELECT:8,START:9,STICK_CLICK_1:10,STICK_CLICK_2:11,DIRECTION_UP:12,DIRECTION_DOWN:13,DIRECTION_LEFT:14,DIRECTION_RIGHT:15,HOME:16},sticks:{STICK_1_X:0,STICK_1_Y:1,STICK_2_X:2,STICK_2_Y:3},deadzones:{STICK_1_X:.1,STICK_1_Y:.1,STICK_2_X:.1,STICK_2_Y:.1}}},464:t=>{t.exports={name:"Xbox Wireless Controller Extended Gamepad",buttons:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SELECT:8,START:9,STICK_CLICK_1:10,STICK_CLICK_2:11,DIRECTION_UP:12,DIRECTION_DOWN:13,DIRECTION_LEFT:14,DIRECTION_RIGHT:15,HOME:16},sticks:{STICK_1_X:0,STICK_1_Y:1,STICK_2_X:2,STICK_2_Y:3},deadzones:{STICK_1_X:.08,STICK_1_Y:.08,STICK_2_X:.08,STICK_2_Y:.08}}},4464:(t,e,s)=>{const{Buttons:n,Sticks:o}=s(1776),r=s(9528),i=t=>{for(let e in r){const s=r[e];if(t.indexOf(s.name)>=0)return s}return null},h=(t,e,s)=>({value:t[e.buttons[s]]&&t[e.buttons[s]].value,pressed:!(!t[e.buttons[s]]||!t[e.buttons[s]].pressed)}),a=(t,e,s)=>{const n=t[e.sticks[s]];if(e.deadzones&&e.deadzones[s]){const t=e.deadzones[s];return Math.abs(n)<t?{value:0}:n<0?{value:(n+t)/(1-t)}:{value:(n-t)/(1-t)}}return{value:n}};t.exports={Homepad:class{constructor(){if(!window)throw new Error("No window available");this.indexToMapping={},this.initializeListeners()}initializeListeners(){window.addEventListener("gamepadconnected",(t=>{const e=t.gamepad,s=i(e.id);s&&(this.indexToMapping[e.index]=s)})),window.addEventListener("gamepaddisconnected",(t=>{delete this.indexToMapping[gamepad.index]}))}getGamepadState(t){const e=navigator.getGamepads()[t],s=this.indexToMapping[t],n=((t,e)=>{const s={};for(let n in e.buttons)s[n]=h(t,e,n);return s})(e.buttons,s),o=((t,e)=>{const s={};for(let n in e.sticks)s[n]=a(t,e,n);return s})(e.axes,s);return{buttons:n,sticks:o}}getGamepads(){if(!navigator||!navigator.getGamepads)throw new Error("No gamepad API available");return navigator.getGamepads().filter((t=>t)).map((t=>({index:t.index,mapping:i(t.id)}))).filter((t=>!!t.mapping)).map((t=>({state:this.getGamepadState(t.index),...t})))}},Buttons:n,Sticks:o}},1776:()=>{},9528:(t,e,s)=>{const n=s(4600),o=s(6596),r=s(464),i=s(3412),h=s(3952),a=s(8608),l=s(5232);t.exports={DUALSHOCK_4:n,STADIA:o,XBOX_ONE:r,LUNA:i,DUALSHOCK_5:h,SWITCH_PRO:a,NES_30:l}},1204:(t,e,s)=>{const{squish:n,unsquish:o}=s(7752),{gameNode:r,GameNode:i}=s(5548),h=(s(8488),s(6744)),a=s(5888),l=s(4728),d=s(7456),c=s(1464),u=s(8),{terrainGenerator:f}=s(3508),y=s(2704),p=s(3544),g=s(6291),x=s(2208),E=s(9136);t.exports={squish:n,unsquish:o,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:d,Squisher:p,ShapeUtils:c,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},6291:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(7828),this.http=s(3156),this.fs=s(4744),this.crypto=s(6556),this.path=s(7940),this.process=s(5202)}getConfigValue(t,e=void 0){const s=this.getConfig();let n=process.env[t]&&`${process.env[t]}`;if(void 0!==n)return"true"===n?n=!0:"false"===n&&(n=!1),console.log(`Using environment value: ${n} for key: ${t}`),n;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),n=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,n):(await downloadFileSync(this.info.id,e),this.initialized=!0,n)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,n)=>{this.existsLocally().then((o=>{o&&!t?(this.initialized=!0,s(o)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{n(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,n)=>{s?e(s):t(n)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,n)=>{const o=this.getHash(t),r=`${e}/${o}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{n(t)}))}))}}},4672:(t,e,s)=>{const n=s(8928),o=s(8488),r=(t,e,s,r,i,h,a,l,d,c,u,f)=>{const y=new o(t,e,s,r,i,h,a,l,d,c,u,f);return n(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:n,fill:o,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:d,subtype:c,node:u,id:f}){this.node=u||r(t,e,s,n,o,i,h,a,l,d,c,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const n in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[n],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}}}},6744:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const n=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,o=Math.floor(Math.random()*n.length);return e[n[o]]}}},5888:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let n in s)if(e=s[n].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},5548:(t,e,s)=>{const n=s(7456),o=s(2704),{gameNode:r,BaseNode:i}=s(4672),h={[n.CIRCLE]:o.SHAPE_2D_CIRCLE,[n.POLYGON]:o.SHAPE_2D_POLYGON,[n.LINE]:o.SHAPE_2D_LINE},a={[o.SHAPE_2D_CIRCLE]:n.CIRCLE,[o.SHAPE_2D_POLYGON]:n.POLYGON,[o.SHAPE_2D_LINE]:n.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,id:c}){if(!(n&&s||d))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,subtype:h[s],id:c})}clone({handleClick:t,input:e,id:s}){const n=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:n})}}class d extends i{constructor({textInfo:t,playerIds:e,input:s,node:n,id:r}){if(!t&&!n)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:n,subtype:o.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new d({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:n})}}class c extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,subtype:o.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new c({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:n})}}const u={Asset:c,Shape:l,Text:d};t.exports={gameNode:r,GameNode:u}},8488:t=>{t.exports=class{constructor(t,e,s,n,o,r,i,h=[],a=null,l=null,d=null,c=null){this.id=c?Number(c):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=n,this.fill=o,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=d}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},7456:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},3544:(t,e,s)=>{const{squish:n,unsquish:o}=s(7752);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:n,onAssetUpdate:o}){if(this.ids=new Set,this.game=t,this.assets={},this.customBottomLayer=s,this.customTopLayer=n,this.initialize(),this.onAssetUpdate=o,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return o(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const n={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,n),s.push(t)}for(const o in t){const r=[],i=t[o],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,n),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,n),s.push(t)}return this.playerFrames=n,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},o={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=n(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0)for(let t of r)o[t]||(o[Number(t)]=[]),o[t].push(i);else Object.keys(o).forEach((t=>{o[t]||(o[Number(t)]=[]),o[t].push(i)}));for(let n=0;n<t.node.children.length;n++){const i=new Set(r);this.squishHelper(t.node.children[n],e,s,o,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const n=t[s].root;e[s]=n}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),n=this.game.constructor.metadata&&this.game.constructor.metadata(),o=n&&n.assets?n.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(o,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(o,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(o,this.game.getAssets());const r=Object.assign(s,o);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let n=0;const o=new Array(32);for(;n<32&&n<e.length;)o[n]=e.charCodeAt(n),n++;const l=(s.length+32).toString(36),d={image:1,audio:2,font:3}[r[e].info.type];let c="";for(let t=0;t<10-l.length;t++)c+="0";for(let t=l.length;t<10;t++)c+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,d,...u,...o,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let n=0;n<this.assets[s].length;n++)e[t++]=this.assets[s][n];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.state=this.squish(this.game.getLayers()),this.broadcast()}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},4728:(t,e,s)=>{const{GameNode:n}=s(5548),o=s(7456),r=s(1464),i=s(6744),h=s(5888);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},3144:(t,e,s)=>{const{GameNode:n}=s(5548);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:n.Asset,2:n.Shape,3:n.Text}}},9136:t=>{t.exports={getPath:(t,e,s,n,o=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+n;if(a<0||a>o||l<0||l>r){let t=a,e=l;a<0?t=0:a>o&&(t=o),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},7752:(t,e,s)=>{const n=s(8488),{CONSTRUCTOR_TO_TYPE:o,TYPE_TO_CONSTRUCTOR:r}=s(3144),i=s(4432),{squishId:h}=s(3812),{squishColor:a}=s(6100),{squishPlayerIds:l}=s(5364),{squishPos:d}=s(4541),{squishFill:c}=s(2920),{squishSize:u}=s(1372),{squishHandleClick:f}=s(9412),{squishBorder:y}=s(4440),{squishSubType:p}=s(2580),{squishInput:g}=s(4336),{squishCoordinates2d:x}=s(9832),{squishEffect:E}=s(2296),{squishText:A}=s(8784),{squishAsset:S}=s(2299),m={id:h,color:a,playerIds:l,pos:d,coordinates2d:x,fill:c,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},C={};for(const t in m)C[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const n=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const o=r[t];if(o in n){const t=n[o];if(null!=t){const r=m[o].squish(t,e,n),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[o].type,a,h,...r])}}}let h=o[t.constructor.name];h||(h=o[i[n.subType]]);const a=s.flat(),l=a.length+5,d=Math.min(255,l),c=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),c,d,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new n;for(;e<t.length;){const n=t[e],o=t[e+1]+t[e+2],r=t.slice(e+3,e+o);if(!C[n]){console.warn("Unknown sub frame type "+n);break}{const t=C[n],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=o}const o=r[t[4]];return o?new o({node:s}):{node:s}}}},2299:(t,e,s)=>{const{getFractional:n}=s(4644),o={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],o=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,d=r.startTime||0;o[0]=Math.floor(i),o[1]=n(i),o[2]=Math.floor(h),o[3]=n(h),o[4]=Math.floor(a),o[5]=n(a),o[6]=Math.floor(l),o[7]=n(l),o[8]=Math.floor(d),o[9]=n(d);for(let t=0;t<s.length;t++)o[10+t]=s.codePointAt(t);return o},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t[6]+t[7]/100,r=t[8]+t[9]/100;return{[String.fromCodePoint.apply(null,t.slice(10))]:{pos:{x:e,y:s},size:{x:n,y:o},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:o}},4440:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},6100:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},9832:(t,e,s)=>{const{getFractional:n}=s(4644),o=s(2704),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==o.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=n(t);const s=r(e.y,i[1]);let o;h[2]=s,h[3]=n(s),o=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(o),h[5]=n(o)}else{const t=i[0];h[0]=Math.floor(t),h[1]=n(t);const e=i[1];h[2]=Math.floor(e),h[3]=n(e);const s=i[2];h[4]=Math.round(s),h[5]=n(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,o=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=o,h[2*t+1]=n(o)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t[e]+t[e+1]/100;s[e/2]=n}if(e===o.SHAPE_2D_POLYGON||e===o.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},2296:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const n=new Array(s);for(let t=0;t<e.length;t++)n[t]=e.codePointAt(t);return n[e.length]=t.shadow.color[0],n[e.length+1]=t.shadow.color[1],n[e.length+2]=t.shadow.color[2],n[e.length+3]=t.shadow.color[3],t.shadow.blur&&(n[e.length+4]=Math.floor(t.shadow.blur/10),n[e.length+5]=t.shadow.blur%10),n}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let n;t.length>10&&(n=10*t[10]+t[11]);const o={[e]:{color:s}};return n&&(o[e].blur=n),o}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},2920:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},9412:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},3812:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},4336:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},5364:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},4541:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},1372:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},2580:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},8784:(t,e,s)=>{const{hypLength:n}=s(4644),o=s(6744),{squishColor:r}=s(6100),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const d=t.size||1,c=e?d*n(e.x,e.y):d;l[4]=Math.floor(c),l[5]=Math.round(100*(c-Math.floor(c)));const u=t.color||o.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let n=6+f.length+2+3*[...h].length;l[n+p]=Number(s[0]),l[n+p+1]=Number(s[1]),l[n+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let n;n=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let o=6+f.length+2+3*[...h].length+3*[...a].length;l[o+g]=Number(n[0]),l[o+g+1]=Number(n[1]),l[o+g+2]=Number(n[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let d=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let n=h[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;d.push(o)}const c=String.fromCodePoint.apply(null,d);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let n=a[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;u.push(o)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let n=l[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;y.push(o)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:n,color:o,align:c,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},4432:(t,e,s)=>{const{GameNode:n}=s(5548),o=s(2704);t.exports={[[o.ASSET]]:n.Asset,[[o.TEXT]]:n.Text,[[o.SHAPE_2D_POLYGON]]:n.Shape,[[o.SHAPE_2D_CIRCLE]]:n.Shape,[[o.SHAPE_2D_LINE]]:n.Shape}},2704:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},3508:(t,e,s)=>{const{getRandomTerrain:n,getRandomStartPoint:o}=s(4528),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const d=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);n()(d,o(h,a,e),h,a,e);const c=((t,e,s,n)=>{const o=[];for(let i=0;i<s;i++)for(let s=0;s<n;s++){const n=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(o.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){o.push(...n);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(n.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(d,e,h,a);return c?i(d,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:n,height:o}=((t,e)=>{const s=t.x,n=t.y,o=e.x,r=e.y;return{width:Math.floor(s/o),height:Math.floor(n/r)}})(t,e);let r=((t,e)=>{const s=[],n={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let o=0;o<t;o++){s[o]=[];for(let r=0;r<e;r++){const i={...n};0===o?i.west=!1:o===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[o].push(i)}}return s})(n,o);const h={x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*o)};return r=i(r,h,s,n,o),r}}},4528:t=>{const e=(t,{x:e,y:s},n,o,r)=>{e<0||e>=n||s<0||s>=o||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s+1,y:n+1},o,r,i)):1===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i)):2===h?(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n-1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n-1},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s,y:n+3},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+3,y:n},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-3,y:n},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s,y:n-3},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s+1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+2,y:n-1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n+1},o,r,i),e(t,{x:s+2,y:n+1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n-1},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const n={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;n.x===s.x&&n.y===s.y;)n.x=Math.floor(Math.random()*t),n.y=Math.floor(Math.random()*e);return n}}},2208:t=>{const e=(t,s,n,o=[])=>{if(!n||n(t)&&t.node.id!==s.node.id){const e=t.node.text,n=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=n[0][0],h=n[1][0],a=r[0][0],l=r[1][0],d=n[0][1],c=n[2][1],u=r[0][1],f=r[2][1];l<i||h<a||d>f||u>c||o.push(t)}for(const r in t.node.children)e(t.node.children[r],s,n,o);return o};t.exports={checkCollisions:(t,s,n=null)=>e(t,s,n)}},4644:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},8928:t=>{t.exports=function(t,e){return new Proxy(t,{get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,n){const o=Reflect.defineProperty(t,s,n);return e&&e(),o},deleteProperty(t,s){const n=Reflect.deleteProperty(t,s);return e&&e(),n}})}},1464:t=>{t.exports={triangle:(t,e,s,n,o,r)=>[[t,e],[s,n],[o,r],[t,e]],rectangle:(t,e,s,n)=>[[t,e],[t+s,e],[t+s,e+n],[t,e+n],[t,e]]}},8:(t,e,s)=>{const{GameNode:n}=s(5548),o=s(7456),r=s(1464),i=s(2208),h=s(6744);t.exports={getView:(t,e,s,a={},l={})=>{const d=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),c=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return d.length>0&&d.forEach((t=>{const n=[],o=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in o){const r=o[s],i=r[0],h=r[1];let d=Math.max(Math.min(i-e.x,100),0),c=Math.max(Math.min(h-e.y,100),0);d=(l.x||1)*d,c=(l.y||1)*c,(!a.filter||a.filter(t))&&(a.x&&(d+=a.x),a.y&&(c+=a.y)),d<0?d=0:d>100&&(d=100),c<0?c=0:c>100&&(c=100),n.push([d,c])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(n&&n.length&&(e.node.text&&(e.node.text.x=n[0][0],e.node.text.y=n[0][1]),n.length&&(e.node.coordinates2d=n),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],n=e.node.coordinates2d[2],o=s[0]-t[0],r=n[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=o,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>c.addChild(t))),c}}},9344:(t,e,s)=>{const{squish:n,unsquish:o}=s(7144),{gameNode:r,GameNode:i}=s(3476),h=(s(3012),s(6752)),a=s(108),l=s(2504),d=s(3852),c=s(868),u=s(2148),{terrainGenerator:f}=s(1572),y=s(6352),p=s(8708),g=s(3744),x=s(5396),E=s(5648);t.exports={squish:n,unsquish:o,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:d,Squisher:p,ShapeUtils:c,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},3744:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(6540),this.http=s(3676),this.fs=s(2608),this.crypto=s(9632),this.path=s(2172),this.process=s(7600)}getConfigValue(t,e=void 0){const s=this.getConfig();let n=process.env[t]&&`${process.env[t]}`;if(void 0!==n)return"true"===n?n=!0:"false"===n&&(n=!1),console.log(`Using environment value: ${n} for key: ${t}`),n;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),n=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,n):(await downloadFileSync(this.info.id,e),this.initialized=!0,n)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,n)=>{this.existsLocally().then((n=>{n&&!t?(this.initialized=!0,s(n)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,n)=>{s?e(s):t(n)}))}))}))}doDownload(t,e){return new Promise(((s,n)=>{const o=this.getHash(t),r=`${e}/${o}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{n(t)}))}))}}},4208:(t,e,s)=>{const n=s(536),o=s(3012),r=(t,e,s,r,i,h,a,l,d,c,u,f)=>{const y=new o(t,e,s,r,i,h,a,l,d,c,u,f);return n(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:n,fill:o,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:d,subtype:c,node:u,id:f}){this.node=u||r(t,e,s,n,o,i,h,a,l,d,c,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const n in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[n],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}}}},6752:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const n=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,o=Math.floor(Math.random()*n.length);return e[n[o]]}}},108:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let n in s)if(e=s[n].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},3476:(t,e,s)=>{const n=s(3852),o=s(6352),{gameNode:r,BaseNode:i}=s(4208),h={[n.CIRCLE]:o.SHAPE_2D_CIRCLE,[n.POLYGON]:o.SHAPE_2D_POLYGON,[n.LINE]:o.SHAPE_2D_LINE},a={[o.SHAPE_2D_CIRCLE]:n.CIRCLE,[o.SHAPE_2D_POLYGON]:n.POLYGON,[o.SHAPE_2D_LINE]:n.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,id:c}){if(!(n&&s||d))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,subtype:h[s],id:c})}clone({handleClick:t,input:e,id:s}){const n=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:n})}}class d extends i{constructor({textInfo:t,playerIds:e,input:s,node:n,id:r}){if(!t&&!n)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:n,subtype:o.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new d({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:n})}}class c extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,subtype:o.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new c({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:n})}}const u={Asset:c,Shape:l,Text:d};t.exports={gameNode:r,GameNode:u}},3012:t=>{t.exports=class{constructor(t,e,s,n,o,r,i,h=[],a=null,l=null,d=null,c=null){this.id=c?Number(c):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=n,this.fill=o,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=d}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},3852:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},8708:(t,e,s)=>{const{squish:n,unsquish:o}=s(7144);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:n,onAssetUpdate:o}){if(this.ids=new Set,this.game=t,this.assets={},this.customBottomLayer=s,this.customTopLayer=n,this.initialize(),this.onAssetUpdate=o,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return o(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const n={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,n),s.push(t)}for(const o in t){const r=[],i=t[o],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,n),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,n),s.push(t)}return this.playerFrames=n,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},o={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=n(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0)for(let t of r)o[t]||(o[Number(t)]=[]),o[t].push(i);else Object.keys(o).forEach((t=>{o[t]||(o[Number(t)]=[]),o[t].push(i)}));for(let n=0;n<t.node.children.length;n++){const i=new Set(r);this.squishHelper(t.node.children[n],e,s,o,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const n=t[s].root;e[s]=n}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),n=this.game.constructor.metadata&&this.game.constructor.metadata(),o=n&&n.assets?n.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(o,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(o,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(o,this.game.getAssets());const r=Object.assign(s,o);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let n=0;const o=new Array(32);for(;n<32&&n<e.length;)o[n]=e.charCodeAt(n),n++;const l=(s.length+32).toString(36),d="image"===r[e].info.type?1:2;let c="";for(let t=0;t<10-l.length;t++)c+="0";for(let t=l.length;t<10;t++)c+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,d,...u,...o,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let n=0;n<this.assets[s].length;n++)e[t++]=this.assets[s][n];this.assetBundle=e,t(e)}}))}))}handleStateChange(t,e){this.state=this.squish(this.game.getLayers()),this.broadcast()}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},2504:(t,e,s)=>{const{GameNode:n}=s(3476),o=s(3852),r=s(868),i=s(6752),h=s(108);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},5116:(t,e,s)=>{const{GameNode:n}=s(3476);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:n.Asset,2:n.Shape,3:n.Text}}},5648:t=>{t.exports={getPath:(t,e,s,n,o=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+n;if(a<0||a>o||l<0||l>r){let t=a,e=l;a<0?t=0:a>o&&(t=o),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},7144:(t,e,s)=>{const n=s(3012),{CONSTRUCTOR_TO_TYPE:o,TYPE_TO_CONSTRUCTOR:r}=s(5116),i=s(6140),{squishId:h}=s(188),{squishColor:a}=s(144),{squishPlayerIds:l}=s(8660),{squishPos:d}=s(0),{squishFill:c}=s(6212),{squishSize:u}=s(7192),{squishHandleClick:f}=s(7372),{squishBorder:y}=s(5468),{squishSubType:p}=s(1420),{squishInput:g}=s(9859),{squishCoordinates2d:x}=s(9472),{squishEffect:E}=s(552),{squishText:A}=s(1672),{squishAsset:S}=s(7820),m={id:h,color:a,playerIds:l,pos:d,coordinates2d:x,fill:c,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},C={};for(const t in m)C[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const n=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const o=r[t];if(o in n){const t=n[o];if(null!=t){const r=m[o].squish(t,e,n),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[o].type,a,h,...r])}}}let h=o[t.constructor.name];h||(h=o[i[n.subType]]);const a=s.flat(),l=a.length+5,d=Math.min(255,l),c=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),c,d,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new n;for(;e<t.length;){const n=t[e],o=t[e+1]+t[e+2],r=t.slice(e+3,e+o);if(!C[n]){console.warn("Unknown sub frame type "+n);break}{const t=C[n],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=o}const o=r[t[4]];return o?new o({node:s}):{node:s}}}},7820:(t,e,s)=>{const{getFractional:n}=s(5520),o={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],o=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,d=r.startTime||0;o[0]=Math.floor(i),o[1]=n(i),o[2]=Math.floor(h),o[3]=n(h),o[4]=Math.floor(a),o[5]=n(a),o[6]=Math.floor(l),o[7]=n(l),o[8]=Math.floor(d),o[9]=n(d);for(let t=0;t<s.length;t++)o[10+t]=s.codePointAt(t);return o},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t[6]+t[7]/100,r=t[8]+t[9]/100;return{[String.fromCodePoint.apply(null,t.slice(10))]:{pos:{x:e,y:s},size:{x:n,y:o},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:o}},5468:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},144:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},9472:(t,e,s)=>{const{getFractional:n}=s(5520),o=s(6352),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==o.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=n(t);const s=r(e.y,i[1]);let o;h[2]=s,h[3]=n(s),o=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(o),h[5]=n(o)}else{const t=i[0];h[0]=Math.floor(t),h[1]=n(t);const e=i[1];h[2]=Math.floor(e),h[3]=n(e);const s=i[2];h[4]=Math.round(s),h[5]=n(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,o=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=o,h[2*t+1]=n(o)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t[e]+t[e+1]/100;s[e/2]=n}if(e===o.SHAPE_2D_POLYGON||e===o.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},552:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const n=new Array(s);for(let t=0;t<e.length;t++)n[t]=e.codePointAt(t);return n[e.length]=t.shadow.color[0],n[e.length+1]=t.shadow.color[1],n[e.length+2]=t.shadow.color[2],n[e.length+3]=t.shadow.color[3],t.shadow.blur&&(n[e.length+4]=Math.floor(t.shadow.blur/10),n[e.length+5]=t.shadow.blur%10),n}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let n;t.length>10&&(n=10*t[10]+t[11]);const o={[e]:{color:s}};return n&&(o[e].blur=n),o}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},6212:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},7372:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},188:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},9859:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},8660:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},0:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},7192:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},1420:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},1672:(t,e,s)=>{const{hypLength:n}=s(5520),o=s(6752),{squishColor:r}=s(144),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=new Array(t.text.length+10+h.length);a[0]=Math.floor(s),a[1]=Math.round(100*(s-Math.floor(s))),a[2]=Math.floor(i),a[3]=Math.round(100*(i-Math.floor(i)));const l=t.size||1,d=e?l*n(e.x,e.y):l;a[4]=Math.floor(d),a[5]=Math.round(100*(d-Math.floor(d)));const c=t.color||o.BLACK,u=r.squish(c);for(let t=0;t<u.length;t++)a[6+t]=u[t];a[6+u.length]=3*[...h].length;let f=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],a[6+u.length+1+f]=Number(s[0]),a[6+u.length+1+f+1]=Number(s[1]),a[6+u.length+1+f+2]=Number(s[2]),f+=3}let y=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let n;n=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`],a[6+u.length+1+f+y]=Number(n[0]),a[6+u.length+1+f+y+1]=Number(n[1]),a[6+u.length+1+f+y+2]=Number(n[2]),y+=3}return a},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t.slice(6,10),r=t[10],i=t.slice(11,11+r),h=t.slice(11+r);let a=[];for(let t=0;t<i.length;t+=3){let e=i[t].toString();1==e.length&&(e=`0${e}`);let s=i[t+1].toString();1==s.length&&(s=`0${s}`);let n=i[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;a.push(o)}const l=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let n=h[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;l.push(o)}const d=String.fromCodePoint.apply(null,a);return{x:e,y:s,text:String.fromCodePoint.apply(null,l),size:n,color:o,align:d}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},6140:(t,e,s)=>{const{GameNode:n}=s(3476),o=s(6352);t.exports={[[o.ASSET]]:n.Asset,[[o.TEXT]]:n.Text,[[o.SHAPE_2D_POLYGON]]:n.Shape,[[o.SHAPE_2D_CIRCLE]]:n.Shape,[[o.SHAPE_2D_LINE]]:n.Shape}},6352:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},1572:(t,e,s)=>{const{getRandomTerrain:n,getRandomStartPoint:o}=s(9392),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const d=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);n()(d,o(h,a,e),h,a,e);const c=((t,e,s,n)=>{const o=[];for(let i=0;i<s;i++)for(let s=0;s<n;s++){const n=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(o.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){o.push(...n);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(n.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(d,e,h,a);return c?i(d,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:n,height:o}=((t,e)=>{const s=t.x,n=t.y,o=e.x,r=e.y;return{width:Math.floor(s/o),height:Math.floor(n/r)}})(t,e);let r=((t,e)=>{const s=[],n={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let o=0;o<t;o++){s[o]=[];for(let r=0;r<e;r++){const i={...n};0===o?i.west=!1:o===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[o].push(i)}}return s})(n,o);const h={x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*o)};return r=i(r,h,s,n,o),r}}},9392:t=>{const e=(t,{x:e,y:s},n,o,r)=>{e<0||e>=n||s<0||s>=o||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s+1,y:n+1},o,r,i)):1===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i)):2===h?(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n-1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n-1},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s,y:n+3},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+3,y:n},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-3,y:n},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s,y:n-3},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s+1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+2,y:n-1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n+1},o,r,i),e(t,{x:s+2,y:n+1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n-1},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const n={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;n.x===s.x&&n.y===s.y;)n.x=Math.floor(Math.random()*t),n.y=Math.floor(Math.random()*e);return n}}},5396:t=>{const e=(t,s,n,o=[])=>{if(!n||n(t)&&t.node.id!==s.node.id){const e=t.node.text,n=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=n[0][0],h=n[1][0],a=r[0][0],l=r[1][0],d=n[0][1],c=n[2][1],u=r[0][1],f=r[2][1];l<i||h<a||d>f||u>c||o.push(t)}for(const r in t.node.children)e(t.node.children[r],s,n,o);return o};t.exports={checkCollisions:(t,s,n=null)=>e(t,s,n)}},5520:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},536:t=>{t.exports=function(t,e){return new Proxy(t,{get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,n){const o=Reflect.defineProperty(t,s,n);return e&&e(),o},deleteProperty(t,s){const n=Reflect.deleteProperty(t,s);return e&&e(),n}})}},868:t=>{t.exports={triangle:(t,e,s,n,o,r)=>[[t,e],[s,n],[o,r],[t,e]],rectangle:(t,e,s,n)=>[[t,e],[t+s,e],[t+s,e+n],[t,e+n],[t,e]]}},2148:(t,e,s)=>{const{GameNode:n}=s(3476),o=s(3852),r=s(868),i=s(5396),h=s(6752);t.exports={getView:(t,e,s,a={},l={})=>{const d=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),c=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return d.length>0&&d.forEach((t=>{const n=[],o=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in o){const r=o[s],i=r[0],h=r[1];let d=Math.max(Math.min(i-e.x,100),0),c=Math.max(Math.min(h-e.y,100),0);d=(l.x||1)*d,c=(l.y||1)*c,(!a.filter||a.filter(t))&&(a.x&&(d+=a.x),a.y&&(c+=a.y)),d<0?d=0:d>100&&(d=100),c<0?c=0:c>100&&(c=100),n.push([d,c])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(n&&n.length&&(e.node.text&&(e.node.text.x=n[0][0],e.node.text.y=n[0][1]),n.length&&(e.node.coordinates2d=n),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],n=e.node.coordinates2d[2],o=s[0]-t[0],r=n[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=o,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>c.addChild(t))),c}}},6756:(t,e,s)=>{const{squish:n,unsquish:o}=s(8520),{gameNode:r,GameNode:i}=s(9656),h=(s(3672),s(7856)),a=s(9190),l=s(5141),d=s(72),c=s(8620),u=s(1884),{terrainGenerator:f}=s(2564),y=s(9e3),p=s(7160),g=s(4888),x=s(6932),E=s(4144);t.exports={squish:n,unsquish:o,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:d,Squisher:p,ShapeUtils:c,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},4888:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(4868),this.http=s(3716),this.fs=s(6296),this.crypto=s(4128),this.path=s(4036),this.process=s(6652)}getConfigValue(t,e=void 0){const s=this.getConfig();let n=process.env[t]&&`${process.env[t]}`;if(void 0!==n)return"true"===n?n=!0:"false"===n&&(n=!1),console.log(`Using environment value: ${n} for key: ${t}`),n;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),n=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,n):(await downloadFileSync(this.info.id,e),this.initialized=!0,n)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,n)=>{this.existsLocally().then((n=>{n&&!t?(this.initialized=!0,s(n)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,n)=>{s?e(s):t(n)}))}))}))}doDownload(t,e){return new Promise(((s,n)=>{const o=this.getHash(t),r=`${e}/${o}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{n(t)}))}))}}},772:(t,e,s)=>{const n=s(2568),o=s(3672),r=(t,e,s,r,i,h,a,l,d,c,u,f)=>{const y=new o(t,e,s,r,i,h,a,l,d,c,u,f);return n(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:n,fill:o,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:d,subtype:c,node:u,id:f}){this.node=u||r(t,e,s,n,o,i,h,a,l,d,c,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const n in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[n],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}}}},7856:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const n=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,o=Math.floor(Math.random()*n.length);return e[n[o]]}}},9190:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let n in s)if(e=s[n].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},9656:(t,e,s)=>{const n=s(72),o=s(9e3),{gameNode:r,BaseNode:i}=s(772),h={[n.CIRCLE]:o.SHAPE_2D_CIRCLE,[n.POLYGON]:o.SHAPE_2D_POLYGON,[n.LINE]:o.SHAPE_2D_LINE},a={[o.SHAPE_2D_CIRCLE]:n.CIRCLE,[o.SHAPE_2D_POLYGON]:n.POLYGON,[o.SHAPE_2D_LINE]:n.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,id:c}){if(!(n&&s||d))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,subtype:h[s],id:c})}clone({handleClick:t,input:e,id:s}){const n=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:n})}}class d extends i{constructor({textInfo:t,playerIds:e,input:s,node:n,id:r}){if(!t&&!n)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:n,subtype:o.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new d({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:n})}}class c extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,subtype:o.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new c({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:n})}}const u={Asset:c,Shape:l,Text:d};t.exports={gameNode:r,GameNode:u}},3672:t=>{t.exports=class{constructor(t,e,s,n,o,r,i,h=[],a=null,l=null,d=null,c=null){this.id=c?Number(c):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=n,this.fill=o,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=d}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},72:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},7160:(t,e,s)=>{const{squish:n,unsquish:o}=s(8520);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:n,onAssetUpdate:o}){if(this.ids=new Set,this.game=t,this.assets={},this.customBottomLayer=s,this.customTopLayer=n,this.initialize(),this.onAssetUpdate=o,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return o(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const n={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,n),s.push(t)}for(const o in t){const r=[],i=t[o],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,n),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,n),s.push(t)}return this.playerFrames=n,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},o={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=n(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0)for(let t of r)o[t]||(o[Number(t)]=[]),o[t].push(i);else Object.keys(o).forEach((t=>{o[t]||(o[Number(t)]=[]),o[t].push(i)}));for(let n=0;n<t.node.children.length;n++){const i=new Set(r);this.squishHelper(t.node.children[n],e,s,o,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const n=t[s].root;e[s]=n}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),n=this.game.constructor.metadata&&this.game.constructor.metadata(),o=n&&n.assets?n.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(o,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(o,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(o,this.game.getAssets());const r=Object.assign(s,o);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let n=0;const o=new Array(32);for(;n<32&&n<e.length;)o[n]=e.charCodeAt(n),n++;const l=(s.length+32).toString(36),d={image:1,audio:2,font:3}[r[e].info.type];let c="";for(let t=0;t<10-l.length;t++)c+="0";for(let t=l.length;t<10;t++)c+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,d,...u,...o,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let n=0;n<this.assets[s].length;n++)e[t++]=this.assets[s][n];this.assetBundle=e,t(e)}}))}))}handleStateChange(t,e){this.state=this.squish(this.game.getLayers()),this.broadcast()}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},5141:(t,e,s)=>{const{GameNode:n}=s(9656),o=s(72),r=s(8620),i=s(7856),h=s(9190);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},9918:(t,e,s)=>{const{GameNode:n}=s(9656);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:n.Asset,2:n.Shape,3:n.Text}}},4144:t=>{t.exports={getPath:(t,e,s,n,o=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+n;if(a<0||a>o||l<0||l>r){let t=a,e=l;a<0?t=0:a>o&&(t=o),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},8520:(t,e,s)=>{const n=s(3672),{CONSTRUCTOR_TO_TYPE:o,TYPE_TO_CONSTRUCTOR:r}=s(9918),i=s(1828),{squishId:h}=s(9848),{squishColor:a}=s(2444),{squishPlayerIds:l}=s(8224),{squishPos:d}=s(8032),{squishFill:c}=s(3724),{squishSize:u}=s(3224),{squishHandleClick:f}=s(3936),{squishBorder:y}=s(2216),{squishSubType:p}=s(9940),{squishInput:g}=s(9388),{squishCoordinates2d:x}=s(4216),{squishEffect:E}=s(632),{squishText:A}=s(6924),{squishAsset:S}=s(7836),m={id:h,color:a,playerIds:l,pos:d,coordinates2d:x,fill:c,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},C={};for(const t in m)C[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const n=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const o=r[t];if(o in n){const t=n[o];if(null!=t){const r=m[o].squish(t,e,n),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[o].type,a,h,...r])}}}let h=o[t.constructor.name];h||(h=o[i[n.subType]]);const a=s.flat(),l=a.length+5,d=Math.min(255,l),c=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),c,d,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new n;for(;e<t.length;){const n=t[e],o=t[e+1]+t[e+2],r=t.slice(e+3,e+o);if(!C[n]){console.warn("Unknown sub frame type "+n);break}{const t=C[n],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=o}const o=r[t[4]];return o?new o({node:s}):{node:s}}}},7836:(t,e,s)=>{const{getFractional:n}=s(3576),o={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],o=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,d=r.startTime||0;o[0]=Math.floor(i),o[1]=n(i),o[2]=Math.floor(h),o[3]=n(h),o[4]=Math.floor(a),o[5]=n(a),o[6]=Math.floor(l),o[7]=n(l),o[8]=Math.floor(d),o[9]=n(d);for(let t=0;t<s.length;t++)o[10+t]=s.codePointAt(t);return o},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t[6]+t[7]/100,r=t[8]+t[9]/100;return{[String.fromCodePoint.apply(null,t.slice(10))]:{pos:{x:e,y:s},size:{x:n,y:o},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:o}},2216:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},2444:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},4216:(t,e,s)=>{const{getFractional:n}=s(3576),o=s(9e3),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==o.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=n(t);const s=r(e.y,i[1]);let o;h[2]=s,h[3]=n(s),o=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(o),h[5]=n(o)}else{const t=i[0];h[0]=Math.floor(t),h[1]=n(t);const e=i[1];h[2]=Math.floor(e),h[3]=n(e);const s=i[2];h[4]=Math.round(s),h[5]=n(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,o=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=o,h[2*t+1]=n(o)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t[e]+t[e+1]/100;s[e/2]=n}if(e===o.SHAPE_2D_POLYGON||e===o.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},632:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const n=new Array(s);for(let t=0;t<e.length;t++)n[t]=e.codePointAt(t);return n[e.length]=t.shadow.color[0],n[e.length+1]=t.shadow.color[1],n[e.length+2]=t.shadow.color[2],n[e.length+3]=t.shadow.color[3],t.shadow.blur&&(n[e.length+4]=Math.floor(t.shadow.blur/10),n[e.length+5]=t.shadow.blur%10),n}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let n;t.length>10&&(n=10*t[10]+t[11]);const o={[e]:{color:s}};return n&&(o[e].blur=n),o}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},3724:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},3936:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},9848:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},9388:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},8224:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},8032:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},3224:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},9940:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},6924:(t,e,s)=>{const{hypLength:n}=s(3576),o=s(7856),{squishColor:r}=s(2444),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const d=t.size||1,c=e?d*n(e.x,e.y):d;l[4]=Math.floor(c),l[5]=Math.round(100*(c-Math.floor(c)));const u=t.color||o.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let n=6+f.length+2+3*[...h].length;l[n+p]=Number(s[0]),l[n+p+1]=Number(s[1]),l[n+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let n;n=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let o=6+f.length+2+3*[...h].length+3*[...a].length;l[o+g]=Number(n[0]),l[o+g+1]=Number(n[1]),l[o+g+2]=Number(n[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let d=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let n=h[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;d.push(o)}const c=String.fromCodePoint.apply(null,d);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let n=a[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;u.push(o)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let n=l[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;y.push(o)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:n,color:o,align:c,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},1828:(t,e,s)=>{const{GameNode:n}=s(9656),o=s(9e3);t.exports={[[o.ASSET]]:n.Asset,[[o.TEXT]]:n.Text,[[o.SHAPE_2D_POLYGON]]:n.Shape,[[o.SHAPE_2D_CIRCLE]]:n.Shape,[[o.SHAPE_2D_LINE]]:n.Shape}},9e3:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},2564:(t,e,s)=>{const{getRandomTerrain:n,getRandomStartPoint:o}=s(1852),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const d=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);n()(d,o(h,a,e),h,a,e);const c=((t,e,s,n)=>{const o=[];for(let i=0;i<s;i++)for(let s=0;s<n;s++){const n=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(o.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){o.push(...n);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(n.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(d,e,h,a);return c?i(d,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:n,height:o}=((t,e)=>{const s=t.x,n=t.y,o=e.x,r=e.y;return{width:Math.floor(s/o),height:Math.floor(n/r)}})(t,e);let r=((t,e)=>{const s=[],n={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let o=0;o<t;o++){s[o]=[];for(let r=0;r<e;r++){const i={...n};0===o?i.west=!1:o===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[o].push(i)}}return s})(n,o);const h={x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*o)};return r=i(r,h,s,n,o),r}}},1852:t=>{const e=(t,{x:e,y:s},n,o,r)=>{e<0||e>=n||s<0||s>=o||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s+1,y:n+1},o,r,i)):1===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i)):2===h?(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n-1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n-1},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s,y:n+3},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+3,y:n},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-3,y:n},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s,y:n-3},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s+1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+2,y:n-1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n+1},o,r,i),e(t,{x:s+2,y:n+1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n-1},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const n={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;n.x===s.x&&n.y===s.y;)n.x=Math.floor(Math.random()*t),n.y=Math.floor(Math.random()*e);return n}}},6932:t=>{const e=(t,s,n,o=[])=>{if(!n||n(t)&&t.node.id!==s.node.id){const e=t.node.text,n=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=n[0][0],h=n[1][0],a=r[0][0],l=r[1][0],d=n[0][1],c=n[2][1],u=r[0][1],f=r[2][1];l<i||h<a||d>f||u>c||o.push(t)}for(const r in t.node.children)e(t.node.children[r],s,n,o);return o};t.exports={checkCollisions:(t,s,n=null)=>e(t,s,n)}},3576:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},2568:t=>{t.exports=function(t,e){return new Proxy(t,{get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,n){const o=Reflect.defineProperty(t,s,n);return e&&e(),o},deleteProperty(t,s){const n=Reflect.deleteProperty(t,s);return e&&e(),n}})}},8620:t=>{t.exports={triangle:(t,e,s,n,o,r)=>[[t,e],[s,n],[o,r],[t,e]],rectangle:(t,e,s,n)=>[[t,e],[t+s,e],[t+s,e+n],[t,e+n],[t,e]]}},1884:(t,e,s)=>{const{GameNode:n}=s(9656),o=s(72),r=s(8620),i=s(6932),h=s(7856);t.exports={getView:(t,e,s,a={},l={})=>{const d=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),c=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return d.length>0&&d.forEach((t=>{const n=[],o=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in o){const r=o[s],i=r[0],h=r[1];let d=Math.max(Math.min(i-e.x,100),0),c=Math.max(Math.min(h-e.y,100),0);d=(l.x||1)*d,c=(l.y||1)*c,(!a.filter||a.filter(t))&&(a.x&&(d+=a.x),a.y&&(c+=a.y)),d<0?d=0:d>100&&(d=100),c<0?c=0:c>100&&(c=100),n.push([d,c])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(n&&n.length&&(e.node.text&&(e.node.text.x=n[0][0],e.node.text.y=n[0][1]),n.length&&(e.node.coordinates2d=n),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],n=e.node.coordinates2d[2],o=s[0]-t[0],r=n[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=o,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>c.addChild(t))),c}}},7477:(t,e,s)=>{const{squish:n,unsquish:o}=s(8840),{gameNode:r,GameNode:i}=s(6376),h=(s(2744),s(1256)),a=s(3436),l=s(4944),d=s(1024),c=s(9376),u=s(4484),{terrainGenerator:f}=s(4743),y=s(5300),p=s(7608),g=s(3360),x=s(9588),E=s(1816);t.exports={squish:n,unsquish:o,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:d,Squisher:p,ShapeUtils:c,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},3360:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(8980),this.http=s(2984),this.fs=s(6544),this.crypto=s(548),this.path=s(3184),this.process=s(8360)}getConfigValue(t,e=void 0){const s=this.getConfig();let n=process.env[t]&&`${process.env[t]}`;if(void 0!==n)return"true"===n?n=!0:"false"===n&&(n=!1),console.log(`Using environment value: ${n} for key: ${t}`),n;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),n=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,n):(await downloadFileSync(this.info.id,e),this.initialized=!0,n)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,n)=>{this.existsLocally().then((o=>{o&&!t?(this.initialized=!0,s(o)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{n(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,n)=>{s?e(s):t(n)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,n)=>{const o=this.getHash(t),r=`${e}/${o}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{n(t)}))}))}}},8984:(t,e,s)=>{const n=s(3871),o=s(2744),r=(t,e,s,r,i,h,a,l,d,c,u,f)=>{const y=new o(t,e,s,r,i,h,a,l,d,c,u,f);return n(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:n,fill:o,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:d,subtype:c,node:u,id:f}){this.node=u||r(t,e,s,n,o,i,h,a,l,d,c,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const n in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[n],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}}}},1256:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const n=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,o=Math.floor(Math.random()*n.length);return e[n[o]]}}},3436:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let n in s)if(e=s[n].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},6376:(t,e,s)=>{const n=s(1024),o=s(5300),{gameNode:r,BaseNode:i}=s(8984),h={[n.CIRCLE]:o.SHAPE_2D_CIRCLE,[n.POLYGON]:o.SHAPE_2D_POLYGON,[n.LINE]:o.SHAPE_2D_LINE},a={[o.SHAPE_2D_CIRCLE]:n.CIRCLE,[o.SHAPE_2D_POLYGON]:n.POLYGON,[o.SHAPE_2D_LINE]:n.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,id:c}){if(!(n&&s||d))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,subtype:h[s],id:c})}clone({handleClick:t,input:e,id:s}){const n=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:n})}}class d extends i{constructor({textInfo:t,playerIds:e,input:s,node:n,id:r}){if(!t&&!n)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:n,subtype:o.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new d({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:n})}}class c extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,subtype:o.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new c({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:n})}}const u={Asset:c,Shape:l,Text:d};t.exports={gameNode:r,GameNode:u}},2744:t=>{t.exports=class{constructor(t,e,s,n,o,r,i,h=[],a=null,l=null,d=null,c=null){this.id=c?Number(c):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=n,this.fill=o,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=d}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},1024:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},7608:(t,e,s)=>{const{squish:n,unsquish:o}=s(8840);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:n,onAssetUpdate:o}){if(this.ids=new Set,this.game=t,this.assets={},this.customBottomLayer=s,this.customTopLayer=n,this.initialize(),this.onAssetUpdate=o,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return o(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const n={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,n),s.push(t)}for(const o in t){const r=[],i=t[o],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,n),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,n),s.push(t)}return this.playerFrames=n,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},o={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=n(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0)for(let t of r)o[t]||(o[Number(t)]=[]),o[t].push(i);else Object.keys(o).forEach((t=>{o[t]||(o[Number(t)]=[]),o[t].push(i)}));for(let n=0;n<t.node.children.length;n++){const i=new Set(r);this.squishHelper(t.node.children[n],e,s,o,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const n=t[s].root;e[s]=n}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),n=this.game.constructor.metadata&&this.game.constructor.metadata(),o=n&&n.assets?n.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(o,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(o,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(o,this.game.getAssets());const r=Object.assign(s,o);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let n=0;const o=new Array(32);for(;n<32&&n<e.length;)o[n]=e.charCodeAt(n),n++;const l=(s.length+32).toString(36),d={image:1,audio:2,font:3}[r[e].info.type];let c="";for(let t=0;t<10-l.length;t++)c+="0";for(let t=l.length;t<10;t++)c+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,d,...u,...o,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let n=0;n<this.assets[s].length;n++)e[t++]=this.assets[s][n];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.state=this.squish(this.game.getLayers()),this.broadcast()}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},4944:(t,e,s)=>{const{GameNode:n}=s(6376),o=s(1024),r=s(9376),i=s(1256),h=s(3436);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},256:(t,e,s)=>{const{GameNode:n}=s(6376);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:n.Asset,2:n.Shape,3:n.Text}}},1816:t=>{t.exports={getPath:(t,e,s,n,o=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+n;if(a<0||a>o||l<0||l>r){let t=a,e=l;a<0?t=0:a>o&&(t=o),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},8840:(t,e,s)=>{const n=s(2744),{CONSTRUCTOR_TO_TYPE:o,TYPE_TO_CONSTRUCTOR:r}=s(256),i=s(3880),{squishId:h}=s(1156),{squishColor:a}=s(8876),{squishPlayerIds:l}=s(3776),{squishPos:d}=s(4708),{squishFill:c}=s(6404),{squishSize:u}=s(4551),{squishHandleClick:f}=s(3656),{squishBorder:y}=s(8372),{squishSubType:p}=s(4848),{squishInput:g}=s(3600),{squishCoordinates2d:x}=s(5456),{squishEffect:E}=s(9372),{squishText:A}=s(4984),{squishAsset:S}=s(5384),m={id:h,color:a,playerIds:l,pos:d,coordinates2d:x,fill:c,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},C={};for(const t in m)C[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const n=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const o=r[t];if(o in n){const t=n[o];if(null!=t){const r=m[o].squish(t,e,n),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[o].type,a,h,...r])}}}let h=o[t.constructor.name];h||(h=o[i[n.subType]]);const a=s.flat(),l=a.length+5,d=Math.min(255,l),c=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),c,d,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new n;for(;e<t.length;){const n=t[e],o=t[e+1]+t[e+2],r=t.slice(e+3,e+o);if(!C[n]){console.warn("Unknown sub frame type "+n);break}{const t=C[n],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=o}const o=r[t[4]];return o?new o({node:s}):{node:s}}}},5384:(t,e,s)=>{const{getFractional:n}=s(184),o={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],o=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,d=r.startTime||0;o[0]=Math.floor(i),o[1]=n(i),o[2]=Math.floor(h),o[3]=n(h),o[4]=Math.floor(a),o[5]=n(a),o[6]=Math.floor(l),o[7]=n(l),o[8]=Math.floor(d),o[9]=n(d);for(let t=0;t<s.length;t++)o[10+t]=s.codePointAt(t);return o},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t[6]+t[7]/100,r=t[8]+t[9]/100;return{[String.fromCodePoint.apply(null,t.slice(10))]:{pos:{x:e,y:s},size:{x:n,y:o},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:o}},8372:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},8876:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},5456:(t,e,s)=>{const{getFractional:n}=s(184),o=s(5300),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==o.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=n(t);const s=r(e.y,i[1]);let o;h[2]=s,h[3]=n(s),o=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(o),h[5]=n(o)}else{const t=i[0];h[0]=Math.floor(t),h[1]=n(t);const e=i[1];h[2]=Math.floor(e),h[3]=n(e);const s=i[2];h[4]=Math.round(s),h[5]=n(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,o=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=o,h[2*t+1]=n(o)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t[e]+t[e+1]/100;s[e/2]=n}if(e===o.SHAPE_2D_POLYGON||e===o.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},9372:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const n=new Array(s);for(let t=0;t<e.length;t++)n[t]=e.codePointAt(t);return n[e.length]=t.shadow.color[0],n[e.length+1]=t.shadow.color[1],n[e.length+2]=t.shadow.color[2],n[e.length+3]=t.shadow.color[3],t.shadow.blur&&(n[e.length+4]=Math.floor(t.shadow.blur/10),n[e.length+5]=t.shadow.blur%10),n}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let n;t.length>10&&(n=10*t[10]+t[11]);const o={[e]:{color:s}};return n&&(o[e].blur=n),o}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},6404:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},3656:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},1156:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},3600:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},3776:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},4708:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},4551:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},4848:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},4984:(t,e,s)=>{const{hypLength:n}=s(184),o=s(1256),{squishColor:r}=s(8876),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const d=t.size||1,c=e?d*n(e.x,e.y):d;l[4]=Math.floor(c),l[5]=Math.round(100*(c-Math.floor(c)));const u=t.color||o.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let n=6+f.length+2+3*[...h].length;l[n+p]=Number(s[0]),l[n+p+1]=Number(s[1]),l[n+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let n;n=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let o=6+f.length+2+3*[...h].length+3*[...a].length;l[o+g]=Number(n[0]),l[o+g+1]=Number(n[1]),l[o+g+2]=Number(n[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let d=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let n=h[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;d.push(o)}const c=String.fromCodePoint.apply(null,d);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let n=a[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;u.push(o)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let n=l[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;y.push(o)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:n,color:o,align:c,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},3880:(t,e,s)=>{const{GameNode:n}=s(6376),o=s(5300);t.exports={[[o.ASSET]]:n.Asset,[[o.TEXT]]:n.Text,[[o.SHAPE_2D_POLYGON]]:n.Shape,[[o.SHAPE_2D_CIRCLE]]:n.Shape,[[o.SHAPE_2D_LINE]]:n.Shape}},5300:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},4743:(t,e,s)=>{const{getRandomTerrain:n,getRandomStartPoint:o}=s(7544),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const d=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);n()(d,o(h,a,e),h,a,e);const c=((t,e,s,n)=>{const o=[];for(let i=0;i<s;i++)for(let s=0;s<n;s++){const n=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(o.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){o.push(...n);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(n.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(d,e,h,a);return c?i(d,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:n,height:o}=((t,e)=>{const s=t.x,n=t.y,o=e.x,r=e.y;return{width:Math.floor(s/o),height:Math.floor(n/r)}})(t,e);let r=((t,e)=>{const s=[],n={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let o=0;o<t;o++){s[o]=[];for(let r=0;r<e;r++){const i={...n};0===o?i.west=!1:o===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[o].push(i)}}return s})(n,o);const h={x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*o)};return r=i(r,h,s,n,o),r}}},7544:t=>{const e=(t,{x:e,y:s},n,o,r)=>{e<0||e>=n||s<0||s>=o||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s+1,y:n+1},o,r,i)):1===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i)):2===h?(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n-1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n-1},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s,y:n+3},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+3,y:n},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-3,y:n},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s,y:n-3},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s+1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+2,y:n-1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n+1},o,r,i),e(t,{x:s+2,y:n+1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n-1},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const n={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;n.x===s.x&&n.y===s.y;)n.x=Math.floor(Math.random()*t),n.y=Math.floor(Math.random()*e);return n}}},9588:t=>{const e=(t,s,n,o=[])=>{if(!n||n(t)&&t.node.id!==s.node.id){const e=t.node.text,n=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=n[0][0],h=n[1][0],a=r[0][0],l=r[1][0],d=n[0][1],c=n[2][1],u=r[0][1],f=r[2][1];l<i||h<a||d>f||u>c||o.push(t)}for(const r in t.node.children)e(t.node.children[r],s,n,o);return o};t.exports={checkCollisions:(t,s,n=null)=>e(t,s,n)}},184:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},3871:t=>{t.exports=function(t,e){return new Proxy(t,{get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,n){const o=Reflect.defineProperty(t,s,n);return e&&e(),o},deleteProperty(t,s){const n=Reflect.deleteProperty(t,s);return e&&e(),n}})}},9376:t=>{t.exports={triangle:(t,e,s,n,o,r)=>[[t,e],[s,n],[o,r],[t,e]],rectangle:(t,e,s,n)=>[[t,e],[t+s,e],[t+s,e+n],[t,e+n],[t,e]]}},4484:(t,e,s)=>{const{GameNode:n}=s(6376),o=s(1024),r=s(9376),i=s(9588),h=s(1256);t.exports={getView:(t,e,s,a={},l={})=>{const d=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),c=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return d.length>0&&d.forEach((t=>{const n=[],o=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in o){const r=o[s],i=r[0],h=r[1];let d=Math.max(Math.min(i-e.x,100),0),c=Math.max(Math.min(h-e.y,100),0);d=(l.x||1)*d,c=(l.y||1)*c,(!a.filter||a.filter(t))&&(a.x&&(d+=a.x),a.y&&(c+=a.y)),d<0?d=0:d>100&&(d=100),c<0?c=0:c>100&&(c=100),n.push([d,c])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(n&&n.length&&(e.node.text&&(e.node.text.x=n[0][0],e.node.text.y=n[0][1]),n.length&&(e.node.coordinates2d=n),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],n=e.node.coordinates2d[2],o=s[0]-t[0],r=n[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=o,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>c.addChild(t))),c}}},7728:(t,e,s)=>{const{squish:n,unsquish:o}=s(8136),{gameNode:r,GameNode:i}=s(3564),h=(s(2544),s(2724)),a=s(7212),l=s(9812),d=s(8268),c=s(7016),u=s(216),{terrainGenerator:f}=s(4608),y=s(8752),p=s(8688),g=s(2912),x=s(5076),E=s(3904);t.exports={squish:n,unsquish:o,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:d,Squisher:p,ShapeUtils:c,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},2912:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(2588),this.http=s(2348),this.fs=s(5376),this.crypto=s(6636),this.path=s(4700),this.process=s(2512)}getConfigValue(t,e=void 0){const s=this.getConfig();let n=process.env[t]&&`${process.env[t]}`;if(void 0!==n)return"true"===n?n=!0:"false"===n&&(n=!1),console.log(`Using environment value: ${n} for key: ${t}`),n;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),n=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,n):(await downloadFileSync(this.info.id,e),this.initialized=!0,n)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,n)=>{this.existsLocally().then((o=>{o&&!t?(this.initialized=!0,s(o)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{n(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,n)=>{s?e(s):t(n)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,n)=>{const o=this.getHash(t),r=`${e}/${o}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{n(t)}))}))}}},3948:(t,e,s)=>{const n=s(9880),o=s(2544),r=(t,e,s,r,i,h,a,l,d,c,u,f)=>{const y=new o(t,e,s,r,i,h,a,l,d,c,u,f);return n(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:n,fill:o,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:d,subtype:c,node:u,id:f}){this.node=u||r(t,e,s,n,o,i,h,a,l,d,c,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const n in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[n],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}free(){this.node.free()}}}},2724:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const n=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,o=Math.floor(Math.random()*n.length);return e[n[o]]}}},7212:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let n in s)if(e=s[n].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},3564:(t,e,s)=>{const n=s(8268),o=s(8752),{gameNode:r,BaseNode:i}=s(3948),h={[n.CIRCLE]:o.SHAPE_2D_CIRCLE,[n.POLYGON]:o.SHAPE_2D_POLYGON,[n.LINE]:o.SHAPE_2D_LINE},a={[o.SHAPE_2D_CIRCLE]:n.CIRCLE,[o.SHAPE_2D_POLYGON]:n.POLYGON,[o.SHAPE_2D_LINE]:n.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,id:c}){if(!(n&&s||d))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,subtype:h[s],id:c})}clone({handleClick:t,input:e,id:s}){const n=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:n})}}class d extends i{constructor({textInfo:t,playerIds:e,input:s,node:n,id:r}){if(!t&&!n)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:n,subtype:o.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new d({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:n})}}class c extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,subtype:o.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new c({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:n})}}const u={Asset:c,Shape:l,Text:d};t.exports={gameNode:r,GameNode:u}},2544:t=>{t.exports=class{constructor(t,e,s,n,o,r,i,h=[],a=null,l=null,d=null,c=null){this.id=c?Number(c):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=n,this.fill=o,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=d}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},8268:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},8688:(t,e,s)=>{const{squish:n,unsquish:o}=s(8136);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:n,onAssetUpdate:o}){if(this.ids=new Set,this.game=t,this.assets={},this.customBottomLayer=s,this.customTopLayer=n,this.initialize(),this.onAssetUpdate=o,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return o(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const n={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,n),s.push(t)}for(const o in t){const r=[],i=t[o],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,n),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,n),s.push(t)}return this.playerFrames=n,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},o={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=n(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0)for(let t of r)o[t]||(o[Number(t)]=[]),o[t].push(i);else Object.keys(o).forEach((t=>{o[t]||(o[Number(t)]=[]),o[t].push(i)}));for(let n=0;n<t.node.children.length;n++){const i=new Set(r);this.squishHelper(t.node.children[n],e,s,o,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const n=t[s].root;e[s]=n}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),n=this.game.constructor.metadata&&this.game.constructor.metadata(),o=n&&n.assets?n.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(o,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(o,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(o,this.game.getAssets());const r=Object.assign(s,o);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let n=0;const o=new Array(32);for(;n<32&&n<e.length;)o[n]=e.charCodeAt(n),n++;const l=(s.length+32).toString(36),d={image:1,audio:2,font:3}[r[e].info.type];let c="";for(let t=0;t<10-l.length;t++)c+="0";for(let t=l.length;t<10;t++)c+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,d,...u,...o,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let n=0;n<this.assets[s].length;n++)e[t++]=this.assets[s][n];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},9812:(t,e,s)=>{const{GameNode:n}=s(3564),o=s(8268),r=s(7016),i=s(2724),h=s(7212);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},432:(t,e,s)=>{const{GameNode:n}=s(3564);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:n.Asset,2:n.Shape,3:n.Text}}},3904:t=>{t.exports={getPath:(t,e,s,n,o=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+n;if(a<0||a>o||l<0||l>r){let t=a,e=l;a<0?t=0:a>o&&(t=o),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},8136:(t,e,s)=>{const n=s(2544),{CONSTRUCTOR_TO_TYPE:o,TYPE_TO_CONSTRUCTOR:r}=s(432),i=s(2196),{squishId:h}=s(4696),{squishColor:a}=s(8168),{squishPlayerIds:l}=s(6892),{squishPos:d}=s(1855),{squishFill:c}=s(1248),{squishSize:u}=s(1504),{squishHandleClick:f}=s(2528),{squishBorder:y}=s(3648),{squishSubType:p}=s(6256),{squishInput:g}=s(2352),{squishCoordinates2d:x}=s(9640),{squishEffect:E}=s(9916),{squishText:A}=s(128),{squishAsset:S}=s(3759),m={id:h,color:a,playerIds:l,pos:d,coordinates2d:x,fill:c,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},C={};for(const t in m)C[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const n=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const o=r[t];if(o in n){const t=n[o];if(null!=t){const r=m[o].squish(t,e,n),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[o].type,a,h,...r])}}}let h=o[t.constructor.name];h||(h=o[i[n.subType]]);const a=s.flat(),l=a.length+5,d=Math.min(255,l),c=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),c,d,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new n;for(;e<t.length;){const n=t[e],o=t[e+1]+t[e+2],r=t.slice(e+3,e+o);if(!C[n]){console.warn("Unknown sub frame type "+n);break}{const t=C[n],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=o}const o=r[t[4]];return o?new o({node:s}):{node:s}}}},3759:(t,e,s)=>{const{getFractional:n}=s(8872),o={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],o=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,d=r.startTime||0;o[0]=Math.floor(i),o[1]=n(i),o[2]=Math.floor(h),o[3]=n(h),o[4]=Math.floor(a),o[5]=n(a),o[6]=Math.floor(l),o[7]=n(l),o[8]=Math.floor(d),o[9]=n(d);for(let t=0;t<s.length;t++)o[10+t]=s.codePointAt(t);return o},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t[6]+t[7]/100,r=t[8]+t[9]/100;return{[String.fromCodePoint.apply(null,t.slice(10))]:{pos:{x:e,y:s},size:{x:n,y:o},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:o}},3648:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},8168:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},9640:(t,e,s)=>{const{getFractional:n}=s(8872),o=s(8752),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==o.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=n(t);const s=r(e.y,i[1]);let o;h[2]=s,h[3]=n(s),o=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(o),h[5]=n(o)}else{const t=i[0];h[0]=Math.floor(t),h[1]=n(t);const e=i[1];h[2]=Math.floor(e),h[3]=n(e);const s=i[2];h[4]=Math.round(s),h[5]=n(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,o=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=o,h[2*t+1]=n(o)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t[e]+t[e+1]/100;s[e/2]=n}if(e===o.SHAPE_2D_POLYGON||e===o.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},9916:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const n=new Array(s);for(let t=0;t<e.length;t++)n[t]=e.codePointAt(t);return n[e.length]=t.shadow.color[0],n[e.length+1]=t.shadow.color[1],n[e.length+2]=t.shadow.color[2],n[e.length+3]=t.shadow.color[3],t.shadow.blur&&(n[e.length+4]=Math.floor(t.shadow.blur/10),n[e.length+5]=t.shadow.blur%10),n}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let n;t.length>10&&(n=10*t[10]+t[11]);const o={[e]:{color:s}};return n&&(o[e].blur=n),o}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},1248:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},2528:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},4696:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},2352:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},6892:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},1855:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},1504:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},6256:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},128:(t,e,s)=>{const{hypLength:n}=s(8872),o=s(2724),{squishColor:r}=s(8168),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const d=t.size||1,c=e?d*n(e.x,e.y):d;l[4]=Math.floor(c),l[5]=Math.round(100*(c-Math.floor(c)));const u=t.color||o.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let n=6+f.length+2+3*[...h].length;l[n+p]=Number(s[0]),l[n+p+1]=Number(s[1]),l[n+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let n;n=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let o=6+f.length+2+3*[...h].length+3*[...a].length;l[o+g]=Number(n[0]),l[o+g+1]=Number(n[1]),l[o+g+2]=Number(n[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let d=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let n=h[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;d.push(o)}const c=String.fromCodePoint.apply(null,d);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let n=a[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;u.push(o)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let n=l[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;y.push(o)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:n,color:o,align:c,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},2196:(t,e,s)=>{const{GameNode:n}=s(3564),o=s(8752);t.exports={[[o.ASSET]]:n.Asset,[[o.TEXT]]:n.Text,[[o.SHAPE_2D_POLYGON]]:n.Shape,[[o.SHAPE_2D_CIRCLE]]:n.Shape,[[o.SHAPE_2D_LINE]]:n.Shape}},8752:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},4608:(t,e,s)=>{const{getRandomTerrain:n,getRandomStartPoint:o}=s(5832),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const d=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);n()(d,o(h,a,e),h,a,e);const c=((t,e,s,n)=>{const o=[];for(let i=0;i<s;i++)for(let s=0;s<n;s++){const n=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(o.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){o.push(...n);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(n.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(d,e,h,a);return c?i(d,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:n,height:o}=((t,e)=>{const s=t.x,n=t.y,o=e.x,r=e.y;return{width:Math.floor(s/o),height:Math.floor(n/r)}})(t,e);let r=((t,e)=>{const s=[],n={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let o=0;o<t;o++){s[o]=[];for(let r=0;r<e;r++){const i={...n};0===o?i.west=!1:o===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[o].push(i)}}return s})(n,o);const h={x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*o)};return r=i(r,h,s,n,o),r}}},5832:t=>{const e=(t,{x:e,y:s},n,o,r)=>{e<0||e>=n||s<0||s>=o||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s+1,y:n+1},o,r,i)):1===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i)):2===h?(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n-1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n-1},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s,y:n+3},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+3,y:n},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-3,y:n},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s,y:n-3},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s+1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+2,y:n-1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n+1},o,r,i),e(t,{x:s+2,y:n+1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n-1},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const n={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;n.x===s.x&&n.y===s.y;)n.x=Math.floor(Math.random()*t),n.y=Math.floor(Math.random()*e);return n}}},5076:t=>{const e=(t,s,n,o=[])=>{if(!n||n(t)&&t.node.id!==s.node.id){const e=t.node.text,n=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=n[0][0],h=n[1][0],a=r[0][0],l=r[1][0],d=n[0][1],c=n[2][1],u=r[0][1],f=r[2][1];l<i||h<a||d>f||u>c||o.push(t)}for(const r in t.node.children)e(t.node.children[r],s,n,o);return o};t.exports={checkCollisions:(t,s,n=null)=>e(t,s,n)}},8872:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},9880:t=>{t.exports=function(t,e){const s={get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,n){const o=Reflect.defineProperty(t,s,n);return e&&e(),o},deleteProperty(t,s){const n=Reflect.deleteProperty(t,s);return e&&e(),n}},n=Proxy.revocable(t,s);return t.free=()=>{n.revoke()},n.proxy}},7016:t=>{t.exports={triangle:(t,e,s,n,o,r)=>[[t,e],[s,n],[o,r],[t,e]],rectangle:(t,e,s,n)=>[[t,e],[t+s,e],[t+s,e+n],[t,e+n],[t,e]]}},216:(t,e,s)=>{const{GameNode:n}=s(3564),o=s(8268),r=s(7016),i=s(5076),h=s(2724);t.exports={getView:(t,e,s,a={},l={})=>{const d=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),c=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return d.length>0&&d.forEach((t=>{const n=[],o=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in o){const r=o[s],i=r[0],h=r[1];let d=Math.max(Math.min(i-e.x,100),0),c=Math.max(Math.min(h-e.y,100),0);d=(l.x||1)*d,c=(l.y||1)*c,(!a.filter||a.filter(t))&&(a.x&&(d+=a.x),a.y&&(c+=a.y)),d<0?d=0:d>100&&(d=100),c<0?c=0:c>100&&(c=100),n.push([d,c])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(n&&n.length&&(e.node.text&&(e.node.text.x=n[0][0],e.node.text.y=n[0][1]),n.length&&(e.node.coordinates2d=n),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],n=e.node.coordinates2d[2],o=s[0]-t[0],r=n[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=o,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>c.addChild(t))),c}}},4328:(t,e,s)=>{const{squish:n,unsquish:o}=s(1307),{gameNode:r,GameNode:i}=s(4412),h=(s(3624),s(4772)),a=s(2664),l=s(8116),d=s(3208),c=s(9500),u=s(2980),{terrainGenerator:f}=s(5104),y=s(4384),p=s(5921),g=s(3587),x=s(5088),E=s(440);t.exports={squish:n,unsquish:o,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:d,Squisher:p,ShapeUtils:c,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},3587:(t,e,s)=>{t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(6032),this.http=s(1528),this.fs=s(179),this.crypto=s(4352),this.path=s(6128),this.process=s(7444)}getConfigValue(t,e=void 0){const s=this.getConfig();let n=process.env[t]&&`${process.env[t]}`;if(void 0!==n)return"true"===n?n=!0:"false"===n&&(n=!1),console.log(`Using environment value: ${n} for key: ${t}`),n;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){return`${this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`)}/${this.getHash(this.info.id)}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),n=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,n):(await downloadFileSync(this.info.id,e),this.initialized=!0,n)}download(t){const e=this.getConfigValue("HG_ASSET_PATH",`${process.cwd()}/.asset_cache`);return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,n)=>{this.existsLocally().then((o=>{o&&!t?(this.initialized=!0,s(o)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{n(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,n)=>{s?e(s):t(n)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,n)=>{const o=this.getHash(t),r=`${e}/${o}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{n(t)}))}))}}},4260:(t,e,s)=>{const n=s(6620),o=s(3624),r=(t,e,s,r,i,h,a,l,d,c,u,f)=>{const y=new o(t,e,s,r,i,h,a,l,d,c,u,f);return n(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:n,fill:o,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:d,subtype:c,node:u,id:f}){this.node=u||r(t,e,s,n,o,i,h,a,l,d,c,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const n in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[n],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}free(){this.node.free()}}}},4772:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const n=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,o=Math.floor(Math.random()*n.length);return e[n[o]]}}},2664:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let n in s)if(e=s[n].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},4412:(t,e,s)=>{const n=s(3208),o=s(4384),{gameNode:r,BaseNode:i}=s(4260),h={[n.CIRCLE]:o.SHAPE_2D_CIRCLE,[n.POLYGON]:o.SHAPE_2D_POLYGON,[n.LINE]:o.SHAPE_2D_LINE},a={[o.SHAPE_2D_CIRCLE]:n.CIRCLE,[o.SHAPE_2D_POLYGON]:n.POLYGON,[o.SHAPE_2D_LINE]:n.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,id:c}){if(!(n&&s||d))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,subtype:h[s],id:c})}clone({handleClick:t,input:e,id:s}){const n=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:n})}}class d extends i{constructor({textInfo:t,playerIds:e,input:s,node:n,id:r}){if(!t&&!n)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:n,subtype:o.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new d({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:n})}}class c extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,subtype:o.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new c({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:n})}}const u={Asset:c,Shape:l,Text:d};t.exports={gameNode:r,GameNode:u}},3624:t=>{t.exports=class{constructor(t,e,s,n,o,r,i,h=[],a=null,l=null,d=null,c=null){this.id=c?Number(c):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=n,this.fill=o,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=d}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},3208:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},5921:(t,e,s)=>{const{squish:n,unsquish:o}=s(1307);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:n,onAssetUpdate:o}){if(this.ids=new Set,this.game=t,this.gameMetadata=t.constructor.metadata&&t.constructor.metadata(),this.assets={},this.customBottomLayer=s,this.customTopLayer=n,this.initialize(),this.onAssetUpdate=o,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return o(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const n={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,n),s.push(t)}for(const o in t){const r=[],i=t[o],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,n),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,n),s.push(t)}return this.playerFrames=n,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},r={},i=new Set){t.node.listeners.has(this)||t.addListener(this);const h=n(t,s);if(e.push(h),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>i.add(t))),i.size>0){let e=new Set;for(let s of i)r[s]||(r[Number(s)]=[]),0===t.node.playerIds.length||t.node.playerIds.findIndex((t=>Number(t)===Number(s)))>=0?r[s].push(h):e.add(s);for(let t of e)i.delete(t)}else Object.keys(r).forEach((t=>{r[t]||(r[Number(t)]=[]),r[t].push(h)}));for(let n=0;n<t.node.children.length;n++){const o=new Set(i);this.squishHelper(t.node.children[n],e,s,r,o)}for(let t in r)for(let e in r[t]){const s=o(r[t][e]);if(s.node.playerIds.length>0&&s.node.playerIds.findIndex((e=>Number(e)===Number(t)))<0&&(console.log(s.node.playerIds),console.log(t),console.log(s.node.playerIds.indexOf(t)),254!=t))throw new Error("fuk")}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const n=t[s].root;e[s]=n}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),n=this.game.constructor.metadata&&this.game.constructor.metadata(),o=n&&n.assets?n.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(o,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(o,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(o,this.game.getAssets());const r=Object.assign(s,o);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let n=0;const o=new Array(32);for(;n<32&&n<e.length;)o[n]=e.charCodeAt(n),n++;const l=(s.length+32).toString(36),d={image:1,audio:2,font:3}[r[e].info.type];let c="";for(let t=0;t<10-l.length;t++)c+="0";for(let t=l.length;t<10;t++)c+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,d,...u,...o,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let n=0;n<this.assets[s].length;n++)e[t++]=this.assets[s][n];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},8116:(t,e,s)=>{const{GameNode:n}=s(4412),o=s(3208),r=s(9500),i=s(4772),h=s(2664);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},8720:(t,e,s)=>{const{GameNode:n}=s(4412);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:n.Asset,2:n.Shape,3:n.Text}}},440:t=>{t.exports={getPath:(t,e,s,n,o=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+n;if(a<0||a>o||l<0||l>r){let t=a,e=l;a<0?t=0:a>o&&(t=o),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},1307:(t,e,s)=>{const n=s(3624),{CONSTRUCTOR_TO_TYPE:o,TYPE_TO_CONSTRUCTOR:r}=s(8720),i=s(9508),{squishId:h}=s(752),{squishColor:a}=s(6692),{squishPlayerIds:l}=s(6532),{squishPos:d}=s(5408),{squishFill:c}=s(3860),{squishSize:u}=s(2507),{squishHandleClick:f}=s(299),{squishBorder:y}=s(8384),{squishSubType:p}=s(9443),{squishInput:g}=s(5864),{squishCoordinates2d:x}=s(3188),{squishEffect:E}=s(9532),{squishText:A}=s(2596),{squishAsset:S}=s(5012),m={id:h,color:a,playerIds:l,pos:d,coordinates2d:x,fill:c,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},C={};for(const t in m)C[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const n=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const o=r[t];if(o in n){const t=n[o];if(null!=t){const r=m[o].squish(t,e,n),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[o].type,a,h,...r])}}}let h=o[t.constructor.name];h||(h=o[i[n.subType]]);const a=s.flat(),l=a.length+5,d=Math.min(255,l),c=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),c,d,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new n;for(;e<t.length;){const n=t[e],o=t[e+1]+t[e+2],r=t.slice(e+3,e+o);if(!C[n]){console.warn("Unknown sub frame type "+n);break}{const t=C[n],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=o}const o=r[t[4]];return o?new o({node:s}):{node:s}}}},5012:(t,e,s)=>{const{getFractional:n}=s(5060),o={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],o=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,d=r.startTime||0;o[0]=Math.floor(i),o[1]=n(i),o[2]=Math.floor(h),o[3]=n(h),o[4]=Math.floor(a),o[5]=n(a),o[6]=Math.floor(l),o[7]=n(l),o[8]=Math.floor(d),o[9]=n(d);for(let t=0;t<s.length;t++)o[10+t]=s.codePointAt(t);return o},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t[6]+t[7]/100,r=t[8]+t[9]/100;return{[String.fromCodePoint.apply(null,t.slice(10))]:{pos:{x:e,y:s},size:{x:n,y:o},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:o}},8384:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},6692:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},3188:(t,e,s)=>{const{getFractional:n}=s(5060),o=s(4384),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==o.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=n(t);const s=r(e.y,i[1]);let o;h[2]=s,h[3]=n(s),o=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(o),h[5]=n(o)}else{const t=i[0];h[0]=Math.floor(t),h[1]=n(t);const e=i[1];h[2]=Math.floor(e),h[3]=n(e);const s=i[2];h[4]=Math.round(s),h[5]=n(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,o=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=o,h[2*t+1]=n(o)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t[e]+t[e+1]/100;s[e/2]=n}if(e===o.SHAPE_2D_POLYGON||e===o.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},9532:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const n=new Array(s);for(let t=0;t<e.length;t++)n[t]=e.codePointAt(t);return n[e.length]=t.shadow.color[0],n[e.length+1]=t.shadow.color[1],n[e.length+2]=t.shadow.color[2],n[e.length+3]=t.shadow.color[3],t.shadow.blur&&(n[e.length+4]=Math.floor(t.shadow.blur/10),n[e.length+5]=t.shadow.blur%10),n}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let n;t.length>10&&(n=10*t[10]+t[11]);const o={[e]:{color:s}};return n&&(o[e].blur=n),o}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},3860:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},299:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},752:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},5864:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},6532:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},5408:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},2507:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},9443:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},2596:(t,e,s)=>{const{hypLength:n}=s(5060),o=s(4772),{squishColor:r}=s(6692),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const d=t.size||1,c=e?d*n(e.x,e.y):d;l[4]=Math.floor(c),l[5]=Math.round(100*(c-Math.floor(c)));const u=t.color||o.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let n=6+f.length+2+3*[...h].length;l[n+p]=Number(s[0]),l[n+p+1]=Number(s[1]),l[n+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let n;n=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let o=6+f.length+2+3*[...h].length+3*[...a].length;l[o+g]=Number(n[0]),l[o+g+1]=Number(n[1]),l[o+g+2]=Number(n[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let d=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let n=h[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;d.push(o)}const c=String.fromCodePoint.apply(null,d);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let n=a[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;u.push(o)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let n=l[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;y.push(o)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:n,color:o,align:c,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},9508:(t,e,s)=>{const{GameNode:n}=s(4412),o=s(4384);t.exports={[[o.ASSET]]:n.Asset,[[o.TEXT]]:n.Text,[[o.SHAPE_2D_POLYGON]]:n.Shape,[[o.SHAPE_2D_CIRCLE]]:n.Shape,[[o.SHAPE_2D_LINE]]:n.Shape}},4384:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},5104:(t,e,s)=>{const{getRandomTerrain:n,getRandomStartPoint:o}=s(7256),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const d=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);n()(d,o(h,a,e),h,a,e);const c=((t,e,s,n)=>{const o=[];for(let i=0;i<s;i++)for(let s=0;s<n;s++){const n=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(o.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){o.push(...n);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(n.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(d,e,h,a);return c?i(d,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:n,height:o}=((t,e)=>{const s=t.x,n=t.y,o=e.x,r=e.y;return{width:Math.floor(s/o),height:Math.floor(n/r)}})(t,e);let r=((t,e)=>{const s=[],n={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let o=0;o<t;o++){s[o]=[];for(let r=0;r<e;r++){const i={...n};0===o?i.west=!1:o===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[o].push(i)}}return s})(n,o);const h={x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*o)};return r=i(r,h,s,n,o),r}}},7256:t=>{const e=(t,{x:e,y:s},n,o,r)=>{e<0||e>=n||s<0||s>=o||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s+1,y:n+1},o,r,i)):1===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i)):2===h?(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n-1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n-1},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s,y:n+3},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+3,y:n},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-3,y:n},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s,y:n-3},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s+1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+2,y:n-1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n+1},o,r,i),e(t,{x:s+2,y:n+1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n-1},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const n={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;n.x===s.x&&n.y===s.y;)n.x=Math.floor(Math.random()*t),n.y=Math.floor(Math.random()*e);return n}}},5088:t=>{const e=(t,s,n,o=[])=>{if(!n||n(t)&&t.node.id!==s.node.id){const e=t.node.text,n=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=n[0][0],h=n[1][0],a=r[0][0],l=r[1][0],d=n[0][1],c=n[2][1],u=r[0][1],f=r[2][1];l<i||h<a||d>f||u>c||o.push(t)}for(const r in t.node.children)e(t.node.children[r],s,n,o);return o};t.exports={checkCollisions:(t,s,n=null)=>e(t,s,n)}},5060:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},6620:t=>{t.exports=function(t,e){const s={get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,n){const o=Reflect.defineProperty(t,s,n);return e&&e(),o},deleteProperty(t,s){const n=Reflect.deleteProperty(t,s);return e&&e(),n}},n=Proxy.revocable(t,s);return t.free=()=>{n.revoke()},n.proxy}},9500:t=>{t.exports={triangle:(t,e,s,n,o,r)=>[[t,e],[s,n],[o,r],[t,e]],rectangle:(t,e,s,n)=>[[t,e],[t+s,e],[t+s,e+n],[t,e+n],[t,e]]}},2980:(t,e,s)=>{const{GameNode:n}=s(4412),o=s(3208),r=s(9500),i=s(5088),h=s(4772);t.exports={getView:(t,e,s,a={},l={})=>{const d=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),c=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return d.length>0&&d.forEach((t=>{const n=[],o=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in o){const r=o[s],i=r[0],h=r[1];let d=Math.max(Math.min(i-e.x,100),0),c=Math.max(Math.min(h-e.y,100),0);d=(l.x||1)*d,c=(l.y||1)*c,(!a.filter||a.filter(t))&&(a.x&&(d+=a.x),a.y&&(c+=a.y)),d<0?d=0:d>100&&(d=100),c<0?c=0:c>100&&(c=100),n.push([d,c])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(n&&n.length&&(e.node.text&&(e.node.text.x=n[0][0],e.node.text.y=n[0][1]),n.length&&(e.node.coordinates2d=n),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],n=e.node.coordinates2d[2],o=s[0]-t[0],r=n[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=o,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>c.addChild(t))),c}}},9148:(t,e,s)=>{const{squish:n,unsquish:o}=s(4904),{gameNode:r,GameNode:i}=s(1608),h=(s(2548),s(6232)),a=s(2384),l=s(9948),d=s(9576),c=s(2735),u=s(152),{terrainGenerator:f}=s(1388),y=s(2935),p=s(1404),g=s(4568),x=s(392),E=s(1728);t.exports={squish:n,unsquish:o,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:d,Squisher:p,ShapeUtils:c,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},4568:(t,e,s)=>{const n=s(1268),{getAppDataPath:o}=s(5624);t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(8371),this.http=s(1272),this.fs=s(1508),this.crypto=s(596),this.path=s(1268),this.process=s(5712)}getConfigValue(t,e=void 0){const s=this.getConfig();let n=process.env[t]&&`${process.env[t]}`;if(void 0!==n)return"true"===n?n=!0:"false"===n&&(n=!1),console.log(`Using environment value: ${n} for key: ${t}`),n;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){const t=this.getHash(this.info.id);return`${n.join(o(),"asset-cache")}/${t}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=n.join(o(),"asset-cache");fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),r=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,r):(await downloadFileSync(this.info.id,e),this.initialized=!0,r)}download(t){const e=n.join(o(),"asset-cache");return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,n)=>{this.existsLocally().then((o=>{o&&!t?(this.initialized=!0,s(o)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{n(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,n)=>{s?e(s):t(n)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,n)=>{const o=this.getHash(t),r=`${e}/${o}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{n(t)}))}))}}},5720:(t,e,s)=>{const n=s(7680),o=s(2548),r=(t,e,s,r,i,h,a,l,d,c,u,f)=>{const y=new o(t,e,s,r,i,h,a,l,d,c,u,f);return n(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:n,fill:o,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:d,subtype:c,node:u,id:f}){this.node=u||r(t,e,s,n,o,i,h,a,l,d,c,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const n in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[n],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}free(){this.node.free()}}}},6232:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const n=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,o=Math.floor(Math.random()*n.length);return e[n[o]]}}},2384:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let n in s)if(e=s[n].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},1608:(t,e,s)=>{const n=s(9576),o=s(2935),{gameNode:r,BaseNode:i}=s(5720),h={[n.CIRCLE]:o.SHAPE_2D_CIRCLE,[n.POLYGON]:o.SHAPE_2D_POLYGON,[n.LINE]:o.SHAPE_2D_LINE},a={[o.SHAPE_2D_CIRCLE]:n.CIRCLE,[o.SHAPE_2D_POLYGON]:n.POLYGON,[o.SHAPE_2D_LINE]:n.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,id:c}){if(!(n&&s||d))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,subtype:h[s],id:c})}clone({handleClick:t,input:e,id:s}){const n=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:n})}}class d extends i{constructor({textInfo:t,playerIds:e,input:s,node:n,id:r}){if(!t&&!n)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:n,subtype:o.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new d({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:n})}}class c extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,subtype:o.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new c({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:n})}}const u={Asset:c,Shape:l,Text:d};t.exports={gameNode:r,GameNode:u}},2548:t=>{t.exports=class{constructor(t,e,s,n,o,r,i,h=[],a=null,l=null,d=null,c=null){this.id=c?Number(c):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=n,this.fill=o,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=d}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},9576:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},1404:(t,e,s)=>{const{squish:n,unsquish:o}=s(4904);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:n,onAssetUpdate:o}){if(this.ids=new Set,this.game=t,this.gameMetadata=t.constructor.metadata&&t.constructor.metadata(),this.assets={},this.customBottomLayer=s,this.customTopLayer=n,this.initialize(),this.onAssetUpdate=o,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return o(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const n={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,n),s.push(t)}for(const o in t){const r=[],i=t[o],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,n),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,n),s.push(t)}return this.playerFrames=n,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},r={},i=new Set){t.node.listeners.has(this)||t.addListener(this);const h=n(t,s);if(e.push(h),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>i.add(t))),i.size>0){let e=new Set;for(let s of i)r[s]||(r[Number(s)]=[]),0===t.node.playerIds.length||t.node.playerIds.findIndex((t=>Number(t)===Number(s)))>=0?r[s].push(h):e.add(s);for(let t of e)i.delete(t)}else Object.keys(r).forEach((t=>{r[t]||(r[Number(t)]=[]),r[t].push(h)}));for(let n=0;n<t.node.children.length;n++){const o=new Set(i);this.squishHelper(t.node.children[n],e,s,r,o)}for(let t in r)for(let e in r[t]){const s=o(r[t][e]);if(s.node.playerIds.length>0&&s.node.playerIds.findIndex((e=>Number(e)===Number(t)))<0&&(console.log(s.node.playerIds),console.log(t),console.log(s.node.playerIds.indexOf(t)),254!=t))throw new Error("fuk")}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const n=t[s].root;e[s]=n}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),n=this.game.constructor.metadata&&this.game.constructor.metadata(),o=n&&n.assets?n.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(o,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(o,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(o,this.game.getAssets());const r=Object.assign(s,o);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let n=0;const o=new Array(32);for(;n<32&&n<e.length;)o[n]=e.charCodeAt(n),n++;const l=(s.length+32).toString(36),d={image:1,audio:2,font:3}[r[e].info.type];let c="";for(let t=0;t<10-l.length;t++)c+="0";for(let t=l.length;t<10;t++)c+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,d,...u,...o,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let n=0;n<this.assets[s].length;n++)e[t++]=this.assets[s][n];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},9948:(t,e,s)=>{const{GameNode:n}=s(1608),o=s(9576),r=s(2735),i=s(6232),h=s(2384);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},5880:(t,e,s)=>{const{GameNode:n}=s(1608);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:n.Asset,2:n.Shape,3:n.Text}}},1728:t=>{t.exports={getPath:(t,e,s,n,o=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+n;if(a<0||a>o||l<0||l>r){let t=a,e=l;a<0?t=0:a>o&&(t=o),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},4904:(t,e,s)=>{const n=s(2548),{CONSTRUCTOR_TO_TYPE:o,TYPE_TO_CONSTRUCTOR:r}=s(5880),i=s(4991),{squishId:h}=s(9973),{squishColor:a}=s(9160),{squishPlayerIds:l}=s(5828),{squishPos:d}=s(5164),{squishFill:c}=s(8264),{squishSize:u}=s(2712),{squishHandleClick:f}=s(2552),{squishBorder:y}=s(7876),{squishSubType:p}=s(364),{squishInput:g}=s(3260),{squishCoordinates2d:x}=s(4244),{squishEffect:E}=s(5656),{squishText:A}=s(8140),{squishAsset:S}=s(7376),m={id:h,color:a,playerIds:l,pos:d,coordinates2d:x,fill:c,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},C={};for(const t in m)C[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const n=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const o=r[t];if(o in n){const t=n[o];if(null!=t){const r=m[o].squish(t,e,n),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[o].type,a,h,...r])}}}let h=o[t.constructor.name];h||(h=o[i[n.subType]]);const a=s.flat(),l=a.length+5,d=Math.min(255,l),c=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),c,d,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new n;for(;e<t.length;){const n=t[e],o=t[e+1]+t[e+2],r=t.slice(e+3,e+o);if(!C[n]){console.warn("Unknown sub frame type "+n);break}{const t=C[n],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=o}const o=r[t[4]];return o?new o({node:s}):{node:s}}}},7376:(t,e,s)=>{const{getFractional:n}=s(9448),o={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],o=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,d=r.startTime||0;o[0]=Math.floor(i),o[1]=n(i),o[2]=Math.floor(h),o[3]=n(h),o[4]=Math.floor(a),o[5]=n(a),o[6]=Math.floor(l),o[7]=n(l),o[8]=Math.floor(d),o[9]=n(d);for(let t=0;t<s.length;t++)o[10+t]=s.codePointAt(t);return o},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t[6]+t[7]/100,r=t[8]+t[9]/100;return{[String.fromCodePoint.apply(null,t.slice(10))]:{pos:{x:e,y:s},size:{x:n,y:o},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:o}},7876:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},9160:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},4244:(t,e,s)=>{const{getFractional:n}=s(9448),o=s(2935),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==o.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=n(t);const s=r(e.y,i[1]);let o;h[2]=s,h[3]=n(s),o=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(o),h[5]=n(o)}else{const t=i[0];h[0]=Math.floor(t),h[1]=n(t);const e=i[1];h[2]=Math.floor(e),h[3]=n(e);const s=i[2];h[4]=Math.round(s),h[5]=n(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,o=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=o,h[2*t+1]=n(o)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t[e]+t[e+1]/100;s[e/2]=n}if(e===o.SHAPE_2D_POLYGON||e===o.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},5656:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const n=new Array(s);for(let t=0;t<e.length;t++)n[t]=e.codePointAt(t);return n[e.length]=t.shadow.color[0],n[e.length+1]=t.shadow.color[1],n[e.length+2]=t.shadow.color[2],n[e.length+3]=t.shadow.color[3],t.shadow.blur&&(n[e.length+4]=Math.floor(t.shadow.blur/10),n[e.length+5]=t.shadow.blur%10),n}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let n;t.length>10&&(n=10*t[10]+t[11]);const o={[e]:{color:s}};return n&&(o[e].blur=n),o}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},8264:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},2552:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},9973:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},3260:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},5828:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},5164:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},2712:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},364:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},8140:(t,e,s)=>{const{hypLength:n}=s(9448),o=s(6232),{squishColor:r}=s(9160),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const d=t.size||1,c=e?d*n(e.x,e.y):d;l[4]=Math.floor(c),l[5]=Math.round(100*(c-Math.floor(c)));const u=t.color||o.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let n=6+f.length+2+3*[...h].length;l[n+p]=Number(s[0]),l[n+p+1]=Number(s[1]),l[n+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let n;n=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let o=6+f.length+2+3*[...h].length+3*[...a].length;l[o+g]=Number(n[0]),l[o+g+1]=Number(n[1]),l[o+g+2]=Number(n[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let d=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let n=h[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;d.push(o)}const c=String.fromCodePoint.apply(null,d);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let n=a[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;u.push(o)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let n=l[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;y.push(o)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:n,color:o,align:c,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},4991:(t,e,s)=>{const{GameNode:n}=s(1608),o=s(2935);t.exports={[[o.ASSET]]:n.Asset,[[o.TEXT]]:n.Text,[[o.SHAPE_2D_POLYGON]]:n.Shape,[[o.SHAPE_2D_CIRCLE]]:n.Shape,[[o.SHAPE_2D_LINE]]:n.Shape}},2935:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},1388:(t,e,s)=>{const{getRandomTerrain:n,getRandomStartPoint:o}=s(7383),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const d=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);n()(d,o(h,a,e),h,a,e);const c=((t,e,s,n)=>{const o=[];for(let i=0;i<s;i++)for(let s=0;s<n;s++){const n=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(o.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){o.push(...n);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(n.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(d,e,h,a);return c?i(d,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:n,height:o}=((t,e)=>{const s=t.x,n=t.y,o=e.x,r=e.y;return{width:Math.floor(s/o),height:Math.floor(n/r)}})(t,e);let r=((t,e)=>{const s=[],n={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let o=0;o<t;o++){s[o]=[];for(let r=0;r<e;r++){const i={...n};0===o?i.west=!1:o===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[o].push(i)}}return s})(n,o);const h={x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*o)};return r=i(r,h,s,n,o),r}}},7383:t=>{const e=(t,{x:e,y:s},n,o,r)=>{e<0||e>=n||s<0||s>=o||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s+1,y:n+1},o,r,i)):1===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i)):2===h?(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n-1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n-1},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s,y:n+3},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+3,y:n},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-3,y:n},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s,y:n-3},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s+1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+2,y:n-1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n+1},o,r,i),e(t,{x:s+2,y:n+1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n-1},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const n={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;n.x===s.x&&n.y===s.y;)n.x=Math.floor(Math.random()*t),n.y=Math.floor(Math.random()*e);return n}}},392:t=>{const e=(t,s,n,o=[])=>{if(!n||n(t)&&t.node.id!==s.node.id){const e=t.node.text,n=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=n[0][0],h=n[1][0],a=r[0][0],l=r[1][0],d=n[0][1],c=n[2][1],u=r[0][1],f=r[2][1];l<i||h<a||d>f||u>c||o.push(t)}for(const r in t.node.children)e(t.node.children[r],s,n,o);return o};t.exports={checkCollisions:(t,s,n=null)=>e(t,s,n)}},9448:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},7680:t=>{t.exports=function(t,e){const s={get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,n){const o=Reflect.defineProperty(t,s,n);return e&&e(),o},deleteProperty(t,s){const n=Reflect.deleteProperty(t,s);return e&&e(),n}},n=Proxy.revocable(t,s);return t.free=()=>{n.revoke()},n.proxy}},2735:t=>{t.exports={triangle:(t,e,s,n,o,r)=>[[t,e],[s,n],[o,r],[t,e]],rectangle:(t,e,s,n)=>[[t,e],[t+s,e],[t+s,e+n],[t,e+n],[t,e]]}},152:(t,e,s)=>{const{GameNode:n}=s(1608),o=s(9576),r=s(2735),i=s(392),h=s(6232);t.exports={getView:(t,e,s,a={},l={})=>{const d=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),c=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return d.length>0&&d.forEach((t=>{const n=[],o=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in o){const r=o[s],i=r[0],h=r[1];let d=Math.max(Math.min(i-e.x,100),0),c=Math.max(Math.min(h-e.y,100),0);d=(l.x||1)*d,c=(l.y||1)*c,(!a.filter||a.filter(t))&&(a.x&&(d+=a.x),a.y&&(c+=a.y)),d<0?d=0:d>100&&(d=100),c<0?c=0:c>100&&(c=100),n.push([d,c])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(n&&n.length&&(e.node.text&&(e.node.text.x=n[0][0],e.node.text.y=n[0][1]),n.length&&(e.node.coordinates2d=n),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],n=e.node.coordinates2d[2],o=s[0]-t[0],r=n[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=o,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>c.addChild(t))),c}}},5624:(t,e,s)=>{const n=s(1268);t.exports={getAppDataPath:()=>{if(!process)return"";switch(process.platform){case"darwin":return n.join(process.env.HOME,"Library","Application Support","homegames");case"win32":return n.join(process.env.APPDATA,"homegames");case"linux":return n.join(process.env.HOME,".homegames");default:console.log("Unsupported platform!"),process.exit(1)}}}},9191:(t,e,s)=>{const{squish:n,unsquish:o}=s(268),{gameNode:r,GameNode:i}=s(2032),h=(s(1040),s(360)),a=s(320),l=s(3754),d=s(9912),c=s(7684),u=s(6428),{terrainGenerator:f}=s(9060),y=s(3536),p=s(5512),g=s(7312),x=s(5792),E=s(1136);t.exports={squish:n,unsquish:o,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:d,Squisher:p,ShapeUtils:c,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},7312:(t,e,s)=>{const n=s(916),{getAppDataPath:o}=s(608);t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(5380),this.http=s(8776),this.fs=s(5740),this.crypto=s(7748),this.path=s(916),this.process=s(512)}getConfigValue(t,e=void 0){const s=this.getConfig();let n=process.env[t]&&`${process.env[t]}`;if(void 0!==n)return"true"===n?n=!0:"false"===n&&(n=!1),console.log(`Using environment value: ${n} for key: ${t}`),n;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){const t=this.getHash(this.info.id);return`${n.join(o(),"asset-cache")}/${t}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=n.join(o(),"asset-cache");fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),r=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,r):(await downloadFileSync(this.info.id,e),this.initialized=!0,r)}download(t){const e=n.join(o(),"asset-cache");return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,n)=>{this.existsLocally().then((o=>{o&&!t?(this.initialized=!0,s(o)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{n(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,n)=>{s?e(s):t(n)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,n)=>{const o=this.getHash(t),r=`${e}/${o}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{n(t)}))}))}}},2170:(t,e,s)=>{const n=s(9464),o=s(1040),r=(t,e,s,r,i,h,a,l,d,c,u,f)=>{const y=new o(t,e,s,r,i,h,a,l,d,c,u,f);return n(y,y.onStateChange.bind(y))};t.exports={gameNode:r,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:n,fill:o,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:d,subtype:c,node:u,id:f}){this.node=u||r(t,e,s,n,o,i,h,a,l,d,c,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t){this.node.addChild(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}getChildren(){return this.node.children}removeChild(t){this.node.removeChild(t)}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const n in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[n],s)}return s}clearChildren(t){this.node.clearChildren(t)}clone(){throw new Error("Clone not implemented")}free(){this.node.free()}}}},360:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const n=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,o=Math.floor(Math.random()*n.length);return e[n[o]]}}},320:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let n in s)if(e=s[n].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},2032:(t,e,s)=>{const n=s(9912),o=s(3536),{gameNode:r,BaseNode:i}=s(2170),h={[n.CIRCLE]:o.SHAPE_2D_CIRCLE,[n.POLYGON]:o.SHAPE_2D_POLYGON,[n.LINE]:o.SHAPE_2D_LINE},a={[o.SHAPE_2D_CIRCLE]:n.CIRCLE,[o.SHAPE_2D_POLYGON]:n.POLYGON,[o.SHAPE_2D_LINE]:n.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,id:c}){if(!(n&&s||d))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,subtype:h[s],id:c})}clone({handleClick:t,input:e,id:s}){const n=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:n})}}class d extends i{constructor({textInfo:t,playerIds:e,input:s,node:n,id:r}){if(!t&&!n)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:n,subtype:o.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new d({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:n})}}class c extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,subtype:o.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new c({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:n})}}const u={Asset:c,Shape:l,Text:d};t.exports={gameNode:r,GameNode:u}},1040:t=>{t.exports=class{constructor(t,e,s,n,o,r,i,h=[],a=null,l=null,d=null,c=null){this.id=c?Number(c):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=n,this.fill=o,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=d}addChild(t){this.children.push(t),this.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1),this.id=this.id)}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},9912:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},5512:(t,e,s)=>{const{squish:n,unsquish:o}=s(268);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:n,onAssetUpdate:o}){if(this.ids=new Set,this.game=t,this.gameMetadata=t.constructor.metadata&&t.constructor.metadata(),this.assets={},this.customBottomLayer=s,this.customTopLayer=n,this.initialize(),this.onAssetUpdate=o,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return o(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const n={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,n),s.push(t)}for(const o in t){const r=[],i=t[o],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,n),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,n),s.push(t)}return this.playerFrames=n,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},o={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=n(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0){let e=new Set;for(let s of r)o[s]||(o[Number(s)]=[]),0===t.node.playerIds.length||t.node.playerIds.findIndex((t=>Number(t)===Number(s)))>=0?o[s].push(i):e.add(s);for(let t of e)r.delete(t)}else Object.keys(o).forEach((t=>{o[t]||(o[Number(t)]=[]),o[t].push(i)}));for(let n=0;n<t.node.children.length;n++){const i=new Set(r);this.squishHelper(t.node.children[n],e,s,o,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const n=t[s].root;e[s]=n}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),n=this.game.constructor.metadata&&this.game.constructor.metadata(),o=n&&n.assets?n.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(o,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(o,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(o,this.game.getAssets());const r=Object.assign(s,o);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let n=0;const o=new Array(32);for(;n<32&&n<e.length;)o[n]=e.charCodeAt(n),n++;const l=(s.length+32).toString(36),d={image:1,audio:2,font:3}[r[e].info.type];let c="";for(let t=0;t<10-l.length;t++)c+="0";for(let t=l.length;t<10;t++)c+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,d,...u,...o,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let n=0;n<this.assets[s].length;n++)e[t++]=this.assets[s][n];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},3754:(t,e,s)=>{const{GameNode:n}=s(2032),o=s(9912),r=s(7684),i=s(360),h=s(320);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},1184:(t,e,s)=>{const{GameNode:n}=s(2032);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:n.Asset,2:n.Shape,3:n.Text}}},1136:t=>{t.exports={getPath:(t,e,s,n,o=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+n;if(a<0||a>o||l<0||l>r){let t=a,e=l;a<0?t=0:a>o&&(t=o),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},268:(t,e,s)=>{const n=s(1040),{CONSTRUCTOR_TO_TYPE:o,TYPE_TO_CONSTRUCTOR:r}=s(1184),i=s(3168),{squishId:h}=s(2772),{squishColor:a}=s(8024),{squishPlayerIds:l}=s(8992),{squishPos:d}=s(6604),{squishFill:c}=s(4224),{squishSize:u}=s(3124),{squishHandleClick:f}=s(6016),{squishBorder:y}=s(3216),{squishSubType:p}=s(7524),{squishInput:g}=s(5736),{squishCoordinates2d:x}=s(2308),{squishEffect:E}=s(2076),{squishText:A}=s(4508),{squishAsset:S}=s(9296),m={id:h,color:a,playerIds:l,pos:d,coordinates2d:x,fill:c,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},C={};for(const t in m)C[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const n=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const o=r[t];if(o in n){const t=n[o];if(null!=t){const r=m[o].squish(t,e,n),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[o].type,a,h,...r])}}}let h=o[t.constructor.name];h||(h=o[i[n.subType]]);const a=s.flat(),l=a.length+5,d=Math.min(255,l),c=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),c,d,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new n;for(;e<t.length;){const n=t[e],o=t[e+1]+t[e+2],r=t.slice(e+3,e+o);if(!C[n]){console.warn("Unknown sub frame type "+n);break}{const t=C[n],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=o}const o=r[t[4]];return o?new o({node:s}):{node:s}}}},9296:(t,e,s)=>{const{getFractional:n}=s(2932),o={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],o=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,d=r.startTime||0;o[0]=Math.floor(i),o[1]=n(i),o[2]=Math.floor(h),o[3]=n(h),o[4]=Math.floor(a),o[5]=n(a),o[6]=Math.floor(l),o[7]=n(l),o[8]=Math.floor(d),o[9]=n(d);for(let t=0;t<s.length;t++)o[10+t]=s.codePointAt(t);return o},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t[6]+t[7]/100,r=t[8]+t[9]/100;return{[String.fromCodePoint.apply(null,t.slice(10))]:{pos:{x:e,y:s},size:{x:n,y:o},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:o}},3216:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},8024:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},2308:(t,e,s)=>{const{getFractional:n}=s(2932),o=s(3536),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==o.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=n(t);const s=r(e.y,i[1]);let o;h[2]=s,h[3]=n(s),o=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(o),h[5]=n(o)}else{const t=i[0];h[0]=Math.floor(t),h[1]=n(t);const e=i[1];h[2]=Math.floor(e),h[3]=n(e);const s=i[2];h[4]=Math.round(s),h[5]=n(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,o=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=o,h[2*t+1]=n(o)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t[e]+t[e+1]/100;s[e/2]=n}if(e===o.SHAPE_2D_POLYGON||e===o.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},2076:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const n=new Array(s);for(let t=0;t<e.length;t++)n[t]=e.codePointAt(t);return n[e.length]=t.shadow.color[0],n[e.length+1]=t.shadow.color[1],n[e.length+2]=t.shadow.color[2],n[e.length+3]=t.shadow.color[3],t.shadow.blur&&(n[e.length+4]=Math.floor(t.shadow.blur/10),n[e.length+5]=t.shadow.blur%10),n}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let n;t.length>10&&(n=10*t[10]+t[11]);const o={[e]:{color:s}};return n&&(o[e].blur=n),o}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},4224:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},6016:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},2772:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},5736:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},8992:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},6604:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},3124:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},7524:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},4508:(t,e,s)=>{const{hypLength:n}=s(2932),o=s(360),{squishColor:r}=s(8024),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const d=t.size||1,c=e?d*n(e.x,e.y):d;l[4]=Math.floor(c),l[5]=Math.round(100*(c-Math.floor(c)));const u=t.color||o.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let n=6+f.length+2+3*[...h].length;l[n+p]=Number(s[0]),l[n+p+1]=Number(s[1]),l[n+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let n;n=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let o=6+f.length+2+3*[...h].length+3*[...a].length;l[o+g]=Number(n[0]),l[o+g+1]=Number(n[1]),l[o+g+2]=Number(n[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let d=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let n=h[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;d.push(o)}const c=String.fromCodePoint.apply(null,d);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let n=a[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;u.push(o)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let n=l[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;y.push(o)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:n,color:o,align:c,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},3168:(t,e,s)=>{const{GameNode:n}=s(2032),o=s(3536);t.exports={[[o.ASSET]]:n.Asset,[[o.TEXT]]:n.Text,[[o.SHAPE_2D_POLYGON]]:n.Shape,[[o.SHAPE_2D_CIRCLE]]:n.Shape,[[o.SHAPE_2D_LINE]]:n.Shape}},3536:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},9060:(t,e,s)=>{const{getRandomTerrain:n,getRandomStartPoint:o}=s(5664),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const d=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);n()(d,o(h,a,e),h,a,e);const c=((t,e,s,n)=>{const o=[];for(let i=0;i<s;i++)for(let s=0;s<n;s++){const n=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(o.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){o.push(...n);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(n.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(d,e,h,a);return c?i(d,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:n,height:o}=((t,e)=>{const s=t.x,n=t.y,o=e.x,r=e.y;return{width:Math.floor(s/o),height:Math.floor(n/r)}})(t,e);let r=((t,e)=>{const s=[],n={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let o=0;o<t;o++){s[o]=[];for(let r=0;r<e;r++){const i={...n};0===o?i.west=!1:o===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[o].push(i)}}return s})(n,o);const h={x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*o)};return r=i(r,h,s,n,o),r}}},5664:t=>{const e=(t,{x:e,y:s},n,o,r)=>{e<0||e>=n||s<0||s>=o||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s+1,y:n+1},o,r,i)):1===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i)):2===h?(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n-1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n-1},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s,y:n+3},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+3,y:n},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-3,y:n},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s,y:n-3},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s+1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+2,y:n-1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n+1},o,r,i),e(t,{x:s+2,y:n+1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n-1},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const n={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;n.x===s.x&&n.y===s.y;)n.x=Math.floor(Math.random()*t),n.y=Math.floor(Math.random()*e);return n}}},5792:t=>{const e=(t,s,n,o=[])=>{if(!n||n(t)&&t.node.id!==s.node.id){const e=t.node.text,n=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=n[0][0],h=n[1][0],a=r[0][0],l=r[1][0],d=n[0][1],c=n[2][1],u=r[0][1],f=r[2][1];l<i||h<a||d>f||u>c||o.push(t)}for(const r in t.node.children)e(t.node.children[r],s,n,o);return o};t.exports={checkCollisions:(t,s,n=null)=>e(t,s,n)}},2932:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},9464:t=>{t.exports=function(t,e){const s={get:(t,e,s)=>Reflect.get(t,e,s),defineProperty(t,s,n){const o=Reflect.defineProperty(t,s,n);return e&&e(),o},deleteProperty(t,s){const n=Reflect.deleteProperty(t,s);return e&&e(),n}},n=Proxy.revocable(t,s);return t.free=()=>{n.revoke()},n.proxy}},7684:t=>{t.exports={triangle:(t,e,s,n,o,r)=>[[t,e],[s,n],[o,r],[t,e]],rectangle:(t,e,s,n)=>[[t,e],[t+s,e],[t+s,e+n],[t,e+n],[t,e]]}},6428:(t,e,s)=>{const{GameNode:n}=s(2032),o=s(9912),r=s(7684),i=s(5792),h=s(360);t.exports={getView:(t,e,s,a={},l={})=>{const d=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),c=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return d.length>0&&d.forEach((t=>{const n=[],o=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in o){const r=o[s],i=r[0],h=r[1];let d=Math.max(Math.min(i-e.x,100),0),c=Math.max(Math.min(h-e.y,100),0);d=(l.x||1)*d,c=(l.y||1)*c,(!a.filter||a.filter(t))&&(a.x&&(d+=a.x),a.y&&(c+=a.y)),d<0?d=0:d>100&&(d=100),c<0?c=0:c>100&&(c=100),n.push([d,c])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(n&&n.length&&(e.node.text&&(e.node.text.x=n[0][0],e.node.text.y=n[0][1]),n.length&&(e.node.coordinates2d=n),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],n=e.node.coordinates2d[2],o=s[0]-t[0],r=n[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=o,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>c.addChild(t))),c}}},608:(t,e,s)=>{const n=s(916);t.exports={getAppDataPath:()=>{if(!process)return"";switch(process.platform){case"darwin":return n.join(process.env.HOME,"Library","Application Support","homegames");case"win32":return n.join(process.env.APPDATA,"homegames");case"linux":return n.join(process.env.HOME,".homegames");default:console.log("Unsupported platform!"),process.exit(1)}}}},7968:(t,e,s)=>{const{squish:n,unsquish:o}=s(316),{gameNode:r,GameNode:i}=s(9104),h=(s(1363),s(2524)),a=s(2176),l=s(7576),d=s(6592),c=s(1088),u=s(3072),{terrainGenerator:f}=s(4552),y=s(6092),p=s(6240),g=s(6616),x=s(3004),E=s(5560);t.exports={squish:n,unsquish:o,gameNode:r,subtypes:y,Game:a,ViewableGame:l,GameNode:i,Colors:h,Shapes:d,Squisher:p,ShapeUtils:c,ViewUtils:u,TerrainGenerator:f,GeometryUtils:x,Asset:g,Physics:E}},6616:(t,e,s)=>{const n=s(6788),{getAppDataPath:o}=s(9808);t.exports=class{constructor(t,e=null){this.info=t,e&&(this.data=e),this.https=s(9572),this.http=s(7028),this.fs=s(6008),this.crypto=s(7804),this.path=s(6788),this.process=s(3560)}getConfigValue(t,e=void 0){const s=this.getConfig();let n=process.env[t]&&`${process.env[t]}`;if(void 0!==n)return"true"===n?n=!0:"false"===n&&(n=!1),console.log(`Using environment value: ${n} for key: ${t}`),n;if(void 0===s[t]&&void 0===e)throw new Error(`No value for ${t} found in config`);return void 0===s[t]&&void 0!==e?e:(console.log(`Found value ${s[t]} in config`),s[t])}getConfig(){if(this.cachedConfig)return this.cachedConfig;const t=[process.cwd(),s.c[s.s].filename,process.mainModule.filename,"/"];let e={};for(let s=0;s<t.length;s++)if(this.fs.existsSync(`${t[s]}/config.json`)){console.log(`Using config at ${t[s]}`),e=JSON.parse(this.fs.readFileSync(`${t[s]}/config.json`));break}return this.cachedConfig=e,e}getHash(t){const e=this.crypto.createHash("sha1");return e.update(t),e.digest("hex")}getFileLocation(){const t=this.getHash(this.info.id);return`${n.join(o(),"asset-cache")}/${t}`}existsLocallySync(){const t=this.getFileLocation(this.info.id);return fs.existsSync(t)}existsLocally(){return new Promise(((t,e)=>{this.data&&t(!0);const s=this.getFileLocation(this.info.id);this.fs.exists(s,(e=>{t(e&&s)}))}))}async downloadSync(t){const e=n.join(o(),"asset-cache");fs.existsSync(e)||fs.mkdirSync(e);const s=this.existsLocallySync(),r=this.getFileLocation(this.info.id);return s&&!t?(this.initialized=!0,r):(await downloadFileSync(this.info.id,e),this.initialized=!0,r)}download(t){const e=n.join(o(),"asset-cache");return this.fs.existsSync(e)||this.fs.mkdirSync(e),new Promise(((s,n)=>{this.existsLocally().then((o=>{o&&!t?(this.initialized=!0,s(o)):this.doDownload(this.info.id,e).then((t=>{this.initialized=!0,s(t)})).catch((t=>{n(t)}))}))}))}getData(){return new Promise(((t,e)=>{this.data?t(this.data):this.download().then((s=>{this.fs.readFile(s,((s,n)=>{s?e(s):t(n)}))})).catch((t=>{e(t)}))}))}doDownload(t,e){return new Promise(((s,n)=>{const o=this.getHash(t),r=`${e}/${o}`,i=this.fs.createWriteStream(r),h=this.https;i.on("close",(()=>{s(r)}));let a="";h.get(`https://assets.homegames.io/${t}`,(t=>{t.on("data",(t=>{a+=t,i.write(t)})),t.on("end",(()=>{i.end()}))})).on("error",(t=>{n(t)}))}))}}},3968:(t,e,s)=>{const n=s(1363),o=(t,e,s,o,r,i,h,a,l,d,c,u)=>new n(t,e,s,o,r,i,h,a,l,d,c,u);t.exports={gameNode:o,BaseNode:class{constructor({color:t,onClick:e,coordinates2d:s,border:n,fill:r,textInfo:i,assetInfo:h,playerIds:a,effects:l,input:d,subtype:c,node:u,id:f}){this.node=u||o(t,e,s,n,r,i,h,a,l,d,c,f),this.id=this.node.id}showFor(t){const e=this.node.playerIds.indexOf(t),s=this.node.playerIds.indexOf(0);if(s>=0){const t=this.node.playerIds;t.splice(s,1),this.node.playerIds=t}if(e<0){const e=this.node.playerIds;e.push(t),this.node.playerIds=e}}hideFor(t){const e=this.node.playerIds.indexOf(t);if(e>=0){let t=this.node.playerIds;t.splice(e,1),0==t.length&&(t=[0]),this.node.playerIds=t}}addChild(t,e=!0){this.node.addChild(t),e&&this.node.onStateChange()}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e],!1);this.node.onStateChange()}getChildren(){return this.node.children}removeChild(t,e=!0){this.node.removeChild(t),e&&this.node.onStateChange()}addListener(t){this.node.addListener(t)}findChild(t){return this.findChildHelper(t,this)}findChildHelper(t,e,s=null){e.node.id===t&&(s=e);for(const n in e.node.children){if(s)return s;s=this.findChildHelper(t,e.node.children[n],s)}return s}clearChildren(t){this.node.clearChildren(t),this.node.onStateChange()}update(t={}){t&&(t.fill&&(this.node.fill=t.fill),t.coordinates2d&&(this.node.coordinates2d=coordinates2d)),this.node.onStateChange()}clone(){throw new Error("Clone not implemented")}}}},2524:t=>{const e={ALMOST_BLACK:[16,16,16,255],ALMOST_WHITE:[238,238,238,255],ANTIQUE_WHITE:[250,235,215,255],AQUA:[188,212,230,255],AQUAMARINE:[127,255,212,255],BEIGE:[245,245,220,255],BIG_GRAY:[221,221,221,255],BLACK:[0,0,0,255],BLAY:[87,102,117,255],BLUE:[0,0,255,255],BLUE_WHISPER:[240,248,255,255],BLEEN:[19,51,55,255],BLOOD:[153,0,0,255],BOOGER:[186,218,85,255],BRIGHT_GRAY:[198,226,255,255],BRONZE:[227,151,17,255],BROWN:[145,97,11,255],CANDY_GREEN:[90,193,142,255],CANDY_PINK:[255,115,115,255],CANDY_RED:[246,84,106,255],CHARCOAL:[51,51,51,255],CALM_BLUE:[8,141,165,255],COOL_BLUE:[64,114,148,255],COOL_GREEN:[180,238,180,255],CORAL:[255,127,80,255],CORPORATE_BEIGE:[203,203,169,255],CREAM:[240,224,136,255],CREAMSICLE:[255,195,160,255],CYAN:[0,255,255,255],DARK_TURQUOISE:[0,206,209,255],DEEP_BLUE:[0,51,102,255],DEEP_PURPLE:[102,0,102,255],DEEP_RED:[139,0,0,255],DIM_GRAY:[105,105,105,255],DULL_BLUE:[192,214,228,255],EMERALD:[39,89,45,255],EVERGREEN:[6,85,53,255],FRIENDLY_BLUE:[70,132,153,255],FUCHSIA:[255,0,255,255],FUNNY_PURPLE:[128,0,128,255],GOLD:[255,215,0,255],GOLDMEMBER:[218,165,32,255],GRAY:[192,192,192,255],GREEN:[0,255,0,255],GUN_METAL_GRAY:[102,102,102,255],HARD_ORANGE_RED:[255,64,64,255],HARD_PINK:[247,52,122,255],HG_BLACK:[26,26,26,255],HG_BLUE:[148,210,230,255],HG_RED:[241,112,112,255],HG_YELLOW:[255,247,143,255],INTERIOR_RED:[255,102,102,255],INVITATION_BLUE:[104,151,187,255],KHAKI:[255,246,143,255],LAVENDER:[230,230,250,255],LIGHT_CORAL:[240,128,128,255],LIGHT_SEA_GREEN:[32,178,170,255],NAVY:[0,0,128,255],MAGENTA:[255,0,255,255],MAROON:[128,0,0,255],MEAN_SEA:[129,216,208,255],MERLOT:[66,4,32,255],MINT:[102,205,170,255],MUSTARD:[232,219,32,255],NEON_BOOGER:[204,255,0,255],NEON_PINK:[255,128,237,255],ORANGE:[255,165,0,255],ORANGE_RED:[255,69,0,255],PALE_TURQUOISE:[175,238,238,255],PEACH:[255,218,185,255],PERFUME_PINK:[255,228,225,255],PERRYWINKLE:[204,204,255,255],PINK:[255,192,203,255],POWDER_BLUE:[176,224,230,255],PURPLE:[128,0,128,255],REAL_ESTATE_BLUE:[14,47,68,255],RED:[255,0,0,255],RUST:[128,0,0,255],SALMON:[250,128,114,255],SEA_GREEN:[0,128,128,255],SHARP_YELLOW:[255,255,102,255],SILVER:[192,192,192,255],SIMPLE_GRAY:[204,204,204,255],SLEEPY_PINK:[255,182,193,255],SMOKE:[245,245,245,255],SMOOTH_BLUE:[76,163,221,255],SOFT_GREEN:[211,255,206,255],SOFT_MINT:[182,252,213,255],SOFT_PINK:[255,192,203,255],STRESSED_PURPLE:[138,43,226,255],SKY_BLUE:[127,229,240,255],STANDARD_GRAY:[128,128,128,255],STORM_GRAY:[105,105,102,255],SUCCESS_GREEN:[0,128,0,255],TEAL:[0,128,128,255],TENSE_SKY:[102,204,204,255],TERRACOTTA:[226,114,91,255],THICK_LUXURY:[195,151,151,255],TURQUOISE:[64,224,208,255],WALLPAPER_BEIGE:[203,190,181,255],WALLPAPER_GREEN:[220,237,193,255],WHITE:[255,255,255,255],YELLOW:[255,255,0,255]},s=Object.keys(e);t.exports={COLORS:e,randomColor:function(t=[]){const n=t.length?((t,e)=>t.length===e.length?["WHITE"]:t.filter((t=>{for(const s of e)if(t===s)return!1;return!0})))(s,t):s,o=Math.floor(Math.random()*n.length);return e[n[o]]}}},2176:t=>{t.exports=class{constructor(){this.listeners=new Set,this.intervals=[],this.timeouts=[],this.playerInfoMap={}}addStateListener(t){this.listeners.add(t)}removeStateListener(t){this.listeners.remove(t)}findNode(t){let e=null;if(this.getLayers){const s=this.getLayers();for(let n in s)if(e=s[n].root.findChild(t),e)break}return e}setInterval(t,e){const s=setInterval(t,e);return this.intervals.push(s),s}setTimeout(t,e){const s=setTimeout(t,e);return this.timeouts.push(s),s}close(){for(const t in this.timeouts){const e=this.timeouts[t];clearTimeout(e)}for(const t in this.intervals){const e=this.intervals[t];clearInterval(e)}}}},9104:(t,e,s)=>{const n=s(6592),o=s(6092),{gameNode:r,BaseNode:i}=s(3968),h={[n.CIRCLE]:o.SHAPE_2D_CIRCLE,[n.POLYGON]:o.SHAPE_2D_POLYGON,[n.LINE]:o.SHAPE_2D_LINE},a={[o.SHAPE_2D_CIRCLE]:n.CIRCLE,[o.SHAPE_2D_POLYGON]:n.POLYGON,[o.SHAPE_2D_LINE]:n.LINE};class l extends i{constructor({color:t,onClick:e,shapeType:s,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,id:c}){if(!(n&&s||d))throw new Error("Shape requires coordinates2d and shapeType");super({color:t,onClick:e,coordinates2d:n,border:o,fill:r,playerIds:i,effects:a,input:l,node:d,subtype:h[s],id:c})}clone({handleClick:t,input:e,id:s}){const n=Number(s)||null;return new l({color:this.node.color,onClick:t,shapeType:a[this.node.subType],coordinates2d:this.node.coordinates2d,border:this.node.border,fill:this.node.fill,playerIds:this.node.playerIds,effects:this.node.effects,input:e,id:n})}}class d extends i{constructor({textInfo:t,playerIds:e,input:s,node:n,id:r}){if(!t&&!n)throw new Error("Text node requires textInfo");super({textInfo:t,playerIds:e,input:s,node:n,subtype:o.TEXT,id:r})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new d({textInfo:Object.assign({},this.node.text),playerIds:this.playerIds?.slice(),id:n})}}class c extends i{constructor({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,id:h}){if(!t&&!i)throw new Error("Asset node requires assetInfo");super({assetInfo:t,onClick:e,coordinates2d:s,playerIds:n,effects:r,node:i,subtype:o.ASSET,id:h})}clone({handleClick:t,input:e,id:s}){const n=s||null;return new c({assetInfo:Object.assign({},this.node.asset),playerIds:this.playerIds?.slice(),id:n})}}const u={Asset:c,Shape:l,Text:d};t.exports={gameNode:r,GameNode:u}},1363:t=>{t.exports=class{constructor(t,e,s,n,o,r,i,h=[],a=null,l=null,d=null,c=null){this.id=c?Number(c):Math.floor(999999999999*Math.random()),this.children=new Array,this.color=t,this.handleClick=e,this.coordinates2d=s,this.border=n,this.fill=o,this.text=r,this.asset=i,this.effects=a,this.input=l,this.listeners=new Set,!h||h instanceof Array||(h=[h]),this.playerIds=h||[],this.subType=d}addChild(t){this.children.push(t)}addChildren(...t){for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(t){const e=this.children.findIndex((e=>e.node.id==t));e>=0&&(this._animation&&clearInterval(this._animation),this.children.splice(e,1))}addListener(t){this.listeners.add(t)}onStateChange(){for(const t of this.listeners)t.handleStateChange(this)}clearChildren(t){if(t){const e=this.children.filter((e=>t.includes(e.id)));this.children=e}else this.children=new Array}}},6592:t=>{t.exports={CIRCLE:1,POLYGON:2,LINE:3}},6240:(t,e,s)=>{const{squish:n,unsquish:o}=s(316);t.exports=class{constructor({game:t,scale:e,customBottomLayer:s,customTopLayer:n,onAssetUpdate:o}){if(this.ids=new Set,this.game=t,this.gameMetadata=t.constructor.metadata&&t.constructor.metadata(),this.assets={},this.customBottomLayer=s,this.customTopLayer=n,this.initialize(),this.onAssetUpdate=o,this.playerFrames={},this.listeners=new Set,this.scale=e||{x:1,y:1},this.state=this.squish(this.game.getLayers()),this.game.tick){const t=this.gameMetadata&&this.gameMetadata.tickRate?this.gameMetadata.tickRate:60;setInterval(this.game.tick.bind(this.game),1e3/t)}}addListener(t){const e={onEvent:t,remove:()=>this.removeListener(e)};this.listeners.add(e)}removeListener(t){this.listeners.remove(t)}unsquish(t){return o(t)}squish(t,e=null){if(!t)return[];t.length;let s=[];const n={};if(this.customBottomLayer){const t=[];this.squishHelper(this.customBottomLayer.root,t,this.customBottomLayer.scale,n),s.push(t)}for(const o in t){const r=[],i=t[o],h=i.scale?{x:this.scale.x*i.scale.x,y:this.scale.y*i.scale.y}:this.scale;this.squishHelper(i.root,r,e||h,n),s.push(r)}if(this.customTopLayer){const t=[];this.squishHelper(this.customTopLayer.root,t,this.customTopLayer.scale,n),s.push(t)}return this.playerFrames=n,s.flat()}getPlayerFrame(t){return this.playerFrames[t]}handleNewAsset(t,e){return new Promise(((t,e)=>{this.initialize().then(t)}))}squishHelper(t,e,s={x:1,y:1},o={},r=new Set){t.node.listeners.has(this)||t.addListener(this);const i=n(t,s);if(e.push(i),t.node.playerIds&&t.node.playerIds.length>0&&t.node.playerIds.forEach((t=>r.add(t))),r.size>0){let e=new Set;for(let s of r)o[s]||(o[Number(s)]=[]),0===t.node.playerIds.length||t.node.playerIds.findIndex((t=>Number(t)===Number(s)))>=0?o[s].push(i):e.add(s);for(let t of e)r.delete(t)}else Object.keys(o).forEach((t=>{o[t]||(o[Number(t)]=[]),o[t].push(i)}));for(let n=0;n<t.node.children.length;n++){const i=new Set(r);this.squishHelper(t.node.children[n],e,s,o,i)}}getJson(){const t=this.game.layers,e=new Array(t.length);for(const s in t){const n=t[s].root;e[s]=n}return JSON.stringify(e)}initialize(){return new Promise(((t,e)=>{const s=Object.assign({},this.assets||{}),n=this.game.constructor.metadata&&this.game.constructor.metadata(),o=n&&n.assets?n.assets:{};this.customBottomLayer&&this.customBottomLayer.assets&&Object.assign(o,this.customBottomLayer.assets),this.customTopLayer&&this.customTopLayer.assets&&Object.assign(o,this.customTopLayer.assets),this.game.getAssets&&this.game.getAssets()&&Object.assign(o,this.game.getAssets());const r=Object.assign(s,o);let i=0,h=0;const a=Object.keys(r).length;for(const e in r)r[e].getData().then((s=>{let n=0;const o=new Array(32);for(;n<32&&n<e.length;)o[n]=e.charCodeAt(n),n++;const l=(s.length+32).toString(36),d={image:1,audio:2,font:3}[r[e].info.type];let c="";for(let t=0;t<10-l.length;t++)c+="0";for(let t=l.length;t<10;t++)c+=l.charAt(t-l.length);const u=new Array(10);for(let t=0;t<10;t++)u[t]=l.charCodeAt(t);if(this.assets[e]=[1,d,...u,...o,...s],i+=this.assets[e].length,h+=1,h==a){const e=new Array(i);for(let t=0;t<i;t++)for(const s in this.assets)for(let n=0;n<this.assets[s].length;n++)e[t++]=this.assets[s][n];this.assetBundle=e,t(e)}})).catch((t=>{console.error("Unable to get asset data for key "+e),console.error(t)}))}))}handleStateChange(t,e){this.listeners.size>0&&(this.state=this.squish(this.game.getLayers()),this.broadcast())}broadcast(){for(const t of this.listeners)t.onEvent(this.state)}}},7576:(t,e,s)=>{const{GameNode:n}=s(9104),o=s(6592),r=s(1088),i=s(2524),h=s(2176);t.exports=class extends h{constructor(t){var e;super(),this.planeSize=t,this.plane=(e=this.planeSize,new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,e,e)})),this.fakeRoot=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:i.COLORS.BLACK}),this.layers=[{root:this.fakeRoot}]}updatePlaneSize(t){this.planeSize=t,this.plane.node.coordinates2d=r.rectangle(0,0,t,t)}getLayers(){return this.layers}getPlane(){return this.plane}getPlaneSize(){return this.planeSize}getViewRoot(){return this.fakeRoot}}},6624:(t,e,s)=>{const{GameNode:n}=s(9104);t.exports={CONSTRUCTOR_TO_TYPE:{Asset:1,Shape:2,Text:3},TYPE_TO_CONSTRUCTOR:{1:n.Asset,2:n.Shape,3:n.Text}}},5560:t=>{t.exports={getPath:(t,e,s,n,o=100,r=100)=>{const i=[];let h=!0;for(;h;){const a=(0===i.length?t:i[i.length-1][0])+s,l=(0===i.length?e:i[i.length-1][1])+n;if(a<0||a>o||l<0||l>r){let t=a,e=l;a<0?t=0:a>o&&(t=o),l<0?e=0:l>r&&(e=r),i[i.length-1][0]!==t&&i[i.length-1][1]!==e&&i.push([t,e]),h=!1}else i.push([a,l])}return i}}},316:(t,e,s)=>{const n=s(1363),{CONSTRUCTOR_TO_TYPE:o,TYPE_TO_CONSTRUCTOR:r}=s(6624),i=s(1640),{squishId:h}=s(1128),{squishColor:a}=s(3480),{squishPlayerIds:l}=s(9677),{squishPos:d}=s(2928),{squishFill:c}=s(9360),{squishSize:u}=s(7888),{squishHandleClick:f}=s(696),{squishBorder:y}=s(8976),{squishSubType:p}=s(2088),{squishInput:g}=s(4028),{squishCoordinates2d:x}=s(3684),{squishEffect:E}=s(9644),{squishText:A}=s(3384),{squishAsset:S}=s(92),m={id:h,color:a,playerIds:l,pos:d,coordinates2d:x,fill:c,size:u,text:A,asset:S,effects:E,handleClick:f,border:y,subType:p,input:g},C={};for(const t in m)C[Number(m[t].type)]=t;t.exports={squish:(t,e=null)=>{let s=[];const n=t.node,r=(()=>{const t=Object.keys(m).filter((t=>m[t].dependsOn&&m[t].dependsOn.length>0));return[Object.keys(m).filter((t=>!m[t].dependsOn||0===m[t].dependsOn.length)),t].flat()})();for(const t in r){const o=r[t];if(o in n){const t=n[o];if(null!=t){const r=m[o].squish(t,e,n),i=r.length+3,h=Math.min(255,i),a=Math.min(255,Math.max(0,i-255));s.push([m[o].type,a,h,...r])}}}let h=o[t.constructor.name];h||(h=o[i[n.subType]]);const a=s.flat(),l=a.length+5,d=Math.min(255,l),c=Math.min(255,Math.max(0,l-255));return[3,Math.min(255,Math.max(0,l-510)),c,d,h,...a]},unsquish:t=>{if(3!=t[0])throw new Error("Squished[0] isnt 3.");if(t.length!==t[1]+t[2]+t[3])throw new Error("Bad length value");let e=5,s=new n;for(;e<t.length;){const n=t[e],o=t[e+1]+t[e+2],r=t.slice(e+3,e+o);if(!C[n]){console.warn("Unknown sub frame type "+n);break}{const t=C[n],e=(0,m[t].unsquish)(r,Object.assign({},s));s[t]=e}e+=o}const o=r[t[4]];return o?new o({node:s}):{node:s}}}},92:(t,e,s)=>{const{getFractional:n}=s(3132),o={type:48,squish:(t,e)=>{const s=Object.keys(t)[0],o=new Array(10+s.length),r=t[s],i=e?e.x*r.pos.x+Math.round(100*(1-e.x))/2:r.pos.x,h=e?e.y*r.pos.y+Math.round(100*(1-e.y))/2:r.pos.y,a=e?e.x*r.size.x:r.size.x,l=e?e.y*r.size.y:r.size.y,d=r.startTime||0;o[0]=Math.floor(i),o[1]=n(i),o[2]=Math.floor(h),o[3]=n(h),o[4]=Math.floor(a),o[5]=n(a),o[6]=Math.floor(l),o[7]=n(l),o[8]=Math.floor(d),o[9]=n(d);for(let t=0;t<s.length;t++)o[10+t]=s.codePointAt(t);return o},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t[6]+t[7]/100,r=t[8]+t[9]/100;return{[String.fromCodePoint.apply(null,t.slice(10))]:{pos:{x:e,y:s},size:{x:n,y:o},startTime:r}}}};t.exports={ASSET_SUBTYPE:48,squishAsset:o}},8976:t=>{t.exports={BORDER_SUBTYPE:54,squishBorder:{type:54,squish:t=>[t],unsquish:t=>t[0]}}},3480:t=>{t.exports={COLOR_SUBTYPE:42,squishColor:{type:42,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},3684:(t,e,s)=>{const{getFractional:n}=s(3132),o=s(6092),r=(t,e)=>t*e+Math.round(100*(1-t))/2,i={type:52,squish:(t,e,s)=>{const i=t.flat(),h=new Array(2*i.length);if(s.subType==o.SHAPE_2D_CIRCLE)if(e){const t=r(e.x,i[0]);h[0]=t,h[1]=n(t);const s=r(e.y,i[1]);let o;h[2]=s,h[3]=n(s),o=e.x===e.y?e.x*i[2]:Math.sqrt(Math.pow(100*e.x,2)+Math.pow(100*e.y,2))*(i[2]/100),h[4]=Math.floor(o),h[5]=n(o)}else{const t=i[0];h[0]=Math.floor(t),h[1]=n(t);const e=i[1];h[2]=Math.floor(e),h[3]=n(e);const s=i[2];h[4]=Math.round(s),h[5]=n(s)}else for(const t in i)if(e){const s=t%2==0?e.x:e.y,o=s*i[t]+Math.round(100*(1-s))/2;h[2*t]=o,h[2*t+1]=n(o)}else h[2*t]=Math.floor(i[t]),h[2*t+1]=Math.round(100*(i[t]-Math.floor(i[t])));return h},dependsOn:["subType"],unsquish:(t,{subType:e})=>{const s=new Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t[e]+t[e+1]/100;s[e/2]=n}if(e===o.SHAPE_2D_POLYGON||e===o.SHAPE_2D_LINE){const t=new Array(s.length/2);for(let e=0;e<s.length;e+=2)t[e/2]=[s[e],s[e+1]];return t}return s}};t.exports={COORDINATES_2D_SUBTYPE:52,squishCoordinates2d:i}},9644:t=>{const e={type:49,squish:t=>{if(t.shadow){const e="shadow";let s=e.length+4;t.shadow.blur&&(s+=2);const n=new Array(s);for(let t=0;t<e.length;t++)n[t]=e.codePointAt(t);return n[e.length]=t.shadow.color[0],n[e.length+1]=t.shadow.color[1],n[e.length+2]=t.shadow.color[2],n[e.length+3]=t.shadow.color[3],t.shadow.blur&&(n[e.length+4]=Math.floor(t.shadow.blur/10),n[e.length+5]=t.shadow.blur%10),n}},unsquish:t=>{const e=String.fromCodePoint.apply(null,t.slice(0,6)),s=t.slice(6,10);let n;t.length>10&&(n=10*t[10]+t[11]);const o={[e]:{color:s}};return n&&(o[e].blur=n),o}};t.exports={EFFECTS_SUBTYPE:49,squishEffect:e}},9360:t=>{t.exports={FILL_SUBTYPE:53,squishFill:{type:53,squish:t=>[t[0],t[1],t[2],t[3]],unsquish:t=>[t[0],t[1],t[2],t[3]]}}},696:t=>{t.exports={ONCLICK_SUBTYPE:50,squishHandleClick:{type:50,squish:t=>t?[1]:[0],unsquish:t=>1===t[0]}}},1128:t=>{const e={type:43,squish:t=>{const e=t.toString();let s=[];if(e.length>2){let t;for(t=0;t+2<=e.length;t+=2)s.push(e.substring(t,t+2));t==e.length-1&&s.push(e.substring(t,t+2))}else 1===e.length?s.push("0"+e):s.push(e);if(s.length<8)for(;s.length<8;)s=["00",...s];return s.map((t=>new Number(t)))},unsquish:t=>{let e="";for(let s=t.length-1;s>=0;s--)e=(t[s]>9?t[s]:"0"+t[s])+e;return new Number(e)}};t.exports={ID_SUBTYPE:43,squishId:e}},4028:t=>{const e={type:51,squish:t=>{const e=new Array(t.type.length);for(let s=0;s<t.type.length;s++)e[s]=t.type.codePointAt(s);return e},unsquish:t=>({type:String.fromCodePoint.apply(null,t)})};t.exports={INPUT_SUBTYPE:51,squishInput:e}},9677:t=>{t.exports={PLAYER_ID_SUBTYPE:44,squishPlayerIds:{type:44,squish:t=>t,unsquish:t=>t}}},2928:t=>{const e=t=>Math.round(100*(t-Math.floor(t))),s={type:45,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={POS_SUBTYPE:45,squishPos:s}},7888:t=>{const e=t=>{Math.round(100*(t-Math.floor(t)))},s={type:46,squish:t=>[Math.floor(t.x),e(t.x),Math.floor(t.y),e(t.y)],unsquish:t=>({x:t[0]+t[1]/100,y:t[2]+t[3]/100})};t.exports={SIZE_SUBTYPE:46,squishSize:s}},2088:t=>{t.exports={SUBTYPE_TYPE:55,squishSubType:{type:55,squish:t=>[t],unsquish:t=>t[0]}}},3384:(t,e,s)=>{const{hypLength:n}=s(3132),o=s(2524),{squishColor:r}=s(3480),i={type:47,squish:(t,e)=>{const s=e?t.x*e.x+Math.round(100*(1-e.x))/2:t.x,i=e?t.y*e.y+Math.round(100*(1-e.y))/2:t.y,h=t.align||"left",a=t.font||"default",l=new Array(t.text.length+10+h.length+a.length);l[0]=Math.floor(s),l[1]=Math.round(100*(s-Math.floor(s))),l[2]=Math.floor(i),l[3]=Math.round(100*(i-Math.floor(i)));const d=t.size||1,c=e?d*n(e.x,e.y):d;l[4]=Math.floor(c),l[5]=Math.round(100*(c-Math.floor(c)));const u=t.color||o.BLACK,f=r.squish(u);for(let t=0;t<f.length;t++)l[6+t]=f[t];l[6+f.length]=3*[...h].length,l[6+f.length+1]=3*[...a].length;let y=0;for(let t=0;t<[...h].length;t++){const e=[...h][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`],l[6+f.length+2+y]=Number(s[0]),l[6+f.length+2+y+1]=Number(s[1]),l[6+f.length+2+y+2]=Number(s[2]),y+=3}let p=0;for(let t=0;t<[...a].length;t++){const e=[...a][t].codePointAt(0).toString();let s;s=1==e.length?["00","00",`0${e}`]:2==e.length?["00","00",`${e}`]:3==e.length?["00",`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`]:4==e.length?["00",`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`]:5==e.length?[`0${e.charAt(0)}`,`${e.charAt(1)}${e.charAt(2)}`,`${e.charAt(3)}${e.charAt(4)}`]:[`${e.charAt(0)}${e.charAt(1)}`,`${e.charAt(2)}${e.charAt(3)}`,`${e.charAt(4)}${e.charAt(5)}`];let n=6+f.length+2+3*[...h].length;l[n+p]=Number(s[0]),l[n+p+1]=Number(s[1]),l[n+p+2]=Number(s[2]),p+=3}let g=0;for(let e=0;e<[...t.text].length;e++){const s=[...t.text][e].codePointAt(0).toString();let n;n=1==s.length?["00","00",`0${s}`]:2==s.length?["00","00",`${s}`]:3==s.length?["00",`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`]:4==s.length?["00",`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`]:5==s.length?[`0${s.charAt(0)}`,`${s.charAt(1)}${s.charAt(2)}`,`${s.charAt(3)}${s.charAt(4)}`]:[`${s.charAt(0)}${s.charAt(1)}`,`${s.charAt(2)}${s.charAt(3)}`,`${s.charAt(4)}${s.charAt(5)}`];let o=6+f.length+2+3*[...h].length+3*[...a].length;l[o+g]=Number(n[0]),l[o+g+1]=Number(n[1]),l[o+g+2]=Number(n[2]),g+=3}return l},unsquish:t=>{const e=t[0]+t[1]/100,s=t[2]+t[3]/100,n=t[4]+t[5]/100,o=t.slice(6,10),r=t[10],i=t[11],h=t.slice(12,12+r),a=t.slice(12+r,12+r+i),l=t.slice(12+r+i);let d=[];for(let t=0;t<h.length;t+=3){let e=h[t].toString();1==e.length&&(e=`0${e}`);let s=h[t+1].toString();1==s.length&&(s=`0${s}`);let n=h[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;d.push(o)}const c=String.fromCodePoint.apply(null,d);let u=[];for(let t=0;t<a.length;t+=3){let e=a[t].toString();1==e.length&&(e=`0${e}`);let s=a[t+1].toString();1==s.length&&(s=`0${s}`);let n=a[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;u.push(o)}const f=String.fromCodePoint.apply(null,u),y=[];for(let t=0;t<l.length;t+=3){let e=l[t].toString();1==e.length&&(e=`0${e}`);let s=l[t+1].toString();1==s.length&&(s=`0${s}`);let n=l[t+2].toString();1==n.length&&(n=`0${n}`);const o=e+s+n;y.push(o)}return{x:e,y:s,text:String.fromCodePoint.apply(null,y),size:n,color:o,align:c,font:f}}};t.exports={TEXT_SUBTYPE:47,squishText:i}},1640:(t,e,s)=>{const{GameNode:n}=s(9104),o=s(6092);t.exports={[[o.ASSET]]:n.Asset,[[o.TEXT]]:n.Text,[[o.SHAPE_2D_POLYGON]]:n.Shape,[[o.SHAPE_2D_CIRCLE]]:n.Shape,[[o.SHAPE_2D_LINE]]:n.Shape}},6092:t=>{t.exports={ASSET:1,TEXT:2,SHAPE_2D_POLYGON:3,SHAPE_2D_CIRCLE:4,SHAPE_2D_LINE:5}},4552:(t,e,s)=>{const{getRandomTerrain:n,getRandomStartPoint:o}=s(5120),r=t=>{for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]={filled:t[e][s].filled,north:t[e][s].north,south:t[e][s].south,east:t[e][s].east,west:t[e][s].west}},i=(t,e,s,h,a,l=0)=>{if(0===s||3===l)return t;const d=(t=>{const e=[];return t.forEach(((t,s)=>{e[s]=[],t.forEach((t=>{e[s].push({...t})}))})),e})(t);n()(d,o(h,a,e),h,a,e);const c=((t,e,s,n)=>{const o=[];for(let i=0;i<s;i++)for(let s=0;s<n;s++){const n=[],h={x:i,y:s};for(;;){const s=t[h.x][h.y];if(o.findIndex((t=>t.x===h.x&&t.y===h.y))>-1||h.x===e.x&&h.y===e.y||s.filled){o.push(...n);break}if((!s.north||s.wentNorth)&&(!s.south||s.wentSouth)&&(!s.east||s.wentEast)&&(!s.west||s.wentWest))return!1;if(n.push({...h}),s.south&&!s.wentSouth)s.wentSouth=!0,h.y=h.y+1;else if(s.east&&!s.wentEast)s.wentEast=!0,h.x=h.x+1;else if(s.north&&!s.wentNorth)s.wentNorth=!0,h.y=h.y-1;else{if(!s.west||s.wentWest)return!1;s.wentWest=!0,h.x=h.x-1}}r(t)}return!0})(d,e,h,a);return c?i(d,e,s-1,h,a,0):i(t,e,s,h,a,l+1)};t.exports={terrainGenerator:(t={x:100,y:100},e={x:5,y:5},s=5)=>{const{width:n,height:o}=((t,e)=>{const s=t.x,n=t.y,o=e.x,r=e.y;return{width:Math.floor(s/o),height:Math.floor(n/r)}})(t,e);let r=((t,e)=>{const s=[],n={filled:!1,north:!0,south:!0,east:!0,west:!0};for(let o=0;o<t;o++){s[o]=[];for(let r=0;r<e;r++){const i={...n};0===o?i.west=!1:o===t-1&&(i.east=!1),0===r?i.north=!1:r===e-1&&(i.south=!1),s[o].push(i)}}return s})(n,o);const h={x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*o)};return r=i(r,h,s,n,o),r}}},5120:t=>{const e=(t,{x:e,y:s},n,o,r)=>{e<0||e>=n||s<0||s>=o||e===r.x&&s===r.y||t[e][s].filled||(t[e][s].north&&(t[e][s-1].south=!1),t[e][s].south&&(t[e][s+1].north=!1),t[e][s].east&&(t[e+1][s].west=!1),t[e][s].west&&(t[e-1][s].east=!1),t[e][s].filled=!0,t[e][s].north=!1,t[e][s].south=!1,t[e][s].east=!1,t[e][s].west=!1)},s=[(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s+1,y:n+1},o,r,i)):1===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i)):2===h?(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n-1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n-1},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s,y:n+3},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+3,y:n},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-3,y:n},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s,y:n-3},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s,y:n+2},o,r,i),e(t,{x:s+1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+2,y:n},o,r,i),e(t,{x:s+2,y:n-1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-2,y:n},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s,y:n-2},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))},(t,{x:s,y:n},o,r,i)=>{const h=Math.floor(4*Math.random());e(t,{x:s,y:n},o,r,i),0===h?(e(t,{x:s,y:n+1},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-1,y:n+2},o,r,i)):1===h?(e(t,{x:s+1,y:n},o,r,i),e(t,{x:s+1,y:n+1},o,r,i),e(t,{x:s+2,y:n+1},o,r,i)):2===h?(e(t,{x:s-1,y:n},o,r,i),e(t,{x:s-1,y:n+1},o,r,i),e(t,{x:s-2,y:n+1},o,r,i)):(e(t,{x:s,y:n-1},o,r,i),e(t,{x:s-1,y:n-1},o,r,i),e(t,{x:s-1,y:n-2},o,r,i))}];t.exports={getRandomTerrain:()=>s[Math.floor(Math.random()*s.length)],getRandomStartPoint:(t,e,s)=>{const n={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*e)};for(;n.x===s.x&&n.y===s.y;)n.x=Math.floor(Math.random()*t),n.y=Math.floor(Math.random()*e);return n}}},3004:t=>{const e=(t,s,n,o=[])=>{if(!n||n(t)&&t.node.id!==s.node.id){const e=t.node.text,n=t.node.coordinates2d||[[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y],[e.x,e.y]],r=s.node.coordinates2d,i=n[0][0],h=n[1][0],a=r[0][0],l=r[1][0],d=n[0][1],c=n[2][1],u=r[0][1],f=r[2][1];l<i||h<a||d>f||u>c||o.push(t)}for(const r in t.node.children)e(t.node.children[r],s,n,o);return o};t.exports={checkCollisions:(t,s,n=null)=>e(t,s,n)}},3132:t=>{t.exports={hypLength:(t,e)=>Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),getFractional:t=>Math.round(100*(t-Math.floor(t)))}},1088:t=>{t.exports={triangle:(t,e,s,n,o,r)=>[[t,e],[s,n],[o,r],[t,e]],rectangle:(t,e,s,n)=>[[t,e],[t+s,e],[t+s,e+n],[t,e+n],[t,e]]}},3072:(t,e,s)=>{const{GameNode:n}=s(9104),o=s(6592),r=s(1088),i=s(3004),h=s(2524);t.exports={getView:(t,e,s,a={},l={})=>{const d=i.checkCollisions(t,{node:{coordinates2d:r.rectangle(e.x,e.y,e.w,e.h)}},(e=>e.node.id!==t.node.id)),c=new n.Shape({shapeType:o.POLYGON,coordinates2d:r.rectangle(0,0,0,0),fill:h.COLORS.BLACK}),u=[];return d.length>0&&d.forEach((t=>{const n=[],o=t.node.coordinates2d||[[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y],[t.node.text.x,t.node.text.y]];for(let s in o){const r=o[s],i=r[0],h=r[1];let d=Math.max(Math.min(i-e.x,100),0),c=Math.max(Math.min(h-e.y,100),0);d=(l.x||1)*d,c=(l.y||1)*c,(!a.filter||a.filter(t))&&(a.x&&(d+=a.x),a.y&&(c+=a.y)),d<0?d=0:d>100&&(d=100),c<0?c=0:c>100&&(c=100),n.push([d,c])}{const e=t.clone({handleClick:null===t.node.handleClick||void 0===t.node.handleClick?null:t.node.handleClick});if(n&&n.length&&(e.node.text&&(e.node.text.x=n[0][0],e.node.text.y=n[0][1]),n.length&&(e.node.coordinates2d=n),e.node.asset)){const t=e.node.coordinates2d[0],s=e.node.coordinates2d[1],n=e.node.coordinates2d[2],o=s[0]-t[0],r=n[1]-s[1];Object.values(e.node.asset)[0].pos.x=t[0],Object.values(e.node.asset)[0].pos.y=t[1],Object.values(e.node.asset)[0].size.x=o,Object.values(e.node.asset)[0].size.y=r}e.node.playerIds=s||[],u.push(e)}})),u.forEach((t=>c.addChild(t))),c}}},9808:(t,e,s)=>{const n=s(6788);t.exports={getAppDataPath:()=>{if(!process)return"";switch(process.platform){case"darwin":return n.join(process.env.HOME,"Library","Application Support","homegames");case"win32":return n.join(process.env.APPDATA,"homegames");case"linux":return n.join(process.env.HOME,".homegames");default:console.log("Unsupported platform!"),process.exit(1)}}}},3040:(t,e,s)=>{const{Homepad:n}=s(4464),o=new n,r={"0756":s(1204),"0762":s(9344),"0765":s(6756),"0766":s(7477),"0767":s(7728),1e3:s(4328),1004:s(9148),1005:s(9191),1006:s(7968)};let i,{squish:h,unsquish:a,Colors:l}=r["0766"];l=l.COLORS;const d=new Worker("socket.js"),c=document.getElementById("game"),u={};let f,y,p,g,x,E,A=!1;const S=()=>new Promise(((t,e)=>{const s=(()=>{const t=navigator.userAgent,e={};/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(t)?e.deviceType="tablet":/Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(t)?e.deviceType="mobile":navigator.maxTouchPoints&&navigator.maxTouchPoints>2?e.deviceType="tablet":e.deviceType="desktop";const s=window.innerWidth,n=window.innerHeight;let o=null;return s&&n&&(o=s/n),e.aspectRatio=o,e})(),n={clientInfo:s},o=new URLSearchParams(window.location.search);if(o.get("gameId")&&o.get("versionId")){const t=o.get("gameId"),e=o.get("versionId"),s=`${window.location.protocol}//${window.location.host}${window.location.pathname}`;window.history.pushState({path:s},"",s),n.requestedGame={gameId:t,versionId:e}}d.postMessage(n),t()})),m=t=>{if(t.data.constructor===Object){if("SOCKET_CLOSE"===t.data.type&&(A=!1),"ERROR"===t.data.type){A=!1;const e=document.createElement("div"),s=document.createElement("div");s.innerHTML="Error: "+t.data.message;const n=document.createElement("a");n.href="https://public.homegames.link/code",n.innerHTML="Try again",e.appendChild(s),e.appendChild(n),(t=>{const e=document.createElement("div");e.style.position="absolute",e.style.width="100vw;",e.style.top="0",e.style["text-align"]="center",e.style["font-size"]="10vw",e.appendChild(t),document.body.appendChild(e)})(e)}}else if(f=new Uint8ClampedArray(t.data),2==f[0]){if(window.playerId=f[1],2==f.length&&d.postMessage({type:"finishReady",playerId:window.playerId}),f.length>2){const t=f[2],e=f[3];y={x:t,y:e},i={x:f[4],y:f[5]},f[6];const s=String.fromCharCode.apply(null,f.slice(7,7+f[6]));window.squishVersion=s;const n=r[s];n&&(h=n.squish,a=n.unsquish,l=n.Colors),P()}}else if(1==f[0])M(f);else if(9==f[0])y={x:f[1],y:f[2]},P();else if(5===f[0]){x=!1;let t=String(f[1])+(String(f[2]).length>1?f[2]:"0"+f[2]);const e=window.serverCode?"public.homegames.link":window.location.hostname,s=window.serverCode?82:t;d.postMessage({socketInfo:{hostname:e,playerId:window.playerId||null,port:Number(s),secure:"localhost"!==window.location.host&&window.isSecureContext,serverCode:window.serverCode,spectating:x}})}else if(6===f[0]){x=!0;let t=String(f[1])+(String(f[2]).length>1?f[2]:"0"+f[2]);const e=window.serverCode?"public.homegames.link":window.location.hostname,s=window.serverCode?82:t;d.postMessage({socketInfo:{hostname:e,playerId:window.playerId||null,port:Number(s),secure:"localhost"!==window.location.host&&window.isSecureContext,serverCode:window.serverCode,spectating:x}})}else if(7===f[0])initPerformance();else if(8===f[0]){let t=String(f[1])+(String(f[2]).length>1?f[2]:"0"+f[2]);if(!E){const e=window.location.hostname;E=new WebSocket(`wss://${e}:${t}`),E.onopen=()=>{console.log("hot client opened")},E.onerror=t=>{console.log("hot client err"),console.log(t)},E.onmessage=t=>{"reload"===t.data&&location.reload()}}}else 3!=f[0]||A||(A=!0,B())};new Promise(((t,e)=>{fetch("/config.json").then((e=>{e.json().then((e=>{t(e)}))}))})).then((t=>{((t,e)=>{new Promise(((s,n)=>{const o=t.PUBLIC_GAME_HOST||"public.homegames.link",r=t.PUBLIC_GAME_PORT||82,i=t.HOME_PORT||7001,h=window.serverCode?o:window.location.hostname,a=window.serverCode?r:i;d.postMessage({socketInfo:{playerId:window.playerId||null,port:Number(a),secure:"localhost"!==window.location.host&&window.isSecureContext,serverCode:window.serverCode,spectating:x,hostname:h}}),d.onmessage=t=>{"SOCKET_READY"===t.data.type&&S().then((()=>{d.onmessage=e,s()}))}}))})(t,m)})),window.playerId=null;let C=!1;const L={};let T,_;const I={},w={},O=document.getElementById("homegames-main"),R=l.BLACK;O.style.background=`rgba(${R[0]}, ${R[1]}, ${R[2]}, ${R[3]})`;const N=c.getContext("2d",{alpha:!1}),P=()=>{const t=window.innerWidth,e=window.innerHeight;let s,n;if(t*y.y/y.x<=e){const t=window.innerWidth;n=t,s=Math.floor(t*(y.y/y.x))}else{const t=window.innerHeight;n=Math.floor(t*(y.x/y.y)),s=t}c.height=2*s,c.width=2*n,g=.5*c.width,clientHeight=.5*c.height,c.style.height=`${clientHeight}px`,c.style.width=`${g}px`},M=t=>{let e=0;for(;t&&e<t.length;)if(1===t[e]){const s=t[e+1];if(1===s){const s=String.fromCharCode.apply(null,t.slice(e+2,e+12)),n=parseInt(s,36),o=t.slice(e+12,e+12+32),r=t.slice(e+12+32,e+12+n),i=String.fromCharCode.apply(null,o.filter((t=>t)));let h="";for(let t=0;t<r.length;t++)h+=String.fromCharCode(r[t]);const a=btoa(h);I[i]={type:"image",data:"data:image/jpeg;base64,"+a},e+=12+n}else if(2===s){const s=String.fromCharCode.apply(null,t.slice(e+2,e+12)),n=parseInt(s,36),o=t.slice(e+12,e+12+32),r=t.slice(e+12+32,e+12+n),i=String.fromCharCode.apply(null,o.filter((t=>t)));T?T.decodeAudioData(r.buffer,(t=>{I[i]={type:"audio",data:t,decoded:!0}}),(t=>{console.log("unable to decode audio data"),console.log(t)})):I[i]={type:"audio",data:r.buffer,decoded:!1},e+=12+n}else if(3===s){const s=String.fromCharCode.apply(null,t.slice(e+2,e+12)),n=parseInt(s,36),o=t.slice(e+12,e+12+32),r=t.slice(e+12+32,e+12+n),i=String.fromCharCode.apply(null,o.filter((t=>t))),h=new FontFace(i,r);h&&h.load().then((t=>{document.fonts.add(t),I[i]={type:"font",data:t,name:i}})),e+=12+n}else console.error("Unknown asset type: "+s)}};let q,$,b=[];function G(t){const e=new Set(Object.keys(u));N.clearRect(0,0,c.width,c.height);let s=0;for(b=[];t&&s<t.length;){t[s];const n="0750"===window.squishVersion||"0751"===window.squishVersion?t[s+1]:t[s+1]+t[s+2]+t[s+3];let o=a(t.slice(s,s+n)).node;if(!o.coordinates2d&&o.input&&o.text){const t=Math.floor(c.width),e=o.text.size/100*t;N.font=e+"px sans-serif";const s=N.measureText(o.text.text);let n=o.text.x*c.width/100;o.text.align&&"center"==o.text.align&&(n-=s.width/2),n=n/c.width*100;const r=s.actualBoundingBoxDescent-s.actualBoundingBoxAscent,i=s.width/c.width*100,h=r/c.height*100,a=[!!o.handleClick,o.input&&o.input.type,o.id,[n,o.text.y,n+i,o.text.y,n+i,o.text.y+h,n,o.text.y+h,n,o.text.y]];b.push(a)}else if(null!==o.coordinates2d&&void 0!==o.coordinates2d){const t=[!!o.handleClick,o.input&&o.input.type,o.id,o.coordinates2d];if(b.push(t),o.effects&&o.effects.shadow){const t=o.effects.shadow.color;N.shadowColor="rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")",o.effects.shadow.blur&&(N.shadowBlur=o.effects.shadow.blur)}if(o.color&&(N.globalAlpha=o.color[3]/255),null!==o.fill&&void 0!==o.fill&&(N.fillStyle="rgba("+o.fill[0]+","+o.fill[1]+","+o.fill[2]+","+o.fill[3]+")"),void 0!==o.border&&null!==o.border&&(N.lineWidth=o.border/255*.1*c.width,N.strokeStyle="rgba("+o.color[0]+","+o.color[1]+","+o.color[2]+","+o.color[3]+")"),null!==o.coordinates2d&&void 0!==o.coordinates2d){N.beginPath();const t=o.coordinates2d[0];N.moveTo(t[0]*c.width/100,t[1]*c.height/100);for(let t=1;t<o.coordinates2d.length;t++){const e=o.coordinates2d[t];N.lineTo(c.width/100*e[0],e[1]*c.height/100)}void 0!==o.fill&&null!==o.fill&&N.fill(),void 0!==o.border&&null!==o.border&&N.stroke()}N.shadowColor=null,N.shadowBlur=0,N.lineWidth=0,N.strokeStyle=null}if(o.text){N.globalAlpha=o.text.color[3]/255,N.fillStyle=`rgba(${o.text.color[0]}, ${o.text.color[1]}, ${o.text.color[2]}, ${o.text.color[3]})`;const t=Math.floor(c.width),e=o.text.size/100*t;N.font=e+"px "+(o.text.font&&"default"!==o.text.font?o.text.font:"sans-serif"),o.text.align&&(N.textAlign=o.text.align),N.textBaseline="top",N.fillText(o.text.text,o.text.x*c.width/100,o.text.y*c.height/100)}if(o.asset){const t=Object.keys(o.asset)[0];if(I[t]&&"audio"===I[t].type)!u[t]&&T&&I[t].decoded?(_=T.createBufferSource(),_.connect(T.destination),_.buffer=I[t].data,_.onended=()=>{delete u[t]},_.start(0,o.asset[t].startTime||0),u[t]=_):!u[t]&&T?console.warn("Cant play audio"):u[t]&&e.delete(t);else{const e=o.asset[t];let s;if(w[t]&&"loading"!==w[t]){if(s=w[t],s.width=e.size.x/100*c.width,s.height=e.size.y/100*c.height,o.effects&&o.effects.shadow){const t=o.effects.shadow.color;N.shadowColor="rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")",o.effects.shadow.blur&&(N.shadowBlur=o.effects.shadow.blur)}N.drawImage(s,e.pos.x/100*c.width,e.pos.y/100*c.height,s.width,s.height)}else w[t]||(s=new Image(e.size.x/100*c.width,e.size.y/100*c.height),w[t]="loading",s.onload=()=>{if(w[t]=s,o.effects&&o.effects.shadow){const t=o.effects.shadow.color;N.shadowColor="rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")",o.effects.shadow.blur&&(N.shadowBlur=o.effects.shadow.blur)}N.drawImage(s,e.pos.x/100*c.width,e.pos.y/100*c.height,s.width,s.height)},I[t]&&(s.src=I[t].data))}}s+=n,N.shadowColor=null,N.shadowBlur=0,N.lineWidth=0,N.strokeStyle=null,N.globalAlpha=1}e.forEach((t=>{u[t].stop()}))}const U=()=>{q=o.getGamepads()};function B(){if(A){if(Object.keys(L).filter((t=>L[t])).forEach((t=>Y(t))),q&&q.length&&q.forEach((t=>{D(o.getGamepadState(t.index))})),p){const t=k(p[0],p[1]);C&&!$&&(H(t),$=setTimeout((()=>{$=null}),30)),t.isClickable||t.action?c.style.cursor="pointer":c.style.cursor="initial",p=null}f&&f.length>1&&3==f[0]&&G(f),window.requestAnimationFrame(B)}}window.addEventListener("gamepadconnected",U),window.addEventListener("gamepaddisconnected",U);const H=function(t={}){if(!p)return;const e=p[0],s=p[1],n=(e-c.offsetLeft)/g*100,o=s/clientHeight*100;if(t.action){if("text"===t.action){C=!1;const e=prompt("Input text");d.postMessage(JSON.stringify({type:"input",input:e,nodeId:t.nodeId}))}else if("file"===t.action){C=!1;const e=document.getElementById("file-input");e.click(),e.onchange=s=>{if(e.files.length>0){const s=new FileReader;s.onload=e=>{d.postMessage(JSON.stringify({type:"input",input:new Uint8Array(s.result),nodeId:t.nodeId}))},s.readAsArrayBuffer(e.files[0])}}}}else if(n<=100&&o<=100){const t={type:"click",data:{x:n,y:o}};d.postMessage(JSON.stringify(t))}},D=t=>{d.postMessage(JSON.stringify({type:"input",gamepad:!0,input:t}))},Y=function(t){const e={type:"keydown",key:t};d.postMessage(JSON.stringify(e))},v=()=>{if(!T){T=new(window.AudioContext||window.webkitAudioContext),"suspended"===T.state&&T.resume();for(const t in I)"audio"!==I[t].type||I[t].decoded||T.decodeAudioData(I[t].data,(e=>{I[t].data=e,I[t].decoded=!0}))}};document.addEventListener("touchstart",v,!1);const k=(t,e)=>{let s=!1,n=null,o=null;if(t<c.offsetLeft-window.scrollLeft)return!1;const r=t-c.offsetLeft-window.scrollX,h=e-window.scrollY,a=100*r/g,l=100*h/clientHeight,d=i.y/2,u=100-i.y/2,f=i.x/2,y=100-i.x/2;if(x&&a>f&&a<y&&l>d&&l<u)return!1;for(const r in b){const i=b[r];let h=i[3];if(!h||!h.length)continue;if(!h[0].length){let t=new Array(h.length/2);for(let e=0;e<h.length;e+=2)t[e/2]=[h[e],h[e+1]];h=t}let a=!1,l=F(h[0][0]),d=F(h[0][0]),c=K(h[0][1]),u=K(h[0][1]);for(let t=1;t<h.length;t++){const e=h[t];l=Math.min(F(e[0]),l),d=Math.max(F(e[0]),d),c=Math.min(K(e[1]),c),u=Math.max(K(e[1]),u)}if(!(t<l||t>d||e<c||e>u)){let s=0,n=h.length-1;for(;s<h.length;n=s++)K(h[s][1])>e!=K(h[n][1])>e&&t<(F(h[n][0])-F(h[s][0]))*(e-K(h[s][1]))/(K(h[n][1])-K(h[s][1]))+F(h[s][0])&&(a=!a)}a&&(s=i[0],n=i[1],o=i[2])}return{isClickable:s,action:n,nodeId:o}},F=t=>t*g/100+c.offsetLeft+window.scrollX,K=t=>t*clientHeight/100+c.offsetTop+window.scrollY;function z(t){return 1==t.key.length&&t.key>=" "&&t.key<="z"||t.keyCode>=36&&t.keyCode<=40||"Meta"===t.key||"Backspace"==t.key}window.addEventListener("mousedown",(function(t){C=!0,p=[t.clientX,t.clientY],v()})),window.addEventListener("mouseup",(function(t){C=!1,p=[t.clientX,t.clientY];const e={type:"mouseup",data:{x:(p[0]-c.offsetLeft)/g*100,y:p[1]/clientHeight*100}};d.postMessage(JSON.stringify(e))})),c.addEventListener("mousemove",(function(t){})),window.addEventListener("touchstart",(function(t){t.preventDefault(),C=!0,p=[t.touches[0].clientX+window.scrollX,t.touches[0].clientY+window.scrollY]})),c.addEventListener("touchmove",(function(t){t.preventDefault(),C=!0,p=[t.touches[0].clientX+window.scrollX,t.touches[0].clientY+window.scrollY]})),window.addEventListener("touchend",(()=>{C=!1})),/Android/i.test(navigator.userAgent)||(document.addEventListener("keydown",(function(t){z(t)&&!L.Meta&&(t.preventDefault(),Y(t.key),L[t.key]=!0)})),document.addEventListener("keyup",(function(t){z(t)&&(t.preventDefault(),function(t){const e={type:"keyup",key:t};d.postMessage(JSON.stringify(e))}(t.key),L[t.key]=!1)}))),window.addEventListener("mousemove",(t=>{p=[t.clientX+window.scrollX,t.clientY+window.scrollY]})),window.addEventListener("resize",(()=>{P(window.gameWidth,window.gameHeight),f&&f.length>1&&3==f[0]&&G(f),S()}))},6556:()=>{},4744:()=>{},3156:()=>{},7828:()=>{},7940:()=>{},5202:()=>{},9632:()=>{},2608:()=>{},3676:()=>{},6540:()=>{},2172:()=>{},7600:()=>{},4128:()=>{},6296:()=>{},3716:()=>{},4868:()=>{},4036:()=>{},6652:()=>{},548:()=>{},6544:()=>{},2984:()=>{},8980:()=>{},3184:()=>{},8360:()=>{},6636:()=>{},5376:()=>{},2348:()=>{},2588:()=>{},4700:()=>{},2512:()=>{},4352:()=>{},179:()=>{},1528:()=>{},6032:()=>{},6128:()=>{},7444:()=>{},596:()=>{},1508:()=>{},1272:()=>{},8371:()=>{},1268:()=>{},5712:()=>{},7748:()=>{},5740:()=>{},8776:()=>{},5380:()=>{},916:()=>{},512:()=>{},7804:()=>{},6008:()=>{},7028:()=>{},9572:()=>{},6788:()=>{},3560:()=>{}},e={};function s(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,s),r.exports}s.c=e,s(s.s=3040)})();